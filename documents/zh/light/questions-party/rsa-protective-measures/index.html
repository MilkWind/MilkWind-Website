<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/MilkWind-Website/_next/static/css/f034c804622acb16.css" data-precedence="next"/><link rel="stylesheet" href="/MilkWind-Website/_next/static/css/276b387d8ca46690.css" data-precedence="next"/><link rel="stylesheet" href="/MilkWind-Website/_next/static/css/5eacd01f773eed7f.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/MilkWind-Website/_next/static/chunks/webpack-1674c92fb524bcda.js"/><script src="/MilkWind-Website/_next/static/chunks/4bd1b696-5119e10e90c1bd1b.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/1684-794bcba02d6f7373.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/main-app-c5f95d71e93250dc.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/46-268e24d727b280ef.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/app/layout-af4a6e723c0ff668.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/app/error-dda32be1d095a86c.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/6874-fbe9a08eb79b991c.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/app/not-found-9ff98b2ccf24cac7.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/206-4f4cbf4d7156f437.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/app/documents/layout-28408791defde09e.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/2415-689c103fb3d2c28d.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/8610-7bd3f91f3cf2a4d6.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/app/documents/loading-1fa3f98b6e5a8e78.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/app/loading-68f227fb49b3ac8c.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/b498d07c-095637f0f10883c6.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/9554-b714f9de28e85d30.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/app/documents/%5B...slug%5D/page-8f3efa7e6c6c5377.js" async=""></script><title>密钥双刃剑：RSA加密在现代Web应用中的安全防护之道 | Interactive Portfolio</title><meta name="description" content="从数学原理到工程实践——解析Questions Party中的端到端加密实现"/><meta name="author" content="Developer"/><meta name="keywords" content="portfolio,3D,interactive,web development,Three.js,Next.js"/><meta property="og:title" content="密钥双刃剑：RSA加密在现代Web应用中的安全防护之道 | Interactive Portfolio"/><meta property="og:description" content="从数学原理到工程实践——解析Questions Party中的端到端加密实现"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2025-06-22"/><meta property="article:tag" content="RSA"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="密钥双刃剑：RSA加密在现代Web应用中的安全防护之道 | Interactive Portfolio"/><meta name="twitter:description" content="从数学原理到工程实践——解析Questions Party中的端到端加密实现"/><link rel="icon" href="/MilkWind-Website/favicon.ico" type="image/x-icon" sizes="32x32"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="/MilkWind-Website/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__variable_9b7fb1 __variable_ca2a15 __variable_591dcc font-sans antialiased min-h-screen bg-background text-foreground"><div class="fixed inset-0 w-full h-full overflow-hidden pointer-events-none z-0" style="background:linear-gradient(135deg, hsl(210, 80%, 60%), hsl(180, 40%, 50%))"></div><div class="fixed top-20 right-5 z-50"><div class="w-16 h-16 rounded-full backdrop-blur-md border animate-pulse bg-surface/60 border-surface/40"></div></div><!--$--><style>
:root {
  --bprogress-color: #0066cc;
  --bprogress-height: 4px;
  --bprogress-spinner-size: 18px;
  --bprogress-spinner-animation-duration: 400ms;
  --bprogress-spinner-border-size: 2px;
  --bprogress-box-shadow: 0 0 10px #0066cc, 0 0 5px #0066cc;
  --bprogress-z-index: 99999;
  --bprogress-spinner-top: 15px;
  --bprogress-spinner-bottom: auto;
  --bprogress-spinner-right: 15px;
  --bprogress-spinner-left: auto;
}

.bprogress {
  width: 0;
  height: 0;
  pointer-events: none;
  z-index: var(--bprogress-z-index);
}

.bprogress .bar {
  background: var(--bprogress-color);
  position: fixed;
  z-index: var(--bprogress-z-index);
  top: 0;
  left: 0;
  width: 100%;
  height: var(--bprogress-height);
}

/* Fancy blur effect */
.bprogress .peg {
  display: block;
  position: absolute;
  right: 0;
  width: 100px;
  height: 100%;
  box-shadow: var(--bprogress-box-shadow);
  opacity: 1.0;
  transform: rotate(3deg) translate(0px, -4px);
}

/* Remove these to get rid of the spinner */
.bprogress .spinner {
  display: block;
  position: fixed;
  z-index: var(--bprogress-z-index);
  top: var(--bprogress-spinner-top);
  bottom: var(--bprogress-spinner-bottom);
  right: var(--bprogress-spinner-right);
  left: var(--bprogress-spinner-left);
}

.bprogress .spinner-icon {
  width: var(--bprogress-spinner-size);
  height: var(--bprogress-spinner-size);
  box-sizing: border-box;
  border: solid var(--bprogress-spinner-border-size) transparent;
  border-top-color: var(--bprogress-color);
  border-left-color: var(--bprogress-color);
  border-radius: 50%;
  -webkit-animation: bprogress-spinner var(--bprogress-spinner-animation-duration) linear infinite;
  animation: bprogress-spinner var(--bprogress-spinner-animation-duration) linear infinite;
}

.bprogress-custom-parent {
  overflow: hidden;
  position: relative;
}

.bprogress-custom-parent .bprogress .spinner,
.bprogress-custom-parent .bprogress .bar {
  position: absolute;
}

.bprogress .indeterminate {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: var(--bprogress-height);
  overflow: hidden;
}

.bprogress .indeterminate .inc,
.bprogress .indeterminate .dec {
  position: absolute;
  top: 0;
  height: 100%;
  background-color: var(--bprogress-color);
}

.bprogress .indeterminate .inc {
  animation: bprogress-indeterminate-increase 2s infinite;
}

.bprogress .indeterminate .dec {
  animation: bprogress-indeterminate-decrease 2s 0.5s infinite;
}

@-webkit-keyframes bprogress-spinner {
  0%   { -webkit-transform: rotate(0deg); transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); transform: rotate(360deg); }
}

@keyframes bprogress-spinner {
  0%   { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

@keyframes bprogress-indeterminate-increase {
  from { left: -5%; width: 5%; }
  to { left: 130%; width: 100%; }
}

@keyframes bprogress-indeterminate-decrease {
  from { left: -80%; width: 80%; }
  to { left: 110%; width: 10%; }
}
</style><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--><!--$--><div class="relative z-30 min-h-screen bg-background "><div class="container mx-auto px-4 py-8 max-w-4xl"><div class="mb-8"><a class="inline-flex items-center text-primary hover:text-primary/80 transition-colors" href="/MilkWind-Website/documents/">documents.backToDocuments</a></div><header class="mb-12"><div class="flex items-center gap-4 mb-4 text-sm text-foreground/60"><span class="px-3 py-1 bg-primary/20 text-primary rounded-full capitalize">questions party</span><span>44 min read</span></div><h1 class="font-bold mb-4 bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent text-4xl md:text-5xl">密钥双刃剑：RSA加密在现代Web应用中的安全防护之道</h1><p class="text-xl text-foreground/80 max-w-3xl">从数学原理到工程实践——解析Questions Party中的端到端加密实现</p><div class="flex flex-wrap gap-2 mt-6"><span class="px-3 py-1 text-sm bg-accent/20 text-accent rounded-full">RSA</span></div></header><article class="prose prose-headings:mt-8 prose-headings:font-semibold prose-headings:text-foreground prose-h1:text-5xl prose-h2:text-4xl prose-h3:text-3xl prose-h4:text-2xl prose-h5:text-xl prose-h6:text-lg max-w-none "><div class="prose-pre:p-4 prose-pre:bg-surface w-full"><h1 id="密钥双刃剑：rsa加密在现代web应用中的安全防护之道" class="group relative text-4xl font-bold mt-8 mb-4 text-foreground leading-tight">
            <a href="#密钥双刃剑：rsa加密在现代web应用中的安全防护之道" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 密钥双刃剑：RSA加密在现代Web应用中的安全防护之道">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            密钥双刃剑：RSA加密在现代Web应用中的安全防护之道
        </h1>
<p class="text-base leading-7 mb-4 text-foreground">在密码学的长河中，如果说对称加密是一把精密的锁，那么非对称加密就是一把神奇的双刃剑——一面可以加密，一面可以解密，却永远不会伤到持剑者。</p>
<p class="text-base leading-7 mb-4 text-foreground">回想起那个信息安全刚刚起步的年代，开发者们还在为如何安全地传输API密钥而头疼不已。明文传输？那是在裸奔。对称加密？密钥分发又成了新的难题。直到RSA算法的出现，才真正解决了这个看似无解的密钥分发问题。</p>
<p class="text-base leading-7 mb-4 text-foreground">本文将深入解析Questions Party项目中RSA加密的完整实现，从数学原理到工程实践，从密钥生成到数据传输，带你看透这把&quot;密钥双刃剑&quot;的真正威力。</p>
<h2 id="rsa算法的数学基础" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#rsa算法的数学基础" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to RSA算法的数学基础">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            RSA算法的数学基础
        </h2>
<h3 id="大数分解的数学难题" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#大数分解的数学难题" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 大数分解的数学难题">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            大数分解的数学难题
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">RSA算法的安全性建立在一个看似简单却极其困难的数学问题上：<strong class="font-bold text-foreground">大整数的素因数分解</strong>。</p>
<p class="text-base leading-7 mb-4 text-foreground">给你两个大质数相乘很容易：<br class="block">
<span class="katex-display inline"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>p</mi><mo>=</mo><mn>61</mn><mo separator="true">,</mo><mi>q</mi><mo>=</mo><mn>53</mn></mrow><annotation encoding="application/x-tex">p = 61, q = 53</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal inline">p</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord inline">61</span><span class="mpunct inline">,</span><span class="mspace inline" style="margin-right:0.1667em;"></span><span class="mord mathnormal inline" style="margin-right:0.03588em;">q</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">53</span></span></span></span></span><br class="block">
<span class="katex-display inline"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>n</mi><mo>=</mo><mi>p</mi><mo>×</mo><mi>q</mi><mo>=</mo><mn>61</mn><mo>×</mo><mn>53</mn><mo>=</mo><mn>3233</mn></mrow><annotation encoding="application/x-tex">n = p \times q = 61 \times 53 = 3233</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline">n</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal inline">p</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">×</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal inline" style="margin-right:0.03588em;">q</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord inline">61</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">×</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">53</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">3233</span></span></span></span></span></p>
<p class="text-base leading-7 mb-4 text-foreground">但如果我现在告诉你 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>3233</mn></mrow><annotation encoding="application/x-tex">n = 3233</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline">n</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">3233</span></span></span></span>，让你找出 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal inline">p</span></span></span></span> 和 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal inline" style="margin-right:0.03588em;">q</span></span></span></span>，你可能需要试很多次才能找到答案。</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">现在想象一下，如果 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal inline">p</span></span></span></span> 和 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal inline" style="margin-right:0.03588em;">q</span></span></span></span> 都是1024位的质数…</strong></p>
<p class="text-base leading-7 mb-4 text-foreground">这就是RSA的核心思想：<strong class="font-bold text-foreground">正向计算简单，逆向计算困难</strong>。</p>
<h3 id="欧拉函数和模运算" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#欧拉函数和模运算" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 欧拉函数和模运算">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            欧拉函数和模运算
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">RSA算法的关键在于欧拉函数 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\phi(n)</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal inline">ϕ</span><span class="mopen inline">(</span><span class="mord mathnormal inline">n</span><span class="mclose inline">)</span></span></span></span>：</p>
<p class="text-base leading-7 mb-4 text-foreground"><span class="katex-display inline"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mi>ϕ</mi><mo stretchy="false">(</mo><mi>p</mi><mo>×</mo><mi>q</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>q</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\phi(n) = \phi(p \times q) = (p-1)(q-1)</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal inline">ϕ</span><span class="mopen inline">(</span><span class="mord mathnormal inline">n</span><span class="mclose inline">)</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal inline">ϕ</span><span class="mopen inline">(</span><span class="mord mathnormal inline">p</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">×</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal inline" style="margin-right:0.03588em;">q</span><span class="mclose inline">)</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen inline">(</span><span class="mord mathnormal inline">p</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">−</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord inline">1</span><span class="mclose inline">)</span><span class="mopen inline">(</span><span class="mord mathnormal inline" style="margin-right:0.03588em;">q</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">−</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord inline">1</span><span class="mclose inline">)</span></span></span></span></span></p>
<p class="text-base leading-7 mb-4 text-foreground">继续我们的例子：<br class="block">
<span class="katex-display inline"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>ϕ</mi><mo stretchy="false">(</mo><mn>3233</mn><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mn>61</mn><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mn>53</mn><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>=</mo><mn>60</mn><mo>×</mo><mn>52</mn><mo>=</mo><mn>3120</mn></mrow><annotation encoding="application/x-tex">\phi(3233) = (61-1)(53-1) = 60 \times 52 = 3120</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal inline">ϕ</span><span class="mopen inline">(</span><span class="mord inline">3233</span><span class="mclose inline">)</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen inline">(</span><span class="mord inline">61</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">−</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord inline">1</span><span class="mclose inline">)</span><span class="mopen inline">(</span><span class="mord inline">53</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">−</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord inline">1</span><span class="mclose inline">)</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord inline">60</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">×</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">52</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">3120</span></span></span></span></span></p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">为什么要计算欧拉函数？</strong>因为它告诉我们在模 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline">n</span></span></span></span> 意义下，有多少个数与 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline">n</span></span></span></span> 互质。</p>
<h3 id="公钥私钥的数学生成过程" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#公钥私钥的数学生成过程" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 公钥私钥的数学生成过程">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            公钥私钥的数学生成过程
        </h3>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">第一步：选择公钥指数 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline">e</span></span></span></span></strong></p>
<p class="text-base leading-7 mb-4 text-foreground">这里举一个小例子，选择 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo>=</mo><mn>17</mn></mrow><annotation encoding="application/x-tex">e = 17</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline">e</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">17</span></span></span></span>，它满足RSA的条件：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed">1 &lt; e &lt; φ(n)，即 1 &lt; 17 &lt; 3120 ✓</li>
<li class="text-foreground leading-relaxed">gcd(17, 3120) = 1，即17与3120互质 ✓</li>
</ul>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">注意</strong>：在实际应用中通常选择 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo>=</mo><mn>65537</mn></mrow><annotation encoding="application/x-tex">e = 65537</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline">e</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">65537</span></span></span></span>，但那需要更大的质数使得 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\phi(n)</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal inline">ϕ</span><span class="mopen inline">(</span><span class="mord mathnormal inline">n</span><span class="mclose inline">)</span></span></span></span> 远大于65537。</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">第二步：计算私钥指数 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.6944em;"></span><span class="mord mathnormal inline">d</span></span></span></span></strong></p>
<p class="text-base leading-7 mb-4 text-foreground">需要满足：<br class="block">
<span class="katex-display inline"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>e</mi><mo>×</mo><mi>d</mi><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width="1em"/><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mspace width="0.3333em"/><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">e \times d \equiv 1 \pmod{\phi(n)}</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal inline">e</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">×</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6944em;"></span><span class="mord mathnormal inline">d</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">≡</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">1</span><span class="mspace allowbreak inline"></span><span class="mspace inline" style="margin-right:1em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen inline">(</span><span class="mord inline"><span class="mord inline"><span class="mord mathrm inline">mod</span></span></span><span class="mspace inline" style="margin-right:0.3333em;"></span><span class="mord mathnormal inline">ϕ</span><span class="mopen inline">(</span><span class="mord mathnormal inline">n</span><span class="mclose inline">))</span></span></span></span></span></p>
<p class="text-base leading-7 mb-4 text-foreground">用我们的例子：<br class="block">
<span class="katex-display inline"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>17</mn><mo>×</mo><mi>d</mi><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width="1em"/><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mspace width="0.3333em"/><mn>3120</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">17 \times d \equiv 1 \pmod{3120}</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord inline">17</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">×</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6944em;"></span><span class="mord mathnormal inline">d</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">≡</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">1</span><span class="mspace allowbreak inline"></span><span class="mspace inline" style="margin-right:1em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen inline">(</span><span class="mord inline"><span class="mord inline"><span class="mord mathrm inline">mod</span></span></span><span class="mspace inline" style="margin-right:0.3333em;"></span><span class="mord inline">3120</span><span class="mclose inline">)</span></span></span></span></span></p>
<p class="text-base leading-7 mb-4 text-foreground">通过扩展欧几里得算法，可以计算出 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>=</mo><mn>2753</mn></mrow><annotation encoding="application/x-tex">d = 2753</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.6944em;"></span><span class="mord mathnormal inline">d</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">2753</span></span></span></span>。</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">验证</strong>：<span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>17</mn><mo>×</mo><mn>2753</mn><mo>=</mo><mn>46801</mn></mrow><annotation encoding="application/x-tex">17 \times 2753 = 46801</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord inline">17</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">×</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">2753</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">46801</span></span></span></span>，<span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>46801</mn><mo>=</mo><mn>15</mn><mo>×</mo><mn>3120</mn><mo>+</mo><mn>1</mn><mo>=</mo><mn>46800</mn><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">46801 = 15 \times 3120 + 1 = 46800 + 1</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">46801</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord inline">15</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">×</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord inline">3120</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">+</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">1</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord inline">46800</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">+</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">1</span></span></span></span>，所以 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>17</mn><mo>×</mo><mn>2753</mn><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width="0.4444em"/><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mspace width="0.3333em"/><mn>3120</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">17 \times 2753 \equiv 1 \pmod{3120}</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord inline">17</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">×</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">2753</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">≡</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">1</span><span class="mspace allowbreak inline"></span><span class="mspace inline" style="margin-right:0.4444em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen inline">(</span><span class="mord inline"><span class="mord inline"><span class="mord mathrm inline">mod</span></span></span><span class="mspace inline" style="margin-right:0.3333em;"></span><span class="mord inline">3120</span><span class="mclose inline">)</span></span></span></span> ✓</p>
<h3 id="扩展欧几里得算法详解" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#扩展欧几里得算法详解" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 扩展欧几里得算法详解">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            扩展欧几里得算法详解
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">扩展欧几里得算法是求解线性丢番图方程 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>x</mi><mo>+</mo><mi>b</mi><mi>y</mi><mo>=</mo><mi>gcd</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">ax + by = \gcd(a,b)</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal inline">a</span><span class="mord mathnormal inline">x</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">+</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal inline">b</span><span class="mord mathnormal inline" style="margin-right:0.03588em;">y</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mop inline"><span style="margin-right:0.01389em;" class="inline">g</span>cd</span><span class="mopen inline">(</span><span class="mord mathnormal inline">a</span><span class="mpunct inline">,</span><span class="mspace inline" style="margin-right:0.1667em;"></span><span class="mord mathnormal inline">b</span><span class="mclose inline">)</span></span></span></span> 的经典算法。在RSA中，我们需要求解：</p>
<p class="text-base leading-7 mb-4 text-foreground"><span class="katex-display inline"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>e</mi><mo>⋅</mo><mi>d</mi><mo>+</mo><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>k</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">e \cdot d + \phi(n) \cdot k = 1</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4445em;"></span><span class="mord mathnormal inline">e</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">⋅</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal inline">d</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">+</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal inline">ϕ</span><span class="mopen inline">(</span><span class="mord mathnormal inline">n</span><span class="mclose inline">)</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">⋅</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6944em;"></span><span class="mord mathnormal inline" style="margin-right:0.03148em;">k</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">1</span></span></span></span></span></p>
<p class="text-base leading-7 mb-4 text-foreground">即找到 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.6944em;"></span><span class="mord mathnormal inline">d</span></span></span></span> 和 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.6944em;"></span><span class="mord mathnormal inline" style="margin-right:0.03148em;">k</span></span></span></span>，使得 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo>⋅</mo><mi>d</mi><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width="0.4444em"/><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mspace width="0.3333em"/><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">e \cdot d \equiv 1 \pmod{\phi(n)}</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4445em;"></span><span class="mord mathnormal inline">e</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">⋅</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6944em;"></span><span class="mord mathnormal inline">d</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">≡</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">1</span><span class="mspace allowbreak inline"></span><span class="mspace inline" style="margin-right:0.4444em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen inline">(</span><span class="mord inline"><span class="mord inline"><span class="mord mathrm inline">mod</span></span></span><span class="mspace inline" style="margin-right:0.3333em;"></span><span class="mord mathnormal inline">ϕ</span><span class="mopen inline">(</span><span class="mord mathnormal inline">n</span><span class="mclose inline">))</span></span></span></span>。</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">算法步骤</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">以我们的例子为例，求解 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>17</mn><mo>⋅</mo><mi>d</mi><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width="0.4444em"/><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mspace width="0.3333em"/><mn>3120</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">17 \cdot d \equiv 1 \pmod{3120}</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">17</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">⋅</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6944em;"></span><span class="mord mathnormal inline">d</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">≡</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">1</span><span class="mspace allowbreak inline"></span><span class="mspace inline" style="margin-right:0.4444em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen inline">(</span><span class="mord inline"><span class="mord inline"><span class="mord mathrm inline">mod</span></span></span><span class="mspace inline" style="margin-right:0.3333em;"></span><span class="mord inline">3120</span><span class="mclose inline">)</span></span></span></span>：</p>
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">初始化</strong>：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mn>0</mn></msub><mo>=</mo><mn>3120</mn><mo separator="true">,</mo><msub><mi>r</mi><mn>1</mn></msub><mo>=</mo><mn>17</mn></mrow><annotation encoding="application/x-tex">r_0 = 3120, r_1 = 17</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord inline"><span class="mord mathnormal inline" style="margin-right:0.02778em;">r</span><span class="msupsub inline"><span class="vlist-t vlist-t2 inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline">0</span></span></span></span><span class="vlist-s inline">​</span></span><span class="vlist-r inline"><span class="vlist inline" style="height:0.15em;"><span class="inline"></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord inline">3120</span><span class="mpunct inline">,</span><span class="mspace inline" style="margin-right:0.1667em;"></span><span class="mord inline"><span class="mord mathnormal inline" style="margin-right:0.02778em;">r</span><span class="msupsub inline"><span class="vlist-t vlist-t2 inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline">1</span></span></span></span><span class="vlist-s inline">​</span></span><span class="vlist-r inline"><span class="vlist inline" style="height:0.15em;"><span class="inline"></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">17</span></span></span></span></li>
<li class="text-foreground leading-relaxed"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mn>0</mn></msub><mo>=</mo><mn>1</mn><mo separator="true">,</mo><msub><mi>s</mi><mn>1</mn></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">s_0 = 1, s_1 = 0</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord inline"><span class="mord mathnormal inline">s</span><span class="msupsub inline"><span class="vlist-t vlist-t2 inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline">0</span></span></span></span><span class="vlist-s inline">​</span></span><span class="vlist-r inline"><span class="vlist inline" style="height:0.15em;"><span class="inline"></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord inline">1</span><span class="mpunct inline">,</span><span class="mspace inline" style="margin-right:0.1667em;"></span><span class="mord inline"><span class="mord mathnormal inline">s</span><span class="msupsub inline"><span class="vlist-t vlist-t2 inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline">1</span></span></span></span><span class="vlist-s inline">​</span></span><span class="vlist-r inline"><span class="vlist inline" style="height:0.15em;"><span class="inline"></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">0</span></span></span></span></li>
<li class="text-foreground leading-relaxed"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn><mo separator="true">,</mo><msub><mi>t</mi><mn>1</mn></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t_0 = 0, t_1 = 1</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord inline"><span class="mord mathnormal inline">t</span><span class="msupsub inline"><span class="vlist-t vlist-t2 inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline">0</span></span></span></span><span class="vlist-s inline">​</span></span><span class="vlist-r inline"><span class="vlist inline" style="height:0.15em;"><span class="inline"></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord inline">0</span><span class="mpunct inline">,</span><span class="mspace inline" style="margin-right:0.1667em;"></span><span class="mord inline"><span class="mord mathnormal inline">t</span><span class="msupsub inline"><span class="vlist-t vlist-t2 inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline">1</span></span></span></span><span class="vlist-s inline">​</span></span><span class="vlist-r inline"><span class="vlist inline" style="height:0.15em;"><span class="inline"></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">1</span></span></span></span></li>
</ul></li>
<li class="text-foreground leading-relaxed"><p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">迭代过程</strong>：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="" data-code="%E7%AC%AC1%E6%AD%A5%EF%BC%9Aq%E2%82%81%20%3D%20%E2%8C%8A3120%2F17%E2%8C%8B%20%3D%20183%0Ar%E2%82%82%20%3D%203120%20-%20183%C3%9717%20%3D%203120%20-%203111%20%3D%209%0As%E2%82%82%20%3D%201%20-%20183%C3%970%20%3D%201%0At%E2%82%82%20%3D%200%20-%20183%C3%971%20%3D%20-183%0A%E7%AC%AC2%E6%AD%A5%EF%BC%9Aq%E2%82%82%20%3D%20%E2%8C%8A17%2F9%E2%8C%8B%20%3D%201%0Ar%E2%82%83%20%3D%2017%20-%201%C3%979%20%3D%208%0As%E2%82%83%20%3D%200%20-%201%C3%971%20%3D%20-1%0At%E2%82%83%20%3D%201%20-%201%C3%97(-183)%20%3D%20184%0A%E7%AC%AC3%E6%AD%A5%EF%BC%9Aq%E2%82%83%20%3D%20%E2%8C%8A9%2F8%E2%8C%8B%20%3D%201%0Ar%E2%82%84%20%3D%209%20-%201%C3%978%20%3D%201%0As%E2%82%84%20%3D%201%20-%201%C3%97(-1)%20%3D%202%0At%E2%82%84%20%3D%20-183%20-%201%C3%97184%20%3D%20-367%0A%E7%AC%AC4%E6%AD%A5%EF%BC%9Ar%E2%82%84%20%3D%201%EF%BC%8C%E7%AE%97%E6%B3%95%E7%BB%93%E6%9D%9F">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">code</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code>第<span class="hljs-number inline">1</span>步：q₁ <span class="hljs-operator inline">=</span> ⌊<span class="hljs-number inline">3120</span>/<span class="hljs-number inline">17</span>⌋ <span class="hljs-operator inline">=</span> <span class="hljs-number inline">183</span>
r₂ <span class="hljs-operator inline">=</span> <span class="hljs-number inline">3120</span> - <span class="hljs-number inline">183</span>×<span class="hljs-number inline">17</span> <span class="hljs-operator inline">=</span> <span class="hljs-number inline">3120</span> - <span class="hljs-number inline">3111</span> <span class="hljs-operator inline">=</span> <span class="hljs-number inline">9</span>
s₂ <span class="hljs-operator inline">=</span> <span class="hljs-number inline">1</span> - <span class="hljs-number inline">183</span>×<span class="hljs-number inline">0</span> <span class="hljs-operator inline">=</span> <span class="hljs-number inline">1</span>
t₂ <span class="hljs-operator inline">=</span> <span class="hljs-number inline">0</span> - <span class="hljs-number inline">183</span>×<span class="hljs-number inline">1</span> <span class="hljs-operator inline">=</span> -<span class="hljs-number inline">183</span>

第<span class="hljs-number inline">2</span>步：q₂ <span class="hljs-operator inline">=</span> ⌊<span class="hljs-number inline">17</span>/<span class="hljs-number inline">9</span>⌋ <span class="hljs-operator inline">=</span> <span class="hljs-number inline">1</span>
r₃ <span class="hljs-operator inline">=</span> <span class="hljs-number inline">17</span> - <span class="hljs-number inline">1</span>×<span class="hljs-number inline">9</span> <span class="hljs-operator inline">=</span> <span class="hljs-number inline">8</span>
s₃ <span class="hljs-operator inline">=</span> <span class="hljs-number inline">0</span> - <span class="hljs-number inline">1</span>×<span class="hljs-number inline">1</span> <span class="hljs-operator inline">=</span> -<span class="hljs-number inline">1</span>
t₃ <span class="hljs-operator inline">=</span> <span class="hljs-number inline">1</span> - <span class="hljs-number inline">1</span>×(-<span class="hljs-number inline">183</span>) <span class="hljs-operator inline">=</span> <span class="hljs-number inline">184</span>

第<span class="hljs-number inline">3</span>步：q₃ <span class="hljs-operator inline">=</span> ⌊<span class="hljs-number inline">9</span>/<span class="hljs-number inline">8</span>⌋ <span class="hljs-operator inline">=</span> <span class="hljs-number inline">1</span>
r₄ <span class="hljs-operator inline">=</span> <span class="hljs-number inline">9</span> - <span class="hljs-number inline">1</span>×<span class="hljs-number inline">8</span> <span class="hljs-operator inline">=</span> <span class="hljs-number inline">1</span>
s₄ <span class="hljs-operator inline">=</span> <span class="hljs-number inline">1</span> - <span class="hljs-number inline">1</span>×(-<span class="hljs-number inline">1</span>) <span class="hljs-operator inline">=</span> <span class="hljs-number inline">2</span>
t₄ <span class="hljs-operator inline">=</span> -<span class="hljs-number inline">183</span> - <span class="hljs-number inline">1</span>×<span class="hljs-number inline">184</span> <span class="hljs-operator inline">=</span> -<span class="hljs-number inline">367</span>

第<span class="hljs-number inline">4</span>步：r₄ <span class="hljs-operator inline">=</span> <span class="hljs-number inline">1</span>，算法结束
</code></pre>
            </div>
        </li>
<li class="text-foreground leading-relaxed"><p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">最终结果</strong>：<br class="block">
当 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mn>4</mn></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">r_4 = 1</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord inline"><span class="mord mathnormal inline" style="margin-right:0.02778em;">r</span><span class="msupsub inline"><span class="vlist-t vlist-t2 inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline">4</span></span></span></span><span class="vlist-s inline">​</span></span><span class="vlist-r inline"><span class="vlist inline" style="height:0.15em;"><span class="inline"></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">1</span></span></span></span> 时，对应的 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mn>4</mn></msub><mo>=</mo><mo>−</mo><mn>367</mn></mrow><annotation encoding="application/x-tex">t_4 = -367</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord inline"><span class="mord mathnormal inline">t</span><span class="msupsub inline"><span class="vlist-t vlist-t2 inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline">4</span></span></span></span><span class="vlist-s inline">​</span></span><span class="vlist-r inline"><span class="vlist inline" style="height:0.15em;"><span class="inline"></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord inline">−</span><span class="mord inline">367</span></span></span></span>。</p>
<p class="text-base leading-7 mb-4 text-foreground">由于我们需要正数，所以 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>=</mo><mo>−</mo><mn>367</mn><mo>+</mo><mn>3120</mn><mo>=</mo><mn>2753</mn></mrow><annotation encoding="application/x-tex">d = -367 + 3120 = 2753</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.6944em;"></span><span class="mord mathnormal inline">d</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord inline">−</span><span class="mord inline">367</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">+</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">3120</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">2753</span></span></span></span>。</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">验证</strong>：<span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>17</mn><mo>×</mo><mn>2753</mn><mo>=</mo><mn>46801</mn><mo>=</mo><mn>15</mn><mo>×</mo><mn>3120</mn><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">17 \times 2753 = 46801 = 15 \times 3120 + 1</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord inline">17</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">×</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">2753</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">46801</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord inline">15</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">×</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord inline">3120</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">+</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">1</span></span></span></span>，确实 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>17</mn><mo>×</mo><mn>2753</mn><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width="0.4444em"/><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mspace width="0.3333em"/><mn>3120</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">17 \times 2753 \equiv 1 \pmod{3120}</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord inline">17</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">×</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">2753</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">≡</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">1</span><span class="mspace allowbreak inline"></span><span class="mspace inline" style="margin-right:0.4444em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen inline">(</span><span class="mord inline"><span class="mord inline"><span class="mord mathrm inline">mod</span></span></span><span class="mspace inline" style="margin-right:0.3333em;"></span><span class="mord inline">3120</span><span class="mclose inline">)</span></span></span></span> ✓</p></li>
</ol>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">算法的数学原理</strong>：<br class="block">
扩展欧几里得算法基于这样的事实：如果 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>gcd</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>e</mi><mo separator="true">,</mo><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\gcd(e, \phi(n)) = 1</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mop inline"><span style="margin-right:0.01389em;" class="inline">g</span>cd</span><span class="mopen inline">(</span><span class="mord mathnormal inline">e</span><span class="mpunct inline">,</span><span class="mspace inline" style="margin-right:0.1667em;"></span><span class="mord mathnormal inline">ϕ</span><span class="mopen inline">(</span><span class="mord mathnormal inline">n</span><span class="mclose inline">))</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">1</span></span></span></span>，那么一定存在整数 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.6944em;"></span><span class="mord mathnormal inline">d</span></span></span></span> 和 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.6944em;"></span><span class="mord mathnormal inline" style="margin-right:0.03148em;">k</span></span></span></span>，使得：<br class="block">
<span class="katex-display inline"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>e</mi><mo>⋅</mo><mi>d</mi><mo>+</mo><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>k</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">e \cdot d + \phi(n) \cdot k = 1</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4445em;"></span><span class="mord mathnormal inline">e</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">⋅</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal inline">d</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">+</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal inline">ϕ</span><span class="mopen inline">(</span><span class="mord mathnormal inline">n</span><span class="mclose inline">)</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">⋅</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6944em;"></span><span class="mord mathnormal inline" style="margin-right:0.03148em;">k</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">1</span></span></span></span></span></p>
<p class="text-base leading-7 mb-4 text-foreground">这等价于：<br class="block">
<span class="katex-display inline"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>e</mi><mo>⋅</mo><mi>d</mi><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width="1em"/><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mspace width="0.3333em"/><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">e \cdot d \equiv 1 \pmod{\phi(n)}</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4445em;"></span><span class="mord mathnormal inline">e</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">⋅</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6944em;"></span><span class="mord mathnormal inline">d</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">≡</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">1</span><span class="mspace allowbreak inline"></span><span class="mspace inline" style="margin-right:1em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen inline">(</span><span class="mord inline"><span class="mord inline"><span class="mord mathrm inline">mod</span></span></span><span class="mspace inline" style="margin-right:0.3333em;"></span><span class="mord mathnormal inline">ϕ</span><span class="mopen inline">(</span><span class="mord mathnormal inline">n</span><span class="mclose inline">))</span></span></span></span></span></p>
<p class="text-base leading-7 mb-4 text-foreground">即 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.6944em;"></span><span class="mord mathnormal inline">d</span></span></span></span> 是 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline">e</span></span></span></span> 在模 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\phi(n)</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal inline">ϕ</span><span class="mopen inline">(</span><span class="mord mathnormal inline">n</span><span class="mclose inline">)</span></span></span></span> 意义下的<strong class="font-bold text-foreground">模逆元</strong>。</p>
<h3 id="加密解密的数学原理" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#加密解密的数学原理" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 加密解密的数学原理">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            加密解密的数学原理
        </h3>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">符号说明</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">让我们首先明确每个数学符号的含义：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline">m</span></span></span></span></strong> (message)：<strong class="font-bold text-foreground">明文消息</strong>，需要加密的原始数据，必须满足 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>≤</mo><mi>m</mi><mo>&lt;</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">0 \leq m &lt; n</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord inline">0</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">≤</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal inline">m</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">&lt;</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline">n</span></span></span></span></li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline">c</span></span></span></span></strong> (ciphertext)：<strong class="font-bold text-foreground">密文</strong>，加密后的数据</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline">e</span></span></span></span></strong> (encryption exponent)：<strong class="font-bold text-foreground">公钥指数</strong>，在我们的例子中是17，在实际应用中通常是65537</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.6944em;"></span><span class="mord mathnormal inline">d</span></span></span></span></strong> (decryption exponent)：<strong class="font-bold text-foreground">私钥指数</strong>，是e在模φ(n)下的模逆元，在我们的例子中是2753</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline">n</span></span></span></span></strong>：<strong class="font-bold text-foreground">模数</strong>，等于两个大质数的乘积，即 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mi>p</mi><mo>×</mo><mi>q</mi></mrow><annotation encoding="application/x-tex">n = p \times q</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline">n</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal inline">p</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">×</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal inline" style="margin-right:0.03588em;">q</span></span></span></span></li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\phi(n)</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal inline">ϕ</span><span class="mopen inline">(</span><span class="mord mathnormal inline">n</span><span class="mclose inline">)</span></span></span></span></strong>：<strong class="font-bold text-foreground">欧拉函数值</strong>，等于 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>q</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(p-1)(q-1)</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen inline">(</span><span class="mord mathnormal inline">p</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">−</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord inline">1</span><span class="mclose inline">)</span><span class="mopen inline">(</span><span class="mord mathnormal inline" style="margin-right:0.03588em;">q</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">−</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord inline">1</span><span class="mclose inline">)</span></span></span></span>，表示小于n且与n互质的正整数个数</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.6944em;"></span><span class="mord mathnormal inline" style="margin-right:0.03148em;">k</span></span></span></span></strong>：<strong class="font-bold text-foreground">任意整数</strong>，在数学证明中出现的辅助变量</li>
</ul>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">加密过程</strong>：<br class="block">
<span class="katex-display inline"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>c</mi><mo>=</mo><msup><mi>m</mi><mi>e</mi></msup><mtext> </mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext> </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">c = m^e \bmod n</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline">c</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.7144em;"></span><span class="mord inline"><span class="mord mathnormal inline">m</span><span class="msupsub inline"><span class="vlist-t inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mathnormal mtight inline">e</span></span></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.0556em;"></span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline"><span class="mord inline"><span class="mord mathrm inline">mod</span></span></span><span class="mspace inline" style="margin-right:0.0556em;"></span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline">n</span></span></span></span></span></p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">解密过程</strong>：<br class="block">
<span class="katex-display inline"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>m</mi><mo>=</mo><msup><mi>c</mi><mi>d</mi></msup><mtext> </mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext> </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">m = c^d \bmod n</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline">m</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.8991em;"></span><span class="mord inline"><span class="mord mathnormal inline">c</span><span class="msupsub inline"><span class="vlist-t inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mathnormal mtight inline">d</span></span></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.0556em;"></span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline"><span class="mord inline"><span class="mord mathrm inline">mod</span></span></span><span class="mspace inline" style="margin-right:0.0556em;"></span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline">n</span></span></span></span></span></p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">RSA正确性的数学证明</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">第一步：应用欧拉定理</strong><br class="block">
根据欧拉定理，对于互质的 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline">m</span></span></span></span> 和 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline">n</span></span></span></span>（即 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>gcd</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>m</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\gcd(m,n) = 1</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mop inline"><span style="margin-right:0.01389em;" class="inline">g</span>cd</span><span class="mopen inline">(</span><span class="mord mathnormal inline">m</span><span class="mpunct inline">,</span><span class="mspace inline" style="margin-right:0.1667em;"></span><span class="mord mathnormal inline">n</span><span class="mclose inline">)</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">1</span></span></span></span>）：<br class="block">
<span class="katex-display inline"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>m</mi><mrow><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></msup><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width="1em"/><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mspace width="0.3333em"/><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">m^{\phi(n)} \equiv 1 \pmod{n}</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.938em;"></span><span class="mord inline"><span class="mord mathnormal inline">m</span><span class="msupsub inline"><span class="vlist-t inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline"><span class="mord mathnormal mtight inline">ϕ</span><span class="mopen mtight inline">(</span><span class="mord mathnormal mtight inline">n</span><span class="mclose mtight inline">)</span></span></span></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">≡</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">1</span><span class="mspace allowbreak inline"></span><span class="mspace inline" style="margin-right:1em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen inline">(</span><span class="mord inline"><span class="mord inline"><span class="mord mathrm inline">mod</span></span></span><span class="mspace inline" style="margin-right:0.3333em;"></span><span class="mord mathnormal inline">n</span><span class="mclose inline">)</span></span></span></span></span></p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">第二步：利用私钥的定义</strong><br class="block">
由于 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.6944em;"></span><span class="mord mathnormal inline">d</span></span></span></span> 是 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline">e</span></span></span></span> 的模逆元，我们有：<br class="block">
<span class="katex-display inline"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>e</mi><mo>⋅</mo><mi>d</mi><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width="1em"/><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mspace width="0.3333em"/><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">e \cdot d \equiv 1 \pmod{\phi(n)}</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4445em;"></span><span class="mord mathnormal inline">e</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">⋅</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6944em;"></span><span class="mord mathnormal inline">d</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">≡</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">1</span><span class="mspace allowbreak inline"></span><span class="mspace inline" style="margin-right:1em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen inline">(</span><span class="mord inline"><span class="mord inline"><span class="mord mathrm inline">mod</span></span></span><span class="mspace inline" style="margin-right:0.3333em;"></span><span class="mord mathnormal inline">ϕ</span><span class="mopen inline">(</span><span class="mord mathnormal inline">n</span><span class="mclose inline">))</span></span></span></span></span></p>
<p class="text-base leading-7 mb-4 text-foreground">这意味着存在某个整数 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.6944em;"></span><span class="mord mathnormal inline" style="margin-right:0.03148em;">k</span></span></span></span>，使得：<br class="block">
<span class="katex-display inline"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>e</mi><mo>⋅</mo><mi>d</mi><mo>=</mo><mn>1</mn><mo>+</mo><mi>k</mi><mo>⋅</mo><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">e \cdot d = 1 + k \cdot \phi(n)</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4445em;"></span><span class="mord mathnormal inline">e</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">⋅</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6944em;"></span><span class="mord mathnormal inline">d</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord inline">1</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">+</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6944em;"></span><span class="mord mathnormal inline" style="margin-right:0.03148em;">k</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">⋅</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal inline">ϕ</span><span class="mopen inline">(</span><span class="mord mathnormal inline">n</span><span class="mclose inline">)</span></span></span></span></span></p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">第三步：验证解密过程</strong><br class="block">
现在我们证明解密确实能恢复原始消息：</p>
<p class="text-base leading-7 mb-4 text-foreground"><span class="katex-display inline"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>c</mi><mi>d</mi></msup><mo>=</mo><mo stretchy="false">(</mo><msup><mi>m</mi><mi>e</mi></msup><msup><mo stretchy="false">)</mo><mi>d</mi></msup><mo>=</mo><msup><mi>m</mi><mrow><mi>e</mi><mi>d</mi></mrow></msup><mo>=</mo><msup><mi>m</mi><mrow><mn>1</mn><mo>+</mo><mi>k</mi><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><msup><mi>m</mi><mn>1</mn></msup><mo>⋅</mo><msup><mi>m</mi><mrow><mi>k</mi><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mi>m</mi><mo>⋅</mo><mo stretchy="false">(</mo><msup><mi>m</mi><mrow><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></msup><msup><mo stretchy="false">)</mo><mi>k</mi></msup></mrow><annotation encoding="application/x-tex">c^d = (m^e)^d = m^{ed} = m^{1 + k\phi(n)} = m^1 \cdot m^{k\phi(n)} = m \cdot (m^{\phi(n)})^k</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.8991em;"></span><span class="mord inline"><span class="mord mathnormal inline">c</span><span class="msupsub inline"><span class="vlist-t inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mathnormal mtight inline">d</span></span></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:1.1491em;vertical-align:-0.25em;"></span><span class="mopen inline">(</span><span class="mord inline"><span class="mord mathnormal inline">m</span><span class="msupsub inline"><span class="vlist-t inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mathnormal mtight inline">e</span></span></span></span></span></span></span></span><span class="mclose inline"><span class="mclose inline">)</span><span class="msupsub inline"><span class="vlist-t inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mathnormal mtight inline">d</span></span></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.8991em;"></span><span class="mord inline"><span class="mord mathnormal inline">m</span><span class="msupsub inline"><span class="vlist-t inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline"><span class="mord mathnormal mtight inline">e</span><span class="mord mathnormal mtight inline">d</span></span></span></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.938em;"></span><span class="mord inline"><span class="mord mathnormal inline">m</span><span class="msupsub inline"><span class="vlist-t inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline"><span class="mord mtight inline">1</span><span class="mbin mtight inline">+</span><span class="mord mathnormal mtight inline" style="margin-right:0.03148em;">k</span><span class="mord mathnormal mtight inline">ϕ</span><span class="mopen mtight inline">(</span><span class="mord mathnormal mtight inline">n</span><span class="mclose mtight inline">)</span></span></span></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.8641em;"></span><span class="mord inline"><span class="mord mathnormal inline">m</span><span class="msupsub inline"><span class="vlist-t inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline">1</span></span></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">⋅</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.938em;"></span><span class="mord inline"><span class="mord mathnormal inline">m</span><span class="msupsub inline"><span class="vlist-t inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline"><span class="mord mathnormal mtight inline" style="margin-right:0.03148em;">k</span><span class="mord mathnormal mtight inline">ϕ</span><span class="mopen mtight inline">(</span><span class="mord mathnormal mtight inline">n</span><span class="mclose mtight inline">)</span></span></span></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.4445em;"></span><span class="mord mathnormal inline">m</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">⋅</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:1.188em;vertical-align:-0.25em;"></span><span class="mopen inline">(</span><span class="mord inline"><span class="mord mathnormal inline">m</span><span class="msupsub inline"><span class="vlist-t inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline"><span class="mord mathnormal mtight inline">ϕ</span><span class="mopen mtight inline">(</span><span class="mord mathnormal mtight inline">n</span><span class="mclose mtight inline">)</span></span></span></span></span></span></span></span></span><span class="mclose inline"><span class="mclose inline">)</span><span class="msupsub inline"><span class="vlist-t inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mathnormal mtight inline" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span></span></span></span></p>
<p class="text-base leading-7 mb-4 text-foreground">根据欧拉定理，<span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>m</mi><mrow><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></msup><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width="0.4444em"/><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mspace width="0.3333em"/><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">m^{\phi(n)} \equiv 1 \pmod{n}</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.888em;"></span><span class="mord inline"><span class="mord mathnormal inline">m</span><span class="msupsub inline"><span class="vlist-t inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline"><span class="mord mathnormal mtight inline">ϕ</span><span class="mopen mtight inline">(</span><span class="mord mathnormal mtight inline">n</span><span class="mclose mtight inline">)</span></span></span></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">≡</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">1</span><span class="mspace allowbreak inline"></span><span class="mspace inline" style="margin-right:0.4444em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen inline">(</span><span class="mord inline"><span class="mord inline"><span class="mord mathrm inline">mod</span></span></span><span class="mspace inline" style="margin-right:0.3333em;"></span><span class="mord mathnormal inline">n</span><span class="mclose inline">)</span></span></span></span>，因此：</p>
<p class="text-base leading-7 mb-4 text-foreground"><span class="katex-display inline"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>m</mi><mo>⋅</mo><mo stretchy="false">(</mo><msup><mi>m</mi><mrow><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></msup><msup><mo stretchy="false">)</mo><mi>k</mi></msup><mo>≡</mo><mi>m</mi><mo>⋅</mo><msup><mn>1</mn><mi>k</mi></msup><mo>≡</mo><mi>m</mi><mspace></mspace><mspace width="1em"/><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mspace width="0.3333em"/><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">m \cdot (m^{\phi(n)})^k \equiv m \cdot 1^k \equiv m \pmod{n}</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4445em;"></span><span class="mord mathnormal inline">m</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">⋅</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:1.188em;vertical-align:-0.25em;"></span><span class="mopen inline">(</span><span class="mord inline"><span class="mord mathnormal inline">m</span><span class="msupsub inline"><span class="vlist-t inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline"><span class="mord mathnormal mtight inline">ϕ</span><span class="mopen mtight inline">(</span><span class="mord mathnormal mtight inline">n</span><span class="mclose mtight inline">)</span></span></span></span></span></span></span></span></span><span class="mclose inline"><span class="mclose inline">)</span><span class="msupsub inline"><span class="vlist-t inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mathnormal mtight inline" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">≡</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.4445em;"></span><span class="mord mathnormal inline">m</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">⋅</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.8991em;"></span><span class="mord inline"><span class="mord inline">1</span><span class="msupsub inline"><span class="vlist-t inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mathnormal mtight inline" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">≡</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline">m</span><span class="mspace allowbreak inline"></span><span class="mspace inline" style="margin-right:1em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen inline">(</span><span class="mord inline"><span class="mord inline"><span class="mord mathrm inline">mod</span></span></span><span class="mspace inline" style="margin-right:0.3333em;"></span><span class="mord mathnormal inline">n</span><span class="mclose inline">)</span></span></span></span></span></p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">结论</strong>：<br class="block">
<span class="katex-display inline"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>c</mi><mi>d</mi></msup><mo>≡</mo><mi>m</mi><mspace></mspace><mspace width="1em"/><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mspace width="0.3333em"/><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">c^d \equiv m \pmod{n}</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.8991em;"></span><span class="mord inline"><span class="mord mathnormal inline">c</span><span class="msupsub inline"><span class="vlist-t inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mathnormal mtight inline">d</span></span></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">≡</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline">m</span><span class="mspace allowbreak inline"></span><span class="mspace inline" style="margin-right:1em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen inline">(</span><span class="mord inline"><span class="mord inline"><span class="mord mathrm inline">mod</span></span></span><span class="mspace inline" style="margin-right:0.3333em;"></span><span class="mord mathnormal inline">n</span><span class="mclose inline">)</span></span></span></span></span></p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">具体数值验证</strong>：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed">设明文 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>=</mo><mn>123</mn></mrow><annotation encoding="application/x-tex">m = 123</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline">m</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">123</span></span></span></span></li>
<li class="text-foreground leading-relaxed">加密：<span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo>=</mo><msup><mn>123</mn><mn>17</mn></msup><mtext> </mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext> </mtext><mn>3233</mn></mrow><annotation encoding="application/x-tex">c = 123^{17} \bmod 3233</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline">c</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.8141em;"></span><span class="mord inline">12</span><span class="mord inline"><span class="mord inline">3</span><span class="msupsub inline"><span class="vlist-t inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline"><span class="mord mtight inline">17</span></span></span></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.0556em;"></span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline"><span class="mord inline"><span class="mord mathrm inline">mod</span></span></span><span class="mspace inline" style="margin-right:0.0556em;"></span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">3233</span></span></span></span></li>
<li class="text-foreground leading-relaxed">解密：<span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>m</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>=</mo><msup><mi>c</mi><mn>2753</mn></msup><mtext> </mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext> </mtext><mn>3233</mn><mo>=</mo><mn>123</mn></mrow><annotation encoding="application/x-tex">m&#x27; = c^{2753} \bmod 3233 = 123</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.7519em;"></span><span class="mord inline"><span class="mord mathnormal inline">m</span><span class="msupsub inline"><span class="vlist-t inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline"><span class="mord mtight inline">′</span></span></span></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.8141em;"></span><span class="mord inline"><span class="mord mathnormal inline">c</span><span class="msupsub inline"><span class="vlist-t inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline"><span class="mord mtight inline">2753</span></span></span></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.0556em;"></span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline"><span class="mord inline"><span class="mord mathrm inline">mod</span></span></span><span class="mspace inline" style="margin-right:0.0556em;"></span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">3233</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">123</span></span></span></span></li>
</ul>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">重要说明</strong>：本例子使用小质数仅为演示目的。在实际应用中，RSA使用1024位或2048位的大质数，此时通常选择 <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo>=</mo><mn>65537</mn></mrow><annotation encoding="application/x-tex">e = 65537</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline">e</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">65537</span></span></span></span>，因为它在保证安全性的同时具有良好的计算性能。</p>
<h2 id="rsa在web安全中的角色定位" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#rsa在web安全中的角色定位" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to RSA在Web安全中的角色定位">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            RSA在Web安全中的角色定位
        </h2>
<h3 id="对称加密-vs-非对称加密的选择策略" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#对称加密-vs-非对称加密的选择策略" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 对称加密 vs 非对称加密的选择策略">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            对称加密 vs 非对称加密的选择策略
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">在现代Web应用中，RSA通常不用于大量数据的加密，而是扮演着&quot;密钥保护者&quot;的角色：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="" data-code="%E4%BC%A0%E7%BB%9F%E7%9A%84%E5%9B%B0%E5%A2%83%EF%BC%9A%0A%E7%94%A8%E6%88%B7%20--%5B%E6%98%8E%E6%96%87API%E5%AF%86%E9%92%A5%5D--%3E%20%E6%9C%8D%E5%8A%A1%E5%99%A8%20%20%E2%9D%8C%20%E4%B8%8D%E5%AE%89%E5%85%A8%0A%E7%94%A8%E6%88%B7%20--%5B%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%5D--%3E%20%E6%9C%8D%E5%8A%A1%E5%99%A8%20%20%20%20%E2%9D%8C%20%E5%AF%86%E9%92%A5%E5%88%86%E5%8F%91%E9%97%AE%E9%A2%98%0ARSA%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%9A%0A%E7%94%A8%E6%88%B7%20--%5BRSA%E5%85%AC%E9%92%A5%E5%8A%A0%E5%AF%86%5D--%3E%20%E6%9C%8D%E5%8A%A1%E5%99%A8%20--%5BRSA%E7%A7%81%E9%92%A5%E8%A7%A3%E5%AF%86%5D--%3E%20%E5%AE%89%E5%85%A8%E5%AD%98%E5%82%A8%20%20%E2%9C%85">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">code</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code><span class="hljs-comment inline">传统的困境：</span>
<span class="hljs-comment inline">用户</span> <span class="hljs-literal inline">--</span><span class="hljs-title inline">[</span><span class="hljs-comment inline">明文API密钥</span><span class="hljs-title inline">]</span><span class="hljs-literal inline">--</span>&gt; <span class="hljs-comment inline">服务器  ❌ 不安全</span>
<span class="hljs-comment inline">用户</span> <span class="hljs-literal inline">--</span><span class="hljs-title inline">[</span><span class="hljs-comment inline">对称加密</span><span class="hljs-title inline">]</span><span class="hljs-literal inline">--</span>&gt; <span class="hljs-comment inline">服务器    ❌ 密钥分发问题</span>

<span class="hljs-comment inline">RSA的解决方案：</span>
<span class="hljs-comment inline">用户</span> <span class="hljs-literal inline">--</span><span class="hljs-title inline">[</span><span class="hljs-comment inline">RSA公钥加密</span><span class="hljs-title inline">]</span><span class="hljs-literal inline">--</span>&gt; <span class="hljs-comment inline">服务器</span> <span class="hljs-literal inline">--</span><span class="hljs-title inline">[</span><span class="hljs-comment inline">RSA私钥解密</span><span class="hljs-title inline">]</span><span class="hljs-literal inline">--</span>&gt; <span class="hljs-comment inline">安全存储  ✅</span>
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">性能对比</strong>：</p>
<table class="w-full border-collapse mb-4 shadow-sm rounded-lg overflow-hidden">
<thead class="bg-surface">
<tr class="border-b border-gray-200"><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">加密方式</th><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">加密速度</th><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">解密速度</th><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">密钥分发</th><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">适用场景</th></tr>
</thead>
<tbody class="bg-background divide-y divide-gray-200">
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">AES-256</td><td class="px-4 py-3 text-sm text-foreground">极快</td><td class="px-4 py-3 text-sm text-foreground">极快</td><td class="px-4 py-3 text-sm text-foreground">困难</td><td class="px-4 py-3 text-sm text-foreground">大量数据</td></tr>
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">RSA-2048</td><td class="px-4 py-3 text-sm text-foreground">慢</td><td class="px-4 py-3 text-sm text-foreground">极慢</td><td class="px-4 py-3 text-sm text-foreground">简单</td><td class="px-4 py-3 text-sm text-foreground">小量数据/密钥交换</td></tr>
</tbody>
</table>
<h3 id="rsa-oaep填充方案的安全性" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#rsa-oaep填充方案的安全性" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to RSA-OAEP填充方案的安全性">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            RSA-OAEP填充方案的安全性
        </h3>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">为什么需要填充？</strong></p>
<p class="text-base leading-7 mb-4 text-foreground">如果直接使用原始RSA：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed">相同明文总是产生相同密文</li>
<li class="text-foreground leading-relaxed">容易受到选择明文攻击</li>
<li class="text-foreground leading-relaxed">明文长度信息泄露</li>
</ul>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">OAEP填充的工作原理</strong>：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="" data-code="%E6%98%8E%E6%96%87%20%E2%86%92%20%E6%B7%BB%E5%8A%A0%E9%9A%8F%E6%9C%BA%E6%95%B0%20%E2%86%92%20%E6%8E%A9%E7%A0%81%E7%94%9F%E6%88%90%20%E2%86%92%20%E6%9C%80%E7%BB%88%E5%AF%86%E6%96%87">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">code</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code>明文 → 添加随机数 → 掩码生成 → 最终密文
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">OAEP确保：</p>
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">随机性</strong>：相同明文每次加密结果不同</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">完整性</strong>：任何篡改都会导致解密失败</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">语义安全</strong>：攻击者无法从密文推断明文信息</li>
</ol>
<h3 id="questions-party安全架构设计" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#questions-party安全架构设计" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Questions Party安全架构设计">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Questions Party安全架构设计
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">更新API Key：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="" data-code="%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5API%E5%AF%86%E9%92%A5%20%E2%86%92%20%E5%89%8D%E7%AB%AFRSA%E5%8A%A0%E5%AF%86%20%E2%86%92%20HTTPS%E4%BC%A0%E8%BE%93%20%E2%86%92%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%98%E5%82%A8%EF%BC%88%E5%AD%98%E5%82%A8%E7%9A%84%E6%98%AF%E5%AF%86%E6%96%87%EF%BC%89">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">code</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code>用户输入API密钥 → 前端RSA加密 → HTTPS传输 → 数据库存储（存储的是密文）
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">使用API Key发送请求：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="" data-code="%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%E8%AF%B7%E6%B1%82%E5%86%85%E5%AE%B9%20%E2%86%92%20HTTPS%E4%BC%A0%E8%BE%93%20%E2%86%92%20%E5%90%8E%E7%AB%AFRSA%E8%A7%A3%E5%AF%86%20%E2%86%92%20%E4%BD%BF%E7%94%A8%E8%A7%A3%E5%AF%86%E5%90%8E%E7%9A%84%E6%98%8E%E6%96%87Key%E8%B0%83%E7%94%A8%E5%A4%A7%E6%A8%A1%E5%9E%8BAPI%20%E2%86%92%20%E8%A7%A3%E6%9E%90%E5%93%8D%E5%BA%94%E5%B9%B6%E8%BF%94%E5%9B%9E">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">code</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code>用户输入请求内容 → HTTPS传输 → 后端RSA解密 → 使用解密后的明文<span class="hljs-built_in inline">Key</span>调用大模型API → 解析响应并返回
</code></pre>
            </div>
        
<h2 id="questions-party项目中的rsa实现架构" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#questions-party项目中的rsa实现架构" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Questions Party项目中的RSA实现架构">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Questions Party项目中的RSA实现架构
        </h2>
<h3 id="整体安全架构设计" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#整体安全架构设计" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 整体安全架构设计">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            整体安全架构设计
        </h3>
<div class="mermaid block" id="mermaid-1767322173316-bvetpq0">graph TB
    subgraph "前端浏览器"
        A[用户输入API密钥] --> B[获取RSA公钥]
        B --> C[前端RSA加密]
        C --> D[HTTPS传输]
    end
    
    subgraph "后端服务器"
        D --> E[接收加密数据]
        E --> G[数据库存储]
    end
    
    subgraph "密钥管理"
        H[环境变量文件] --> I[RSA密钥对]
        I --> J[公钥分发]
        I --> K[私钥保护]
    end
    
    J --> B
    K --> G</div>
<h3 id="前后端分离架构下的加密策略" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#前后端分离架构下的加密策略" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 前后端分离架构下的加密策略">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            前后端分离架构下的加密策略
        </h3>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">前端职责</strong>：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed">获取公钥</li>
<li class="text-foreground leading-relaxed">加密敏感数据</li>
<li class="text-foreground leading-relaxed">传输加密数据</li>
</ul>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">后端职责</strong>：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed">密钥对管理</li>
<li class="text-foreground leading-relaxed">公钥分发</li>
<li class="text-foreground leading-relaxed">存储加密数据</li>
</ul>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">安全边界</strong>：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed">私钥永远不离开服务器</li>
<li class="text-foreground leading-relaxed">公钥可以自由分发</li>
<li class="text-foreground leading-relaxed">敏感数据只在必要时解密</li>
</ul>
<h3 id="密钥管理和分发机制" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#密钥管理和分发机制" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 密钥管理和分发机制">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            密钥管理和分发机制
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="const%20jsrsasign%20%3D%20require('jsrsasign')%3B%0Aconst%20%7B%20KEYUTIL%20%7D%20%3D%20jsrsasign%3B%0Aconst%20crypto%20%3D%20require('crypto')%3B%0Aclass%20RSACrypto%20%7B%0Aconstructor()%20%7B%0Athis.keySize%20%3D%202048%3B%0Athis.initializeKeys()%3B%0A%7D%0A%2F%2F%20%E4%BB%8E%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%88%9D%E5%A7%8B%E5%8C%96RSA%E5%AF%86%E9%92%A5%E5%AF%B9%E6%88%96%E7%94%9F%E6%88%90%E6%96%B0%E7%9A%84%E5%AF%86%E9%92%A5%E5%AF%B9%0AinitializeKeys()%20%7B%0Aif%20(process.env.RSA_PUBLIC_KEY%20%26%26%20process.env.RSA_PRIVATE_KEY)%20%7B%0A%2F%2F%20%E5%A4%84%E7%90%86%E8%BD%AC%E4%B9%89%E5%92%8C%E9%9D%9E%E8%BD%AC%E4%B9%89%E7%9A%84%E6%8D%A2%E8%A1%8C%E7%AC%A6%EF%BC%88%E5%85%BC%E5%AE%B9%E6%80%A7%E8%80%83%E8%99%91%EF%BC%89%0Athis.publicKeyPEM%20%3D%20process.env.RSA_PUBLIC_KEY.includes('%5C%5Cn')%0A%3F%20process.env.RSA_PUBLIC_KEY.replace(%2F%5C%5Cn%2Fg%2C%20'%5Cn')%0A%3A%20process.env.RSA_PUBLIC_KEY%3B%0Athis.privateKeyPEM%20%3D%20process.env.RSA_PRIVATE_KEY.includes('%5C%5Cn')%0A%3F%20process.env.RSA_PRIVATE_KEY.replace(%2F%5C%5Cn%2Fg%2C%20'%5Cn')%0A%3A%20process.env.RSA_PRIVATE_KEY%3B%0A%7D%20else%20%7B%0Aconsole.warn('RSA%20keys%20not%20found%20in%20environment.%20Generating%20new%20keys...')%3B%0Aconst%20keyPair%20%3D%20this.generateKeyPair()%3B%0Athis.publicKeyPEM%20%3D%20keyPair.publicKeyPEM%3B%0Athis.privateKeyPEM%20%3D%20keyPair.privateKeyPEM%3B%0Aconsole.log('Generated%20RSA%20Public%20Key%3A'%2C%20this.publicKeyPEM)%3B%0Aconsole.log('Generated%20RSA%20Private%20Key%3A'%2C%20this.privateKeyPEM)%3B%0Aconsole.log('Please%20add%20these%20keys%20to%20your%20.env%20file%3A')%3B%0Aconsole.log('RSA_PUBLIC_KEY%3D%22'%20%2B%20this.publicKeyPEM.replace(%2F%5Cn%2Fg%2C%20'%5C%5Cn')%20%2B%20'%22')%3B%0Aconsole.log('RSA_PRIVATE_KEY%3D%22'%20%2B%20this.privateKeyPEM.replace(%2F%5Cn%2Fg%2C%20'%5C%5Cn')%20%2B%20'%22')%3B%0A%7D%0A%7D%0A%2F%2F%20RSA%E5%AF%86%E9%92%A5%E5%AF%B9%E7%94%9F%E6%88%90%EF%BC%9A%E4%BD%BF%E7%94%A8jsrsasign%E7%94%9F%E6%88%90%E6%A0%87%E5%87%86%E6%A0%BC%E5%BC%8F%E5%AF%86%E9%92%A5%0AgenerateKeyPair(keySize%20%3D%202048)%20%7B%0Atry%20%7B%0Aconst%20keyPair%20%3D%20KEYUTIL.generateKeypair('RSA'%2C%20keySize)%3B%0Aconst%20publicKeyPEM%20%3D%20KEYUTIL.getPEM(keyPair.pubKeyObj)%3B%20%20%20%20%20%20%20%2F%2F%20%E5%85%AC%E9%92%A5PEM%E6%A0%BC%E5%BC%8F%0Aconst%20privateKeyPEM%20%3D%20KEYUTIL.getPEM(keyPair.prvKeyObj%2C%20'PKCS8PRV')%3B%20%20%2F%2F%20%E7%A7%81%E9%92%A5PKCS8%E6%A0%BC%E5%BC%8F%0Areturn%20%7B%20publicKeyPEM%2C%20privateKeyPEM%20%7D%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60RSA%20key%20generation%20failed%3A%20%24%7Berror.message%7D%60)%3B%0A%7D%0A%7D%0A%2F%2F%20%E5%85%AC%E9%92%A5%E5%88%86%E5%8F%91%E6%8E%A5%E5%8F%A3%EF%BC%9A%E4%BE%9B%E5%89%8D%E7%AB%AF%E8%8E%B7%E5%8F%96%E5%85%AC%E9%92%A5%0AgetPublicKey()%20%7B%0Areturn%20this.publicKeyPEM%3B%0A%7D%0A%2F%2F%20RSA-OAEP%E5%8A%A0%E5%AF%86%E5%AE%9E%E7%8E%B0%EF%BC%9A%E4%BD%BF%E7%94%A8Node.js%20crypto%E6%A8%A1%E5%9D%97%E7%A1%AE%E4%BF%9D%E6%9C%80%E4%BD%B3%E6%80%A7%E8%83%BD%E5%92%8C%E5%AE%89%E5%85%A8%E6%80%A7%0Aencrypt(plaintext)%20%7B%0Atry%20%7B%0A%2F%2F%20%E8%BE%93%E5%85%A5%E9%AA%8C%E8%AF%81%EF%BC%9A%E7%A1%AE%E4%BF%9D%E6%98%8E%E6%96%87%E6%9C%89%E6%95%88%0Aif%20(!plaintext%20%7C%7C%20typeof%20plaintext%20!%3D%3D%20'string')%20%7B%0Athrow%20new%20Error('Invalid%20plaintext%20for%20encryption')%3B%0A%7D%0A%2F%2F%20UTF-8%E7%BC%96%E7%A0%81%E8%BD%AC%E6%8D%A2%EF%BC%9A%E7%A1%AE%E4%BF%9D%E4%B8%AD%E6%96%87%E7%AD%89%E5%AD%97%E7%AC%A6%E6%AD%A3%E7%A1%AE%E5%A4%84%E7%90%86%0Aconst%20buffer%20%3D%20Buffer.from(plaintext%2C%20'utf8')%3B%0A%2F%2F%20%E6%A0%B8%E5%BF%83%E5%8A%A0%E5%AF%86%E9%80%BB%E8%BE%91%EF%BC%9A%E4%BD%BF%E7%94%A8OAEP%E5%A1%AB%E5%85%85%E7%9A%84RSA%E5%8A%A0%E5%AF%86%0A%2F%2F%20%E9%80%89%E6%8B%A9Node.js%20crypto%E8%80%8C%E9%9D%9Ejsrsasign%E7%9A%84%E5%8E%9F%E5%9B%A0%EF%BC%9A%E6%9B%B4%E5%8F%AF%E9%9D%A0%E7%9A%84OAEP%E5%AE%9E%E7%8E%B0%0Aconst%20encrypted%20%3D%20crypto.publicEncrypt(%0A%7B%0Akey%3A%20this.publicKeyPEM%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20PEM%E6%A0%BC%E5%BC%8F%E5%85%AC%E9%92%A5%0Apadding%3A%20crypto.constants.RSA_PKCS1_OAEP_PADDING%2C%20%20%20%2F%2F%20OAEP%E5%A1%AB%E5%85%85%EF%BC%8C%E9%98%B2%E6%AD%A2%E5%A1%AB%E5%85%85%E6%94%BB%E5%87%BB%0AoaepHash%3A%20'sha256'%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20SHA-256%E5%93%88%E5%B8%8C%E5%87%BD%E6%95%B0%0A%7D%2C%0Abuffer%0A)%3B%0A%2F%2F%20Base64%E7%BC%96%E7%A0%81%EF%BC%9A%E4%BE%BF%E4%BA%8E%E7%BD%91%E7%BB%9C%E4%BC%A0%E8%BE%93%E5%92%8C%E5%AD%98%E5%82%A8%0Areturn%20encrypted.toString('base64')%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60RSA%20encryption%20failed%3A%20%24%7Berror.message%7D%60)%3B%0A%7D%0A%7D%0A%2F%2F%20RSA-OAEP%E8%A7%A3%E5%AF%86%E5%AE%9E%E7%8E%B0%EF%BC%9A%E4%B8%B4%E6%97%B6%E8%A7%A3%E5%AF%86%E7%AD%96%E7%95%A5%E7%9A%84%E6%A0%B8%E5%BF%83%0Adecrypt(encryptedData)%20%7B%0Atry%20%7B%0A%2F%2F%20%E8%BE%93%E5%85%A5%E9%AA%8C%E8%AF%81%EF%BC%9A%E7%A1%AE%E4%BF%9D%E5%AF%86%E6%96%87%E6%A0%BC%E5%BC%8F%E6%AD%A3%E7%A1%AE%0Aif%20(!encryptedData%20%7C%7C%20typeof%20encryptedData%20!%3D%3D%20'string')%20%7B%0Athrow%20new%20Error('Invalid%20encrypted%20data%20for%20decryption')%3B%0A%7D%0A%2F%2F%20Base64%E8%A7%A3%E7%A0%81%EF%BC%9A%E6%81%A2%E5%A4%8D%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AF%86%E6%96%87%0Aconst%20encryptedBuffer%20%3D%20Buffer.from(encryptedData%2C%20'base64')%3B%0A%2F%2F%20%E6%A0%B8%E5%BF%83%E8%A7%A3%E5%AF%86%E9%80%BB%E8%BE%91%EF%BC%9A%E4%BD%BF%E7%94%A8%E7%A7%81%E9%92%A5%E8%A7%A3%E5%AF%86%0Aconst%20decrypted%20%3D%20crypto.privateDecrypt(%0A%7B%0Akey%3A%20this.privateKeyPEM%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20PEM%E6%A0%BC%E5%BC%8F%E7%A7%81%E9%92%A5%0Apadding%3A%20crypto.constants.RSA_PKCS1_OAEP_PADDING%2C%20%20%20%2F%2F%20%E4%B8%8E%E5%8A%A0%E5%AF%86%E4%BF%9D%E6%8C%81%E4%B8%80%E8%87%B4%E7%9A%84%E5%A1%AB%E5%85%85%0AoaepHash%3A%20'sha256'%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%B8%8E%E5%8A%A0%E5%AF%86%E4%BF%9D%E6%8C%81%E4%B8%80%E8%87%B4%E7%9A%84%E5%93%88%E5%B8%8C%0A%7D%2C%0AencryptedBuffer%0A)%3B%0A%2F%2F%20UTF-8%E8%A7%A3%E7%A0%81%EF%BC%9A%E6%81%A2%E5%A4%8D%E5%8E%9F%E5%A7%8B%E5%AD%97%E7%AC%A6%E4%B8%B2%0Areturn%20decrypted.toString('utf8')%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60RSA%20decryption%20failed%3A%20%24%7Berror.message%7D%60)%3B%0A%7D%0A%7D%0A%2F%2F%20%E7%81%B5%E6%B4%BB%E5%8A%A0%E5%AF%86%E6%8E%A5%E5%8F%A3%EF%BC%9A%E6%94%AF%E6%8C%81%E4%BD%BF%E7%94%A8%E4%BB%BB%E6%84%8F%E5%85%AC%E9%92%A5%E5%8A%A0%E5%AF%86%EF%BC%88%E6%B5%8B%E8%AF%95%E7%94%A8%EF%BC%89%0AencryptWithPublicKey(plaintext%2C%20publicKeyPEM)%20%7B%0Atry%20%7B%0Aif%20(!plaintext%20%7C%7C%20typeof%20plaintext%20!%3D%3D%20'string')%20%7B%0Athrow%20new%20Error('Invalid%20plaintext%20for%20encryption')%3B%0A%7D%0Aconst%20buffer%20%3D%20Buffer.from(plaintext%2C%20'utf8')%3B%0A%2F%2F%20%E4%BD%BF%E7%94%A8%E5%A4%96%E9%83%A8%E6%8F%90%E4%BE%9B%E7%9A%84%E5%85%AC%E9%92%A5%E8%BF%9B%E8%A1%8C%E5%8A%A0%E5%AF%86%0Aconst%20encrypted%20%3D%20crypto.publicEncrypt(%0A%7B%0Akey%3A%20publicKeyPEM%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%A4%96%E9%83%A8%E5%85%AC%E9%92%A5%0Apadding%3A%20crypto.constants.RSA_PKCS1_OAEP_PADDING%2C%0AoaepHash%3A%20'sha256'%2C%0A%7D%2C%0Abuffer%0A)%3B%0Areturn%20encrypted.toString('base64')%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60RSA%20encryption%20with%20provided%20key%20failed%3A%20%24%7Berror.message%7D%60)%3B%0A%7D%0A%7D%0A%2F%2F%20%E5%AF%86%E9%92%A5%E9%AA%8C%E8%AF%81%E5%B7%A5%E5%85%B7%EF%BC%9A%E7%A1%AE%E4%BF%9D%E5%AF%86%E9%92%A5%E6%A0%BC%E5%BC%8F%E6%AD%A3%E7%A1%AE%0AvalidateKey(keyPEM%2C%20isPrivate%20%3D%20false)%20%7B%0Atry%20%7B%0Aconst%20keyObj%20%3D%20KEYUTIL.getKey(keyPEM)%3B%0Areturn%20keyObj%20%26%26%20(isPrivate%20%3F%20keyObj.isPrivate%20%3A%20keyObj.isPublic)%3B%0A%7D%20catch%20(error)%20%7B%0Areturn%20false%3B%20%20%20%2F%2F%20%E9%AA%8C%E8%AF%81%E5%A4%B1%E8%B4%A5%E8%BF%94%E5%9B%9Efalse%E8%80%8C%E9%9D%9E%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8%0A%7D%0A%7D%0A%7D%0A%2F%2F%20%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E5%AF%BC%E5%87%BA%EF%BC%9A%E5%85%A8%E5%B1%80%E5%94%AF%E4%B8%80%E5%AE%9E%E4%BE%8B%EF%BC%8C%E8%8A%82%E7%9C%81%E5%86%85%E5%AD%98%E5%B9%B6%E4%BF%9D%E8%AF%81%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%0Aconst%20rsaCrypto%20%3D%20new%20RSACrypto()%3B%0A%2F%2F%20%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%87%BA%EF%BC%9A%E6%8F%90%E4%BE%9B%E5%A4%9A%E7%A7%8D%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F%0Amodule.exports%20%3D%20%7B%0ARSACrypto%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%AF%BC%E5%87%BA%E7%B1%BB%EF%BC%88%E7%94%A8%E4%BA%8E%E6%89%A9%E5%B1%95%EF%BC%89%0ArsaCrypto%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%AF%BC%E5%87%BA%E5%8D%95%E4%BE%8B%E5%AE%9E%E4%BE%8B%0AgenerateKeyPair%3A%20(keySize)%20%3D%3E%20rsaCrypto.generateKeyPair(keySize)%2C%20%20%20%20%20%2F%2F%20%E4%BE%BF%E5%88%A9%E5%87%BD%E6%95%B0%0Aencrypt%3A%20(plaintext)%20%3D%3E%20rsaCrypto.encrypt(plaintext)%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%BE%BF%E5%88%A9%E5%87%BD%E6%95%B0%0Adecrypt%3A%20(encryptedData)%20%3D%3E%20rsaCrypto.decrypt(encryptedData)%2C%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%BE%BF%E5%88%A9%E5%87%BD%E6%95%B0%0AgetPublicKey%3A%20()%20%3D%3E%20rsaCrypto.getPublicKey()%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%BE%BF%E5%88%A9%E5%87%BD%E6%95%B0%0AencryptWithPublicKey%3A%20(plaintext%2C%20publicKey)%20%3D%3E%20rsaCrypto.encryptWithPublicKey(plaintext%2C%20publicKey)%2C%0AvalidateKey%3A%20(keyPEM%2C%20isPrivate)%20%3D%3E%20rsaCrypto.validateKey(keyPEM%2C%20isPrivate)%0A%7D%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-keyword inline">const</span> jsrsasign = <span class="hljs-built_in inline">require</span>(<span class="hljs-string inline">&#x27;jsrsasign&#x27;</span>);
<span class="hljs-keyword inline">const</span> { <span class="hljs-variable constant_ inline">KEYUTIL</span> } = jsrsasign;
<span class="hljs-keyword inline">const</span> crypto = <span class="hljs-built_in inline">require</span>(<span class="hljs-string inline">&#x27;crypto&#x27;</span>);

<span class="hljs-keyword inline">class</span> <span class="hljs-title class_ inline">RSACrypto</span> {
  <span class="hljs-title function_ inline">constructor</span>(<span class="hljs-params inline"></span>) {
    <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">keySize</span> = <span class="hljs-number inline">2048</span>;
    <span class="hljs-variable language_ inline">this</span>.<span class="hljs-title function_ inline">initializeKeys</span>();
  }

  <span class="hljs-comment inline">// 从环境变量初始化RSA密钥对或生成新的密钥对</span>
  <span class="hljs-title function_ inline">initializeKeys</span>(<span class="hljs-params inline"></span>) {
    <span class="hljs-keyword inline">if</span> (process.<span class="hljs-property inline">env</span>.<span class="hljs-property inline">RSA_PUBLIC_KEY</span> &amp;&amp; process.<span class="hljs-property inline">env</span>.<span class="hljs-property inline">RSA_PRIVATE_KEY</span>) {
      <span class="hljs-comment inline">// 处理转义和非转义的换行符（兼容性考虑）</span>
      <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">publicKeyPEM</span> = process.<span class="hljs-property inline">env</span>.<span class="hljs-property inline">RSA_PUBLIC_KEY</span>.<span class="hljs-title function_ inline">includes</span>(<span class="hljs-string inline">&#x27;\\n&#x27;</span>) 
        ? process.<span class="hljs-property inline">env</span>.<span class="hljs-property inline">RSA_PUBLIC_KEY</span>.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/\\n/g</span>, <span class="hljs-string inline">&#x27;\n&#x27;</span>)
        : process.<span class="hljs-property inline">env</span>.<span class="hljs-property inline">RSA_PUBLIC_KEY</span>;
      <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">privateKeyPEM</span> = process.<span class="hljs-property inline">env</span>.<span class="hljs-property inline">RSA_PRIVATE_KEY</span>.<span class="hljs-title function_ inline">includes</span>(<span class="hljs-string inline">&#x27;\\n&#x27;</span>)
        ? process.<span class="hljs-property inline">env</span>.<span class="hljs-property inline">RSA_PRIVATE_KEY</span>.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/\\n/g</span>, <span class="hljs-string inline">&#x27;\n&#x27;</span>)
        : process.<span class="hljs-property inline">env</span>.<span class="hljs-property inline">RSA_PRIVATE_KEY</span>;
    } <span class="hljs-keyword inline">else</span> {
      <span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">warn</span>(<span class="hljs-string inline">&#x27;RSA keys not found in environment. Generating new keys...&#x27;</span>);
      <span class="hljs-keyword inline">const</span> keyPair = <span class="hljs-variable language_ inline">this</span>.<span class="hljs-title function_ inline">generateKeyPair</span>();
      <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">publicKeyPEM</span> = keyPair.<span class="hljs-property inline">publicKeyPEM</span>;
      <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">privateKeyPEM</span> = keyPair.<span class="hljs-property inline">privateKeyPEM</span>;
      
      <span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">log</span>(<span class="hljs-string inline">&#x27;Generated RSA Public Key:&#x27;</span>, <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">publicKeyPEM</span>);
      <span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">log</span>(<span class="hljs-string inline">&#x27;Generated RSA Private Key:&#x27;</span>, <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">privateKeyPEM</span>);
      <span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">log</span>(<span class="hljs-string inline">&#x27;Please add these keys to your .env file:&#x27;</span>);
      <span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">log</span>(<span class="hljs-string inline">&#x27;RSA_PUBLIC_KEY=&quot;&#x27;</span> + <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">publicKeyPEM</span>.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/\n/g</span>, <span class="hljs-string inline">&#x27;\\n&#x27;</span>) + <span class="hljs-string inline">&#x27;&quot;&#x27;</span>);
      <span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">log</span>(<span class="hljs-string inline">&#x27;RSA_PRIVATE_KEY=&quot;&#x27;</span> + <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">privateKeyPEM</span>.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/\n/g</span>, <span class="hljs-string inline">&#x27;\\n&#x27;</span>) + <span class="hljs-string inline">&#x27;&quot;&#x27;</span>);
    }
  }

  <span class="hljs-comment inline">// RSA密钥对生成：使用jsrsasign生成标准格式密钥</span>
  <span class="hljs-title function_ inline">generateKeyPair</span>(<span class="hljs-params inline">keySize = <span class="hljs-number inline">2048</span></span>) {
    <span class="hljs-keyword inline">try</span> {
      <span class="hljs-keyword inline">const</span> keyPair = <span class="hljs-variable constant_ inline">KEYUTIL</span>.<span class="hljs-title function_ inline">generateKeypair</span>(<span class="hljs-string inline">&#x27;RSA&#x27;</span>, keySize);
      <span class="hljs-keyword inline">const</span> publicKeyPEM = <span class="hljs-variable constant_ inline">KEYUTIL</span>.<span class="hljs-title function_ inline">getPEM</span>(keyPair.<span class="hljs-property inline">pubKeyObj</span>);       <span class="hljs-comment inline">// 公钥PEM格式</span>
      <span class="hljs-keyword inline">const</span> privateKeyPEM = <span class="hljs-variable constant_ inline">KEYUTIL</span>.<span class="hljs-title function_ inline">getPEM</span>(keyPair.<span class="hljs-property inline">prvKeyObj</span>, <span class="hljs-string inline">&#x27;PKCS8PRV&#x27;</span>);  <span class="hljs-comment inline">// 私钥PKCS8格式</span>
      
      <span class="hljs-keyword inline">return</span> { publicKeyPEM, privateKeyPEM };
    } <span class="hljs-keyword inline">catch</span> (error) {
      <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">`RSA key generation failed: <span class="hljs-subst inline">${error.message}</span>`</span>);
    }
  }

  <span class="hljs-comment inline">// 公钥分发接口：供前端获取公钥</span>
  <span class="hljs-title function_ inline">getPublicKey</span>(<span class="hljs-params inline"></span>) {
    <span class="hljs-keyword inline">return</span> <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">publicKeyPEM</span>;
  }

  <span class="hljs-comment inline">// RSA-OAEP加密实现：使用Node.js crypto模块确保最佳性能和安全性</span>
  <span class="hljs-title function_ inline">encrypt</span>(<span class="hljs-params inline">plaintext</span>) {
    <span class="hljs-keyword inline">try</span> {
      <span class="hljs-comment inline">// 输入验证：确保明文有效</span>
      <span class="hljs-keyword inline">if</span> (!plaintext || <span class="hljs-keyword inline">typeof</span> plaintext !== <span class="hljs-string inline">&#x27;string&#x27;</span>) {
        <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">&#x27;Invalid plaintext for encryption&#x27;</span>);
      }

      <span class="hljs-comment inline">// UTF-8编码转换：确保中文等字符正确处理</span>
      <span class="hljs-keyword inline">const</span> buffer = <span class="hljs-title class_ inline">Buffer</span>.<span class="hljs-title function_ inline">from</span>(plaintext, <span class="hljs-string inline">&#x27;utf8&#x27;</span>);
      
      <span class="hljs-comment inline">// 核心加密逻辑：使用OAEP填充的RSA加密</span>
      <span class="hljs-comment inline">// 选择Node.js crypto而非jsrsasign的原因：更可靠的OAEP实现</span>
      <span class="hljs-keyword inline">const</span> encrypted = crypto.<span class="hljs-title function_ inline">publicEncrypt</span>(
        {
          <span class="hljs-attr inline">key</span>: <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">publicKeyPEM</span>,                              <span class="hljs-comment inline">// PEM格式公钥</span>
          <span class="hljs-attr inline">padding</span>: crypto.<span class="hljs-property inline">constants</span>.<span class="hljs-property inline">RSA_PKCS1_OAEP_PADDING</span>,   <span class="hljs-comment inline">// OAEP填充，防止填充攻击</span>
          <span class="hljs-attr inline">oaepHash</span>: <span class="hljs-string inline">&#x27;sha256&#x27;</span>,                                  <span class="hljs-comment inline">// SHA-256哈希函数</span>
        },
        buffer
      );

      <span class="hljs-comment inline">// Base64编码：便于网络传输和存储</span>
      <span class="hljs-keyword inline">return</span> encrypted.<span class="hljs-title function_ inline">toString</span>(<span class="hljs-string inline">&#x27;base64&#x27;</span>);
    } <span class="hljs-keyword inline">catch</span> (error) {
      <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">`RSA encryption failed: <span class="hljs-subst inline">${error.message}</span>`</span>);
    }
  }

  <span class="hljs-comment inline">// RSA-OAEP解密实现：临时解密策略的核心</span>
  <span class="hljs-title function_ inline">decrypt</span>(<span class="hljs-params inline">encryptedData</span>) {
    <span class="hljs-keyword inline">try</span> {
      <span class="hljs-comment inline">// 输入验证：确保密文格式正确</span>
      <span class="hljs-keyword inline">if</span> (!encryptedData || <span class="hljs-keyword inline">typeof</span> encryptedData !== <span class="hljs-string inline">&#x27;string&#x27;</span>) {
        <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">&#x27;Invalid encrypted data for decryption&#x27;</span>);
      }

      <span class="hljs-comment inline">// Base64解码：恢复二进制密文</span>
      <span class="hljs-keyword inline">const</span> encryptedBuffer = <span class="hljs-title class_ inline">Buffer</span>.<span class="hljs-title function_ inline">from</span>(encryptedData, <span class="hljs-string inline">&#x27;base64&#x27;</span>);
      
      <span class="hljs-comment inline">// 核心解密逻辑：使用私钥解密</span>
      <span class="hljs-keyword inline">const</span> decrypted = crypto.<span class="hljs-title function_ inline">privateDecrypt</span>(
        {
          <span class="hljs-attr inline">key</span>: <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">privateKeyPEM</span>,                             <span class="hljs-comment inline">// PEM格式私钥</span>
          <span class="hljs-attr inline">padding</span>: crypto.<span class="hljs-property inline">constants</span>.<span class="hljs-property inline">RSA_PKCS1_OAEP_PADDING</span>,   <span class="hljs-comment inline">// 与加密保持一致的填充</span>
          <span class="hljs-attr inline">oaepHash</span>: <span class="hljs-string inline">&#x27;sha256&#x27;</span>,                                  <span class="hljs-comment inline">// 与加密保持一致的哈希</span>
        },
        encryptedBuffer
      );

      <span class="hljs-comment inline">// UTF-8解码：恢复原始字符串</span>
      <span class="hljs-keyword inline">return</span> decrypted.<span class="hljs-title function_ inline">toString</span>(<span class="hljs-string inline">&#x27;utf8&#x27;</span>);
    } <span class="hljs-keyword inline">catch</span> (error) {
      <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">`RSA decryption failed: <span class="hljs-subst inline">${error.message}</span>`</span>);
    }
  }

  <span class="hljs-comment inline">// 灵活加密接口：支持使用任意公钥加密（测试用）</span>
  <span class="hljs-title function_ inline">encryptWithPublicKey</span>(<span class="hljs-params inline">plaintext, publicKeyPEM</span>) {
    <span class="hljs-keyword inline">try</span> {
      <span class="hljs-keyword inline">if</span> (!plaintext || <span class="hljs-keyword inline">typeof</span> plaintext !== <span class="hljs-string inline">&#x27;string&#x27;</span>) {
        <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">&#x27;Invalid plaintext for encryption&#x27;</span>);
      }

      <span class="hljs-keyword inline">const</span> buffer = <span class="hljs-title class_ inline">Buffer</span>.<span class="hljs-title function_ inline">from</span>(plaintext, <span class="hljs-string inline">&#x27;utf8&#x27;</span>);
      
      <span class="hljs-comment inline">// 使用外部提供的公钥进行加密</span>
      <span class="hljs-keyword inline">const</span> encrypted = crypto.<span class="hljs-title function_ inline">publicEncrypt</span>(
        {
          <span class="hljs-attr inline">key</span>: publicKeyPEM,                                   <span class="hljs-comment inline">// 外部公钥</span>
          <span class="hljs-attr inline">padding</span>: crypto.<span class="hljs-property inline">constants</span>.<span class="hljs-property inline">RSA_PKCS1_OAEP_PADDING</span>,
          <span class="hljs-attr inline">oaepHash</span>: <span class="hljs-string inline">&#x27;sha256&#x27;</span>,
        },
        buffer
      );

      <span class="hljs-keyword inline">return</span> encrypted.<span class="hljs-title function_ inline">toString</span>(<span class="hljs-string inline">&#x27;base64&#x27;</span>);
    } <span class="hljs-keyword inline">catch</span> (error) {
      <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">`RSA encryption with provided key failed: <span class="hljs-subst inline">${error.message}</span>`</span>);
    }
  }

  <span class="hljs-comment inline">// 密钥验证工具：确保密钥格式正确</span>
  <span class="hljs-title function_ inline">validateKey</span>(<span class="hljs-params inline">keyPEM, isPrivate = <span class="hljs-literal inline">false</span></span>) {
    <span class="hljs-keyword inline">try</span> {
      <span class="hljs-keyword inline">const</span> keyObj = <span class="hljs-variable constant_ inline">KEYUTIL</span>.<span class="hljs-title function_ inline">getKey</span>(keyPEM);
      <span class="hljs-keyword inline">return</span> keyObj &amp;&amp; (isPrivate ? keyObj.<span class="hljs-property inline">isPrivate</span> : keyObj.<span class="hljs-property inline">isPublic</span>);
    } <span class="hljs-keyword inline">catch</span> (error) {
      <span class="hljs-keyword inline">return</span> <span class="hljs-literal inline">false</span>;   <span class="hljs-comment inline">// 验证失败返回false而非抛出异常</span>
    }
  }
}

<span class="hljs-comment inline">// 单例模式导出：全局唯一实例，节省内存并保证缓存一致性</span>
<span class="hljs-keyword inline">const</span> rsaCrypto = <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">RSACrypto</span>();

<span class="hljs-comment inline">// 模块导出：提供多种使用方式</span>
<span class="hljs-variable language_ inline">module</span>.<span class="hljs-property inline">exports</span> = {
  <span class="hljs-title class_ inline">RSACrypto</span>,                                                    <span class="hljs-comment inline">// 导出类（用于扩展）</span>
  rsaCrypto,                                                   <span class="hljs-comment inline">// 导出单例实例</span>
  <span class="hljs-attr inline">generateKeyPair</span>: <span class="hljs-function inline">(<span class="hljs-params inline">keySize</span>) =&gt;</span> rsaCrypto.<span class="hljs-title function_ inline">generateKeyPair</span>(keySize),     <span class="hljs-comment inline">// 便利函数</span>
  <span class="hljs-attr inline">encrypt</span>: <span class="hljs-function inline">(<span class="hljs-params inline">plaintext</span>) =&gt;</span> rsaCrypto.<span class="hljs-title function_ inline">encrypt</span>(plaintext),                 <span class="hljs-comment inline">// 便利函数</span>
  <span class="hljs-attr inline">decrypt</span>: <span class="hljs-function inline">(<span class="hljs-params inline">encryptedData</span>) =&gt;</span> rsaCrypto.<span class="hljs-title function_ inline">decrypt</span>(encryptedData),         <span class="hljs-comment inline">// 便利函数</span>
  <span class="hljs-attr inline">getPublicKey</span>: <span class="hljs-function inline">() =&gt;</span> rsaCrypto.<span class="hljs-title function_ inline">getPublicKey</span>(),                         <span class="hljs-comment inline">// 便利函数</span>
  <span class="hljs-attr inline">encryptWithPublicKey</span>: <span class="hljs-function inline">(<span class="hljs-params inline">plaintext, publicKey</span>) =&gt;</span> rsaCrypto.<span class="hljs-title function_ inline">encryptWithPublicKey</span>(plaintext, publicKey),
  <span class="hljs-attr inline">validateKey</span>: <span class="hljs-function inline">(<span class="hljs-params inline">keyPEM, isPrivate</span>) =&gt;</span> rsaCrypto.<span class="hljs-title function_ inline">validateKey</span>(keyPEM, isPrivate)
};
</code></pre>
            </div>
        
<h3 id="密钥初始化设计" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#密钥初始化设计" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 密钥初始化设计">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            密钥初始化设计
        </h3>
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">环境变量优先</strong>：生产环境使用预配置的密钥</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">自动生成兜底</strong>：开发环境自动生成临时密钥</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">格式兼容性</strong>：处理转义字符的兼容性问题</li>
</ol>
<h3 id="加密数据的存储策略" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#加密数据的存储策略" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 加密数据的存储策略">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            加密数据的存储策略
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="%2F%2F%20%E4%BD%BF%E7%94%A8RSA%E8%A7%A3%E5%AF%86API%E5%AF%86%E9%92%A5%E7%9A%84%E6%96%B9%E6%B3%95%0AuserSchema.methods.decryptApiKey%20%3D%20function(encryptedKey%20%3D%20null)%20%7B%0Atry%20%7B%0Aconst%20keyToDecrypt%20%3D%20encryptedKey%20%7C%7C%20this.apiKey%3B%0Aif%20(!keyToDecrypt)%20%7B%0Areturn%20null%3B%0A%7D%0A%2F%2F%20%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E4%B8%BARSA%E5%8A%A0%E5%AF%86%EF%BC%88%E5%89%8D%E7%AB%AF%E4%BC%A0%E6%9D%A5%E7%9A%84base64%E6%A0%BC%E5%BC%8F%EF%BC%89%0Aif%20(keyToDecrypt.startsWith('rsa%3A'))%20%7B%0Aconst%20encryptedData%20%3D%20keyToDecrypt.substring(4)%3B%0Areturn%20decrypt(encryptedData)%3B%0A%7D%0A%2F%2F%20%E5%A6%82%E6%9E%9C%E4%B8%8D%E6%98%AF%E5%8A%A0%E5%AF%86%E7%9A%84%EF%BC%8C%E7%9B%B4%E6%8E%A5%E8%BF%94%E5%9B%9E%EF%BC%88%E5%BC%80%E5%8F%91%2F%E6%B5%8B%E8%AF%95%E7%94%A8%EF%BC%89%0Areturn%20keyToDecrypt%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60API%20key%20decryption%20failed%3A%20%24%7Berror.message%7D%60)%3B%0A%7D%0A%7D%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-comment inline">// 使用RSA解密API密钥的方法</span>
userSchema.<span class="hljs-property inline">methods</span>.<span class="hljs-property inline">decryptApiKey</span> = <span class="hljs-keyword inline">function</span>(<span class="hljs-params inline">encryptedKey = <span class="hljs-literal inline">null</span></span>) {
  <span class="hljs-keyword inline">try</span> {
    <span class="hljs-keyword inline">const</span> keyToDecrypt = encryptedKey || <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">apiKey</span>;
    
    <span class="hljs-keyword inline">if</span> (!keyToDecrypt) {
      <span class="hljs-keyword inline">return</span> <span class="hljs-literal inline">null</span>;
    }

    <span class="hljs-comment inline">// 检查是否为RSA加密（前端传来的base64格式）</span>
    <span class="hljs-keyword inline">if</span> (keyToDecrypt.<span class="hljs-title function_ inline">startsWith</span>(<span class="hljs-string inline">&#x27;rsa:&#x27;</span>)) {
      <span class="hljs-keyword inline">const</span> encryptedData = keyToDecrypt.<span class="hljs-title function_ inline">substring</span>(<span class="hljs-number inline">4</span>);
      <span class="hljs-keyword inline">return</span> <span class="hljs-title function_ inline">decrypt</span>(encryptedData);
    }
    
    <span class="hljs-comment inline">// 如果不是加密的，直接返回（开发/测试用）</span>
    <span class="hljs-keyword inline">return</span> keyToDecrypt;
  } <span class="hljs-keyword inline">catch</span> (error) {
    <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">`API key decryption failed: <span class="hljs-subst inline">${error.message}</span>`</span>);
  }
};
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">存储策略</strong>：</p>
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">前缀标识</strong>：<code>rsa:</code>前缀标识加密数据</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">兼容性处理</strong>：支持明文存储（开发环境）</li>
</ol>
<h2 id="后端rsa密钥管理与加密服务" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#后端rsa密钥管理与加密服务" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 后端RSA密钥管理与加密服务">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            后端RSA密钥管理与加密服务
        </h2>
<h3 id="rsacrypto类的单例模式设计" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#rsacrypto类的单例模式设计" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to RSACrypto类的单例模式设计">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            RSACrypto类的单例模式设计
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="%2F%2F%20%E5%AF%BC%E5%87%BA%E5%8D%95%E4%BE%8B%E5%AE%9E%E4%BE%8B%0Aconst%20rsaCrypto%20%3D%20new%20RSACrypto()%3B%0Amodule.exports%20%3D%20%7B%0ARSACrypto%2C%0ArsaCrypto%2C%0AgenerateKeyPair%3A%20(keySize)%20%3D%3E%20rsaCrypto.generateKeyPair(keySize)%2C%0Aencrypt%3A%20(plaintext)%20%3D%3E%20rsaCrypto.encrypt(plaintext)%2C%0Adecrypt%3A%20(encryptedData)%20%3D%3E%20rsaCrypto.decrypt(encryptedData)%2C%0AgetPublicKey%3A%20()%20%3D%3E%20rsaCrypto.getPublicKey()%2C%0AencryptWithPublicKey%3A%20(plaintext%2C%20publicKey)%20%3D%3E%20rsaCrypto.encryptWithPublicKey(plaintext%2C%20publicKey)%2C%0AvalidateKey%3A%20(keyPEM%2C%20isPrivate)%20%3D%3E%20rsaCrypto.validateKey(keyPEM%2C%20isPrivate)%0A%7D%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-comment inline">// 导出单例实例</span>
<span class="hljs-keyword inline">const</span> rsaCrypto = <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">RSACrypto</span>();

<span class="hljs-variable language_ inline">module</span>.<span class="hljs-property inline">exports</span> = {
  <span class="hljs-title class_ inline">RSACrypto</span>,
  rsaCrypto,
  <span class="hljs-attr inline">generateKeyPair</span>: <span class="hljs-function inline">(<span class="hljs-params inline">keySize</span>) =&gt;</span> rsaCrypto.<span class="hljs-title function_ inline">generateKeyPair</span>(keySize),
  <span class="hljs-attr inline">encrypt</span>: <span class="hljs-function inline">(<span class="hljs-params inline">plaintext</span>) =&gt;</span> rsaCrypto.<span class="hljs-title function_ inline">encrypt</span>(plaintext),
  <span class="hljs-attr inline">decrypt</span>: <span class="hljs-function inline">(<span class="hljs-params inline">encryptedData</span>) =&gt;</span> rsaCrypto.<span class="hljs-title function_ inline">decrypt</span>(encryptedData),
  <span class="hljs-attr inline">getPublicKey</span>: <span class="hljs-function inline">() =&gt;</span> rsaCrypto.<span class="hljs-title function_ inline">getPublicKey</span>(),
  <span class="hljs-attr inline">encryptWithPublicKey</span>: <span class="hljs-function inline">(<span class="hljs-params inline">plaintext, publicKey</span>) =&gt;</span> rsaCrypto.<span class="hljs-title function_ inline">encryptWithPublicKey</span>(plaintext, publicKey),
  <span class="hljs-attr inline">validateKey</span>: <span class="hljs-function inline">(<span class="hljs-params inline">keyPEM, isPrivate</span>) =&gt;</span> rsaCrypto.<span class="hljs-title function_ inline">validateKey</span>(keyPEM, isPrivate)
};
</code></pre>
            </div>
        
<h3 id="密钥初始化策略" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#密钥初始化策略" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 密钥初始化策略">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            密钥初始化策略
        </h3>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">生成策略</strong>：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="%2F%2F%20%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%EF%BC%9A%E4%BD%BF%E7%94%A8%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%0Aif%20(process.env.RSA_PUBLIC_KEY%20%26%26%20process.env.RSA_PRIVATE_KEY)%20%7B%0A%2F%2F%20%E4%BD%BF%E7%94%A8%E9%A2%84%E9%85%8D%E7%BD%AE%E7%9A%84%E5%AF%86%E9%92%A5%E5%AF%B9%0A%7D%20else%20%7B%0A%2F%2F%20%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%EF%BC%9A%E5%8A%A8%E6%80%81%E7%94%9F%E6%88%90%0Aconst%20keyPair%20%3D%20this.generateKeyPair()%3B%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-comment inline">// 生产环境：使用环境变量</span>
<span class="hljs-keyword inline">if</span> (process.<span class="hljs-property inline">env</span>.<span class="hljs-property inline">RSA_PUBLIC_KEY</span> &amp;&amp; process.<span class="hljs-property inline">env</span>.<span class="hljs-property inline">RSA_PRIVATE_KEY</span>) {
  <span class="hljs-comment inline">// 使用预配置的密钥对</span>
} <span class="hljs-keyword inline">else</span> {
  <span class="hljs-comment inline">// 开发环境：动态生成</span>
  <span class="hljs-keyword inline">const</span> keyPair = <span class="hljs-variable language_ inline">this</span>.<span class="hljs-title function_ inline">generateKeyPair</span>();
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">密钥生成的数学过程</strong>：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="%2F%2F%20%E7%94%9F%E6%88%90RSA%E5%AF%86%E9%92%A5%E5%AF%B9%0AgenerateKeyPair(keySize%20%3D%202048)%20%7B%0Atry%20%7B%0Aconst%20keyPair%20%3D%20KEYUTIL.generateKeypair('RSA'%2C%20keySize)%3B%0Aconst%20publicKeyPEM%20%3D%20KEYUTIL.getPEM(keyPair.pubKeyObj)%3B%0Aconst%20privateKeyPEM%20%3D%20KEYUTIL.getPEM(keyPair.prvKeyObj%2C%20'PKCS8PRV')%3B%0Areturn%20%7B%20publicKeyPEM%2C%20privateKeyPEM%20%7D%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60RSA%20key%20generation%20failed%3A%20%24%7Berror.message%7D%60)%3B%0A%7D%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-comment inline">// 生成RSA密钥对</span>
<span class="hljs-title function_ inline">generateKeyPair</span>(<span class="hljs-params inline">keySize = <span class="hljs-number inline">2048</span></span>) {
  <span class="hljs-keyword inline">try</span> {
    <span class="hljs-keyword inline">const</span> keyPair = <span class="hljs-variable constant_ inline">KEYUTIL</span>.<span class="hljs-title function_ inline">generateKeypair</span>(<span class="hljs-string inline">&#x27;RSA&#x27;</span>, keySize);
    <span class="hljs-keyword inline">const</span> publicKeyPEM = <span class="hljs-variable constant_ inline">KEYUTIL</span>.<span class="hljs-title function_ inline">getPEM</span>(keyPair.<span class="hljs-property inline">pubKeyObj</span>);
    <span class="hljs-keyword inline">const</span> privateKeyPEM = <span class="hljs-variable constant_ inline">KEYUTIL</span>.<span class="hljs-title function_ inline">getPEM</span>(keyPair.<span class="hljs-property inline">prvKeyObj</span>, <span class="hljs-string inline">&#x27;PKCS8PRV&#x27;</span>);
    
    <span class="hljs-keyword inline">return</span> { publicKeyPEM, privateKeyPEM };
  } <span class="hljs-keyword inline">catch</span> (error) {
    <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">`RSA key generation failed: <span class="hljs-subst inline">${error.message}</span>`</span>);
  }
}
</code></pre>
            </div>
        
<h3 id="nodejs-crypto模块的oaep实现" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#nodejs-crypto模块的oaep实现" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Node.js crypto模块的OAEP实现">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Node.js crypto模块的OAEP实现
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="%2F%2F%20%E4%BD%BF%E7%94%A8RSA-OAEP%E5%92%8C%E5%85%AC%E9%92%A5%E5%8A%A0%E5%AF%86%E6%95%B0%E6%8D%AE%0Aencrypt(plaintext)%20%7B%0Atry%20%7B%0Aif%20(!plaintext%20%7C%7C%20typeof%20plaintext%20!%3D%3D%20'string')%20%7B%0Athrow%20new%20Error('Invalid%20plaintext%20for%20encryption')%3B%0A%7D%0A%2F%2F%20%E5%B0%86%E6%98%8E%E6%96%87%E8%BD%AC%E6%8D%A2%E4%B8%BABuffer%0Aconst%20buffer%20%3D%20Buffer.from(plaintext%2C%20'utf8')%3B%0A%2F%2F%20%E4%BD%BF%E7%94%A8Node.js%20crypto%E6%A8%A1%E5%9D%97%E8%BF%9B%E8%A1%8CRSA-OAEP%E5%8A%A0%E5%AF%86%EF%BC%88%E6%AF%94jsrsasign%E6%9B%B4%E5%8F%AF%E9%9D%A0%EF%BC%89%0Aconst%20encrypted%20%3D%20crypto.publicEncrypt(%0A%7B%0Akey%3A%20this.publicKeyPEM%2C%0Apadding%3A%20crypto.constants.RSA_PKCS1_OAEP_PADDING%2C%0AoaepHash%3A%20'sha256'%2C%0A%7D%2C%0Abuffer%0A)%3B%0Areturn%20encrypted.toString('base64')%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60RSA%20encryption%20failed%3A%20%24%7Berror.message%7D%60)%3B%0A%7D%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-comment inline">// 使用RSA-OAEP和公钥加密数据</span>
<span class="hljs-title function_ inline">encrypt</span>(<span class="hljs-params inline">plaintext</span>) {
  <span class="hljs-keyword inline">try</span> {
    <span class="hljs-keyword inline">if</span> (!plaintext || <span class="hljs-keyword inline">typeof</span> plaintext !== <span class="hljs-string inline">&#x27;string&#x27;</span>) {
      <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">&#x27;Invalid plaintext for encryption&#x27;</span>);
    }

    <span class="hljs-comment inline">// 将明文转换为Buffer</span>
    <span class="hljs-keyword inline">const</span> buffer = <span class="hljs-title class_ inline">Buffer</span>.<span class="hljs-title function_ inline">from</span>(plaintext, <span class="hljs-string inline">&#x27;utf8&#x27;</span>);
    
    <span class="hljs-comment inline">// 使用Node.js crypto模块进行RSA-OAEP加密（比jsrsasign更可靠）</span>
    <span class="hljs-keyword inline">const</span> encrypted = crypto.<span class="hljs-title function_ inline">publicEncrypt</span>(
      {
        <span class="hljs-attr inline">key</span>: <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">publicKeyPEM</span>,
        <span class="hljs-attr inline">padding</span>: crypto.<span class="hljs-property inline">constants</span>.<span class="hljs-property inline">RSA_PKCS1_OAEP_PADDING</span>,
        <span class="hljs-attr inline">oaepHash</span>: <span class="hljs-string inline">&#x27;sha256&#x27;</span>,
      },
      buffer
    );

    <span class="hljs-keyword inline">return</span> encrypted.<span class="hljs-title function_ inline">toString</span>(<span class="hljs-string inline">&#x27;base64&#x27;</span>);
  } <span class="hljs-keyword inline">catch</span> (error) {
    <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">`RSA encryption failed: <span class="hljs-subst inline">${error.message}</span>`</span>);
  }
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">OAEP参数解析</strong>：</p>
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">padding: RSA_PKCS1_OAEP_PADDING</strong>：使用OAEP填充方案</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">oaepHash: ‘sha256’</strong>：使用SHA-256作为哈希函数</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">输出格式</strong>：Base64编码便于传输</li>
</ol>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">为什么混合使用jsrsasign和crypto？</strong></p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">jsrsasign</strong>：密钥生成和管理</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">crypto</strong>：加密解密操作（性能更好）</li>
</ul>
<h2 id="前端rsa加密实现深度剖析" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#前端rsa加密实现深度剖析" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 前端RSA加密实现深度剖析">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            前端RSA加密实现深度剖析
        </h2>
<h3 id="web-crypto-api的使用" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#web-crypto-api的使用" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Web Crypto API的使用">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Web Crypto API的使用
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20%E4%BD%BF%E7%94%A8RSA-OAEP%E8%BF%9B%E8%A1%8C%E5%8A%A0%E5%AF%86%EF%BC%88%E4%B8%8E%E5%90%8E%E7%AB%AF%E5%85%BC%E5%AE%B9%EF%BC%89%0Aasync%20encrypt(plaintext%3A%20string)%3A%20Promisestring%3E%20%7B%0Aif%20(!this.publicKey)%20%7B%0Athrow%20new%20Error('Public%20key%20not%20set.%20Call%20setPublicKey()%20first.')%3B%0A%7D%0Aif%20(!plaintext%20%7C%7C%20typeof%20plaintext%20!%3D%3D%20'string')%20%7B%0Athrow%20new%20Error('Invalid%20plaintext%20for%20encryption')%3B%0A%7D%0Atry%20%7B%0A%2F%2F%20%E4%BD%BF%E7%94%A8Web%20Crypto%20API%E8%BF%9B%E8%A1%8CRSA-OAEP%E5%8A%A0%E5%AF%86%0A%2F%2F%20%E9%A6%96%E5%85%88%EF%BC%8C%E5%AF%BC%E5%85%A5%E5%85%AC%E9%92%A5%0Aconst%20publicKeyBuffer%20%3D%20this.pemToArrayBuffer(this.publicKey)%3B%0Aconst%20cryptoKey%20%3D%20await%20window.crypto.subtle.importKey(%0A'spki'%2C%0ApublicKeyBuffer%2C%0A%7B%0Aname%3A%20'RSA-OAEP'%2C%0Ahash%3A%20'SHA-256'%2C%0A%7D%2C%0Afalse%2C%0A%5B'encrypt'%5D%0A)%3B%0A%2F%2F%20%E5%8A%A0%E5%AF%86%E6%98%8E%E6%96%87%0Aconst%20plaintextBuffer%20%3D%20new%20TextEncoder().encode(plaintext)%3B%0Aconst%20encryptedBuffer%20%3D%20await%20window.crypto.subtle.encrypt(%0A%7B%0Aname%3A%20'RSA-OAEP'%2C%0A%7D%2C%0AcryptoKey%2C%0AplaintextBuffer%0A)%3B%0A%2F%2F%20%E8%BD%AC%E4%B8%BAbase64%E4%BB%A5%E5%8C%B9%E9%85%8D%E5%90%8E%E7%AB%AF%E6%A0%BC%E5%BC%8F%0Areturn%20this.arrayBufferToBase64(encryptedBuffer)%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60RSA%20encryption%20failed%3A%20%24%7Berror%20instanceof%20Error%20%3F%20error.message%20%3A%20'Unknown%20error'%7D%60)%3B%0A%7D%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// 使用RSA-OAEP进行加密（与后端兼容）</span>
<span class="hljs-keyword inline">async</span> <span class="hljs-title function_ inline">encrypt</span>(<span class="hljs-attr inline">plaintext</span>: <span class="hljs-built_in inline">string</span>): <span class="hljs-title class_ inline">Promise</span>&lt;<span class="hljs-built_in inline">string</span>&gt; {
  <span class="hljs-keyword inline">if</span> (!<span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">publicKey</span>) {
    <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">&#x27;Public key not set. Call setPublicKey() first.&#x27;</span>);
  }

  <span class="hljs-keyword inline">if</span> (!plaintext || <span class="hljs-keyword inline">typeof</span> plaintext !== <span class="hljs-string inline">&#x27;string&#x27;</span>) {
    <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">&#x27;Invalid plaintext for encryption&#x27;</span>);
  }

  <span class="hljs-keyword inline">try</span> {
    <span class="hljs-comment inline">// 使用Web Crypto API进行RSA-OAEP加密</span>
    <span class="hljs-comment inline">// 首先，导入公钥</span>
    <span class="hljs-keyword inline">const</span> publicKeyBuffer = <span class="hljs-variable language_ inline">this</span>.<span class="hljs-title function_ inline">pemToArrayBuffer</span>(<span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">publicKey</span>);

    <span class="hljs-keyword inline">const</span> cryptoKey = <span class="hljs-keyword inline">await</span> <span class="hljs-variable language_ inline">window</span>.<span class="hljs-property inline">crypto</span>.<span class="hljs-property inline">subtle</span>.<span class="hljs-title function_ inline">importKey</span>(
      <span class="hljs-string inline">&#x27;spki&#x27;</span>,
      publicKeyBuffer,
      {
        <span class="hljs-attr inline">name</span>: <span class="hljs-string inline">&#x27;RSA-OAEP&#x27;</span>,
        <span class="hljs-attr inline">hash</span>: <span class="hljs-string inline">&#x27;SHA-256&#x27;</span>,
      },
      <span class="hljs-literal inline">false</span>,
      [<span class="hljs-string inline">&#x27;encrypt&#x27;</span>]
    );

    <span class="hljs-comment inline">// 加密明文</span>
    <span class="hljs-keyword inline">const</span> plaintextBuffer = <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">TextEncoder</span>().<span class="hljs-title function_ inline">encode</span>(plaintext);
    <span class="hljs-keyword inline">const</span> encryptedBuffer = <span class="hljs-keyword inline">await</span> <span class="hljs-variable language_ inline">window</span>.<span class="hljs-property inline">crypto</span>.<span class="hljs-property inline">subtle</span>.<span class="hljs-title function_ inline">encrypt</span>(
      {
        <span class="hljs-attr inline">name</span>: <span class="hljs-string inline">&#x27;RSA-OAEP&#x27;</span>,
      },
      cryptoKey,
      plaintextBuffer
    );

    <span class="hljs-comment inline">// 转为base64以匹配后端格式</span>
    <span class="hljs-keyword inline">return</span> <span class="hljs-variable language_ inline">this</span>.<span class="hljs-title function_ inline">arrayBufferToBase64</span>(encryptedBuffer);
  } <span class="hljs-keyword inline">catch</span> (error) {
    <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">`RSA encryption failed: <span class="hljs-subst inline">${error <span class="hljs-keyword inline">instanceof</span> <span class="hljs-built_in inline">Error</span> ? error.message : <span class="hljs-string inline">&#x27;Unknown error&#x27;</span>}</span>`</span>);
  }
}
</code></pre>
            </div>
        
<h3 id="pem格式密钥的处理" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#pem格式密钥的处理" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to PEM格式密钥的处理">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            PEM格式密钥的处理
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20%E8%BE%85%E5%8A%A9%E6%96%B9%E6%B3%95%EF%BC%9A%E5%B0%86PEM%E6%A0%BC%E5%BC%8F%E8%BD%AC%E6%8D%A2%E4%B8%BAArrayBuffer%0Aprivate%20pemToArrayBuffer(pem%3A%20string)%3A%20ArrayBuffer%20%7B%0A%2F%2F%20%E7%A7%BB%E9%99%A4%E5%A4%B4%E9%83%A8%E5%92%8C%E5%B0%BE%E9%83%A8%0Aconst%20pemHeader%20%3D%20'-----BEGIN%20PUBLIC%20KEY-----'%3B%0Aconst%20pemFooter%20%3D%20'-----END%20PUBLIC%20KEY-----'%3B%0Aconst%20pemContents%20%3D%20pem.replace(pemHeader%2C%20'').replace(pemFooter%2C%20'').replace(%2F%5Cs%2Fg%2C%20'')%3B%0A%2F%2F%20base64%E8%A7%A3%E7%A0%81%E4%B8%BA%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AD%97%E7%AC%A6%E4%B8%B2%0Aconst%20binaryString%20%3D%20atob(pemContents)%3B%0A%2F%2F%20%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%ACArrayBuffer%0Aconst%20bytes%20%3D%20new%20Uint8Array(binaryString.length)%3B%0Afor%20(let%20i%20%3D%200%3B%20i%20length%3B%20i%2B%2B)%20%7B%0Abytes%5Bi%5D%20%3D%20binaryString.charCodeAt(i)%3B%0A%7D%0Areturn%20bytes.buffer%3B%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// 辅助方法：将PEM格式转换为ArrayBuffer</span>
<span class="hljs-keyword inline">private</span> <span class="hljs-title function_ inline">pemToArrayBuffer</span>(<span class="hljs-attr inline">pem</span>: <span class="hljs-built_in inline">string</span>): <span class="hljs-title class_ inline">ArrayBuffer</span> {
  <span class="hljs-comment inline">// 移除头部和尾部</span>
  <span class="hljs-keyword inline">const</span> pemHeader = <span class="hljs-string inline">&#x27;-----BEGIN PUBLIC KEY-----&#x27;</span>;
  <span class="hljs-keyword inline">const</span> pemFooter = <span class="hljs-string inline">&#x27;-----END PUBLIC KEY-----&#x27;</span>;
  <span class="hljs-keyword inline">const</span> pemContents = pem.<span class="hljs-title function_ inline">replace</span>(pemHeader, <span class="hljs-string inline">&#x27;&#x27;</span>).<span class="hljs-title function_ inline">replace</span>(pemFooter, <span class="hljs-string inline">&#x27;&#x27;</span>).<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/\s/g</span>, <span class="hljs-string inline">&#x27;&#x27;</span>);

  <span class="hljs-comment inline">// base64解码为二进制字符串</span>
  <span class="hljs-keyword inline">const</span> binaryString = <span class="hljs-title function_ inline">atob</span>(pemContents);

  <span class="hljs-comment inline">// 二进制字符串转ArrayBuffer</span>
  <span class="hljs-keyword inline">const</span> bytes = <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Uint8Array</span>(binaryString.<span class="hljs-property inline">length</span>);
  <span class="hljs-keyword inline">for</span> (<span class="hljs-keyword inline">let</span> i = <span class="hljs-number inline">0</span>; i &lt; binaryString.<span class="hljs-property inline">length</span>; i++) {
    bytes[i] = binaryString.<span class="hljs-title function_ inline">charCodeAt</span>(i);
  }

  <span class="hljs-keyword inline">return</span> bytes.<span class="hljs-property inline">buffer</span>;
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">PEM格式解析</strong>：</p>
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">头尾去除</strong>：移除PEM格式的标识头</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">空白清理</strong>：去除所有空白字符</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Base64解码</strong>：将Base64字符串转换为二进制</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">ArrayBuffer转换</strong>：转换为Web Crypto API需要的格式</li>
</ol>
<h3 id="arraybuffer和base64的转换" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#arraybuffer和base64的转换" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to ArrayBuffer和Base64的转换">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            ArrayBuffer和Base64的转换
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20%E8%BE%85%E5%8A%A9%E6%96%B9%E6%B3%95%EF%BC%9A%E5%B0%86ArrayBuffer%E8%BD%AC%E6%8D%A2%E4%B8%BAbase64%0Aprivate%20arrayBufferToBase64(buffer%3A%20ArrayBuffer)%3A%20string%20%7B%0Aconst%20bytes%20%3D%20new%20Uint8Array(buffer)%3B%0Alet%20binary%20%3D%20''%3B%0Afor%20(let%20i%20%3D%200%3B%20i%20byteLength%3B%20i%2B%2B)%20%7B%0Abinary%20%2B%3D%20String.fromCharCode(bytes%5Bi%5D)%3B%0A%7D%0Areturn%20btoa(binary)%3B%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// 辅助方法：将ArrayBuffer转换为base64</span>
<span class="hljs-keyword inline">private</span> <span class="hljs-title function_ inline">arrayBufferToBase64</span>(<span class="hljs-attr inline">buffer</span>: <span class="hljs-title class_ inline">ArrayBuffer</span>): <span class="hljs-built_in inline">string</span> {
  <span class="hljs-keyword inline">const</span> bytes = <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Uint8Array</span>(buffer);
  <span class="hljs-keyword inline">let</span> binary = <span class="hljs-string inline">&#x27;&#x27;</span>;
  <span class="hljs-keyword inline">for</span> (<span class="hljs-keyword inline">let</span> i = <span class="hljs-number inline">0</span>; i &lt; bytes.<span class="hljs-property inline">byteLength</span>; i++) {
    binary += <span class="hljs-title class_ inline">String</span>.<span class="hljs-title function_ inline">fromCharCode</span>(bytes[i]);
  }
  <span class="hljs-keyword inline">return</span> <span class="hljs-title function_ inline">btoa</span>(binary);
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">数据转换</strong>：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="" data-code="%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5(String)%20%E2%86%92%20TextEncoder%20%E2%86%92%20ArrayBuffer%20%E2%86%92%20Web%20Crypto%20API%20%E2%86%92%20ArrayBuffer%20%E2%86%92%20Base64%20%E2%86%92%20%E7%BD%91%E7%BB%9C%E4%BC%A0%E8%BE%93">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">code</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code>用户输入(<span class="hljs-built_in inline">String</span>) → TextEncoder → <span class="hljs-built_in inline">ArrayBuffer</span> → Web Crypto API → <span class="hljs-built_in inline">ArrayBuffer</span> → Base64 → 网络传输
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">转换步骤解释：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">TextEncoder</strong>：将字符串转换为UTF-8字节</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">ArrayBuffer</strong>：Web Crypto API的标准格式</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Base64</strong>：网络传输的安全编码</li>
</ul>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">降级策略</strong>：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20%E6%A3%80%E6%9F%A5Web%20Crypto%20API%E6%94%AF%E6%8C%81%0Aif%20(!window.crypto%20%7C%7C%20!window.crypto.subtle)%20%7B%0A%2F%2F%20%E9%99%8D%E7%BA%A7%E5%88%B0jsrsasign%E5%AE%9E%E7%8E%B0%0Areturn%20this.jsrsasignEncrypt(plaintext)%3B%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// 检查Web Crypto API支持</span>
<span class="hljs-keyword inline">if</span> (!<span class="hljs-variable language_ inline">window</span>.<span class="hljs-property inline">crypto</span> || !<span class="hljs-variable language_ inline">window</span>.<span class="hljs-property inline">crypto</span>.<span class="hljs-property inline">subtle</span>) {
  <span class="hljs-comment inline">// 降级到jsrsasign实现</span>
  <span class="hljs-keyword inline">return</span> <span class="hljs-variable language_ inline">this</span>.<span class="hljs-title function_ inline">jsrsasignEncrypt</span>(plaintext);
}
</code></pre>
            </div>
        
<h2 id="api密钥更新流程的完整实现" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#api密钥更新流程的完整实现" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to API密钥更新流程的完整实现">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            API密钥更新流程的完整实现
        </h2>
<h3 id="updateapikey接口的设计思路" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#updateapikey接口的设计思路" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to updateApiKey接口的设计思路">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            updateApiKey接口的设计思路
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="%2F%2F%20%40desc%20%20%20%20%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7API%E5%AF%86%E9%92%A5%0A%2F%2F%20%40route%20%20%20PUT%20%2Fapi%2Fauth%2Fapi-key%0A%2F%2F%20%40access%20%20Private%0Aexports.updateApiKey%20%3D%20async%20(req%2C%20res)%20%3D%3E%20%7B%0Atry%20%7B%0Aconst%20%7B%20apiKey%2C%20useCustomApiKey%20%7D%20%3D%20req.body%3B%0A%2F%2F%20%E6%A0%A1%E9%AA%8C%E8%BE%93%E5%85%A5%EF%BC%8C%E4%BB%85%E5%BD%93useCustomApiKey%E4%B8%BAtrue%E4%B8%94apiKey%E6%9C%89%E5%80%BC%E6%97%B6%E6%89%8D%E8%A6%81%E6%B1%82apiKey%0A%2F%2F%20%E5%85%81%E8%AE%B8useCustomApiKey%E4%B8%BAtrue%E4%BD%86apiKey%E4%B8%BA%E7%A9%BA%EF%BC%88%E7%94%A8%E6%88%B7%E6%89%93%E7%AE%97%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BD%86%E8%BF%98%E6%9C%AA%E8%BE%93%E5%85%A5%EF%BC%89%0Aif%20(useCustomApiKey%20%26%26%20apiKey%20%26%26%20apiKey.trim().length%20%3D%3D%3D%200)%20%7B%0Areturn%20res.status(400).json(%7B%0Asuccess%3A%20false%2C%0Amessage%3A%20req.t('auth.apiKeyRequired')%0A%7D)%3B%0A%7D%0Aconst%20user%20%3D%20await%20User.findById(req.user.id)%3B%0Aif%20(!user)%20%7B%0Areturn%20res.status(404).json(%7B%0Asuccess%3A%20false%2C%0Amessage%3A%20req.t('auth.userNotFound')%0A%7D)%3B%0A%7D%0A%2F%2F%20%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7API%E5%AF%86%E9%92%A5%E8%AE%BE%E7%BD%AE%0Aif%20(useCustomApiKey)%20%7B%0A%2F%2F%20%E5%A6%82%E6%9E%9CapiKey%E6%9C%89%E5%80%BC%E4%B8%94%E9%9D%9E%E7%A9%BA%EF%BC%8C%E7%9B%B4%E6%8E%A5%E5%AD%98%E5%82%A8%E5%89%8D%E7%AB%AF%E5%8A%A0%E5%AF%86%E5%90%8E%E7%9A%84API%E5%AF%86%E9%92%A5%0A%2F%2F%20%E5%89%8D%E7%AB%AF%E5%8F%91%E9%80%81%E5%B8%A6%E6%9C%89'rsa%3A'%E5%89%8D%E7%BC%80%E7%9A%84RSA%E5%8A%A0%E5%AF%86API%E5%AF%86%E9%92%A5%E2%80%94%E2%80%94%E6%AD%A4%E5%A4%84%E4%B8%8D%E5%81%9A%E8%A7%A3%E5%AF%86%0Aif%20(apiKey%20%26%26%20apiKey.trim().length%20%3E%200)%20%7B%0Auser.apiKey%20%3D%20apiKey.trim()%3B%20%2F%2F%20%E7%9B%B4%E6%8E%A5%E5%AD%98%E5%82%A8%E5%8A%A0%E5%AF%86%E6%95%B0%E6%8D%AE%0A%7D%20else%20%7B%0Auser.apiKey%20%3D%20undefined%3B%0A%7D%0Auser.useCustomApiKey%20%3D%20true%3B%0A%7D%20else%20%7B%0Auser.apiKey%20%3D%20undefined%3B%0Auser.useCustomApiKey%20%3D%20false%3B%0A%7D%0Aawait%20user.save()%3B%0Ares.status(200).json(%7B%0Asuccess%3A%20true%2C%0Amessage%3A%20req.t('auth.apiKeyUpdatedSuccessfully')%2C%0AuseCustomApiKey%3A%20user.useCustomApiKey%0A%7D)%3B%0A%7D%20catch%20(error)%20%7B%0Ares.status(500).json(%7B%0Asuccess%3A%20false%2C%0Amessage%3A%20req.t('auth.serverError')%0A%7D)%3B%0A%7D%0A%7D%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-comment inline">// @desc    更新用户API密钥</span>
<span class="hljs-comment inline">// @route   PUT /api/auth/api-key</span>
<span class="hljs-comment inline">// @access  Private</span>
<span class="hljs-built_in inline">exports</span>.<span class="hljs-property inline">updateApiKey</span> = <span class="hljs-title function_ inline">async</span> (req, res) =&gt; {
  <span class="hljs-keyword inline">try</span> {
    <span class="hljs-keyword inline">const</span> { apiKey, useCustomApiKey } = req.<span class="hljs-property inline">body</span>;

    <span class="hljs-comment inline">// 校验输入，仅当useCustomApiKey为true且apiKey有值时才要求apiKey</span>
    <span class="hljs-comment inline">// 允许useCustomApiKey为true但apiKey为空（用户打算自定义但还未输入）</span>
    <span class="hljs-keyword inline">if</span> (useCustomApiKey &amp;&amp; apiKey &amp;&amp; apiKey.<span class="hljs-title function_ inline">trim</span>().<span class="hljs-property inline">length</span> === <span class="hljs-number inline">0</span>) {
      <span class="hljs-keyword inline">return</span> res.<span class="hljs-title function_ inline">status</span>(<span class="hljs-number inline">400</span>).<span class="hljs-title function_ inline">json</span>({
        <span class="hljs-attr inline">success</span>: <span class="hljs-literal inline">false</span>,
        <span class="hljs-attr inline">message</span>: req.<span class="hljs-title function_ inline">t</span>(<span class="hljs-string inline">&#x27;auth.apiKeyRequired&#x27;</span>)
      });
    }

    <span class="hljs-keyword inline">const</span> user = <span class="hljs-keyword inline">await</span> <span class="hljs-title class_ inline">User</span>.<span class="hljs-title function_ inline">findById</span>(req.<span class="hljs-property inline">user</span>.<span class="hljs-property inline">id</span>);
    <span class="hljs-keyword inline">if</span> (!user) {
      <span class="hljs-keyword inline">return</span> res.<span class="hljs-title function_ inline">status</span>(<span class="hljs-number inline">404</span>).<span class="hljs-title function_ inline">json</span>({
        <span class="hljs-attr inline">success</span>: <span class="hljs-literal inline">false</span>,
        <span class="hljs-attr inline">message</span>: req.<span class="hljs-title function_ inline">t</span>(<span class="hljs-string inline">&#x27;auth.userNotFound&#x27;</span>)
      });
    }

    <span class="hljs-comment inline">// 更新用户API密钥设置</span>
    <span class="hljs-keyword inline">if</span> (useCustomApiKey) {
      <span class="hljs-comment inline">// 如果apiKey有值且非空，直接存储前端加密后的API密钥</span>
      <span class="hljs-comment inline">// 前端发送带有&#x27;rsa:&#x27;前缀的RSA加密API密钥——此处不做解密</span>
      <span class="hljs-keyword inline">if</span> (apiKey &amp;&amp; apiKey.<span class="hljs-title function_ inline">trim</span>().<span class="hljs-property inline">length</span> &gt; <span class="hljs-number inline">0</span>) {
        user.<span class="hljs-property inline">apiKey</span> = apiKey.<span class="hljs-title function_ inline">trim</span>(); <span class="hljs-comment inline">// 直接存储加密数据</span>
      } <span class="hljs-keyword inline">else</span> {
        user.<span class="hljs-property inline">apiKey</span> = <span class="hljs-literal inline">undefined</span>;
      }
      user.<span class="hljs-property inline">useCustomApiKey</span> = <span class="hljs-literal inline">true</span>;
    } <span class="hljs-keyword inline">else</span> {
      user.<span class="hljs-property inline">apiKey</span> = <span class="hljs-literal inline">undefined</span>;
      user.<span class="hljs-property inline">useCustomApiKey</span> = <span class="hljs-literal inline">false</span>;
    }

    <span class="hljs-keyword inline">await</span> user.<span class="hljs-title function_ inline">save</span>();

    res.<span class="hljs-title function_ inline">status</span>(<span class="hljs-number inline">200</span>).<span class="hljs-title function_ inline">json</span>({
      <span class="hljs-attr inline">success</span>: <span class="hljs-literal inline">true</span>,
      <span class="hljs-attr inline">message</span>: req.<span class="hljs-title function_ inline">t</span>(<span class="hljs-string inline">&#x27;auth.apiKeyUpdatedSuccessfully&#x27;</span>),
      <span class="hljs-attr inline">useCustomApiKey</span>: user.<span class="hljs-property inline">useCustomApiKey</span>
    });
  } <span class="hljs-keyword inline">catch</span> (error) {
    res.<span class="hljs-title function_ inline">status</span>(<span class="hljs-number inline">500</span>).<span class="hljs-title function_ inline">json</span>({
      <span class="hljs-attr inline">success</span>: <span class="hljs-literal inline">false</span>,
      <span class="hljs-attr inline">message</span>: req.<span class="hljs-title function_ inline">t</span>(<span class="hljs-string inline">&#x27;auth.serverError&#x27;</span>)
    });
  }
};
</code></pre>
            </div>
        
<h3 id="前端加密-→-传输-→-后端解密的完整流程" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#前端加密-→-传输-→-后端解密的完整流程" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 前端加密 → 传输 → 后端解密的完整流程">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            前端加密 → 传输 → 后端解密的完整流程
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20updateApiKey%20%3D%20async%20(apiKey%3A%20string%2C%20shouldUseCustomKey%3A%20boolean)%20%3D%3E%20%7B%0Aloading.value%20%3D%20true%0Atry%20%7B%0A%2F%2F%20%E5%8A%A0%E5%AF%86%E5%89%8D%E8%8E%B7%E5%8F%96%E6%9C%80%E6%96%B0%E5%85%AC%E9%92%A5%0Aif%20(shouldUseCustomKey%20%26%26%20apiKey)%20%7B%0Aconst%20keyResult%20%3D%20await%20fetchPublicKey()%0Aif%20(!keyResult.success)%20%7B%0Atoast.error(t('apiKey.publicKeyFetchFailed'))%0Areturn%20%7Bsuccess%3A%20false%2C%20message%3A%20t('apiKey.publicKeyFetchError')%7D%0A%7D%0A%7D%0A%2F%2F%20%E5%A6%82%E6%9E%9C%E6%9C%89%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AF%86%E9%92%A5%E4%B8%94%E6%9C%89apiKey%EF%BC%8C%E8%BF%9B%E8%A1%8C%E5%8A%A0%E5%AF%86%0Alet%20encryptedApiKey%20%3D%20''%0Aif%20(shouldUseCustomKey%20%26%26%20apiKey%20%26%26%20publicKey.value)%20%7B%0Atry%20%7B%0Aconst%20encrypted%20%3D%20await%20rsaCrypto.encrypt(apiKey)%0AencryptedApiKey%20%3D%20'rsa%3A'%20%2B%20encrypted%0A%7D%20catch%20(encryptError)%20%7B%0Atoast.error(t('apiKey.encryptionFailed'))%0Aconsole.error(encryptedApiKey)%0Areturn%20%7Bsuccess%3A%20false%2C%20message%3A%20t('apiKey.encryptionError')%7D%0A%7D%0A%7D%0Aconst%20response%20%3D%20await%20aiConfigAPI.updateApiKey(%7B%0AapiKey%3A%20shouldUseCustomKey%20%3F%20encryptedApiKey%20%3A%20''%2C%0AuseCustomApiKey%3A%20shouldUseCustomKey%0A%7D)%0Aif%20(response.data.success)%20%7B%0AuseCustomApiKey.value%20%3D%20response.data.useCustomApiKey%0AhasCustomApiKey.value%20%3D%20shouldUseCustomKey%20%26%26%20!!apiKey%0AcustomApiKey.value%20%3D%20apiKey%0Atoast.success(t('apiKey.updateSuccess'))%0Areturn%20%7Bsuccess%3A%20true%7D%0A%7D%20else%20%7B%0Aconst%20message%20%3D%20response.data.message%20%7C%7C%20t('common.error')%0Atoast.error(message)%0Areturn%20%7Bsuccess%3A%20false%2C%20message%7D%0A%7D%0A%7D%20catch%20(error%3A%20any)%20%7B%0Aconst%20message%20%3D%20error.response%3F.data%3F.message%20%7C%7C%20t('common.error')%0Atoast.error(message)%0Areturn%20%7Bsuccess%3A%20false%2C%20message%7D%0A%7D%20finally%20%7B%0Aloading.value%20%3D%20false%0A%7D%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> <span class="hljs-title function_ inline">updateApiKey</span> = <span class="hljs-keyword inline">async</span> (<span class="hljs-params inline"><span class="hljs-attr inline">apiKey</span>: <span class="hljs-built_in inline">string</span>, <span class="hljs-attr inline">shouldUseCustomKey</span>: <span class="hljs-built_in inline">boolean</span></span>) =&gt; {
  loading.<span class="hljs-property inline">value</span> = <span class="hljs-literal inline">true</span>
  <span class="hljs-keyword inline">try</span> {
    <span class="hljs-comment inline">// 加密前获取最新公钥</span>
    <span class="hljs-keyword inline">if</span> (shouldUseCustomKey &amp;&amp; apiKey) {
      <span class="hljs-keyword inline">const</span> keyResult = <span class="hljs-keyword inline">await</span> <span class="hljs-title function_ inline">fetchPublicKey</span>()
      <span class="hljs-keyword inline">if</span> (!keyResult.<span class="hljs-property inline">success</span>) {
        toast.<span class="hljs-title function_ inline">error</span>(<span class="hljs-title function_ inline">t</span>(<span class="hljs-string inline">&#x27;apiKey.publicKeyFetchFailed&#x27;</span>))
        <span class="hljs-keyword inline">return</span> {<span class="hljs-attr inline">success</span>: <span class="hljs-literal inline">false</span>, <span class="hljs-attr inline">message</span>: <span class="hljs-title function_ inline">t</span>(<span class="hljs-string inline">&#x27;apiKey.publicKeyFetchError&#x27;</span>)}
      }
    }

    <span class="hljs-comment inline">// 如果有自定义密钥且有apiKey，进行加密</span>
    <span class="hljs-keyword inline">let</span> encryptedApiKey = <span class="hljs-string inline">&#x27;&#x27;</span>
    <span class="hljs-keyword inline">if</span> (shouldUseCustomKey &amp;&amp; apiKey &amp;&amp; publicKey.<span class="hljs-property inline">value</span>) {
      <span class="hljs-keyword inline">try</span> {
        <span class="hljs-keyword inline">const</span> encrypted = <span class="hljs-keyword inline">await</span> rsaCrypto.<span class="hljs-title function_ inline">encrypt</span>(apiKey)
        encryptedApiKey = <span class="hljs-string inline">&#x27;rsa:&#x27;</span> + encrypted
      } <span class="hljs-keyword inline">catch</span> (encryptError) {
        toast.<span class="hljs-title function_ inline">error</span>(<span class="hljs-title function_ inline">t</span>(<span class="hljs-string inline">&#x27;apiKey.encryptionFailed&#x27;</span>))
        <span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">error</span>(encryptedApiKey)
        <span class="hljs-keyword inline">return</span> {<span class="hljs-attr inline">success</span>: <span class="hljs-literal inline">false</span>, <span class="hljs-attr inline">message</span>: <span class="hljs-title function_ inline">t</span>(<span class="hljs-string inline">&#x27;apiKey.encryptionError&#x27;</span>)}
      }
    }

    <span class="hljs-keyword inline">const</span> response = <span class="hljs-keyword inline">await</span> aiConfigAPI.<span class="hljs-title function_ inline">updateApiKey</span>({
      <span class="hljs-attr inline">apiKey</span>: shouldUseCustomKey ? encryptedApiKey : <span class="hljs-string inline">&#x27;&#x27;</span>,
      <span class="hljs-attr inline">useCustomApiKey</span>: shouldUseCustomKey
    })

    <span class="hljs-keyword inline">if</span> (response.<span class="hljs-property inline">data</span>.<span class="hljs-property inline">success</span>) {
      useCustomApiKey.<span class="hljs-property inline">value</span> = response.<span class="hljs-property inline">data</span>.<span class="hljs-property inline">useCustomApiKey</span>
      hasCustomApiKey.<span class="hljs-property inline">value</span> = shouldUseCustomKey &amp;&amp; !!apiKey
      customApiKey.<span class="hljs-property inline">value</span> = apiKey
      toast.<span class="hljs-title function_ inline">success</span>(<span class="hljs-title function_ inline">t</span>(<span class="hljs-string inline">&#x27;apiKey.updateSuccess&#x27;</span>))
      <span class="hljs-keyword inline">return</span> {<span class="hljs-attr inline">success</span>: <span class="hljs-literal inline">true</span>}
    } <span class="hljs-keyword inline">else</span> {
      <span class="hljs-keyword inline">const</span> message = response.<span class="hljs-property inline">data</span>.<span class="hljs-property inline">message</span> || <span class="hljs-title function_ inline">t</span>(<span class="hljs-string inline">&#x27;common.error&#x27;</span>)
      toast.<span class="hljs-title function_ inline">error</span>(message)
      <span class="hljs-keyword inline">return</span> {<span class="hljs-attr inline">success</span>: <span class="hljs-literal inline">false</span>, message}
    }
  } <span class="hljs-keyword inline">catch</span> (<span class="hljs-attr inline">error</span>: <span class="hljs-built_in inline">any</span>) {
    <span class="hljs-keyword inline">const</span> message = error.<span class="hljs-property inline">response</span>?.<span class="hljs-property inline">data</span>?.<span class="hljs-property inline">message</span> || <span class="hljs-title function_ inline">t</span>(<span class="hljs-string inline">&#x27;common.error&#x27;</span>)
    toast.<span class="hljs-title function_ inline">error</span>(message)
    <span class="hljs-keyword inline">return</span> {<span class="hljs-attr inline">success</span>: <span class="hljs-literal inline">false</span>, message}
  } <span class="hljs-keyword inline">finally</span> {
    loading.<span class="hljs-property inline">value</span> = <span class="hljs-literal inline">false</span>
  }
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">完整流程的数据变化</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">更新API密钥时</strong>：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="" data-code="%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%3A%20%22sk-1234567890abcdef%22%0A%E2%86%93%0A%E5%89%8D%E7%AB%AF%E5%8A%A0%E5%AF%86%3A%20%22rsa%3ABase64EncryptedData...%22%0A%E2%86%93%0AHTTPS%E4%BC%A0%E8%BE%93%3A%20%5BTLS%E5%8A%A0%E5%AF%86%E7%9A%84RSA%E5%8A%A0%E5%AF%86%E6%95%B0%E6%8D%AE%5D%0A%E2%86%93%0A%E5%90%8E%E7%AB%AF%E6%8E%A5%E6%94%B6%3A%20%22rsa%3ABase64EncryptedData...%22%0A%E2%86%93%0A%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%98%E5%82%A8%3A%20%22rsa%3ABase64EncryptedData...%22%20(%E7%9B%B4%E6%8E%A5%E5%AD%98%E5%82%A8%E5%AF%86%E6%96%87)">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">code</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code><span class="hljs-section inline">用户输入: &quot;sk-1234567890abcdef&quot;</span>
  ↓
<span class="hljs-section inline">前端加密: &quot;rsa:Base64EncryptedData...&quot;</span>
  ↓
<span class="hljs-section inline">HTTPS传输: [TLS加密的RSA加密数据]</span>
  ↓
<span class="hljs-section inline">后端接收: &quot;rsa:Base64EncryptedData...&quot;</span>
  ↓
<span class="hljs-section inline">数据库存储: &quot;rsa:Base64EncryptedData...&quot; (直接存储密文)</span>
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">使用API密钥调用模型时</strong>：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="" data-code="%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E5%8F%96%3A%20%22rsa%3ABase64EncryptedData...%22%0A%E2%86%93%0A%E4%B8%B4%E6%97%B6%E8%A7%A3%E5%AF%86%3A%20%22sk-1234567890abcdef%22%0A%E2%86%93%0A%E8%B0%83%E7%94%A8%E5%A4%A7%E6%A8%A1%E5%9E%8BAPI%3A%20%E4%BD%BF%E7%94%A8%E6%98%8E%E6%96%87%E5%AF%86%E9%92%A5%0A%E2%86%93%0A%E8%A7%A3%E5%AF%86%E5%90%8E%E7%AB%8B%E5%8D%B3%E6%B8%85%E7%90%86%3A%20%E6%98%8E%E6%96%87%E5%AF%86%E9%92%A5%E4%BB%8E%E5%86%85%E5%AD%98%E9%94%80%E6%AF%81">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">code</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code><span class="hljs-section inline">数据库读取: &quot;rsa:Base64EncryptedData...&quot;</span>
  ↓
<span class="hljs-section inline">临时解密: &quot;sk-1234567890abcdef&quot;</span>
  ↓
<span class="hljs-section inline">调用大模型API: 使用明文密钥</span>
  ↓
<span class="hljs-section inline">解密后立即清理: 明文密钥从内存销毁</span>
</code></pre>
            </div>
        
<h3 id="错误处理和用户体验优化" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#错误处理和用户体验优化" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 错误处理和用户体验优化">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            错误处理和用户体验优化
        </h3>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">多层错误处理</strong>：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20%E5%B1%82%E7%BA%A71%EF%BC%9A%E5%8A%A0%E5%AF%86%E5%A4%B1%E8%B4%A5%0Atry%20%7B%0Aconst%20encrypted%20%3D%20await%20rsaCrypto.encrypt(apiKey)%0AencryptedApiKey%20%3D%20'rsa%3A'%20%2B%20encrypted%0A%7D%20catch%20(encryptError)%20%7B%0Atoast.error(t('apiKey.encryptionFailed'))%0Areturn%20%7Bsuccess%3A%20false%2C%20message%3A%20t('apiKey.encryptionError')%7D%0A%7D%0A%2F%2F%20%E5%B1%82%E7%BA%A72%EF%BC%9A%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%A4%B1%E8%B4%A5%0Atry%20%7B%0Aconst%20response%20%3D%20await%20aiConfigAPI.updateApiKey(%7B...%7D)%0A%7D%20catch%20(error%3A%20any)%20%7B%0Aconst%20message%20%3D%20error.response%3F.data%3F.message%20%7C%7C%20t('common.error')%0Atoast.error(message)%0Areturn%20%7Bsuccess%3A%20false%2C%20message%7D%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// 层级1：加密失败</span>
<span class="hljs-keyword inline">try</span> {
  <span class="hljs-keyword inline">const</span> encrypted = <span class="hljs-keyword inline">await</span> rsaCrypto.<span class="hljs-title function_ inline">encrypt</span>(apiKey)
  encryptedApiKey = <span class="hljs-string inline">&#x27;rsa:&#x27;</span> + encrypted
} <span class="hljs-keyword inline">catch</span> (encryptError) {
  toast.<span class="hljs-title function_ inline">error</span>(<span class="hljs-title function_ inline">t</span>(<span class="hljs-string inline">&#x27;apiKey.encryptionFailed&#x27;</span>))
  <span class="hljs-keyword inline">return</span> {<span class="hljs-attr inline">success</span>: <span class="hljs-literal inline">false</span>, <span class="hljs-attr inline">message</span>: <span class="hljs-title function_ inline">t</span>(<span class="hljs-string inline">&#x27;apiKey.encryptionError&#x27;</span>)}
}

<span class="hljs-comment inline">// 层级2：网络请求失败</span>
<span class="hljs-keyword inline">try</span> {
  <span class="hljs-keyword inline">const</span> response = <span class="hljs-keyword inline">await</span> aiConfigAPI.<span class="hljs-title function_ inline">updateApiKey</span>({...})
} <span class="hljs-keyword inline">catch</span> (<span class="hljs-attr inline">error</span>: <span class="hljs-built_in inline">any</span>) {
  <span class="hljs-keyword inline">const</span> message = error.<span class="hljs-property inline">response</span>?.<span class="hljs-property inline">data</span>?.<span class="hljs-property inline">message</span> || <span class="hljs-title function_ inline">t</span>(<span class="hljs-string inline">&#x27;common.error&#x27;</span>)
  toast.<span class="hljs-title function_ inline">error</span>(message)
  <span class="hljs-keyword inline">return</span> {<span class="hljs-attr inline">success</span>: <span class="hljs-literal inline">false</span>, message}
}
</code></pre>
            </div>
        
<h2 id="数据存储与解密策略" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#数据存储与解密策略" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 数据存储与解密策略">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            数据存储与解密策略
        </h2>
<h3 id="加密数据的数据库存储格式" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#加密数据的数据库存储格式" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 加密数据的数据库存储格式">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            加密数据的数据库存储格式
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="%2F%2F%20%E8%87%AA%E5%AE%9A%E4%B9%89API%E5%AF%86%E9%92%A5%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%8C%E6%9C%AA%E8%AE%BE%E7%BD%AE%E6%97%B6%E4%BD%BF%E7%94%A8%E5%B9%B3%E5%8F%B0%E9%BB%98%E8%AE%A4%EF%BC%89%0A%2F%2F%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%98%E5%82%A8%E4%B8%BA%E5%8A%A0%E5%AF%86%E5%BD%A2%E5%BC%8F%0AapiKey%3A%20%7B%0Atype%3A%20String%2C%0Arequired%3A%20false%2C%0Atrim%3A%20true%0A%7D%2C%0A%2F%2F%20%E6%98%AF%E5%90%A6%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89API%E5%AF%86%E9%92%A5%0AuseCustomApiKey%3A%20%7B%0Atype%3A%20Boolean%2C%0Adefault%3A%20false%0A%7D%2C">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-comment inline">// 自定义API密钥（可选，未设置时使用平台默认）</span>
<span class="hljs-comment inline">// 数据库存储为加密形式</span>
<span class="hljs-attr inline">apiKey</span>: {
  <span class="hljs-attr inline">type</span>: <span class="hljs-title class_ inline">String</span>,
  <span class="hljs-attr inline">required</span>: <span class="hljs-literal inline">false</span>,
  <span class="hljs-attr inline">trim</span>: <span class="hljs-literal inline">true</span>
},
<span class="hljs-comment inline">// 是否使用自定义API密钥</span>
<span class="hljs-attr inline">useCustomApiKey</span>: {
  <span class="hljs-attr inline">type</span>: <span class="hljs-title class_ inline">Boolean</span>,
  <span class="hljs-attr inline">default</span>: <span class="hljs-literal inline">false</span>
},
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">数据库存储的数据格式</strong>：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="%2F%2F%20%E7%94%A8%E6%88%B7%E6%96%87%E6%A1%A3%E7%A4%BA%E4%BE%8B%0A%7B%0A_id%3A%20ObjectId(%22...%22)%2C%0Ausername%3A%20%22testuser%22%2C%0Aemail%3A%20%22test%40example.com%22%2C%0AapiKey%3A%20%22rsa%3ABase64EncodedEncryptedData...%22%2C%20%20%2F%2F%20%E5%8A%A0%E5%AF%86%E5%AD%98%E5%82%A8%0AuseCustomApiKey%3A%20true%2C%0A%2F%2F%20...%20%E5%85%B6%E4%BB%96%E5%AD%97%E6%AE%B5%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-comment inline">// 用户文档示例</span>
{
  <span class="hljs-attr inline">_id</span>: <span class="hljs-title class_ inline">ObjectId</span>(<span class="hljs-string inline">&quot;...&quot;</span>),
  <span class="hljs-attr inline">username</span>: <span class="hljs-string inline">&quot;testuser&quot;</span>,
  <span class="hljs-attr inline">email</span>: <span class="hljs-string inline">&quot;test@example.com&quot;</span>,
  <span class="hljs-attr inline">apiKey</span>: <span class="hljs-string inline">&quot;rsa:Base64EncodedEncryptedData...&quot;</span>,  <span class="hljs-comment inline">// 加密存储</span>
  <span class="hljs-attr inline">useCustomApiKey</span>: <span class="hljs-literal inline">true</span>,
  <span class="hljs-comment inline">// ... 其他字段</span>
}
</code></pre>
            </div>
        
<h3 id="rsa前缀的标识机制" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#rsa前缀的标识机制" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to rsa:前缀的标识机制">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            rsa:前缀的标识机制
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="%2F%2F%20%E4%BD%BF%E7%94%A8RSA%E8%A7%A3%E5%AF%86API%E5%AF%86%E9%92%A5%E7%9A%84%E6%96%B9%E6%B3%95%0AuserSchema.methods.decryptApiKey%20%3D%20function(encryptedKey%20%3D%20null)%20%7B%0Atry%20%7B%0Aconst%20keyToDecrypt%20%3D%20encryptedKey%20%7C%7C%20this.apiKey%3B%0Aif%20(!keyToDecrypt)%20%7B%0Areturn%20null%3B%0A%7D%0A%2F%2F%20%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E4%B8%BARSA%E5%8A%A0%E5%AF%86%EF%BC%88%E5%89%8D%E7%AB%AF%E4%BC%A0%E6%9D%A5%E7%9A%84base64%E6%A0%BC%E5%BC%8F%EF%BC%89%0Aif%20(keyToDecrypt.startsWith('rsa%3A'))%20%7B%0Aconst%20encryptedData%20%3D%20keyToDecrypt.substring(4)%3B%0Areturn%20decrypt(encryptedData)%3B%0A%7D%0A%2F%2F%20%E5%A6%82%E6%9E%9C%E4%B8%8D%E6%98%AF%E5%8A%A0%E5%AF%86%E7%9A%84%EF%BC%8C%E7%9B%B4%E6%8E%A5%E8%BF%94%E5%9B%9E%EF%BC%88%E5%BC%80%E5%8F%91%2F%E6%B5%8B%E8%AF%95%E7%94%A8%EF%BC%89%0Areturn%20keyToDecrypt%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60API%20key%20decryption%20failed%3A%20%24%7Berror.message%7D%60)%3B%0A%7D%0A%7D%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-comment inline">// 使用RSA解密API密钥的方法</span>
userSchema.<span class="hljs-property inline">methods</span>.<span class="hljs-property inline">decryptApiKey</span> = <span class="hljs-keyword inline">function</span>(<span class="hljs-params inline">encryptedKey = <span class="hljs-literal inline">null</span></span>) {
  <span class="hljs-keyword inline">try</span> {
    <span class="hljs-keyword inline">const</span> keyToDecrypt = encryptedKey || <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">apiKey</span>;
    
    <span class="hljs-keyword inline">if</span> (!keyToDecrypt) {
      <span class="hljs-keyword inline">return</span> <span class="hljs-literal inline">null</span>;
    }

    <span class="hljs-comment inline">// 检查是否为RSA加密（前端传来的base64格式）</span>
    <span class="hljs-keyword inline">if</span> (keyToDecrypt.<span class="hljs-title function_ inline">startsWith</span>(<span class="hljs-string inline">&#x27;rsa:&#x27;</span>)) {
      <span class="hljs-keyword inline">const</span> encryptedData = keyToDecrypt.<span class="hljs-title function_ inline">substring</span>(<span class="hljs-number inline">4</span>);
      <span class="hljs-keyword inline">return</span> <span class="hljs-title function_ inline">decrypt</span>(encryptedData);
    }
    
    <span class="hljs-comment inline">// 如果不是加密的，直接返回（开发/测试用）</span>
    <span class="hljs-keyword inline">return</span> keyToDecrypt;
  } <span class="hljs-keyword inline">catch</span> (error) {
    <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">`API key decryption failed: <span class="hljs-subst inline">${error.message}</span>`</span>);
  }
};
</code></pre>
            </div>
        
<h3 id="解密时机的选择策略" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#解密时机的选择策略" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 解密时机的选择策略">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            解密时机的选择策略
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="%2F%2F%20%E8%8E%B7%E5%8F%96AI%E6%9C%8D%E5%8A%A1%E7%94%A8%E7%9A%84%E8%A7%A3%E5%AF%86%E5%90%8EAPI%E5%AF%86%E9%92%A5%E7%9A%84%E6%96%B9%E6%B3%95%0AuserSchema.methods.getDecryptedApiKey%20%3D%20function()%20%7B%0Aif%20(!this.apiKey%20%7C%7C%20!this.useCustomApiKey)%20%7B%0Areturn%20null%3B%0A%7D%0Areturn%20this.decryptApiKey()%3B%0A%7D%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-comment inline">// 获取AI服务用的解密后API密钥的方法</span>
userSchema.<span class="hljs-property inline">methods</span>.<span class="hljs-property inline">getDecryptedApiKey</span> = <span class="hljs-keyword inline">function</span>(<span class="hljs-params inline"></span>) {
  <span class="hljs-keyword inline">if</span> (!<span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">apiKey</span> || !<span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">useCustomApiKey</span>) {
    <span class="hljs-keyword inline">return</span> <span class="hljs-literal inline">null</span>;
  }
  <span class="hljs-keyword inline">return</span> <span class="hljs-variable language_ inline">this</span>.<span class="hljs-title function_ inline">decryptApiKey</span>();
};
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">Questions Party的选择</strong>：<strong class="font-bold text-foreground">按需临时解密</strong></p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed">存储时：直接存储加密数据，不解密</li>
<li class="text-foreground leading-relaxed">使用时：仅在调用大模型API时临时解密</li>
<li class="text-foreground leading-relaxed">解密后：立即清理内存中的明文数据</li>
<li class="text-foreground leading-relaxed">优势：最大化安全性，最小化明文暴露时间</li>
</ul>
<h3 id="内存中明文数据的生命周期管理" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#内存中明文数据的生命周期管理" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 内存中明文数据的生命周期管理">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            内存中明文数据的生命周期管理
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="%2F%2F%20%E8%8E%B7%E5%8F%96%E8%A7%A3%E5%AF%86%E5%90%8E%E7%9A%84%E5%B9%B3%E5%8F%B0API%E5%AF%86%E9%92%A5%E7%9A%84%E8%BE%85%E5%8A%A9%E5%87%BD%E6%95%B0%0Afunction%20getPlatformApiKey()%20%7B%0A%2F%2F%20%E4%BC%98%E5%85%88%E5%B0%9D%E8%AF%95%E8%8E%B7%E5%8F%96%E5%8A%A0%E5%AF%86%E7%9A%84API%E5%AF%86%E9%92%A5%0Aif%20(process.env.ENCRYPTED_PLATFORM_API_KEY)%20%7B%0Atry%20%7B%0Aconst%20%7Bdecrypt%7D%20%3D%20require('..%2Futils%2FrsaCrypto')%3B%0Aif%20(process.env.ENCRYPTED_PLATFORM_API_KEY.startsWith('rsa%3A'))%20%7B%0Aconst%20encryptedData%20%3D%20process.env.ENCRYPTED_PLATFORM_API_KEY.substring(4)%3B%0Areturn%20decrypt(encryptedData)%3B%0A%7D%0A%7D%20catch%20(error)%20%7B%0Aconsole.warn('Failed%20to%20decrypt%20platform%20API%20key%3A'%2C%20error.message)%3B%0A%7D%0A%7D%0A%2F%2F%20%E5%A6%82%E6%9E%9C%E6%9C%89%E8%A7%A3%E5%AF%86%E5%90%8E%E7%9A%84%E5%AF%86%E9%92%A5%E5%88%99%E8%BF%94%E5%9B%9E%EF%BC%8C%E5%90%A6%E5%88%99%E8%BF%94%E5%9B%9Enull%0Areturn%20null%3B%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-comment inline">// 获取解密后的平台API密钥的辅助函数</span>
<span class="hljs-keyword inline">function</span> <span class="hljs-title function_ inline">getPlatformApiKey</span>(<span class="hljs-params inline"></span>) {
    <span class="hljs-comment inline">// 优先尝试获取加密的API密钥</span>
    <span class="hljs-keyword inline">if</span> (process.<span class="hljs-property inline">env</span>.<span class="hljs-property inline">ENCRYPTED_PLATFORM_API_KEY</span>) {
        <span class="hljs-keyword inline">try</span> {
            <span class="hljs-keyword inline">const</span> {decrypt} = <span class="hljs-built_in inline">require</span>(<span class="hljs-string inline">&#x27;../utils/rsaCrypto&#x27;</span>);

            <span class="hljs-keyword inline">if</span> (process.<span class="hljs-property inline">env</span>.<span class="hljs-property inline">ENCRYPTED_PLATFORM_API_KEY</span>.<span class="hljs-title function_ inline">startsWith</span>(<span class="hljs-string inline">&#x27;rsa:&#x27;</span>)) {
                <span class="hljs-keyword inline">const</span> encryptedData = process.<span class="hljs-property inline">env</span>.<span class="hljs-property inline">ENCRYPTED_PLATFORM_API_KEY</span>.<span class="hljs-title function_ inline">substring</span>(<span class="hljs-number inline">4</span>);
                <span class="hljs-keyword inline">return</span> <span class="hljs-title function_ inline">decrypt</span>(encryptedData);
            }
        } <span class="hljs-keyword inline">catch</span> (error) {
            <span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">warn</span>(<span class="hljs-string inline">&#x27;Failed to decrypt platform API key:&#x27;</span>, error.<span class="hljs-property inline">message</span>);
        }
    }

    <span class="hljs-comment inline">// 如果有解密后的密钥则返回，否则返回null</span>
    <span class="hljs-keyword inline">return</span> <span class="hljs-literal inline">null</span>;
}
</code></pre>
            </div>
        
<h2 id="安全性分析与攻击防护" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#安全性分析与攻击防护" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 安全性分析与攻击防护">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            安全性分析与攻击防护
        </h2>
<h3 id="常见的rsa攻击方式和防护措施" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#常见的rsa攻击方式和防护措施" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 常见的RSA攻击方式和防护措施">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            常见的RSA攻击方式和防护措施
        </h3>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">1. 小公钥指数攻击</strong></p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="%2F%2F%20%E2%9D%8C%20%E5%8D%B1%E9%99%A9%E7%9A%84%E9%80%89%E6%8B%A9%0Ae%20%3D%203%20%20%2F%2F%20%E5%A4%AA%E5%B0%8F%EF%BC%8C%E5%AE%B9%E6%98%93%E5%8F%97%E5%88%B0%E6%94%BB%E5%87%BB%0A%2F%2F%20%E2%9C%85%20%E5%AE%89%E5%85%A8%E7%9A%84%E9%80%89%E6%8B%A9%0Ae%20%3D%2065537%20%20%2F%2F%20%E8%B6%B3%E5%A4%9F%E5%A4%A7%EF%BC%8C%E8%AE%A1%E7%AE%97%E6%95%88%E7%8E%87%E9%AB%98">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-comment inline">// ❌ 危险的选择</span>
e = <span class="hljs-number inline">3</span>  <span class="hljs-comment inline">// 太小，容易受到攻击</span>

<span class="hljs-comment inline">// ✅ 安全的选择</span>
e = <span class="hljs-number inline">65537</span>  <span class="hljs-comment inline">// 足够大，计算效率高</span>
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">2. 时间攻击</strong></p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="%2F%2F%20%E2%9D%8C%20%E5%AE%B9%E6%98%93%E5%8F%97%E5%88%B0%E6%97%B6%E9%97%B4%E6%94%BB%E5%87%BB%0Afunction%20unsafeDecrypt(ciphertext)%20%7B%0A%2F%2F%20%E8%A7%A3%E5%AF%86%E6%97%B6%E9%97%B4%E4%B8%8E%E7%A7%81%E9%92%A5%E7%9B%B8%E5%85%B3%0Areturn%20privateKey.decrypt(ciphertext)%3B%0A%7D%0A%2F%2F%20%E2%9C%85%20%E4%BD%BF%E7%94%A8%E5%B8%B8%E6%95%B0%E6%97%B6%E9%97%B4%E7%AE%97%E6%B3%95%0Afunction%20safeDecrypt(ciphertext)%20%7B%0A%2F%2F%20Node.js%20crypto%E6%A8%A1%E5%9D%97%E5%B7%B2%E7%BB%8F%E5%AE%9E%E7%8E%B0%E4%BA%86%E6%97%B6%E9%97%B4%E6%94%BB%E5%87%BB%E9%98%B2%E6%8A%A4%0Areturn%20crypto.privateDecrypt(%7B%0Akey%3A%20privateKey%2C%0Apadding%3A%20crypto.constants.RSA_PKCS1_OAEP_PADDING%0A%7D%2C%20ciphertext)%3B%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-comment inline">// ❌ 容易受到时间攻击</span>
<span class="hljs-keyword inline">function</span> <span class="hljs-title function_ inline">unsafeDecrypt</span>(<span class="hljs-params inline">ciphertext</span>) {
  <span class="hljs-comment inline">// 解密时间与私钥相关</span>
  <span class="hljs-keyword inline">return</span> privateKey.<span class="hljs-title function_ inline">decrypt</span>(ciphertext);
}

<span class="hljs-comment inline">// ✅ 使用常数时间算法</span>
<span class="hljs-keyword inline">function</span> <span class="hljs-title function_ inline">safeDecrypt</span>(<span class="hljs-params inline">ciphertext</span>) {
  <span class="hljs-comment inline">// Node.js crypto模块已经实现了时间攻击防护</span>
  <span class="hljs-keyword inline">return</span> crypto.<span class="hljs-title function_ inline">privateDecrypt</span>({
    <span class="hljs-attr inline">key</span>: privateKey,
    <span class="hljs-attr inline">padding</span>: crypto.<span class="hljs-property inline">constants</span>.<span class="hljs-property inline">RSA_PKCS1_OAEP_PADDING</span>
  }, ciphertext);
}
</code></pre>
            </div>
        
<h3 id="填充攻击的原理和oaep的防护机制" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#填充攻击的原理和oaep的防护机制" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 填充攻击的原理和OAEP的防护机制">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            填充攻击的原理和OAEP的防护机制
        </h3>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">PKCS#1 v1.5填充的漏洞</strong>：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="" data-code="%E5%8E%9F%E5%A7%8BRSA%3A%20c%20%3D%20m%5Ee%20mod%20n%0APKCS%231%20v1.5%3A%2000%20%7C%7C%20BT%20%7C%7C%20PS%20%7C%7C%2000%20%7C%7C%20D%0A%E9%97%AE%E9%A2%98%EF%BC%9A%E5%A1%AB%E5%85%85%E6%A0%BC%E5%BC%8F%E5%9B%BA%E5%AE%9A%EF%BC%8C%E5%AE%B9%E6%98%93%E5%8F%97%E5%88%B0%E5%A1%AB%E5%85%85%E6%94%BB%E5%87%BB">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">code</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code>原始RSA: c = m^e <span class="hljs-keyword inline">mod</span> n
PKCS#<span class="hljs-number inline">1</span> v1<span class="hljs-number inline">.5</span>: <span class="hljs-number inline">00</span> |<span class="hljs-type inline">| BT</span> |<span class="hljs-type inline">| PS</span> |<span class="hljs-type inline">| 00</span> |<span class="hljs-type inline">| D</span>

问题：填充格式固定，容易受到填充攻击
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">OAEP填充的防护机制</strong>：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="" data-code="OAEP%3A%20%E4%BD%BF%E7%94%A8%E9%9A%8F%E6%9C%BA%E6%95%B0%E5%92%8C%E6%8E%A9%E7%A0%81%E7%94%9F%E6%88%90%E5%87%BD%E6%95%B0%0A%E7%BB%93%E6%9E%9C%EF%BC%9A%E7%9B%B8%E5%90%8C%E6%98%8E%E6%96%87%E6%AF%8F%E6%AC%A1%E5%8A%A0%E5%AF%86%E9%83%BD%E4%B8%8D%E5%90%8C">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">code</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code><span class="hljs-symbol inline">OAEP:</span> 使用随机数和掩码生成函数
结果：相同明文每次加密都不同
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">数学表示</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground"><span class="katex-display inline"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>OAEP</mtext><mo stretchy="false">(</mo><mi>m</mi><mo separator="true">,</mo><mi>r</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mi>X</mi><mo>⊕</mo><mi>G</mi><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mi mathvariant="normal">∥</mi><mo stretchy="false">(</mo><mi>Y</mi><mo>⊕</mo><mi>H</mi><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{OAEP}(m, r) = (X \oplus G(Y)) \| (Y \oplus H(X))</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text inline"><span class="mord inline">OAEP</span></span><span class="mopen inline">(</span><span class="mord mathnormal inline">m</span><span class="mpunct inline">,</span><span class="mspace inline" style="margin-right:0.1667em;"></span><span class="mord mathnormal inline" style="margin-right:0.02778em;">r</span><span class="mclose inline">)</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen inline">(</span><span class="mord mathnormal inline" style="margin-right:0.07847em;">X</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">⊕</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal inline">G</span><span class="mopen inline">(</span><span class="mord mathnormal inline" style="margin-right:0.22222em;">Y</span><span class="mclose inline">))</span><span class="mord inline">∥</span><span class="mopen inline">(</span><span class="mord mathnormal inline" style="margin-right:0.22222em;">Y</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">⊕</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal inline" style="margin-right:0.08125em;">H</span><span class="mopen inline">(</span><span class="mord mathnormal inline" style="margin-right:0.07847em;">X</span><span class="mclose inline">))</span></span></span></span></span></p>
<p class="text-base leading-7 mb-4 text-foreground">其中：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline">m</span></span></span></span>：原始消息</li>
<li class="text-foreground leading-relaxed"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.4306em;"></span><span class="mord mathnormal inline" style="margin-right:0.02778em;">r</span></span></span></span>：随机数</li>
<li class="text-foreground leading-relaxed"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi></mrow><annotation encoding="application/x-tex">G</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.6833em;"></span><span class="mord mathnormal inline">G</span></span></span></span>，<span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.6833em;"></span><span class="mord mathnormal inline" style="margin-right:0.08125em;">H</span></span></span></span>：掩码生成函数</li>
</ul>
<h2 id="完整代码全解析" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#完整代码全解析" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 完整代码全解析">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            完整代码全解析
        </h2>
<h3 id="后端rsa密钥管理核心实现-srcutilsrsacryptojs" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#后端rsa密钥管理核心实现-srcutilsrsacryptojs" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 后端RSA密钥管理核心实现 (src/utils/rsaCrypto.js)">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            后端RSA密钥管理核心实现 (<code>src/utils/rsaCrypto.js</code>)
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="%2F%2F%20%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%85%A5%EF%BC%9A%E5%AF%86%E9%92%A5%E7%94%9F%E6%88%90%E5%BA%93%E5%92%8CNode.js%E5%8E%9F%E7%94%9F%E5%8A%A0%E5%AF%86%E6%A8%A1%E5%9D%97%0Aconst%20jsrsasign%20%3D%20require('jsrsasign')%3B%20%20%20%20%2F%2F%20%E7%94%A8%E4%BA%8E%E5%AF%86%E9%92%A5%E7%94%9F%E6%88%90%E5%92%8C%E7%AE%A1%E7%90%86%0Aconst%20%7B%20KEYUTIL%20%7D%20%3D%20jsrsasign%3B%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%AF%86%E9%92%A5%E5%B7%A5%E5%85%B7%E7%B1%BB%0Aconst%20crypto%20%3D%20require('crypto')%3B%20%20%20%20%20%20%20%20%20%20%2F%2F%20Node.js%E5%8E%9F%E7%94%9F%E5%8A%A0%E5%AF%86%E6%A8%A1%E5%9D%97%EF%BC%8C%E6%80%A7%E8%83%BD%E6%9B%B4%E5%A5%BD%0Aclass%20RSACrypto%20%7B%0Aconstructor()%20%7B%0Athis.keySize%20%3D%202048%3B%0Athis.initializeKeys()%3B%0A%7D%0A%2F%2F%20%E4%BB%8E%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%88%9D%E5%A7%8B%E5%8C%96RSA%E5%AF%86%E9%92%A5%E5%AF%B9%E6%88%96%E7%94%9F%E6%88%90%E6%96%B0%E7%9A%84%E5%AF%86%E9%92%A5%E5%AF%B9%0AinitializeKeys()%20%7B%0Aif%20(process.env.RSA_PUBLIC_KEY%20%26%26%20process.env.RSA_PRIVATE_KEY)%20%7B%0A%2F%2F%20%E5%A4%84%E7%90%86%E8%BD%AC%E4%B9%89%E5%92%8C%E9%9D%9E%E8%BD%AC%E4%B9%89%E7%9A%84%E6%8D%A2%E8%A1%8C%E7%AC%A6%EF%BC%88%E5%85%BC%E5%AE%B9%E6%80%A7%E8%80%83%E8%99%91%EF%BC%89%0Athis.publicKeyPEM%20%3D%20process.env.RSA_PUBLIC_KEY.includes('%5C%5Cn')%0A%3F%20process.env.RSA_PUBLIC_KEY.replace(%2F%5C%5Cn%2Fg%2C%20'%5Cn')%0A%3A%20process.env.RSA_PUBLIC_KEY%3B%0Athis.privateKeyPEM%20%3D%20process.env.RSA_PRIVATE_KEY.includes('%5C%5Cn')%0A%3F%20process.env.RSA_PRIVATE_KEY.replace(%2F%5C%5Cn%2Fg%2C%20'%5Cn')%0A%3A%20process.env.RSA_PRIVATE_KEY%3B%0A%7D%20else%20%7B%0Aconsole.warn('RSA%20keys%20not%20found%20in%20environment.%20Generating%20new%20keys...')%3B%0Aconst%20keyPair%20%3D%20this.generateKeyPair()%3B%0Athis.publicKeyPEM%20%3D%20keyPair.publicKeyPEM%3B%0Athis.privateKeyPEM%20%3D%20keyPair.privateKeyPEM%3B%0Aconsole.log('Generated%20RSA%20Public%20Key%3A'%2C%20this.publicKeyPEM)%3B%0Aconsole.log('Generated%20RSA%20Private%20Key%3A'%2C%20this.privateKeyPEM)%3B%0Aconsole.log('Please%20add%20these%20keys%20to%20your%20.env%20file%3A')%3B%0Aconsole.log('RSA_PUBLIC_KEY%3D%22'%20%2B%20this.publicKeyPEM.replace(%2F%5Cn%2Fg%2C%20'%5C%5Cn')%20%2B%20'%22')%3B%0Aconsole.log('RSA_PRIVATE_KEY%3D%22'%20%2B%20this.privateKeyPEM.replace(%2F%5Cn%2Fg%2C%20'%5C%5Cn')%20%2B%20'%22')%3B%0A%7D%0A%7D%0A%2F%2F%20RSA%E5%AF%86%E9%92%A5%E5%AF%B9%E7%94%9F%E6%88%90%EF%BC%9A%E4%BD%BF%E7%94%A8jsrsasign%E7%94%9F%E6%88%90%E6%A0%87%E5%87%86%E6%A0%BC%E5%BC%8F%E5%AF%86%E9%92%A5%0AgenerateKeyPair(keySize%20%3D%202048)%20%7B%0Atry%20%7B%0Aconst%20keyPair%20%3D%20KEYUTIL.generateKeypair('RSA'%2C%20keySize)%3B%0Aconst%20publicKeyPEM%20%3D%20KEYUTIL.getPEM(keyPair.pubKeyObj)%3B%20%20%20%20%20%20%20%2F%2F%20%E5%85%AC%E9%92%A5PEM%E6%A0%BC%E5%BC%8F%0Aconst%20privateKeyPEM%20%3D%20KEYUTIL.getPEM(keyPair.prvKeyObj%2C%20'PKCS8PRV')%3B%20%20%2F%2F%20%E7%A7%81%E9%92%A5PKCS8%E6%A0%BC%E5%BC%8F%0Areturn%20%7B%20publicKeyPEM%2C%20privateKeyPEM%20%7D%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60RSA%20key%20generation%20failed%3A%20%24%7Berror.message%7D%60)%3B%0A%7D%0A%7D%0A%2F%2F%20%E5%85%AC%E9%92%A5%E5%88%86%E5%8F%91%E6%8E%A5%E5%8F%A3%EF%BC%9A%E4%BE%9B%E5%89%8D%E7%AB%AF%E8%8E%B7%E5%8F%96%E5%85%AC%E9%92%A5%0AgetPublicKey()%20%7B%0Areturn%20this.publicKeyPEM%3B%0A%7D%0A%2F%2F%20RSA-OAEP%E5%8A%A0%E5%AF%86%E5%AE%9E%E7%8E%B0%EF%BC%9A%E4%BD%BF%E7%94%A8Node.js%20crypto%E6%A8%A1%E5%9D%97%E7%A1%AE%E4%BF%9D%E6%9C%80%E4%BD%B3%E6%80%A7%E8%83%BD%E5%92%8C%E5%AE%89%E5%85%A8%E6%80%A7%0Aencrypt(plaintext)%20%7B%0Atry%20%7B%0A%2F%2F%20%E8%BE%93%E5%85%A5%E9%AA%8C%E8%AF%81%EF%BC%9A%E7%A1%AE%E4%BF%9D%E6%98%8E%E6%96%87%E6%9C%89%E6%95%88%0Aif%20(!plaintext%20%7C%7C%20typeof%20plaintext%20!%3D%3D%20'string')%20%7B%0Athrow%20new%20Error('Invalid%20plaintext%20for%20encryption')%3B%0A%7D%0A%2F%2F%20UTF-8%E7%BC%96%E7%A0%81%E8%BD%AC%E6%8D%A2%EF%BC%9A%E7%A1%AE%E4%BF%9D%E4%B8%AD%E6%96%87%E7%AD%89%E5%AD%97%E7%AC%A6%E6%AD%A3%E7%A1%AE%E5%A4%84%E7%90%86%0Aconst%20buffer%20%3D%20Buffer.from(plaintext%2C%20'utf8')%3B%0A%2F%2F%20%E6%A0%B8%E5%BF%83%E5%8A%A0%E5%AF%86%E9%80%BB%E8%BE%91%EF%BC%9A%E4%BD%BF%E7%94%A8OAEP%E5%A1%AB%E5%85%85%E7%9A%84RSA%E5%8A%A0%E5%AF%86%0A%2F%2F%20%E9%80%89%E6%8B%A9Node.js%20crypto%E8%80%8C%E9%9D%9Ejsrsasign%E7%9A%84%E5%8E%9F%E5%9B%A0%EF%BC%9A%E6%9B%B4%E5%8F%AF%E9%9D%A0%E7%9A%84OAEP%E5%AE%9E%E7%8E%B0%0Aconst%20encrypted%20%3D%20crypto.publicEncrypt(%0A%7B%0Akey%3A%20this.publicKeyPEM%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20PEM%E6%A0%BC%E5%BC%8F%E5%85%AC%E9%92%A5%0Apadding%3A%20crypto.constants.RSA_PKCS1_OAEP_PADDING%2C%20%20%20%2F%2F%20OAEP%E5%A1%AB%E5%85%85%EF%BC%8C%E9%98%B2%E6%AD%A2%E5%A1%AB%E5%85%85%E6%94%BB%E5%87%BB%0AoaepHash%3A%20'sha256'%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20SHA-256%E5%93%88%E5%B8%8C%E5%87%BD%E6%95%B0%0A%7D%2C%0Abuffer%0A)%3B%0A%2F%2F%20Base64%E7%BC%96%E7%A0%81%EF%BC%9A%E4%BE%BF%E4%BA%8E%E7%BD%91%E7%BB%9C%E4%BC%A0%E8%BE%93%E5%92%8C%E5%AD%98%E5%82%A8%0Areturn%20encrypted.toString('base64')%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60RSA%20encryption%20failed%3A%20%24%7Berror.message%7D%60)%3B%0A%7D%0A%7D%0A%2F%2F%20RSA-OAEP%E8%A7%A3%E5%AF%86%E5%AE%9E%E7%8E%B0%EF%BC%9A%E4%B8%B4%E6%97%B6%E8%A7%A3%E5%AF%86%E7%AD%96%E7%95%A5%E7%9A%84%E6%A0%B8%E5%BF%83%0Adecrypt(encryptedData)%20%7B%0Atry%20%7B%0A%2F%2F%20%E8%BE%93%E5%85%A5%E9%AA%8C%E8%AF%81%EF%BC%9A%E7%A1%AE%E4%BF%9D%E5%AF%86%E6%96%87%E6%A0%BC%E5%BC%8F%E6%AD%A3%E7%A1%AE%0Aif%20(!encryptedData%20%7C%7C%20typeof%20encryptedData%20!%3D%3D%20'string')%20%7B%0Athrow%20new%20Error('Invalid%20encrypted%20data%20for%20decryption')%3B%0A%7D%0A%2F%2F%20Base64%E8%A7%A3%E7%A0%81%EF%BC%9A%E6%81%A2%E5%A4%8D%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AF%86%E6%96%87%0Aconst%20encryptedBuffer%20%3D%20Buffer.from(encryptedData%2C%20'base64')%3B%0A%2F%2F%20%E6%A0%B8%E5%BF%83%E8%A7%A3%E5%AF%86%E9%80%BB%E8%BE%91%EF%BC%9A%E4%BD%BF%E7%94%A8%E7%A7%81%E9%92%A5%E8%A7%A3%E5%AF%86%0Aconst%20decrypted%20%3D%20crypto.privateDecrypt(%0A%7B%0Akey%3A%20this.privateKeyPEM%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20PEM%E6%A0%BC%E5%BC%8F%E7%A7%81%E9%92%A5%0Apadding%3A%20crypto.constants.RSA_PKCS1_OAEP_PADDING%2C%20%20%20%2F%2F%20%E4%B8%8E%E5%8A%A0%E5%AF%86%E4%BF%9D%E6%8C%81%E4%B8%80%E8%87%B4%E7%9A%84%E5%A1%AB%E5%85%85%0AoaepHash%3A%20'sha256'%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%B8%8E%E5%8A%A0%E5%AF%86%E4%BF%9D%E6%8C%81%E4%B8%80%E8%87%B4%E7%9A%84%E5%93%88%E5%B8%8C%0A%7D%2C%0AencryptedBuffer%0A)%3B%0A%2F%2F%20UTF-8%E8%A7%A3%E7%A0%81%EF%BC%9A%E6%81%A2%E5%A4%8D%E5%8E%9F%E5%A7%8B%E5%AD%97%E7%AC%A6%E4%B8%B2%0Areturn%20decrypted.toString('utf8')%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60RSA%20decryption%20failed%3A%20%24%7Berror.message%7D%60)%3B%0A%7D%0A%7D%0A%2F%2F%20%E7%81%B5%E6%B4%BB%E5%8A%A0%E5%AF%86%E6%8E%A5%E5%8F%A3%EF%BC%9A%E6%94%AF%E6%8C%81%E4%BD%BF%E7%94%A8%E4%BB%BB%E6%84%8F%E5%85%AC%E9%92%A5%E5%8A%A0%E5%AF%86%EF%BC%88%E6%B5%8B%E8%AF%95%E7%94%A8%EF%BC%89%0AencryptWithPublicKey(plaintext%2C%20publicKeyPEM)%20%7B%0Atry%20%7B%0Aif%20(!plaintext%20%7C%7C%20typeof%20plaintext%20!%3D%3D%20'string')%20%7B%0Athrow%20new%20Error('Invalid%20plaintext%20for%20encryption')%3B%0A%7D%0Aconst%20buffer%20%3D%20Buffer.from(plaintext%2C%20'utf8')%3B%0A%2F%2F%20%E4%BD%BF%E7%94%A8%E5%A4%96%E9%83%A8%E6%8F%90%E4%BE%9B%E7%9A%84%E5%85%AC%E9%92%A5%E8%BF%9B%E8%A1%8C%E5%8A%A0%E5%AF%86%0Aconst%20encrypted%20%3D%20crypto.publicEncrypt(%0A%7B%0Akey%3A%20publicKeyPEM%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%A4%96%E9%83%A8%E5%85%AC%E9%92%A5%0Apadding%3A%20crypto.constants.RSA_PKCS1_OAEP_PADDING%2C%0AoaepHash%3A%20'sha256'%2C%0A%7D%2C%0Abuffer%0A)%3B%0Areturn%20encrypted.toString('base64')%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60RSA%20encryption%20with%20provided%20key%20failed%3A%20%24%7Berror.message%7D%60)%3B%0A%7D%0A%7D%0A%2F%2F%20%E5%AF%86%E9%92%A5%E9%AA%8C%E8%AF%81%E5%B7%A5%E5%85%B7%EF%BC%9A%E7%A1%AE%E4%BF%9D%E5%AF%86%E9%92%A5%E6%A0%BC%E5%BC%8F%E6%AD%A3%E7%A1%AE%0AvalidateKey(keyPEM%2C%20isPrivate%20%3D%20false)%20%7B%0Atry%20%7B%0Aconst%20keyObj%20%3D%20KEYUTIL.getKey(keyPEM)%3B%0Areturn%20keyObj%20%26%26%20(isPrivate%20%3F%20keyObj.isPrivate%20%3A%20keyObj.isPublic)%3B%0A%7D%20catch%20(error)%20%7B%0Areturn%20false%3B%20%20%20%2F%2F%20%E9%AA%8C%E8%AF%81%E5%A4%B1%E8%B4%A5%E8%BF%94%E5%9B%9Efalse%E8%80%8C%E9%9D%9E%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8%0A%7D%0A%7D%0A%7D%0A%2F%2F%20%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E5%AF%BC%E5%87%BA%EF%BC%9A%E5%85%A8%E5%B1%80%E5%94%AF%E4%B8%80%E5%AE%9E%E4%BE%8B%EF%BC%8C%E8%8A%82%E7%9C%81%E5%86%85%E5%AD%98%E5%B9%B6%E4%BF%9D%E8%AF%81%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%0Aconst%20rsaCrypto%20%3D%20new%20RSACrypto()%3B%0A%2F%2F%20%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%87%BA%EF%BC%9A%E6%8F%90%E4%BE%9B%E5%A4%9A%E7%A7%8D%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F%0Amodule.exports%20%3D%20%7B%0ARSACrypto%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%AF%BC%E5%87%BA%E7%B1%BB%EF%BC%88%E7%94%A8%E4%BA%8E%E6%89%A9%E5%B1%95%EF%BC%89%0ArsaCrypto%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%AF%BC%E5%87%BA%E5%8D%95%E4%BE%8B%E5%AE%9E%E4%BE%8B%0AgenerateKeyPair%3A%20(keySize)%20%3D%3E%20rsaCrypto.generateKeyPair(keySize)%2C%20%20%20%20%20%2F%2F%20%E4%BE%BF%E5%88%A9%E5%87%BD%E6%95%B0%0Aencrypt%3A%20(plaintext)%20%3D%3E%20rsaCrypto.encrypt(plaintext)%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%BE%BF%E5%88%A9%E5%87%BD%E6%95%B0%0Adecrypt%3A%20(encryptedData)%20%3D%3E%20rsaCrypto.decrypt(encryptedData)%2C%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%BE%BF%E5%88%A9%E5%87%BD%E6%95%B0%0AgetPublicKey%3A%20()%20%3D%3E%20rsaCrypto.getPublicKey()%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%BE%BF%E5%88%A9%E5%87%BD%E6%95%B0%0AencryptWithPublicKey%3A%20(plaintext%2C%20publicKey)%20%3D%3E%20rsaCrypto.encryptWithPublicKey(plaintext%2C%20publicKey)%2C%0AvalidateKey%3A%20(keyPEM%2C%20isPrivate)%20%3D%3E%20rsaCrypto.validateKey(keyPEM%2C%20isPrivate)%0A%7D%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-comment inline">// 模块导入：密钥生成库和Node.js原生加密模块</span>
<span class="hljs-keyword inline">const</span> jsrsasign = <span class="hljs-built_in inline">require</span>(<span class="hljs-string inline">&#x27;jsrsasign&#x27;</span>);    <span class="hljs-comment inline">// 用于密钥生成和管理</span>
<span class="hljs-keyword inline">const</span> { <span class="hljs-variable constant_ inline">KEYUTIL</span> } = jsrsasign;            <span class="hljs-comment inline">// 密钥工具类</span>
<span class="hljs-keyword inline">const</span> crypto = <span class="hljs-built_in inline">require</span>(<span class="hljs-string inline">&#x27;crypto&#x27;</span>);          <span class="hljs-comment inline">// Node.js原生加密模块，性能更好</span>

<span class="hljs-keyword inline">class</span> <span class="hljs-title class_ inline">RSACrypto</span> {
  <span class="hljs-title function_ inline">constructor</span>(<span class="hljs-params inline"></span>) {
    <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">keySize</span> = <span class="hljs-number inline">2048</span>;
    <span class="hljs-variable language_ inline">this</span>.<span class="hljs-title function_ inline">initializeKeys</span>();
  }

  <span class="hljs-comment inline">// 从环境变量初始化RSA密钥对或生成新的密钥对</span>
  <span class="hljs-title function_ inline">initializeKeys</span>(<span class="hljs-params inline"></span>) {
    <span class="hljs-keyword inline">if</span> (process.<span class="hljs-property inline">env</span>.<span class="hljs-property inline">RSA_PUBLIC_KEY</span> &amp;&amp; process.<span class="hljs-property inline">env</span>.<span class="hljs-property inline">RSA_PRIVATE_KEY</span>) {
      <span class="hljs-comment inline">// 处理转义和非转义的换行符（兼容性考虑）</span>
      <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">publicKeyPEM</span> = process.<span class="hljs-property inline">env</span>.<span class="hljs-property inline">RSA_PUBLIC_KEY</span>.<span class="hljs-title function_ inline">includes</span>(<span class="hljs-string inline">&#x27;\\n&#x27;</span>) 
        ? process.<span class="hljs-property inline">env</span>.<span class="hljs-property inline">RSA_PUBLIC_KEY</span>.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/\\n/g</span>, <span class="hljs-string inline">&#x27;\n&#x27;</span>)
        : process.<span class="hljs-property inline">env</span>.<span class="hljs-property inline">RSA_PUBLIC_KEY</span>;
      <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">privateKeyPEM</span> = process.<span class="hljs-property inline">env</span>.<span class="hljs-property inline">RSA_PRIVATE_KEY</span>.<span class="hljs-title function_ inline">includes</span>(<span class="hljs-string inline">&#x27;\\n&#x27;</span>)
        ? process.<span class="hljs-property inline">env</span>.<span class="hljs-property inline">RSA_PRIVATE_KEY</span>.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/\\n/g</span>, <span class="hljs-string inline">&#x27;\n&#x27;</span>)
        : process.<span class="hljs-property inline">env</span>.<span class="hljs-property inline">RSA_PRIVATE_KEY</span>;
    } <span class="hljs-keyword inline">else</span> {
      <span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">warn</span>(<span class="hljs-string inline">&#x27;RSA keys not found in environment. Generating new keys...&#x27;</span>);
      <span class="hljs-keyword inline">const</span> keyPair = <span class="hljs-variable language_ inline">this</span>.<span class="hljs-title function_ inline">generateKeyPair</span>();
      <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">publicKeyPEM</span> = keyPair.<span class="hljs-property inline">publicKeyPEM</span>;
      <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">privateKeyPEM</span> = keyPair.<span class="hljs-property inline">privateKeyPEM</span>;
      
      <span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">log</span>(<span class="hljs-string inline">&#x27;Generated RSA Public Key:&#x27;</span>, <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">publicKeyPEM</span>);
      <span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">log</span>(<span class="hljs-string inline">&#x27;Generated RSA Private Key:&#x27;</span>, <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">privateKeyPEM</span>);
      <span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">log</span>(<span class="hljs-string inline">&#x27;Please add these keys to your .env file:&#x27;</span>);
      <span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">log</span>(<span class="hljs-string inline">&#x27;RSA_PUBLIC_KEY=&quot;&#x27;</span> + <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">publicKeyPEM</span>.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/\n/g</span>, <span class="hljs-string inline">&#x27;\\n&#x27;</span>) + <span class="hljs-string inline">&#x27;&quot;&#x27;</span>);
      <span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">log</span>(<span class="hljs-string inline">&#x27;RSA_PRIVATE_KEY=&quot;&#x27;</span> + <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">privateKeyPEM</span>.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/\n/g</span>, <span class="hljs-string inline">&#x27;\\n&#x27;</span>) + <span class="hljs-string inline">&#x27;&quot;&#x27;</span>);
    }
  }

  <span class="hljs-comment inline">// RSA密钥对生成：使用jsrsasign生成标准格式密钥</span>
  <span class="hljs-title function_ inline">generateKeyPair</span>(<span class="hljs-params inline">keySize = <span class="hljs-number inline">2048</span></span>) {
    <span class="hljs-keyword inline">try</span> {
      <span class="hljs-keyword inline">const</span> keyPair = <span class="hljs-variable constant_ inline">KEYUTIL</span>.<span class="hljs-title function_ inline">generateKeypair</span>(<span class="hljs-string inline">&#x27;RSA&#x27;</span>, keySize);
      <span class="hljs-keyword inline">const</span> publicKeyPEM = <span class="hljs-variable constant_ inline">KEYUTIL</span>.<span class="hljs-title function_ inline">getPEM</span>(keyPair.<span class="hljs-property inline">pubKeyObj</span>);       <span class="hljs-comment inline">// 公钥PEM格式</span>
      <span class="hljs-keyword inline">const</span> privateKeyPEM = <span class="hljs-variable constant_ inline">KEYUTIL</span>.<span class="hljs-title function_ inline">getPEM</span>(keyPair.<span class="hljs-property inline">prvKeyObj</span>, <span class="hljs-string inline">&#x27;PKCS8PRV&#x27;</span>);  <span class="hljs-comment inline">// 私钥PKCS8格式</span>
      
      <span class="hljs-keyword inline">return</span> { publicKeyPEM, privateKeyPEM };
    } <span class="hljs-keyword inline">catch</span> (error) {
      <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">`RSA key generation failed: <span class="hljs-subst inline">${error.message}</span>`</span>);
    }
  }

  <span class="hljs-comment inline">// 公钥分发接口：供前端获取公钥</span>
  <span class="hljs-title function_ inline">getPublicKey</span>(<span class="hljs-params inline"></span>) {
    <span class="hljs-keyword inline">return</span> <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">publicKeyPEM</span>;
  }

  <span class="hljs-comment inline">// RSA-OAEP加密实现：使用Node.js crypto模块确保最佳性能和安全性</span>
  <span class="hljs-title function_ inline">encrypt</span>(<span class="hljs-params inline">plaintext</span>) {
    <span class="hljs-keyword inline">try</span> {
      <span class="hljs-comment inline">// 输入验证：确保明文有效</span>
      <span class="hljs-keyword inline">if</span> (!plaintext || <span class="hljs-keyword inline">typeof</span> plaintext !== <span class="hljs-string inline">&#x27;string&#x27;</span>) {
        <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">&#x27;Invalid plaintext for encryption&#x27;</span>);
      }

      <span class="hljs-comment inline">// UTF-8编码转换：确保中文等字符正确处理</span>
      <span class="hljs-keyword inline">const</span> buffer = <span class="hljs-title class_ inline">Buffer</span>.<span class="hljs-title function_ inline">from</span>(plaintext, <span class="hljs-string inline">&#x27;utf8&#x27;</span>);
      
      <span class="hljs-comment inline">// 核心加密逻辑：使用OAEP填充的RSA加密</span>
      <span class="hljs-comment inline">// 选择Node.js crypto而非jsrsasign的原因：更可靠的OAEP实现</span>
      <span class="hljs-keyword inline">const</span> encrypted = crypto.<span class="hljs-title function_ inline">publicEncrypt</span>(
        {
          <span class="hljs-attr inline">key</span>: <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">publicKeyPEM</span>,                              <span class="hljs-comment inline">// PEM格式公钥</span>
          <span class="hljs-attr inline">padding</span>: crypto.<span class="hljs-property inline">constants</span>.<span class="hljs-property inline">RSA_PKCS1_OAEP_PADDING</span>,   <span class="hljs-comment inline">// OAEP填充，防止填充攻击</span>
          <span class="hljs-attr inline">oaepHash</span>: <span class="hljs-string inline">&#x27;sha256&#x27;</span>,                                  <span class="hljs-comment inline">// SHA-256哈希函数</span>
        },
        buffer
      );

      <span class="hljs-comment inline">// Base64编码：便于网络传输和存储</span>
      <span class="hljs-keyword inline">return</span> encrypted.<span class="hljs-title function_ inline">toString</span>(<span class="hljs-string inline">&#x27;base64&#x27;</span>);
    } <span class="hljs-keyword inline">catch</span> (error) {
      <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">`RSA encryption failed: <span class="hljs-subst inline">${error.message}</span>`</span>);
    }
  }

  <span class="hljs-comment inline">// RSA-OAEP解密实现：临时解密策略的核心</span>
  <span class="hljs-title function_ inline">decrypt</span>(<span class="hljs-params inline">encryptedData</span>) {
    <span class="hljs-keyword inline">try</span> {
      <span class="hljs-comment inline">// 输入验证：确保密文格式正确</span>
      <span class="hljs-keyword inline">if</span> (!encryptedData || <span class="hljs-keyword inline">typeof</span> encryptedData !== <span class="hljs-string inline">&#x27;string&#x27;</span>) {
        <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">&#x27;Invalid encrypted data for decryption&#x27;</span>);
      }

      <span class="hljs-comment inline">// Base64解码：恢复二进制密文</span>
      <span class="hljs-keyword inline">const</span> encryptedBuffer = <span class="hljs-title class_ inline">Buffer</span>.<span class="hljs-title function_ inline">from</span>(encryptedData, <span class="hljs-string inline">&#x27;base64&#x27;</span>);
      
      <span class="hljs-comment inline">// 核心解密逻辑：使用私钥解密</span>
      <span class="hljs-keyword inline">const</span> decrypted = crypto.<span class="hljs-title function_ inline">privateDecrypt</span>(
        {
          <span class="hljs-attr inline">key</span>: <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">privateKeyPEM</span>,                             <span class="hljs-comment inline">// PEM格式私钥</span>
          <span class="hljs-attr inline">padding</span>: crypto.<span class="hljs-property inline">constants</span>.<span class="hljs-property inline">RSA_PKCS1_OAEP_PADDING</span>,   <span class="hljs-comment inline">// 与加密保持一致的填充</span>
          <span class="hljs-attr inline">oaepHash</span>: <span class="hljs-string inline">&#x27;sha256&#x27;</span>,                                  <span class="hljs-comment inline">// 与加密保持一致的哈希</span>
        },
        encryptedBuffer
      );

      <span class="hljs-comment inline">// UTF-8解码：恢复原始字符串</span>
      <span class="hljs-keyword inline">return</span> decrypted.<span class="hljs-title function_ inline">toString</span>(<span class="hljs-string inline">&#x27;utf8&#x27;</span>);
    } <span class="hljs-keyword inline">catch</span> (error) {
      <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">`RSA decryption failed: <span class="hljs-subst inline">${error.message}</span>`</span>);
    }
  }

  <span class="hljs-comment inline">// 灵活加密接口：支持使用任意公钥加密（测试用）</span>
  <span class="hljs-title function_ inline">encryptWithPublicKey</span>(<span class="hljs-params inline">plaintext, publicKeyPEM</span>) {
    <span class="hljs-keyword inline">try</span> {
      <span class="hljs-keyword inline">if</span> (!plaintext || <span class="hljs-keyword inline">typeof</span> plaintext !== <span class="hljs-string inline">&#x27;string&#x27;</span>) {
        <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">&#x27;Invalid plaintext for encryption&#x27;</span>);
      }

      <span class="hljs-keyword inline">const</span> buffer = <span class="hljs-title class_ inline">Buffer</span>.<span class="hljs-title function_ inline">from</span>(plaintext, <span class="hljs-string inline">&#x27;utf8&#x27;</span>);
      
      <span class="hljs-comment inline">// 使用外部提供的公钥进行加密</span>
      <span class="hljs-keyword inline">const</span> encrypted = crypto.<span class="hljs-title function_ inline">publicEncrypt</span>(
        {
          <span class="hljs-attr inline">key</span>: publicKeyPEM,                                   <span class="hljs-comment inline">// 外部公钥</span>
          <span class="hljs-attr inline">padding</span>: crypto.<span class="hljs-property inline">constants</span>.<span class="hljs-property inline">RSA_PKCS1_OAEP_PADDING</span>,
          <span class="hljs-attr inline">oaepHash</span>: <span class="hljs-string inline">&#x27;sha256&#x27;</span>,
        },
        buffer
      );

      <span class="hljs-keyword inline">return</span> encrypted.<span class="hljs-title function_ inline">toString</span>(<span class="hljs-string inline">&#x27;base64&#x27;</span>);
    } <span class="hljs-keyword inline">catch</span> (error) {
      <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">`RSA encryption with provided key failed: <span class="hljs-subst inline">${error.message}</span>`</span>);
    }
  }

  <span class="hljs-comment inline">// 密钥验证工具：确保密钥格式正确</span>
  <span class="hljs-title function_ inline">validateKey</span>(<span class="hljs-params inline">keyPEM, isPrivate = <span class="hljs-literal inline">false</span></span>) {
    <span class="hljs-keyword inline">try</span> {
      <span class="hljs-keyword inline">const</span> keyObj = <span class="hljs-variable constant_ inline">KEYUTIL</span>.<span class="hljs-title function_ inline">getKey</span>(keyPEM);
      <span class="hljs-keyword inline">return</span> keyObj &amp;&amp; (isPrivate ? keyObj.<span class="hljs-property inline">isPrivate</span> : keyObj.<span class="hljs-property inline">isPublic</span>);
    } <span class="hljs-keyword inline">catch</span> (error) {
      <span class="hljs-keyword inline">return</span> <span class="hljs-literal inline">false</span>;   <span class="hljs-comment inline">// 验证失败返回false而非抛出异常</span>
    }
  }
}

<span class="hljs-comment inline">// 单例模式导出：全局唯一实例，节省内存并保证缓存一致性</span>
<span class="hljs-keyword inline">const</span> rsaCrypto = <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">RSACrypto</span>();

<span class="hljs-comment inline">// 模块导出：提供多种使用方式</span>
<span class="hljs-variable language_ inline">module</span>.<span class="hljs-property inline">exports</span> = {
  <span class="hljs-title class_ inline">RSACrypto</span>,                                                    <span class="hljs-comment inline">// 导出类（用于扩展）</span>
  rsaCrypto,                                                   <span class="hljs-comment inline">// 导出单例实例</span>
  <span class="hljs-attr inline">generateKeyPair</span>: <span class="hljs-function inline">(<span class="hljs-params inline">keySize</span>) =&gt;</span> rsaCrypto.<span class="hljs-title function_ inline">generateKeyPair</span>(keySize),     <span class="hljs-comment inline">// 便利函数</span>
  <span class="hljs-attr inline">encrypt</span>: <span class="hljs-function inline">(<span class="hljs-params inline">plaintext</span>) =&gt;</span> rsaCrypto.<span class="hljs-title function_ inline">encrypt</span>(plaintext),                 <span class="hljs-comment inline">// 便利函数</span>
  <span class="hljs-attr inline">decrypt</span>: <span class="hljs-function inline">(<span class="hljs-params inline">encryptedData</span>) =&gt;</span> rsaCrypto.<span class="hljs-title function_ inline">decrypt</span>(encryptedData),         <span class="hljs-comment inline">// 便利函数</span>
  <span class="hljs-attr inline">getPublicKey</span>: <span class="hljs-function inline">() =&gt;</span> rsaCrypto.<span class="hljs-title function_ inline">getPublicKey</span>(),                         <span class="hljs-comment inline">// 便利函数</span>
  <span class="hljs-attr inline">encryptWithPublicKey</span>: <span class="hljs-function inline">(<span class="hljs-params inline">plaintext, publicKey</span>) =&gt;</span> rsaCrypto.<span class="hljs-title function_ inline">encryptWithPublicKey</span>(plaintext, publicKey),
  <span class="hljs-attr inline">validateKey</span>: <span class="hljs-function inline">(<span class="hljs-params inline">keyPEM, isPrivate</span>) =&gt;</span> rsaCrypto.<span class="hljs-title function_ inline">validateKey</span>(keyPEM, isPrivate)
};
</code></pre>
            </div>
        
<h3 id="前端rsa加密核心实现-srcutilsrsacryptots" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#前端rsa加密核心实现-srcutilsrsacryptots" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 前端RSA加密核心实现 (src/utils/rsaCrypto.ts)">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            前端RSA加密核心实现 (<code>src/utils/rsaCrypto.ts</code>)
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="import%20*%20as%20jsrsasign%20from%20'jsrsasign'%3B%20%20%20%2F%2F%20RSA%E5%AF%86%E9%92%A5%E6%93%8D%E4%BD%9C%E5%BA%93%0Aconst%20%7BKEYUTIL%7D%20%3D%20jsrsasign%3B%0Aexport%20class%20RSACrypto%20%7B%0Aprivate%20publicKey%3A%20string%20%7C%20null%20%3D%20null%3B%20%20%20%2F%2F%20%E5%AD%98%E5%82%A8%E4%BB%8E%E5%90%8E%E7%AB%AF%E8%8E%B7%E5%8F%96%E7%9A%84%E5%85%AC%E9%92%A5%0A%2F%2F%20%E9%9D%99%E6%80%81%E5%B7%A5%E5%85%B7%E6%96%B9%E6%B3%95%EF%BC%9A%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AE%9A%E5%85%AC%E9%92%A5%E5%8A%A0%E5%AF%86%EF%BC%88%E6%B5%8B%E8%AF%95%E7%94%A8%EF%BC%89%0Astatic%20async%20encryptWithKey(plaintext%3A%20string%2C%20publicKeyPEM%3A%20string)%3A%20Promisestring%3E%20%7B%0Aconst%20rsa%20%3D%20new%20RSACrypto()%3B%0Arsa.setPublicKey(publicKeyPEM)%3B%0Areturn%20await%20rsa.encrypt(plaintext)%3B%0A%7D%0A%2F%2F%20%E9%9D%99%E6%80%81%E5%AE%89%E5%85%A8%E9%AA%8C%E8%AF%81%EF%BC%9A%E7%A1%AE%E4%BF%9D%E5%85%AC%E9%92%A5%E6%A0%BC%E5%BC%8F%E6%AD%A3%E7%A1%AE%E4%B8%94%E4%B8%8D%E5%8C%85%E5%90%AB%E7%A7%81%E9%92%A5%E4%BF%A1%E6%81%AF%0Astatic%20validatePublicKey(keyPEM%3A%20string)%3A%20boolean%20%7B%0Atry%20%7B%0Aconst%20keyObj%20%3D%20KEYUTIL.getKey(keyPEM)%3B%0A%2F%2F%20%E5%85%B3%E9%94%AE%E5%AE%89%E5%85%A8%E6%A3%80%E6%9F%A5%EF%BC%9ARSA%E5%85%AC%E9%92%A5%E5%8F%AA%E5%BA%94%E5%8C%85%E5%90%AB%E6%A8%A1%E6%95%B0(n)%E5%92%8C%E5%85%AC%E9%92%A5%E6%8C%87%E6%95%B0(e)%0A%2F%2F%20%E7%BB%9D%E5%AF%B9%E4%B8%8D%E8%83%BD%E5%8C%85%E5%90%AB%E7%A7%81%E9%92%A5%E6%8C%87%E6%95%B0(d)%20-%20%E8%BF%99%E6%98%AF%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4%E7%9A%84%E6%A0%B8%E5%BF%83%0Areturn%20keyObj%20%26%26%0A'n'%20in%20keyObj%20%26%26%20%20%20%20%2F%2F%20%E6%A8%A1%E6%95%B0n%E5%BF%85%E9%A1%BB%E5%AD%98%E5%9C%A8%0A'e'%20in%20keyObj%20%26%26%20%20%20%20%2F%2F%20%E5%85%AC%E9%92%A5%E6%8C%87%E6%95%B0e%E5%BF%85%E9%A1%BB%E5%AD%98%E5%9C%A8%0A!('d'%20in%20keyObj)%3B%20%20%20%2F%2F%20%E7%A7%81%E9%92%A5%E6%8C%87%E6%95%B0d%E7%BB%9D%E5%AF%B9%E4%B8%8D%E8%83%BD%E5%AD%98%E5%9C%A8%EF%BC%81%0A%7D%20catch%20%7B%0Areturn%20false%3B%20%20%20%2F%2F%20%E8%A7%A3%E6%9E%90%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%AE%89%E5%85%A8%E6%8B%92%E7%BB%9D%0A%7D%0A%7D%0A%2F%2F%20%E5%AF%86%E9%92%A5%E8%AE%BE%E7%BD%AE%EF%BC%9A%E6%8E%A5%E6%94%B6%E5%90%8E%E7%AB%AF%E5%88%86%E5%8F%91%E7%9A%84%E5%85%AC%E9%92%A5%0AsetPublicKey(publicKeyPEM%3A%20string)%20%7B%0Athis.publicKey%20%3D%20publicKeyPEM%3B%0A%7D%0A%2F%2F%20%E5%AF%86%E9%92%A5%E8%8E%B7%E5%8F%96%EF%BC%9A%E8%BF%94%E5%9B%9E%E5%BD%93%E5%89%8D%E8%AE%BE%E7%BD%AE%E7%9A%84%E5%85%AC%E9%92%A5%0AgetPublicKey()%3A%20string%20%7C%20null%20%7B%0Areturn%20this.publicKey%3B%0A%7D%0A%2F%2F%20%E6%A0%B8%E5%BF%83%E5%8A%A0%E5%AF%86%E6%96%B9%E6%B3%95%EF%BC%9A%E4%BD%BF%E7%94%A8Web%20Crypto%20API%E5%AE%9E%E7%8E%B0RSA-OAEP%E5%8A%A0%E5%AF%86%0Aasync%20encrypt(plaintext%3A%20string)%3A%20Promisestring%3E%20%7B%0A%2F%2F%20%E5%89%8D%E7%BD%AE%E6%A3%80%E6%9F%A5%EF%BC%9A%E7%A1%AE%E4%BF%9D%E5%85%AC%E9%92%A5%E5%B7%B2%E8%AE%BE%E7%BD%AE%0Aif%20(!this.publicKey)%20%7B%0Athrow%20new%20Error('Public%20key%20not%20set.%20Call%20setPublicKey()%20first.')%3B%0A%7D%0A%2F%2F%20%E8%BE%93%E5%85%A5%E9%AA%8C%E8%AF%81%EF%BC%9A%E7%A1%AE%E4%BF%9D%E6%98%8E%E6%96%87%E6%9C%89%E6%95%88%0Aif%20(!plaintext%20%7C%7C%20typeof%20plaintext%20!%3D%3D%20'string')%20%7B%0Athrow%20new%20Error('Invalid%20plaintext%20for%20encryption')%3B%0A%7D%0Atry%20%7B%0A%2F%2F%20%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9APEM%E6%A0%BC%E5%BC%8F%E5%AF%86%E9%92%A5%E8%BD%AC%E6%8D%A2%E4%B8%BAWeb%20Crypto%20API%E9%9C%80%E8%A6%81%E7%9A%84ArrayBuffer%0Aconst%20publicKeyBuffer%20%3D%20this.pemToArrayBuffer(this.publicKey)%3B%0A%2F%2F%20%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E5%AF%BC%E5%85%A5%E5%85%AC%E9%92%A5%E5%88%B0Web%20Crypto%20API%0A%2F%2F%20%E4%BD%BF%E7%94%A8%E6%A0%87%E5%87%86%E7%9A%84SPKI%E6%A0%BC%E5%BC%8F%E5%92%8CRSA-OAEP%E7%AE%97%E6%B3%95%0Aconst%20cryptoKey%20%3D%20await%20window.crypto.subtle.importKey(%0A'spki'%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Subject%20Public%20Key%20Info%E6%A0%BC%E5%BC%8F%0ApublicKeyBuffer%2C%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AF%86%E9%92%A5%E6%95%B0%E6%8D%AE%0A%7B%0Aname%3A%20'RSA-OAEP'%2C%20%20%20%20%20%20%20%2F%2F%20%E7%AE%97%E6%B3%95%E5%90%8D%E7%A7%B0%EF%BC%8C%E4%B8%8E%E5%90%8E%E7%AB%AF%E4%BF%9D%E6%8C%81%E4%B8%80%E8%87%B4%0Ahash%3A%20'SHA-256'%2C%20%20%20%20%20%20%20%20%2F%2F%20%E5%93%88%E5%B8%8C%E5%87%BD%E6%95%B0%EF%BC%8C%E4%B8%8E%E5%90%8E%E7%AB%AF%E4%BF%9D%E6%8C%81%E4%B8%80%E8%87%B4%0A%7D%2C%0Afalse%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%B8%8D%E5%85%81%E8%AE%B8%E6%8F%90%E5%8F%96%E5%AF%86%E9%92%A5%EF%BC%88%E5%AE%89%E5%85%A8%E8%80%83%E8%99%91%EF%BC%89%0A%5B'encrypt'%5D%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%8F%AA%E5%85%81%E8%AE%B8%E5%8A%A0%E5%AF%86%E6%93%8D%E4%BD%9C%0A)%3B%0A%2F%2F%20%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E6%98%8E%E6%96%87%E7%BC%96%E7%A0%81%E5%92%8C%E5%8A%A0%E5%AF%86%0Aconst%20plaintextBuffer%20%3D%20new%20TextEncoder().encode(plaintext)%3B%20%20%2F%2F%20UTF-8%E7%BC%96%E7%A0%81%0Aconst%20encryptedBuffer%20%3D%20await%20window.crypto.subtle.encrypt(%0A%7B%0Aname%3A%20'RSA-OAEP'%2C%20%20%20%20%20%20%2F%2F%20%E4%BD%BF%E7%94%A8OAEP%E5%A1%AB%E5%85%85%0A%7D%2C%0AcryptoKey%2C%0AplaintextBuffer%0A)%3B%0A%2F%2F%20%E7%AC%AC%E5%9B%9B%E6%AD%A5%EF%BC%9ABase64%E7%BC%96%E7%A0%81%E4%BB%A5%E5%8C%B9%E9%85%8D%E5%90%8E%E7%AB%AF%E6%A0%BC%E5%BC%8F%0Areturn%20this.arrayBufferToBase64(encryptedBuffer)%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60RSA%20encryption%20failed%3A%20%24%7Berror%20instanceof%20Error%20%3F%20error.message%20%3A%20'Unknown%20error'%7D%60)%3B%0A%7D%0A%7D%0A%2F%2F%20%E7%A7%81%E6%9C%89%E5%B7%A5%E5%85%B7%E6%96%B9%E6%B3%95%EF%BC%9APEM%E6%A0%BC%E5%BC%8F%E8%BD%ACArrayBuffer%0Aprivate%20pemToArrayBuffer(pem%3A%20string)%3A%20ArrayBuffer%20%7B%0A%2F%2F%20%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E7%A7%BB%E9%99%A4PEM%E6%A0%BC%E5%BC%8F%E7%9A%84%E5%A4%B4%E5%B0%BE%E6%A0%87%E8%AF%86%E5%92%8C%E6%89%80%E6%9C%89%E7%A9%BA%E7%99%BD%E5%AD%97%E7%AC%A6%0Aconst%20pemHeader%20%3D%20'-----BEGIN%20PUBLIC%20KEY-----'%3B%0Aconst%20pemFooter%20%3D%20'-----END%20PUBLIC%20KEY-----'%3B%0Aconst%20pemContents%20%3D%20pem.replace(pemHeader%2C%20'')%0A.replace(pemFooter%2C%20'')%0A.replace(%2F%5Cs%2Fg%2C%20'')%3B%20%20%20%2F%2F%20%E7%A7%BB%E9%99%A4%E6%89%80%E6%9C%89%E7%A9%BA%E7%99%BD%E5%AD%97%E7%AC%A6%0A%2F%2F%20%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9ABase64%E8%A7%A3%E7%A0%81%E4%B8%BA%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AD%97%E7%AC%A6%E4%B8%B2%0Aconst%20binaryString%20%3D%20atob(pemContents)%3B%0A%2F%2F%20%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%ACArrayBuffer%EF%BC%88Web%20Crypto%20API%E6%A0%87%E5%87%86%E6%A0%BC%E5%BC%8F%EF%BC%89%0Aconst%20bytes%20%3D%20new%20Uint8Array(binaryString.length)%3B%0Afor%20(let%20i%20%3D%200%3B%20i%20length%3B%20i%2B%2B)%20%7B%0Abytes%5Bi%5D%20%3D%20binaryString.charCodeAt(i)%3B%20%20%20%2F%2F%20%E9%80%90%E5%AD%97%E8%8A%82%E8%BD%AC%E6%8D%A2%0A%7D%0Areturn%20bytes.buffer%3B%0A%7D%0A%2F%2F%20%E7%A7%81%E6%9C%89%E5%B7%A5%E5%85%B7%E6%96%B9%E6%B3%95%EF%BC%9AArrayBuffer%E8%BD%ACBase64%EF%BC%88%E7%BD%91%E7%BB%9C%E4%BC%A0%E8%BE%93%E6%A0%BC%E5%BC%8F%EF%BC%89%0Aprivate%20arrayBufferToBase64(buffer%3A%20ArrayBuffer)%3A%20string%20%7B%0Aconst%20bytes%20%3D%20new%20Uint8Array(buffer)%3B%0Alet%20binary%20%3D%20''%3B%0A%2F%2F%20%E9%80%90%E5%AD%97%E8%8A%82%E8%BD%AC%E6%8D%A2%E4%B8%BA%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AD%97%E7%AC%A6%E4%B8%B2%0Afor%20(let%20i%20%3D%200%3B%20i%20byteLength%3B%20i%2B%2B)%20%7B%0Abinary%20%2B%3D%20String.fromCharCode(bytes%5Bi%5D)%3B%0A%7D%0Areturn%20btoa(binary)%3B%20%20%20%2F%2F%20Base64%E7%BC%96%E7%A0%81%0A%7D%0A%7D%0A%2F%2F%20%E5%AF%BC%E5%87%BA%E5%8D%95%E4%BE%8B%E5%AE%9E%E4%BE%8B%EF%BC%9A%E5%85%A8%E5%B1%80%E5%94%AF%E4%B8%80%EF%BC%8C%E4%BE%BF%E4%BA%8E%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%0Aexport%20const%20rsaCrypto%20%3D%20new%20RSACrypto()%3B%0A%2F%2F%20%E5%AF%BC%E5%87%BA%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%EF%BC%9A%E4%BE%BF%E4%BA%8E%E7%9B%B4%E6%8E%A5%E8%B0%83%E7%94%A8%0Aexport%20const%20encryptWithKey%20%3D%20RSACrypto.encryptWithKey%3B%0Aexport%20const%20validatePublicKey%20%3D%20RSACrypto.validatePublicKey%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">import</span> * <span class="hljs-keyword inline">as</span> jsrsasign <span class="hljs-keyword inline">from</span> <span class="hljs-string inline">&#x27;jsrsasign&#x27;</span>;   <span class="hljs-comment inline">// RSA密钥操作库</span>

<span class="hljs-keyword inline">const</span> {<span class="hljs-variable constant_ inline">KEYUTIL</span>} = jsrsasign;

<span class="hljs-keyword inline">export</span> <span class="hljs-keyword inline">class</span> <span class="hljs-title class_ inline">RSACrypto</span> {
    <span class="hljs-keyword inline">private</span> <span class="hljs-attr inline">publicKey</span>: <span class="hljs-built_in inline">string</span> | <span class="hljs-literal inline">null</span> = <span class="hljs-literal inline">null</span>;   <span class="hljs-comment inline">// 存储从后端获取的公钥</span>

    <span class="hljs-comment inline">// 静态工具方法：使用指定公钥加密（测试用）</span>
    <span class="hljs-keyword inline">static</span> <span class="hljs-keyword inline">async</span> <span class="hljs-title function_ inline">encryptWithKey</span>(<span class="hljs-attr inline">plaintext</span>: <span class="hljs-built_in inline">string</span>, <span class="hljs-attr inline">publicKeyPEM</span>: <span class="hljs-built_in inline">string</span>): <span class="hljs-title class_ inline">Promise</span>&lt;<span class="hljs-built_in inline">string</span>&gt; {
        <span class="hljs-keyword inline">const</span> rsa = <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">RSACrypto</span>();
        rsa.<span class="hljs-title function_ inline">setPublicKey</span>(publicKeyPEM);
        <span class="hljs-keyword inline">return</span> <span class="hljs-keyword inline">await</span> rsa.<span class="hljs-title function_ inline">encrypt</span>(plaintext);
    }

    <span class="hljs-comment inline">// 静态安全验证：确保公钥格式正确且不包含私钥信息</span>
    <span class="hljs-keyword inline">static</span> <span class="hljs-title function_ inline">validatePublicKey</span>(<span class="hljs-attr inline">keyPEM</span>: <span class="hljs-built_in inline">string</span>): <span class="hljs-built_in inline">boolean</span> {
        <span class="hljs-keyword inline">try</span> {
            <span class="hljs-keyword inline">const</span> keyObj = <span class="hljs-variable constant_ inline">KEYUTIL</span>.<span class="hljs-title function_ inline">getKey</span>(keyPEM);
            <span class="hljs-comment inline">// 关键安全检查：RSA公钥只应包含模数(n)和公钥指数(e)</span>
            <span class="hljs-comment inline">// 绝对不能包含私钥指数(d) - 这是安全防护的核心</span>
            <span class="hljs-keyword inline">return</span> keyObj &amp;&amp; 
                   <span class="hljs-string inline">&#x27;n&#x27;</span> <span class="hljs-keyword inline">in</span> keyObj &amp;&amp;    <span class="hljs-comment inline">// 模数n必须存在</span>
                   <span class="hljs-string inline">&#x27;e&#x27;</span> <span class="hljs-keyword inline">in</span> keyObj &amp;&amp;    <span class="hljs-comment inline">// 公钥指数e必须存在</span>
                   !(<span class="hljs-string inline">&#x27;d&#x27;</span> <span class="hljs-keyword inline">in</span> keyObj);   <span class="hljs-comment inline">// 私钥指数d绝对不能存在！</span>
        } <span class="hljs-keyword inline">catch</span> {
            <span class="hljs-keyword inline">return</span> <span class="hljs-literal inline">false</span>;   <span class="hljs-comment inline">// 解析失败，安全拒绝</span>
        }
    }

    <span class="hljs-comment inline">// 密钥设置：接收后端分发的公钥</span>
    <span class="hljs-title function_ inline">setPublicKey</span>(<span class="hljs-params inline"><span class="hljs-attr inline">publicKeyPEM</span>: <span class="hljs-built_in inline">string</span></span>) {
        <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">publicKey</span> = publicKeyPEM;
    }

    <span class="hljs-comment inline">// 密钥获取：返回当前设置的公钥</span>
    <span class="hljs-title function_ inline">getPublicKey</span>(): <span class="hljs-built_in inline">string</span> | <span class="hljs-literal inline">null</span> {
        <span class="hljs-keyword inline">return</span> <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">publicKey</span>;
    }

    <span class="hljs-comment inline">// 核心加密方法：使用Web Crypto API实现RSA-OAEP加密</span>
    <span class="hljs-keyword inline">async</span> <span class="hljs-title function_ inline">encrypt</span>(<span class="hljs-attr inline">plaintext</span>: <span class="hljs-built_in inline">string</span>): <span class="hljs-title class_ inline">Promise</span>&lt;<span class="hljs-built_in inline">string</span>&gt; {
        <span class="hljs-comment inline">// 前置检查：确保公钥已设置</span>
        <span class="hljs-keyword inline">if</span> (!<span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">publicKey</span>) {
            <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">&#x27;Public key not set. Call setPublicKey() first.&#x27;</span>);
        }

        <span class="hljs-comment inline">// 输入验证：确保明文有效</span>
        <span class="hljs-keyword inline">if</span> (!plaintext || <span class="hljs-keyword inline">typeof</span> plaintext !== <span class="hljs-string inline">&#x27;string&#x27;</span>) {
            <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">&#x27;Invalid plaintext for encryption&#x27;</span>);
        }

        <span class="hljs-keyword inline">try</span> {
            <span class="hljs-comment inline">// 第一步：PEM格式密钥转换为Web Crypto API需要的ArrayBuffer</span>
            <span class="hljs-keyword inline">const</span> publicKeyBuffer = <span class="hljs-variable language_ inline">this</span>.<span class="hljs-title function_ inline">pemToArrayBuffer</span>(<span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">publicKey</span>);

            <span class="hljs-comment inline">// 第二步：导入公钥到Web Crypto API</span>
            <span class="hljs-comment inline">// 使用标准的SPKI格式和RSA-OAEP算法</span>
            <span class="hljs-keyword inline">const</span> cryptoKey = <span class="hljs-keyword inline">await</span> <span class="hljs-variable language_ inline">window</span>.<span class="hljs-property inline">crypto</span>.<span class="hljs-property inline">subtle</span>.<span class="hljs-title function_ inline">importKey</span>(
                <span class="hljs-string inline">&#x27;spki&#x27;</span>,                     <span class="hljs-comment inline">// Subject Public Key Info格式</span>
                publicKeyBuffer,            <span class="hljs-comment inline">// 二进制密钥数据</span>
                {
                    <span class="hljs-attr inline">name</span>: <span class="hljs-string inline">&#x27;RSA-OAEP&#x27;</span>,       <span class="hljs-comment inline">// 算法名称，与后端保持一致</span>
                    <span class="hljs-attr inline">hash</span>: <span class="hljs-string inline">&#x27;SHA-256&#x27;</span>,        <span class="hljs-comment inline">// 哈希函数，与后端保持一致</span>
                },
                <span class="hljs-literal inline">false</span>,                      <span class="hljs-comment inline">// 不允许提取密钥（安全考虑）</span>
                [<span class="hljs-string inline">&#x27;encrypt&#x27;</span>]                 <span class="hljs-comment inline">// 只允许加密操作</span>
            );

            <span class="hljs-comment inline">// 第三步：明文编码和加密</span>
            <span class="hljs-keyword inline">const</span> plaintextBuffer = <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">TextEncoder</span>().<span class="hljs-title function_ inline">encode</span>(plaintext);  <span class="hljs-comment inline">// UTF-8编码</span>
            <span class="hljs-keyword inline">const</span> encryptedBuffer = <span class="hljs-keyword inline">await</span> <span class="hljs-variable language_ inline">window</span>.<span class="hljs-property inline">crypto</span>.<span class="hljs-property inline">subtle</span>.<span class="hljs-title function_ inline">encrypt</span>(
                {
                    <span class="hljs-attr inline">name</span>: <span class="hljs-string inline">&#x27;RSA-OAEP&#x27;</span>,      <span class="hljs-comment inline">// 使用OAEP填充</span>
                },
                cryptoKey,
                plaintextBuffer
            );

            <span class="hljs-comment inline">// 第四步：Base64编码以匹配后端格式</span>
            <span class="hljs-keyword inline">return</span> <span class="hljs-variable language_ inline">this</span>.<span class="hljs-title function_ inline">arrayBufferToBase64</span>(encryptedBuffer);
        } <span class="hljs-keyword inline">catch</span> (error) {
            <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">`RSA encryption failed: <span class="hljs-subst inline">${error <span class="hljs-keyword inline">instanceof</span> <span class="hljs-built_in inline">Error</span> ? error.message : <span class="hljs-string inline">&#x27;Unknown error&#x27;</span>}</span>`</span>);
        }
    }

    <span class="hljs-comment inline">// 私有工具方法：PEM格式转ArrayBuffer</span>
    <span class="hljs-keyword inline">private</span> <span class="hljs-title function_ inline">pemToArrayBuffer</span>(<span class="hljs-attr inline">pem</span>: <span class="hljs-built_in inline">string</span>): <span class="hljs-title class_ inline">ArrayBuffer</span> {
        <span class="hljs-comment inline">// 第一步：移除PEM格式的头尾标识和所有空白字符</span>
        <span class="hljs-keyword inline">const</span> pemHeader = <span class="hljs-string inline">&#x27;-----BEGIN PUBLIC KEY-----&#x27;</span>;
        <span class="hljs-keyword inline">const</span> pemFooter = <span class="hljs-string inline">&#x27;-----END PUBLIC KEY-----&#x27;</span>;
        <span class="hljs-keyword inline">const</span> pemContents = pem.<span class="hljs-title function_ inline">replace</span>(pemHeader, <span class="hljs-string inline">&#x27;&#x27;</span>)
                              .<span class="hljs-title function_ inline">replace</span>(pemFooter, <span class="hljs-string inline">&#x27;&#x27;</span>)
                              .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/\s/g</span>, <span class="hljs-string inline">&#x27;&#x27;</span>);   <span class="hljs-comment inline">// 移除所有空白字符</span>

        <span class="hljs-comment inline">// 第二步：Base64解码为二进制字符串</span>
        <span class="hljs-keyword inline">const</span> binaryString = <span class="hljs-title function_ inline">atob</span>(pemContents);

        <span class="hljs-comment inline">// 第三步：二进制字符串转ArrayBuffer（Web Crypto API标准格式）</span>
        <span class="hljs-keyword inline">const</span> bytes = <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Uint8Array</span>(binaryString.<span class="hljs-property inline">length</span>);
        <span class="hljs-keyword inline">for</span> (<span class="hljs-keyword inline">let</span> i = <span class="hljs-number inline">0</span>; i &lt; binaryString.<span class="hljs-property inline">length</span>; i++) {
            bytes[i] = binaryString.<span class="hljs-title function_ inline">charCodeAt</span>(i);   <span class="hljs-comment inline">// 逐字节转换</span>
        }

        <span class="hljs-keyword inline">return</span> bytes.<span class="hljs-property inline">buffer</span>;
    }

    <span class="hljs-comment inline">// 私有工具方法：ArrayBuffer转Base64（网络传输格式）</span>
    <span class="hljs-keyword inline">private</span> <span class="hljs-title function_ inline">arrayBufferToBase64</span>(<span class="hljs-attr inline">buffer</span>: <span class="hljs-title class_ inline">ArrayBuffer</span>): <span class="hljs-built_in inline">string</span> {
        <span class="hljs-keyword inline">const</span> bytes = <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Uint8Array</span>(buffer);
        <span class="hljs-keyword inline">let</span> binary = <span class="hljs-string inline">&#x27;&#x27;</span>;
        <span class="hljs-comment inline">// 逐字节转换为二进制字符串</span>
        <span class="hljs-keyword inline">for</span> (<span class="hljs-keyword inline">let</span> i = <span class="hljs-number inline">0</span>; i &lt; bytes.<span class="hljs-property inline">byteLength</span>; i++) {
            binary += <span class="hljs-title class_ inline">String</span>.<span class="hljs-title function_ inline">fromCharCode</span>(bytes[i]);
        }
        <span class="hljs-keyword inline">return</span> <span class="hljs-title function_ inline">btoa</span>(binary);   <span class="hljs-comment inline">// Base64编码</span>
    }
}

<span class="hljs-comment inline">// 导出单例实例：全局唯一，便于状态管理</span>
<span class="hljs-keyword inline">export</span> <span class="hljs-keyword inline">const</span> rsaCrypto = <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">RSACrypto</span>();

<span class="hljs-comment inline">// 导出工具函数：便于直接调用</span>
<span class="hljs-keyword inline">export</span> <span class="hljs-keyword inline">const</span> encryptWithKey = <span class="hljs-title class_ inline">RSACrypto</span>.<span class="hljs-property inline">encryptWithKey</span>;
<span class="hljs-keyword inline">export</span> <span class="hljs-keyword inline">const</span> validatePublicKey = <span class="hljs-title class_ inline">RSACrypto</span>.<span class="hljs-property inline">validatePublicKey</span>;
</code></pre>
            </div>
        
<h3 id="用户模型解密逻辑核心实现-srcmodelsuserjs" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#用户模型解密逻辑核心实现-srcmodelsuserjs" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 用户模型解密逻辑核心实现 (src/models/User.js)">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            用户模型解密逻辑核心实现 (<code>src/models/User.js</code>)
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="%2F%2F%20%E4%BD%BF%E7%94%A8RSA%E8%A7%A3%E5%AF%86API%E5%AF%86%E9%92%A5%E7%9A%84%E6%96%B9%E6%B3%95%0AuserSchema.methods.decryptApiKey%20%3D%20function(encryptedKey%20%3D%20null)%20%7B%0Atry%20%7B%0Aconst%20keyToDecrypt%20%3D%20encryptedKey%20%7C%7C%20this.apiKey%3B%0Aif%20(!keyToDecrypt)%20%7B%0Areturn%20null%3B%0A%7D%0A%2F%2F%20%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E4%B8%BARSA%E5%8A%A0%E5%AF%86%EF%BC%88%E5%89%8D%E7%AB%AF%E4%BC%A0%E6%9D%A5%E7%9A%84base64%E6%A0%BC%E5%BC%8F%EF%BC%89%0Aif%20(keyToDecrypt.startsWith('rsa%3A'))%20%7B%0Aconst%20encryptedData%20%3D%20keyToDecrypt.substring(4)%3B%0Areturn%20decrypt(encryptedData)%3B%0A%7D%0A%2F%2F%20%E5%A6%82%E6%9E%9C%E4%B8%8D%E6%98%AF%E5%8A%A0%E5%AF%86%E7%9A%84%EF%BC%8C%E7%9B%B4%E6%8E%A5%E8%BF%94%E5%9B%9E%EF%BC%88%E5%BC%80%E5%8F%91%2F%E6%B5%8B%E8%AF%95%E7%94%A8%EF%BC%89%0Areturn%20keyToDecrypt%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60API%20key%20decryption%20failed%3A%20%24%7Berror.message%7D%60)%3B%0A%7D%0A%7D%3B%0A%2F%2F%20%E6%8C%89%E9%9C%80%E8%A7%A3%E5%AF%86%E7%9A%84%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5%EF%BC%9A%E5%8F%AA%E5%9C%A8%E7%9C%9F%E6%AD%A3%E9%9C%80%E8%A6%81%E6%97%B6%E6%89%8D%E8%A7%A3%E5%AF%86%0AuserSchema.methods.getDecryptedApiKey%20%3D%20function()%20%7B%0A%2F%2F%20%E5%8F%8C%E9%87%8D%E5%AE%89%E5%85%A8%E6%A3%80%E6%9F%A5%EF%BC%9A%E5%BF%85%E9%A1%BB%E5%90%8C%E6%97%B6%E6%BB%A1%E8%B6%B3%E6%9C%89%E5%AF%86%E9%92%A5%E4%B8%94%E5%90%AF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AF%86%E9%92%A5%0Aif%20(!this.apiKey%20%7C%7C%20!this.useCustomApiKey)%20%7B%0Areturn%20null%3B%20%20%20%2F%2F%20%E4%B8%8D%E6%BB%A1%E8%B6%B3%E6%9D%A1%E4%BB%B6%EF%BC%8C%E8%BF%94%E5%9B%9Enull%0A%7D%0A%2F%2F%20%E4%B8%B4%E6%97%B6%E8%A7%A3%E5%AF%86%EF%BC%9A%E8%B0%83%E7%94%A8%E8%A7%A3%E5%AF%86%E6%96%B9%E6%B3%95%E8%8E%B7%E5%8F%96%E6%98%8E%E6%96%87%E5%AF%86%E9%92%A5%0Areturn%20this.decryptApiKey()%3B%0A%7D%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-comment inline">// 使用RSA解密API密钥的方法</span>
userSchema.<span class="hljs-property inline">methods</span>.<span class="hljs-property inline">decryptApiKey</span> = <span class="hljs-keyword inline">function</span>(<span class="hljs-params inline">encryptedKey = <span class="hljs-literal inline">null</span></span>) {
  <span class="hljs-keyword inline">try</span> {
    <span class="hljs-keyword inline">const</span> keyToDecrypt = encryptedKey || <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">apiKey</span>;
    
    <span class="hljs-keyword inline">if</span> (!keyToDecrypt) {
      <span class="hljs-keyword inline">return</span> <span class="hljs-literal inline">null</span>;
    }

    <span class="hljs-comment inline">// 检查是否为RSA加密（前端传来的base64格式）</span>
    <span class="hljs-keyword inline">if</span> (keyToDecrypt.<span class="hljs-title function_ inline">startsWith</span>(<span class="hljs-string inline">&#x27;rsa:&#x27;</span>)) {
      <span class="hljs-keyword inline">const</span> encryptedData = keyToDecrypt.<span class="hljs-title function_ inline">substring</span>(<span class="hljs-number inline">4</span>);
      <span class="hljs-keyword inline">return</span> <span class="hljs-title function_ inline">decrypt</span>(encryptedData);
    }
    
    <span class="hljs-comment inline">// 如果不是加密的，直接返回（开发/测试用）</span>
    <span class="hljs-keyword inline">return</span> keyToDecrypt;
  } <span class="hljs-keyword inline">catch</span> (error) {
    <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">`API key decryption failed: <span class="hljs-subst inline">${error.message}</span>`</span>);
  }
};

<span class="hljs-comment inline">// 按需解密的安全策略：只在真正需要时才解密</span>
userSchema.<span class="hljs-property inline">methods</span>.<span class="hljs-property inline">getDecryptedApiKey</span> = <span class="hljs-keyword inline">function</span>(<span class="hljs-params inline"></span>) {
  <span class="hljs-comment inline">// 双重安全检查：必须同时满足有密钥且启用自定义密钥</span>
  <span class="hljs-keyword inline">if</span> (!<span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">apiKey</span> || !<span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">useCustomApiKey</span>) {
    <span class="hljs-keyword inline">return</span> <span class="hljs-literal inline">null</span>;   <span class="hljs-comment inline">// 不满足条件，返回null</span>
  }
  <span class="hljs-comment inline">// 临时解密：调用解密方法获取明文密钥</span>
  <span class="hljs-keyword inline">return</span> <span class="hljs-variable language_ inline">this</span>.<span class="hljs-title function_ inline">decryptApiKey</span>();
};
</code></pre>
            </div>
        
<h3 id="认证控制器密钥管理核心实现-srccontrollersauthcontrollerjs" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#认证控制器密钥管理核心实现-srccontrollersauthcontrollerjs" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 认证控制器密钥管理核心实现 (src/controllers/authController.js)">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            认证控制器密钥管理核心实现 (<code>src/controllers/authController.js</code>)
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="%2F%2F%20API%E6%8E%A5%E5%8F%A3%EF%BC%9A%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7API%E5%AF%86%E9%92%A5%0A%2F%2F%20%40desc%20%20%20%20%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7API%E5%AF%86%E9%92%A5%0A%2F%2F%20%40route%20%20%20PUT%20%2Fapi%2Fauth%2Fapi-key%0A%2F%2F%20%40access%20%20Private%20(%E9%9C%80%E8%A6%81%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81)%0Aexports.updateApiKey%20%3D%20async%20(req%2C%20res)%20%3D%3E%20%7B%0Atry%20%7B%0Aconst%20%7B%20apiKey%2C%20useCustomApiKey%20%7D%20%3D%20req.body%3B%0A%2F%2F%20%E8%BE%93%E5%85%A5%E9%AA%8C%E8%AF%81%E7%9A%84%E8%BE%B9%E7%95%8C%E6%9D%A1%E4%BB%B6%E5%A4%84%E7%90%86%EF%BC%9A%E7%B2%BE%E7%A1%AE%E7%9A%84%E9%AA%8C%E8%AF%81%E9%80%BB%E8%BE%91%0A%2F%2F%20%E5%8F%AA%E6%9C%89%E5%9C%A8%E6%98%8E%E7%A1%AE%E8%A6%81%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AF%86%E9%92%A5%E4%B8%94%E6%8F%90%E4%BE%9B%E4%BA%86%E7%A9%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%97%B6%E6%89%8D%E6%8A%A5%E9%94%99%0A%2F%2F%20%E5%85%81%E8%AE%B8%E8%AE%BE%E7%BD%AEuseCustomApiKey%20%3D%20true%E4%BD%86%E6%9A%82%E4%B8%8D%E6%8F%90%E4%BE%9B%E5%AF%86%E9%92%A5%E7%9A%84%E6%83%85%E5%86%B5%0Aif%20(useCustomApiKey%20%26%26%20apiKey%20%26%26%20apiKey.trim().length%20%3D%3D%3D%200)%20%7B%0Areturn%20res.status(400).json(%7B%0Asuccess%3A%20false%2C%0Amessage%3A%20req.t('auth.apiKeyRequired')%20%20%20%2F%2F%20%E5%9B%BD%E9%99%85%E5%8C%96%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF%0A%7D)%3B%0A%7D%0A%2F%2F%20%E7%94%A8%E6%88%B7%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%EF%BC%9A%E7%A1%AE%E4%BF%9D%E7%94%A8%E6%88%B7%E5%AD%98%E5%9C%A8%0Aconst%20user%20%3D%20await%20User.findById(req.user.id)%3B%0Aif%20(!user)%20%7B%0Areturn%20res.status(404).json(%7B%0Asuccess%3A%20false%2C%0Amessage%3A%20req.t('auth.userNotFound')%0A%7D)%3B%0A%7D%0A%2F%2F%20%E5%AF%86%E9%92%A5%E6%9B%B4%E6%96%B0%E7%9A%84%E6%A0%B8%E5%BF%83%E9%80%BB%E8%BE%91%EF%BC%9A%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E7%9A%84%E5%8E%9F%E5%AD%90%E6%80%A7%E6%93%8D%E4%BD%9C%0Aif%20(useCustomApiKey)%20%7B%0A%2F%2F%20%E5%85%B3%E9%94%AE%E5%AE%89%E5%85%A8%E5%86%B3%E7%AD%96%EF%BC%9A%E7%9B%B4%E6%8E%A5%E5%AD%98%E5%82%A8%E5%89%8D%E7%AB%AF%E5%8A%A0%E5%AF%86%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%8C%E7%BB%9D%E4%B8%8D%E5%9C%A8%E6%AD%A4%E5%A4%84%E8%A7%A3%E5%AF%86%0A%2F%2F%20%E5%89%8D%E7%AB%AF%E5%8F%91%E9%80%81%E7%9A%84%E6%98%AFRSA%E5%8A%A0%E5%AF%86%E6%95%B0%E6%8D%AE%EF%BC%8C%E6%A0%BC%E5%BC%8F%E4%B8%BA%20'rsa%3ABase64EncryptedData'%0Aif%20(apiKey%20%26%26%20apiKey.trim().length%20%3E%200)%20%7B%0Auser.apiKey%20%3D%20apiKey.trim()%3B%20%20%20%2F%2F%20%E7%9B%B4%E6%8E%A5%E5%AD%98%E5%82%A8%E5%AF%86%E6%96%87%EF%BC%8C%E4%BF%9D%E6%8C%81%E5%8A%A0%E5%AF%86%E7%8A%B6%E6%80%81%0A%7D%20else%20%7B%0Auser.apiKey%20%3D%20undefined%3B%20%20%20%20%20%20%20%2F%2F%20%E6%B8%85%E7%A9%BA%E5%AF%86%E9%92%A5%E6%95%B0%E6%8D%AE%0A%7D%0Auser.useCustomApiKey%20%3D%20true%3B%20%20%20%20%20%2F%2F%20%E5%90%AF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AF%86%E9%92%A5%E6%A0%87%E5%BF%97%0A%7D%20else%20%7B%0A%2F%2F%20%E7%A6%81%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AF%86%E9%92%A5%EF%BC%9A%E5%90%8C%E6%97%B6%E6%B8%85%E7%A9%BA%E5%AF%86%E9%92%A5%E6%95%B0%E6%8D%AE%E5%92%8C%E6%A0%87%E5%BF%97%E4%BD%8D%EF%BC%8C%E7%A1%AE%E4%BF%9D%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7%0Auser.apiKey%20%3D%20undefined%3B%0Auser.useCustomApiKey%20%3D%20false%3B%0A%7D%0A%2F%2F%20%E5%8E%9F%E5%AD%90%E6%80%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C%EF%BC%9A%E7%A1%AE%E4%BF%9D%E7%8A%B6%E6%80%81%E5%8F%98%E6%9B%B4%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7%0Aawait%20user.save()%3B%0A%2F%2F%20%E6%88%90%E5%8A%9F%E5%93%8D%E5%BA%94%EF%BC%9A%E8%BF%94%E5%9B%9E%E6%93%8D%E4%BD%9C%E7%BB%93%E6%9E%9C%E5%92%8C%E6%96%B0%E7%8A%B6%E6%80%81%0Ares.status(200).json(%7B%0Asuccess%3A%20true%2C%0Amessage%3A%20req.t('auth.apiKeyUpdatedSuccessfully')%2C%0AuseCustomApiKey%3A%20user.useCustomApiKey%20%20%20%20%2F%2F%20%E8%BF%94%E5%9B%9E%E5%BD%93%E5%89%8D%E7%8A%B6%E6%80%81%E4%BE%9B%E5%89%8D%E7%AB%AF%E7%A1%AE%E8%AE%A4%0A%7D)%3B%0A%7D%20catch%20(error)%20%7B%0A%2F%2F%20%E7%BB%9F%E4%B8%80%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%EF%BC%9A%E8%AE%B0%E5%BD%95%E9%94%99%E8%AF%AF%E5%B9%B6%E8%BF%94%E5%9B%9E%E7%94%A8%E6%88%B7%E5%8F%8B%E5%A5%BD%E7%9A%84%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF%0Ares.status(500).json(%7B%0Asuccess%3A%20false%2C%0Amessage%3A%20req.t('auth.serverError')%0A%7D)%3B%0A%7D%0A%7D%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-comment inline">// API接口：更新用户API密钥</span>
<span class="hljs-comment inline">// @desc    更新用户API密钥</span>
<span class="hljs-comment inline">// @route   PUT /api/auth/api-key</span>
<span class="hljs-comment inline">// @access  Private (需要身份验证)</span>
<span class="hljs-built_in inline">exports</span>.<span class="hljs-property inline">updateApiKey</span> = <span class="hljs-title function_ inline">async</span> (req, res) =&gt; {
  <span class="hljs-keyword inline">try</span> {
    <span class="hljs-keyword inline">const</span> { apiKey, useCustomApiKey } = req.<span class="hljs-property inline">body</span>;

    <span class="hljs-comment inline">// 输入验证的边界条件处理：精确的验证逻辑</span>
    <span class="hljs-comment inline">// 只有在明确要使用自定义密钥且提供了空字符串时才报错</span>
    <span class="hljs-comment inline">// 允许设置useCustomApiKey = true但暂不提供密钥的情况</span>
    <span class="hljs-keyword inline">if</span> (useCustomApiKey &amp;&amp; apiKey &amp;&amp; apiKey.<span class="hljs-title function_ inline">trim</span>().<span class="hljs-property inline">length</span> === <span class="hljs-number inline">0</span>) {
      <span class="hljs-keyword inline">return</span> res.<span class="hljs-title function_ inline">status</span>(<span class="hljs-number inline">400</span>).<span class="hljs-title function_ inline">json</span>({
        <span class="hljs-attr inline">success</span>: <span class="hljs-literal inline">false</span>,
        <span class="hljs-attr inline">message</span>: req.<span class="hljs-title function_ inline">t</span>(<span class="hljs-string inline">&#x27;auth.apiKeyRequired&#x27;</span>)   <span class="hljs-comment inline">// 国际化错误信息</span>
      });
    }

    <span class="hljs-comment inline">// 用户身份验证：确保用户存在</span>
    <span class="hljs-keyword inline">const</span> user = <span class="hljs-keyword inline">await</span> <span class="hljs-title class_ inline">User</span>.<span class="hljs-title function_ inline">findById</span>(req.<span class="hljs-property inline">user</span>.<span class="hljs-property inline">id</span>);
    <span class="hljs-keyword inline">if</span> (!user) {
      <span class="hljs-keyword inline">return</span> res.<span class="hljs-title function_ inline">status</span>(<span class="hljs-number inline">404</span>).<span class="hljs-title function_ inline">json</span>({
        <span class="hljs-attr inline">success</span>: <span class="hljs-literal inline">false</span>,
        <span class="hljs-attr inline">message</span>: req.<span class="hljs-title function_ inline">t</span>(<span class="hljs-string inline">&#x27;auth.userNotFound&#x27;</span>)
      });
    }

    <span class="hljs-comment inline">// 密钥更新的核心逻辑：状态管理的原子性操作</span>
    <span class="hljs-keyword inline">if</span> (useCustomApiKey) {
      <span class="hljs-comment inline">// 关键安全决策：直接存储前端加密的数据，绝不在此处解密</span>
      <span class="hljs-comment inline">// 前端发送的是RSA加密数据，格式为 &#x27;rsa:Base64EncryptedData&#x27;</span>
      <span class="hljs-keyword inline">if</span> (apiKey &amp;&amp; apiKey.<span class="hljs-title function_ inline">trim</span>().<span class="hljs-property inline">length</span> &gt; <span class="hljs-number inline">0</span>) {
        user.<span class="hljs-property inline">apiKey</span> = apiKey.<span class="hljs-title function_ inline">trim</span>();   <span class="hljs-comment inline">// 直接存储密文，保持加密状态</span>
      } <span class="hljs-keyword inline">else</span> {
        user.<span class="hljs-property inline">apiKey</span> = <span class="hljs-literal inline">undefined</span>;       <span class="hljs-comment inline">// 清空密钥数据</span>
      }
      user.<span class="hljs-property inline">useCustomApiKey</span> = <span class="hljs-literal inline">true</span>;     <span class="hljs-comment inline">// 启用自定义密钥标志</span>
    } <span class="hljs-keyword inline">else</span> {
      <span class="hljs-comment inline">// 禁用自定义密钥：同时清空密钥数据和标志位，确保数据一致性</span>
      user.<span class="hljs-property inline">apiKey</span> = <span class="hljs-literal inline">undefined</span>;
      user.<span class="hljs-property inline">useCustomApiKey</span> = <span class="hljs-literal inline">false</span>;
    }

    <span class="hljs-comment inline">// 原子性数据库操作：确保状态变更的一致性</span>
    <span class="hljs-keyword inline">await</span> user.<span class="hljs-title function_ inline">save</span>();

    <span class="hljs-comment inline">// 成功响应：返回操作结果和新状态</span>
    res.<span class="hljs-title function_ inline">status</span>(<span class="hljs-number inline">200</span>).<span class="hljs-title function_ inline">json</span>({
      <span class="hljs-attr inline">success</span>: <span class="hljs-literal inline">true</span>,
      <span class="hljs-attr inline">message</span>: req.<span class="hljs-title function_ inline">t</span>(<span class="hljs-string inline">&#x27;auth.apiKeyUpdatedSuccessfully&#x27;</span>),
      <span class="hljs-attr inline">useCustomApiKey</span>: user.<span class="hljs-property inline">useCustomApiKey</span>    <span class="hljs-comment inline">// 返回当前状态供前端确认</span>
    });
  } <span class="hljs-keyword inline">catch</span> (error) {
    <span class="hljs-comment inline">// 统一错误处理：记录错误并返回用户友好的错误信息</span>
    res.<span class="hljs-title function_ inline">status</span>(<span class="hljs-number inline">500</span>).<span class="hljs-title function_ inline">json</span>({
      <span class="hljs-attr inline">success</span>: <span class="hljs-literal inline">false</span>,
      <span class="hljs-attr inline">message</span>: req.<span class="hljs-title function_ inline">t</span>(<span class="hljs-string inline">&#x27;auth.serverError&#x27;</span>)
    });
  }
};
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">代码架构的核心设计原则</strong>：</p>
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">安全优先原则</strong>：后端永不存储明文密钥，只在使用时临时解密</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">职责分离原则</strong>：前端负责加密，后端负责存储和按需解密</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">数据一致性原则</strong>：确保密钥数据和使用标志的原子性更新</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">错误处理原则</strong>：每个层级都有详细的错误处理和国际化支持</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">向前兼容原则</strong>：支持开发环境的调试需求，保持系统灵活性</li>
</ol>
<p class="text-base leading-7 mb-4 text-foreground">通过这些代码的详细解析，我们可以看到Questions Party项目在RSA实现上的每一个细节都经过了深思熟虑，既保证了安全性，又兼顾了可维护性和易用性。整个架构体现了现代Web安全开发的最佳实践。</p>
<h2 id="完整的端到端加密流程追踪" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#完整的端到端加密流程追踪" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 完整的端到端加密流程追踪">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            完整的端到端加密流程追踪
        </h2>
<h3 id="从用户输入到数据库存储的完整追踪" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#从用户输入到数据库存储的完整追踪" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 从用户输入到数据库存储的完整追踪">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            从用户输入到数据库存储的完整追踪
        </h3>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">API密钥更新流程</strong>：</p>
<div class="mermaid block" id="mermaid-1767322173316-7ncmf7i">sequenceDiagram
    participant U as 用户
    participant F as 前端
    participant B as 后端
    participant D as 数据库
    
    U->>F: 输入API密钥
    F->>B: 获取RSA公钥
    B->>F: 返回公钥
    F->>F: RSA加密密钥
    F->>B: 发送加密数据
    B->>D: 直接存储加密数据
    D->>B: 确认存储
    B->>F: 返回成功状态
    F->>U: 显示成功消息</div>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">API密钥使用流程</strong>：</p>
<div class="mermaid block" id="mermaid-1767322173316-oj7lz3i">sequenceDiagram
    participant U as 用户
    participant F as 前端
    participant B as 后端
    participant D as 数据库
    participant A as 大模型API
    
    U->>F: 发送请求
    F->>B: 请求处理
    B->>D: 读取加密密钥
    D->>B: 返回加密数据
    B->>B: 临时解密密钥
    B->>A: 使用明文密钥调用API
    A->>B: 返回API响应
    B->>B: 清理明文密钥
    B->>F: 返回处理结果
    F->>U: 显示结果</div>
<h3 id="每一步的数据状态变化" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#每一步的数据状态变化" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 每一步的数据状态变化">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            每一步的数据状态变化
        </h3>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">API密钥更新流程的数据状态</strong>：</p>
<table class="w-full border-collapse mb-4 shadow-sm rounded-lg overflow-hidden">
<thead class="bg-surface">
<tr class="border-b border-gray-200"><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">步骤</th><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">位置</th><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">数据状态</th><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">格式</th><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">安全性</th></tr>
</thead>
<tbody class="bg-background divide-y divide-gray-200">
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">1</td><td class="px-4 py-3 text-sm text-foreground">用户输入</td><td class="px-4 py-3 text-sm text-foreground">明文</td><td class="px-4 py-3 text-sm text-foreground">String</td><td class="px-4 py-3 text-sm text-foreground">低</td></tr>
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">2</td><td class="px-4 py-3 text-sm text-foreground">前端内存</td><td class="px-4 py-3 text-sm text-foreground">明文</td><td class="px-4 py-3 text-sm text-foreground">String</td><td class="px-4 py-3 text-sm text-foreground">低</td></tr>
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">3</td><td class="px-4 py-3 text-sm text-foreground">前端加密</td><td class="px-4 py-3 text-sm text-foreground">密文</td><td class="px-4 py-3 text-sm text-foreground">Base64</td><td class="px-4 py-3 text-sm text-foreground">高</td></tr>
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">4</td><td class="px-4 py-3 text-sm text-foreground">网络传输</td><td class="px-4 py-3 text-sm text-foreground">密文+TLS</td><td class="px-4 py-3 text-sm text-foreground">Encrypted</td><td class="px-4 py-3 text-sm text-foreground">极高</td></tr>
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">5</td><td class="px-4 py-3 text-sm text-foreground">后端接收</td><td class="px-4 py-3 text-sm text-foreground">密文</td><td class="px-4 py-3 text-sm text-foreground">Base64</td><td class="px-4 py-3 text-sm text-foreground">高</td></tr>
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">6</td><td class="px-4 py-3 text-sm text-foreground">数据库存储</td><td class="px-4 py-3 text-sm text-foreground">密文</td><td class="px-4 py-3 text-sm text-foreground">rsa:Base64</td><td class="px-4 py-3 text-sm text-foreground">高</td></tr>
</tbody>
</table>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">API密钥使用流程的数据状态</strong>：</p>
<table class="w-full border-collapse mb-4 shadow-sm rounded-lg overflow-hidden">
<thead class="bg-surface">
<tr class="border-b border-gray-200"><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">步骤</th><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">位置</th><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">数据状态</th><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">格式</th><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">安全性</th></tr>
</thead>
<tbody class="bg-background divide-y divide-gray-200">
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">1</td><td class="px-4 py-3 text-sm text-foreground">数据库读取</td><td class="px-4 py-3 text-sm text-foreground">密文</td><td class="px-4 py-3 text-sm text-foreground">rsa:Base64</td><td class="px-4 py-3 text-sm text-foreground">高</td></tr>
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">2</td><td class="px-4 py-3 text-sm text-foreground">后端临时解密</td><td class="px-4 py-3 text-sm text-foreground">明文</td><td class="px-4 py-3 text-sm text-foreground">String</td><td class="px-4 py-3 text-sm text-foreground">中</td></tr>
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">3</td><td class="px-4 py-3 text-sm text-foreground">调用大模型API</td><td class="px-4 py-3 text-sm text-foreground">明文</td><td class="px-4 py-3 text-sm text-foreground">String</td><td class="px-4 py-3 text-sm text-foreground">中</td></tr>
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">4</td><td class="px-4 py-3 text-sm text-foreground">内存清理</td><td class="px-4 py-3 text-sm text-foreground">已销毁</td><td class="px-4 py-3 text-sm text-foreground">-</td><td class="px-4 py-3 text-sm text-foreground">极高</td></tr>
</tbody>
</table>
<h3 id="调试和监控的最佳实践" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#调试和监控的最佳实践" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 调试和监控的最佳实践">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            调试和监控的最佳实践
        </h3>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">日志记录策略</strong>：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="%2F%2F%20%E2%9C%85%20%E5%AE%89%E5%85%A8%E7%9A%84%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%0Aconsole.log('API%20key%20updated%20for%20user%3A'%2C%20user.id)%3B%0Aconsole.log('Using%20custom%20API%20key%3A'%2C%20user.useCustomApiKey)%3B%0A%2F%2F%20%E2%9D%8C%20%E5%8D%B1%E9%99%A9%E7%9A%84%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%0Aconsole.log('API%20key%3A'%2C%20apiKey)%3B%20%20%2F%2F%20%E6%B0%B8%E8%BF%9C%E4%B8%8D%E8%A6%81%E8%AE%B0%E5%BD%95%E6%95%8F%E6%84%9F%E6%95%B0%E6%8D%AE%0Aconsole.log('Decrypted%20key%3A'%2C%20decryptedKey)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-comment inline">// ✅ 安全的日志记录</span>
<span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">log</span>(<span class="hljs-string inline">&#x27;API key updated for user:&#x27;</span>, user.<span class="hljs-property inline">id</span>);
<span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">log</span>(<span class="hljs-string inline">&#x27;Using custom API key:&#x27;</span>, user.<span class="hljs-property inline">useCustomApiKey</span>);

<span class="hljs-comment inline">// ❌ 危险的日志记录</span>
<span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">log</span>(<span class="hljs-string inline">&#x27;API key:&#x27;</span>, apiKey);  <span class="hljs-comment inline">// 永远不要记录敏感数据</span>
<span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">log</span>(<span class="hljs-string inline">&#x27;Decrypted key:&#x27;</span>, decryptedKey);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">监控指标</strong>：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="const%20securityMetrics%20%3D%20%7B%0AencryptionSuccessRate%3A%20'99.9%25'%2C%0AdecryptionErrorRate%3A%20'0.1%25'%2C%0AkeyRotationFrequency%3A%20'90%20days'%2C%0AsuspiciousActivityCount%3A%200%0A%7D%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-keyword inline">const</span> securityMetrics = {
  <span class="hljs-attr inline">encryptionSuccessRate</span>: <span class="hljs-string inline">&#x27;99.9%&#x27;</span>,
  <span class="hljs-attr inline">decryptionErrorRate</span>: <span class="hljs-string inline">&#x27;0.1%&#x27;</span>,
  <span class="hljs-attr inline">keyRotationFrequency</span>: <span class="hljs-string inline">&#x27;90 days&#x27;</span>,
  <span class="hljs-attr inline">suspiciousActivityCount</span>: <span class="hljs-number inline">0</span>
};
</code></pre>
            </div>
        
<h2 id="系统架构总结与最佳实践" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#系统架构总结与最佳实践" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 系统架构总结与最佳实践">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            系统架构总结与最佳实践
        </h2>
<h3 id="rsa在现代web应用中的完整架构" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#rsa在现代web应用中的完整架构" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to RSA在现代Web应用中的完整架构">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            RSA在现代Web应用中的完整架构
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">通过对Questions Party项目的深入分析，我们可以总结出一套完整的RSA加密架构：</p>
<div class="mermaid block" id="mermaid-1767322173316-osw3zw5">graph TB
    subgraph "安全边界"
        subgraph "前端安全域"
            A[用户输入] --> B[数据验证]
            B --> C[获取公钥]
            C --> D[RSA加密]
            D --> E[安全传输]
        end
        
        subgraph "传输安全域"
            E --> F[HTTPS隧道]
            F --> G[TLS终结]
        end
        
        subgraph "后端安全域"
            G --> H[数据接收]
            H --> I[身份验证]
            I --> J[直接存储密文]
            J --> K[按需临时解密]
            K --> L[业务处理]
            L --> M[内存清理]
        end
        
        subgraph "存储安全域"
            M --> N[数据库]
            N --> O[备份加密]
        end
    end
    
    subgraph "密钥管理域"
        P[密钥生成] --> Q[密钥分发]
        Q --> R[密钥轮换]
        R --> S[密钥销毁]
    end
    
    Q --> C
    P --> K</div>
<h2 id="写在最后" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#写在最后" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 写在最后">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            写在最后
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">在设计安全性加密架构的时候，我会假设：前端代码被逆向了，而中间传输被拦截了，它们的算法、数据完全暴露在攻击者的眼中，只有后端是安全的。在这种情况下，怎样的加密流程才能够确保安全呢？</p>
<p class="text-base leading-7 mb-4 text-foreground">倘若只有后端是安全的，那么要解决这个问题，只能从后端下手。即——我需要有某个安全的东西来对解密这一步进行把关，确保明文密钥只会临时存在于后端，将攻击者窃取密钥的可能性降到最低。</p>
<p class="text-base leading-7 mb-4 text-foreground">后来我想到了非对称加密。</p>
<p class="text-base leading-7 mb-4 text-foreground"><em class="italic text-foreground">愿你的加密如古老行星上的瘢痕般无法预测。公钥和私钥各为彼岸的一端，渡过中间长长的未知之河，带着你心中的信息安然来到彼岸吧。密钥如夜空中的双子星，公钥照亮世界，私钥守护自己；愿你的加密如古代的密语，只有真正理解的人才能解读其中的奥秘。在这个数字化的时代，让我们用代码编织更安全的未来，用数学构筑更牢固的防线！</em> 🔐✨</p>
</div></article><footer class="mt-16 pt-8 border-t border-foreground/20"><div class="flex items-center justify-between"><a class="inline-flex items-center px-4 py-2 bg-primary text-foreground rounded-lg hover:bg-primary/90 transition-colors" href="/MilkWind-Website/documents/">documents.backToDocuments</a><div class="text-sm text-foreground/60"><span>documents.byAuthor<!-- --> <!-- -->MilkWind</span></div></div></footer></div></div><!--$--><!--/$--><!--$--><!--/$--><!--/$--><!--/$--><script src="/MilkWind-Website/_next/static/chunks/webpack-1674c92fb524bcda.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[38735,[\"46\",\"static/chunks/46-268e24d727b280ef.js\",\"7177\",\"static/chunks/app/layout-af4a6e723c0ff668.js\"],\"default\"]\n3:I[19945,[\"46\",\"static/chunks/46-268e24d727b280ef.js\",\"7177\",\"static/chunks/app/layout-af4a6e723c0ff668.js\"],\"default\"]\n4:I[65337,[\"46\",\"static/chunks/46-268e24d727b280ef.js\",\"7177\",\"static/chunks/app/layout-af4a6e723c0ff668.js\"],\"default\"]\n5:I[96190,[\"46\",\"static/chunks/46-268e24d727b280ef.js\",\"7177\",\"static/chunks/app/layout-af4a6e723c0ff668.js\"],\"ClientProviders\"]\n6:I[87555,[],\"\"]\n7:I[51901,[\"8039\",\"static/chunks/app/error-dda32be1d095a86c.js\"],\"default\"]\n8:I[31295,[],\"\"]\n9:I[6874,[\"6874\",\"static/chunks/6874-fbe9a08eb79b991c.js\",\"4345\",\"static/chunks/app/not-found-9ff98b2ccf24cac7.js\"],\"\"]\na:I[94970,[],\"ClientSegmentRoot\"]\nb:I[44065,[\"206\",\"static/chunks/206-4f4cbf4d7156f437.js\",\"3092\",\"static/chunks/app/documents/layout-28408791defde09e.js\"],\"default\"]\ne:I[59665,[],\"MetadataBoundary\"]\n10:I[59665,[],\"OutletBoundary\"]\n13:I[74911,[],\"AsyncMetadataOutlet\"]\n15:I[39460,[\"2415\",\"static/chunks/2415-689c103fb3d2c28d.js\",\"8610\",\"static/chunks/8610-7bd3f91f3cf2a4d6.js\",\"5650\",\"static/chunks/app/documents/loading-1fa3f98b6e5a8e78.js\"],\"default\"]\n16:I[88610,[\"2415\",\"static/chunks/2415-689c103fb3d2c28d.js\",\"8610\",\"static/chunks/8610-7bd3f91f3cf2a4d6.js\",\"4209\",\"static/chunks/app/loading-68f227fb49b3ac8c.js\"],\"default\"]\n17:I[59665,[],\"ViewportBoundary\"]\n19:I[26614,[],\"\"]\n:HL[\"/MilkWind-Website/_next/static/css/f034c804622acb16.css\",\"style\"]\n:HL[\"/MilkWind-Website/_next/static/css/276b387d8ca46690.css\",\"style\"]\n:HL[\"/MilkWind-Website/_next/static/css/5eacd01f773eed7f.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"ARIfyKTG2kypPJcFndv6Z\",\"p\":\"/MilkWind-Website\",\"c\":[\"\",\"documents\",\"zh\",\"light\",\"questions-party\",\"rsa-protective-measures\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"documents\",{\"children\":[[\"slug\",\"zh/light/questions-party/rsa-protective-measures\",\"c\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/MilkWind-Website/_next/static/css/f034c804622acb16.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/MilkWind-Website/_next/static/css/276b387d8ca46690.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"__variable_9b7fb1 __variable_ca2a15 __variable_591dcc font-sans antialiased min-h-screen bg-background text-foreground\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"$L2\",null,{}],[\"$\",\"$L3\",null,{}],[\"$\",\"$L4\",null,{}],[\"$\",\"$L5\",null,{\"children\":[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$7\",\"errorStyles\":[],\"errorScripts\":[],\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"div\",null,{\"className\":\"z-10 relative min-h-screen flex items-center justify-center bg-background p-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"text-center max-w-md\",\"children\":[[\"$\",\"div\",null,{\"className\":\"text-8xl font-bold text-primary mb-4\",\"children\":\"404\"}],[\"$\",\"h2\",null,{\"className\":\"text-2xl font-bold text-foreground mb-4\",\"children\":\"Page Not Found\"}],[\"$\",\"p\",null,{\"className\":\"text-foreground/70 mb-8\",\"children\":\"The page you're looking for doesn't exist or has been moved to a different location.\"}],[\"$\",\"div\",null,{\"className\":\"flex flex-col sm:flex-row gap-4 justify-center\",\"children\":[[\"$\",\"$L9\",null,{\"href\":\"/\",\"className\":\"px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary/80 transition-colors\",\"children\":\"Go Home\"}],[\"$\",\"$L9\",null,{\"href\":\"/works\",\"className\":\"px-6 py-2 border border-primary text-primary rounded-lg hover:bg-primary/10 transition-colors\",\"children\":\"View Works\"}]]}],[\"$\",\"div\",null,{\"className\":\"absolute inset-0 overflow-hidden pointer-events-none -z-10\",\"children\":[[\"$\",\"div\",null,{\"className\":\"absolute top-1/4 left-1/4 w-2 h-2 bg-primary/20 rounded-full animate-float\"}],[\"$\",\"div\",null,{\"className\":\"absolute top-3/4 right-1/4 w-3 h-3 bg-accent/20 rounded-full animate-float\",\"style\":{\"animationDelay\":\"1s\"}}],[\"$\",\"div\",null,{\"className\":\"absolute bottom-1/4 left-1/3 w-1 h-1 bg-secondary/20 rounded-full animate-float\",\"style\":{\"animationDelay\":\"2s\"}}]]}]]}]}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}]}]]}],{\"children\":[\"documents\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$La\",null,{\"Component\":\"$b\",\"slots\":{\"children\":[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]},\"params\":{},\"promise\":\"$@c\"}]]}],{\"children\":[[\"slug\",\"zh/light/questions-party/rsa-protective-measures\",\"c\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$Ld\",[\"$\",\"$Le\",null,{\"children\":\"$Lf\"}],[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/MilkWind-Website/_next/static/css/5eacd01f773eed7f.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L10\",null,{\"children\":[\"$L11\",\"$L12\",[\"$\",\"$L13\",null,{\"promise\":\"$@14\"}]]}]]}],{},null,false]},null,false]},[[\"$\",\"$L15\",\"l\",{}],[],[]],false]},[[\"$\",\"$L16\",\"l\",{}],[],[]],false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"rMRVy_hPPhqAc1schTLI-\",{\"children\":[[\"$\",\"$L17\",null,{\"children\":\"$L18\"}],null]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$19\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"1a:\"$Sreact.suspense\"\n1b:I[74911,[],\"AsyncMetadata\"]\nc:{}\nf:[\"$\",\"$1a\",null,{\"fallback\":null,\"children\":[\"$\",\"$L1b\",null,{\"promise\":\"$@1c\"}]}]\n"])</script><script>self.__next_f.push([1,"1d:I[57340,[\"5584\",\"static/chunks/b498d07c-095637f0f10883c6.js\",\"2415\",\"static/chunks/2415-689c103fb3d2c28d.js\",\"6874\",\"static/chunks/6874-fbe9a08eb79b991c.js\",\"9554\",\"static/chunks/9554-b714f9de28e85d30.js\",\"1873\",\"static/chunks/app/documents/%5B...slug%5D/page-8f3efa7e6c6c5377.js\"],\"DocumentPageClient\"]\n1e:T65d7f,"])</script><script>self.__next_f.push([1,"\u003ch1 id=\"密钥双刃剑：rsa加密在现代web应用中的安全防护之道\" class=\"group relative text-4xl font-bold mt-8 mb-4 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#密钥双刃剑：rsa加密在现代web应用中的安全防护之道\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 密钥双刃剑：RSA加密在现代Web应用中的安全防护之道\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            密钥双刃剑：RSA加密在现代Web应用中的安全防护之道\n        \u003c/h1\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e在密码学的长河中，如果说对称加密是一把精密的锁，那么非对称加密就是一把神奇的双刃剑——一面可以加密，一面可以解密，却永远不会伤到持剑者。\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e回想起那个信息安全刚刚起步的年代，开发者们还在为如何安全地传输API密钥而头疼不已。明文传输？那是在裸奔。对称加密？密钥分发又成了新的难题。直到RSA算法的出现，才真正解决了这个看似无解的密钥分发问题。\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e本文将深入解析Questions Party项目中RSA加密的完整实现，从数学原理到工程实践，从密钥生成到数据传输，带你看透这把\u0026quot;密钥双刃剑\u0026quot;的真正威力。\u003c/p\u003e\n\u003ch2 id=\"rsa算法的数学基础\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#rsa算法的数学基础\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to RSA算法的数学基础\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            RSA算法的数学基础\n        \u003c/h2\u003e\n\u003ch3 id=\"大数分解的数学难题\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#大数分解的数学难题\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 大数分解的数学难题\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            大数分解的数学难题\n        \u003c/h3\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003eRSA算法的安全性建立在一个看似简单却极其困难的数学问题上：\u003cstrong class=\"font-bold text-foreground\"\u003e大整数的素因数分解\u003c/strong\u003e。\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e给你两个大质数相乘很容易：\u003cbr class=\"block\"\u003e\n\u003cspan class=\"katex-display inline\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ep\u003c/mi\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e61\u003c/mn\u003e\u003cmo separator=\"true\"\u003e,\u003c/mo\u003e\u003cmi\u003eq\u003c/mi\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e53\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ep = 61, q = 53\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.625em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ep\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.8389em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e61\u003c/span\u003e\u003cspan class=\"mpunct inline\"\u003e,\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.1667em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\" style=\"margin-right:0.03588em;\"\u003eq\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e53\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cbr class=\"block\"\u003e\n\u003cspan class=\"katex-display inline\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmi\u003ep\u003c/mi\u003e\u003cmo\u003e×\u003c/mo\u003e\u003cmi\u003eq\u003c/mi\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e61\u003c/mn\u003e\u003cmo\u003e×\u003c/mo\u003e\u003cmn\u003e53\u003c/mn\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e3233\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003en = p \\times q = 61 \\times 53 = 3233\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.7778em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ep\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e×\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.625em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\" style=\"margin-right:0.03588em;\"\u003eq\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.7278em;vertical-align:-0.0833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e61\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e×\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e53\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e3233\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e但如果我现在告诉你 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e3233\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003en = 3233\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e3233\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e，让你找出 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ep\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ep\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.625em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ep\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e 和 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eq\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eq\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.625em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\" style=\"margin-right:0.03588em;\"\u003eq\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e，你可能需要试很多次才能找到答案。\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e现在想象一下，如果 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ep\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ep\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.625em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ep\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e 和 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eq\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eq\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.625em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\" style=\"margin-right:0.03588em;\"\u003eq\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e 都是1024位的质数…\u003c/strong\u003e\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e这就是RSA的核心思想：\u003cstrong class=\"font-bold text-foreground\"\u003e正向计算简单，逆向计算困难\u003c/strong\u003e。\u003c/p\u003e\n\u003ch3 id=\"欧拉函数和模运算\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#欧拉函数和模运算\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 欧拉函数和模运算\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            欧拉函数和模运算\n        \u003c/h3\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003eRSA算法的关键在于欧拉函数 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\phi(n)\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003eϕ\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e：\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cspan class=\"katex-display inline\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003ep\u003c/mi\u003e\u003cmo\u003e×\u003c/mo\u003e\u003cmi\u003eq\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003ep\u003c/mi\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003eq\u003c/mi\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\phi(n) = \\phi(p \\times q) = (p-1)(q-1)\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003eϕ\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003eϕ\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ep\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e×\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\" style=\"margin-right:0.03588em;\"\u003eq\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ep\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e−\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\" style=\"margin-right:0.03588em;\"\u003eq\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e−\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e继续我们的例子：\u003cbr class=\"block\"\u003e\n\u003cspan class=\"katex-display inline\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmn\u003e3233\u003c/mn\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmn\u003e61\u003c/mn\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmn\u003e53\u003c/mn\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e60\u003c/mn\u003e\u003cmo\u003e×\u003c/mo\u003e\u003cmn\u003e52\u003c/mn\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e3120\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\phi(3233) = (61-1)(53-1) = 60 \\times 52 = 3120\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003eϕ\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e3233\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e61\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e−\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e53\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e−\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.7278em;vertical-align:-0.0833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e60\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e×\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e52\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e3120\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e为什么要计算欧拉函数？\u003c/strong\u003e因为它告诉我们在模 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003en\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e 意义下，有多少个数与 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003en\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e 互质。\u003c/p\u003e\n\u003ch3 id=\"公钥私钥的数学生成过程\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#公钥私钥的数学生成过程\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 公钥私钥的数学生成过程\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            公钥私钥的数学生成过程\n        \u003c/h3\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e第一步：选择公钥指数 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ee\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ee\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ee\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e这里举一个小例子，选择 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ee\u003c/mi\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e17\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ee = 17\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ee\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e17\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e，它满足RSA的条件：\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e1 \u0026lt; e \u0026lt; φ(n)，即 1 \u0026lt; 17 \u0026lt; 3120 ✓\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003egcd(17, 3120) = 1，即17与3120互质 ✓\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e注意\u003c/strong\u003e：在实际应用中通常选择 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ee\u003c/mi\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e65537\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ee = 65537\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ee\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e65537\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e，但那需要更大的质数使得 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\phi(n)\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003eϕ\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e 远大于65537。\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e第二步：计算私钥指数 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ed\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ed\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ed\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e需要满足：\u003cbr class=\"block\"\u003e\n\u003cspan class=\"katex-display inline\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ee\u003c/mi\u003e\u003cmo\u003e×\u003c/mo\u003e\u003cmi\u003ed\u003c/mi\u003e\u003cmo\u003e≡\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmspace\u003e\u003c/mspace\u003e\u003cmspace width=\"1em\"/\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmrow\u003e\u003cmi mathvariant=\"normal\"\u003em\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003eo\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003ed\u003c/mi\u003e\u003c/mrow\u003e\u003cmspace width=\"0.3333em\"/\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ee \\times d \\equiv 1 \\pmod{\\phi(n)}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6667em;vertical-align:-0.0833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ee\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e×\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ed\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e≡\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003cspan class=\"mspace allowbreak inline\"\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:1em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathrm inline\"\u003emod\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.3333em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003eϕ\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e用我们的例子：\u003cbr class=\"block\"\u003e\n\u003cspan class=\"katex-display inline\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmn\u003e17\u003c/mn\u003e\u003cmo\u003e×\u003c/mo\u003e\u003cmi\u003ed\u003c/mi\u003e\u003cmo\u003e≡\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmspace\u003e\u003c/mspace\u003e\u003cmspace width=\"1em\"/\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmrow\u003e\u003cmi mathvariant=\"normal\"\u003em\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003eo\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003ed\u003c/mi\u003e\u003c/mrow\u003e\u003cmspace width=\"0.3333em\"/\u003e\u003cmn\u003e3120\u003c/mn\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e17 \\times d \\equiv 1 \\pmod{3120}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.7278em;vertical-align:-0.0833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e17\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e×\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ed\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e≡\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003cspan class=\"mspace allowbreak inline\"\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:1em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathrm inline\"\u003emod\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.3333em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e3120\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e通过扩展欧几里得算法，可以计算出 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ed\u003c/mi\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e2753\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ed = 2753\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ed\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e2753\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e。\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e验证\u003c/strong\u003e：\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmn\u003e17\u003c/mn\u003e\u003cmo\u003e×\u003c/mo\u003e\u003cmn\u003e2753\u003c/mn\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e46801\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e17 \\times 2753 = 46801\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.7278em;vertical-align:-0.0833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e17\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e×\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e2753\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e46801\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e，\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmn\u003e46801\u003c/mn\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e15\u003c/mn\u003e\u003cmo\u003e×\u003c/mo\u003e\u003cmn\u003e3120\u003c/mn\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e46800\u003c/mn\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e46801 = 15 \\times 3120 + 1 = 46800 + 1\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e46801\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.7278em;vertical-align:-0.0833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e15\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e×\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.7278em;vertical-align:-0.0833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e3120\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e+\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.7278em;vertical-align:-0.0833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e46800\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e+\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e，所以 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmn\u003e17\u003c/mn\u003e\u003cmo\u003e×\u003c/mo\u003e\u003cmn\u003e2753\u003c/mn\u003e\u003cmo\u003e≡\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmspace\u003e\u003c/mspace\u003e\u003cmspace width=\"0.4444em\"/\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmrow\u003e\u003cmi mathvariant=\"normal\"\u003em\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003eo\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003ed\u003c/mi\u003e\u003c/mrow\u003e\u003cmspace width=\"0.3333em\"/\u003e\u003cmn\u003e3120\u003c/mn\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e17 \\times 2753 \\equiv 1 \\pmod{3120}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.7278em;vertical-align:-0.0833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e17\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e×\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e2753\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e≡\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003cspan class=\"mspace allowbreak inline\"\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.4444em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathrm inline\"\u003emod\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.3333em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e3120\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e ✓\u003c/p\u003e\n\u003ch3 id=\"扩展欧几里得算法详解\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#扩展欧几里得算法详解\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 扩展欧几里得算法详解\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            扩展欧几里得算法详解\n        \u003c/h3\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e扩展欧几里得算法是求解线性丢番图方程 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ea\u003c/mi\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmi\u003eb\u003c/mi\u003e\u003cmi\u003ey\u003c/mi\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmi\u003egcd\u003c/mi\u003e\u003cmo\u003e⁡\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003ea\u003c/mi\u003e\u003cmo separator=\"true\"\u003e,\u003c/mo\u003e\u003cmi\u003eb\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eax + by = \\gcd(a,b)\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6667em;vertical-align:-0.0833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ea\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ex\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e+\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.8889em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003eb\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\" style=\"margin-right:0.03588em;\"\u003ey\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mop inline\"\u003e\u003cspan style=\"margin-right:0.01389em;\" class=\"inline\"\u003eg\u003c/span\u003ecd\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ea\u003c/span\u003e\u003cspan class=\"mpunct inline\"\u003e,\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.1667em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003eb\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e 的经典算法。在RSA中，我们需要求解：\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cspan class=\"katex-display inline\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ee\u003c/mi\u003e\u003cmo\u003e⋅\u003c/mo\u003e\u003cmi\u003ed\u003c/mi\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo\u003e⋅\u003c/mo\u003e\u003cmi\u003ek\u003c/mi\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ee \\cdot d + \\phi(n) \\cdot k = 1\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4445em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ee\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e⋅\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.7778em;vertical-align:-0.0833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ed\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e+\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003eϕ\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e⋅\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\" style=\"margin-right:0.03148em;\"\u003ek\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e即找到 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ed\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ed\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ed\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e 和 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ek\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ek\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\" style=\"margin-right:0.03148em;\"\u003ek\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e，使得 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ee\u003c/mi\u003e\u003cmo\u003e⋅\u003c/mo\u003e\u003cmi\u003ed\u003c/mi\u003e\u003cmo\u003e≡\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmspace\u003e\u003c/mspace\u003e\u003cmspace width=\"0.4444em\"/\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmrow\u003e\u003cmi mathvariant=\"normal\"\u003em\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003eo\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003ed\u003c/mi\u003e\u003c/mrow\u003e\u003cmspace width=\"0.3333em\"/\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ee \\cdot d \\equiv 1 \\pmod{\\phi(n)}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4445em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ee\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e⋅\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ed\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e≡\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003cspan class=\"mspace allowbreak inline\"\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.4444em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathrm inline\"\u003emod\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.3333em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003eϕ\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e。\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e算法步骤\u003c/strong\u003e：\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e以我们的例子为例，求解 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmn\u003e17\u003c/mn\u003e\u003cmo\u003e⋅\u003c/mo\u003e\u003cmi\u003ed\u003c/mi\u003e\u003cmo\u003e≡\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmspace\u003e\u003c/mspace\u003e\u003cmspace width=\"0.4444em\"/\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmrow\u003e\u003cmi mathvariant=\"normal\"\u003em\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003eo\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003ed\u003c/mi\u003e\u003c/mrow\u003e\u003cmspace width=\"0.3333em\"/\u003e\u003cmn\u003e3120\u003c/mn\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e17 \\cdot d \\equiv 1 \\pmod{3120}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e17\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e⋅\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ed\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e≡\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003cspan class=\"mspace allowbreak inline\"\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.4444em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathrm inline\"\u003emod\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.3333em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e3120\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e：\u003c/p\u003e\n\u003col class=\"list-decimal list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e初始化\u003c/strong\u003e：\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003er\u003c/mi\u003e\u003cmn\u003e0\u003c/mn\u003e\u003c/msub\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e3120\u003c/mn\u003e\u003cmo separator=\"true\"\u003e,\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003er\u003c/mi\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/msub\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e17\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003er_0 = 3120, r_1 = 17\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.5806em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathnormal inline\" style=\"margin-right:0.02778em;\"\u003er\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t vlist-t2 inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mtight inline\"\u003e0\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s inline\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.15em;\"\u003e\u003cspan class=\"inline\"\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.8389em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e3120\u003c/span\u003e\u003cspan class=\"mpunct inline\"\u003e,\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.1667em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathnormal inline\" style=\"margin-right:0.02778em;\"\u003er\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t vlist-t2 inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mtight inline\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s inline\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.15em;\"\u003e\u003cspan class=\"inline\"\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e17\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003es\u003c/mi\u003e\u003cmn\u003e0\u003c/mn\u003e\u003c/msub\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmo separator=\"true\"\u003e,\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003es\u003c/mi\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/msub\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e0\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003es_0 = 1, s_1 = 0\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.5806em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathnormal inline\"\u003es\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t vlist-t2 inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mtight inline\"\u003e0\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s inline\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.15em;\"\u003e\u003cspan class=\"inline\"\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.8389em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003cspan class=\"mpunct inline\"\u003e,\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.1667em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathnormal inline\"\u003es\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t vlist-t2 inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mtight inline\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s inline\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.15em;\"\u003e\u003cspan class=\"inline\"\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e0\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003et\u003c/mi\u003e\u003cmn\u003e0\u003c/mn\u003e\u003c/msub\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e0\u003c/mn\u003e\u003cmo separator=\"true\"\u003e,\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003et\u003c/mi\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/msub\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003et_0 = 0, t_1 = 1\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.7651em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathnormal inline\"\u003et\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t vlist-t2 inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mtight inline\"\u003e0\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s inline\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.15em;\"\u003e\u003cspan class=\"inline\"\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.8389em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e0\u003c/span\u003e\u003cspan class=\"mpunct inline\"\u003e,\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.1667em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathnormal inline\"\u003et\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t vlist-t2 inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mtight inline\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s inline\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.15em;\"\u003e\u003cspan class=\"inline\"\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/li\u003e\n\u003c/ul\u003e\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e迭代过程\u003c/strong\u003e：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"\" data-code=\"%E7%AC%AC1%E6%AD%A5%EF%BC%9Aq%E2%82%81%20%3D%20%E2%8C%8A3120%2F17%E2%8C%8B%20%3D%20183%0Ar%E2%82%82%20%3D%203120%20-%20183%C3%9717%20%3D%203120%20-%203111%20%3D%209%0As%E2%82%82%20%3D%201%20-%20183%C3%970%20%3D%201%0At%E2%82%82%20%3D%200%20-%20183%C3%971%20%3D%20-183%0A%E7%AC%AC2%E6%AD%A5%EF%BC%9Aq%E2%82%82%20%3D%20%E2%8C%8A17%2F9%E2%8C%8B%20%3D%201%0Ar%E2%82%83%20%3D%2017%20-%201%C3%979%20%3D%208%0As%E2%82%83%20%3D%200%20-%201%C3%971%20%3D%20-1%0At%E2%82%83%20%3D%201%20-%201%C3%97(-183)%20%3D%20184%0A%E7%AC%AC3%E6%AD%A5%EF%BC%9Aq%E2%82%83%20%3D%20%E2%8C%8A9%2F8%E2%8C%8B%20%3D%201%0Ar%E2%82%84%20%3D%209%20-%201%C3%978%20%3D%201%0As%E2%82%84%20%3D%201%20-%201%C3%97(-1)%20%3D%202%0At%E2%82%84%20%3D%20-183%20-%201%C3%97184%20%3D%20-367%0A%E7%AC%AC4%E6%AD%A5%EF%BC%9Ar%E2%82%84%20%3D%201%EF%BC%8C%E7%AE%97%E6%B3%95%E7%BB%93%E6%9D%9F\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ecode\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode\u003e第\u003cspan class=\"hljs-number inline\"\u003e1\u003c/span\u003e步：q₁ \u003cspan class=\"hljs-operator inline\"\u003e=\u003c/span\u003e ⌊\u003cspan class=\"hljs-number inline\"\u003e3120\u003c/span\u003e/\u003cspan class=\"hljs-number inline\"\u003e17\u003c/span\u003e⌋ \u003cspan class=\"hljs-operator inline\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-number inline\"\u003e183\u003c/span\u003e\nr₂ \u003cspan class=\"hljs-operator inline\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-number inline\"\u003e3120\u003c/span\u003e - \u003cspan class=\"hljs-number inline\"\u003e183\u003c/span\u003e×\u003cspan class=\"hljs-number inline\"\u003e17\u003c/span\u003e \u003cspan class=\"hljs-operator inline\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-number inline\"\u003e3120\u003c/span\u003e - \u003cspan class=\"hljs-number inline\"\u003e3111\u003c/span\u003e \u003cspan class=\"hljs-operator inline\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-number inline\"\u003e9\u003c/span\u003e\ns₂ \u003cspan class=\"hljs-operator inline\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-number inline\"\u003e1\u003c/span\u003e - \u003cspan class=\"hljs-number inline\"\u003e183\u003c/span\u003e×\u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e \u003cspan class=\"hljs-operator inline\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-number inline\"\u003e1\u003c/span\u003e\nt₂ \u003cspan class=\"hljs-operator inline\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e - \u003cspan class=\"hljs-number inline\"\u003e183\u003c/span\u003e×\u003cspan class=\"hljs-number inline\"\u003e1\u003c/span\u003e \u003cspan class=\"hljs-operator inline\"\u003e=\u003c/span\u003e -\u003cspan class=\"hljs-number inline\"\u003e183\u003c/span\u003e\n\n第\u003cspan class=\"hljs-number inline\"\u003e2\u003c/span\u003e步：q₂ \u003cspan class=\"hljs-operator inline\"\u003e=\u003c/span\u003e ⌊\u003cspan class=\"hljs-number inline\"\u003e17\u003c/span\u003e/\u003cspan class=\"hljs-number inline\"\u003e9\u003c/span\u003e⌋ \u003cspan class=\"hljs-operator inline\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-number inline\"\u003e1\u003c/span\u003e\nr₃ \u003cspan class=\"hljs-operator inline\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-number inline\"\u003e17\u003c/span\u003e - \u003cspan class=\"hljs-number inline\"\u003e1\u003c/span\u003e×\u003cspan class=\"hljs-number inline\"\u003e9\u003c/span\u003e \u003cspan class=\"hljs-operator inline\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-number inline\"\u003e8\u003c/span\u003e\ns₃ \u003cspan class=\"hljs-operator inline\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e - \u003cspan class=\"hljs-number inline\"\u003e1\u003c/span\u003e×\u003cspan class=\"hljs-number inline\"\u003e1\u003c/span\u003e \u003cspan class=\"hljs-operator inline\"\u003e=\u003c/span\u003e -\u003cspan class=\"hljs-number inline\"\u003e1\u003c/span\u003e\nt₃ \u003cspan class=\"hljs-operator inline\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-number inline\"\u003e1\u003c/span\u003e - \u003cspan class=\"hljs-number inline\"\u003e1\u003c/span\u003e×(-\u003cspan class=\"hljs-number inline\"\u003e183\u003c/span\u003e) \u003cspan class=\"hljs-operator inline\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-number inline\"\u003e184\u003c/span\u003e\n\n第\u003cspan class=\"hljs-number inline\"\u003e3\u003c/span\u003e步：q₃ \u003cspan class=\"hljs-operator inline\"\u003e=\u003c/span\u003e ⌊\u003cspan class=\"hljs-number inline\"\u003e9\u003c/span\u003e/\u003cspan class=\"hljs-number inline\"\u003e8\u003c/span\u003e⌋ \u003cspan class=\"hljs-operator inline\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-number inline\"\u003e1\u003c/span\u003e\nr₄ \u003cspan class=\"hljs-operator inline\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-number inline\"\u003e9\u003c/span\u003e - \u003cspan class=\"hljs-number inline\"\u003e1\u003c/span\u003e×\u003cspan class=\"hljs-number inline\"\u003e8\u003c/span\u003e \u003cspan class=\"hljs-operator inline\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-number inline\"\u003e1\u003c/span\u003e\ns₄ \u003cspan class=\"hljs-operator inline\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-number inline\"\u003e1\u003c/span\u003e - \u003cspan class=\"hljs-number inline\"\u003e1\u003c/span\u003e×(-\u003cspan class=\"hljs-number inline\"\u003e1\u003c/span\u003e) \u003cspan class=\"hljs-operator inline\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-number inline\"\u003e2\u003c/span\u003e\nt₄ \u003cspan class=\"hljs-operator inline\"\u003e=\u003c/span\u003e -\u003cspan class=\"hljs-number inline\"\u003e183\u003c/span\u003e - \u003cspan class=\"hljs-number inline\"\u003e1\u003c/span\u003e×\u003cspan class=\"hljs-number inline\"\u003e184\u003c/span\u003e \u003cspan class=\"hljs-operator inline\"\u003e=\u003c/span\u003e -\u003cspan class=\"hljs-number inline\"\u003e367\u003c/span\u003e\n\n第\u003cspan class=\"hljs-number inline\"\u003e4\u003c/span\u003e步：r₄ \u003cspan class=\"hljs-operator inline\"\u003e=\u003c/span\u003e \u003cspan class=\"hljs-number inline\"\u003e1\u003c/span\u003e，算法结束\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e最终结果\u003c/strong\u003e：\u003cbr class=\"block\"\u003e\n当 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003er\u003c/mi\u003e\u003cmn\u003e4\u003c/mn\u003e\u003c/msub\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003er_4 = 1\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.5806em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathnormal inline\" style=\"margin-right:0.02778em;\"\u003er\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t vlist-t2 inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mtight inline\"\u003e4\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s inline\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.15em;\"\u003e\u003cspan class=\"inline\"\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e 时，对应的 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003et\u003c/mi\u003e\u003cmn\u003e4\u003c/mn\u003e\u003c/msub\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmn\u003e367\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003et_4 = -367\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.7651em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathnormal inline\"\u003et\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t vlist-t2 inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mtight inline\"\u003e4\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s inline\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.15em;\"\u003e\u003cspan class=\"inline\"\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.7278em;vertical-align:-0.0833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e−\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e367\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e。\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e由于我们需要正数，所以 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ed\u003c/mi\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmn\u003e367\u003c/mn\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmn\u003e3120\u003c/mn\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e2753\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ed = -367 + 3120 = 2753\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ed\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.7278em;vertical-align:-0.0833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e−\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e367\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e+\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e3120\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e2753\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e。\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e验证\u003c/strong\u003e：\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmn\u003e17\u003c/mn\u003e\u003cmo\u003e×\u003c/mo\u003e\u003cmn\u003e2753\u003c/mn\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e46801\u003c/mn\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e15\u003c/mn\u003e\u003cmo\u003e×\u003c/mo\u003e\u003cmn\u003e3120\u003c/mn\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e17 \\times 2753 = 46801 = 15 \\times 3120 + 1\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.7278em;vertical-align:-0.0833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e17\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e×\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e2753\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e46801\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.7278em;vertical-align:-0.0833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e15\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e×\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.7278em;vertical-align:-0.0833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e3120\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e+\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e，确实 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmn\u003e17\u003c/mn\u003e\u003cmo\u003e×\u003c/mo\u003e\u003cmn\u003e2753\u003c/mn\u003e\u003cmo\u003e≡\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmspace\u003e\u003c/mspace\u003e\u003cmspace width=\"0.4444em\"/\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmrow\u003e\u003cmi mathvariant=\"normal\"\u003em\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003eo\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003ed\u003c/mi\u003e\u003c/mrow\u003e\u003cmspace width=\"0.3333em\"/\u003e\u003cmn\u003e3120\u003c/mn\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e17 \\times 2753 \\equiv 1 \\pmod{3120}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.7278em;vertical-align:-0.0833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e17\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e×\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e2753\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e≡\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003cspan class=\"mspace allowbreak inline\"\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.4444em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathrm inline\"\u003emod\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.3333em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e3120\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e ✓\u003c/p\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e算法的数学原理\u003c/strong\u003e：\u003cbr class=\"block\"\u003e\n扩展欧几里得算法基于这样的事实：如果 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003egcd\u003c/mi\u003e\u003cmo\u003e⁡\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003ee\u003c/mi\u003e\u003cmo separator=\"true\"\u003e,\u003c/mo\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\gcd(e, \\phi(n)) = 1\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mop inline\"\u003e\u003cspan style=\"margin-right:0.01389em;\" class=\"inline\"\u003eg\u003c/span\u003ecd\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ee\u003c/span\u003e\u003cspan class=\"mpunct inline\"\u003e,\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.1667em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003eϕ\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e))\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e，那么一定存在整数 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ed\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ed\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ed\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e 和 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ek\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ek\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\" style=\"margin-right:0.03148em;\"\u003ek\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e，使得：\u003cbr class=\"block\"\u003e\n\u003cspan class=\"katex-display inline\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ee\u003c/mi\u003e\u003cmo\u003e⋅\u003c/mo\u003e\u003cmi\u003ed\u003c/mi\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo\u003e⋅\u003c/mo\u003e\u003cmi\u003ek\u003c/mi\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ee \\cdot d + \\phi(n) \\cdot k = 1\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4445em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ee\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e⋅\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.7778em;vertical-align:-0.0833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ed\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e+\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003eϕ\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e⋅\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\" style=\"margin-right:0.03148em;\"\u003ek\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e这等价于：\u003cbr class=\"block\"\u003e\n\u003cspan class=\"katex-display inline\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ee\u003c/mi\u003e\u003cmo\u003e⋅\u003c/mo\u003e\u003cmi\u003ed\u003c/mi\u003e\u003cmo\u003e≡\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmspace\u003e\u003c/mspace\u003e\u003cmspace width=\"1em\"/\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmrow\u003e\u003cmi mathvariant=\"normal\"\u003em\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003eo\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003ed\u003c/mi\u003e\u003c/mrow\u003e\u003cmspace width=\"0.3333em\"/\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ee \\cdot d \\equiv 1 \\pmod{\\phi(n)}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4445em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ee\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e⋅\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ed\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e≡\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003cspan class=\"mspace allowbreak inline\"\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:1em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathrm inline\"\u003emod\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.3333em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003eϕ\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e即 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ed\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ed\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ed\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e 是 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ee\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ee\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ee\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e 在模 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\phi(n)\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003eϕ\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e 意义下的\u003cstrong class=\"font-bold text-foreground\"\u003e模逆元\u003c/strong\u003e。\u003c/p\u003e\n\u003ch3 id=\"加密解密的数学原理\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#加密解密的数学原理\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 加密解密的数学原理\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            加密解密的数学原理\n        \u003c/h3\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e符号说明\u003c/strong\u003e：\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e让我们首先明确每个数学符号的含义：\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003em\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003em\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003em\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/strong\u003e (message)：\u003cstrong class=\"font-bold text-foreground\"\u003e明文消息\u003c/strong\u003e，需要加密的原始数据，必须满足 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmn\u003e0\u003c/mn\u003e\u003cmo\u003e≤\u003c/mo\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmo\u003e\u0026lt;\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e0 \\leq m \u0026lt; n\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.7804em;vertical-align:-0.136em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e0\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e≤\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.5782em;vertical-align:-0.0391em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003em\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ec\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ec\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ec\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/strong\u003e (ciphertext)：\u003cstrong class=\"font-bold text-foreground\"\u003e密文\u003c/strong\u003e，加密后的数据\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ee\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ee\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ee\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/strong\u003e (encryption exponent)：\u003cstrong class=\"font-bold text-foreground\"\u003e公钥指数\u003c/strong\u003e，在我们的例子中是17，在实际应用中通常是65537\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ed\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ed\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ed\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/strong\u003e (decryption exponent)：\u003cstrong class=\"font-bold text-foreground\"\u003e私钥指数\u003c/strong\u003e，是e在模φ(n)下的模逆元，在我们的例子中是2753\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003en\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/strong\u003e：\u003cstrong class=\"font-bold text-foreground\"\u003e模数\u003c/strong\u003e，等于两个大质数的乘积，即 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmi\u003ep\u003c/mi\u003e\u003cmo\u003e×\u003c/mo\u003e\u003cmi\u003eq\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003en = p \\times q\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.7778em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ep\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e×\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.625em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\" style=\"margin-right:0.03588em;\"\u003eq\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\phi(n)\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003eϕ\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/strong\u003e：\u003cstrong class=\"font-bold text-foreground\"\u003e欧拉函数值\u003c/strong\u003e，等于 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003ep\u003c/mi\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003eq\u003c/mi\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e(p-1)(q-1)\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ep\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e−\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\" style=\"margin-right:0.03588em;\"\u003eq\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e−\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e，表示小于n且与n互质的正整数个数\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ek\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ek\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\" style=\"margin-right:0.03148em;\"\u003ek\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/strong\u003e：\u003cstrong class=\"font-bold text-foreground\"\u003e任意整数\u003c/strong\u003e，在数学证明中出现的辅助变量\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e加密过程\u003c/strong\u003e：\u003cbr class=\"block\"\u003e\n\u003cspan class=\"katex-display inline\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ec\u003c/mi\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmsup\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmi\u003ee\u003c/mi\u003e\u003c/msup\u003e\u003cmtext\u003e \u003c/mtext\u003e\u003cmo lspace=\"0.22em\" rspace=\"0.22em\"\u003e\u003cmrow\u003e\u003cmi mathvariant=\"normal\"\u003em\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003eo\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003ed\u003c/mi\u003e\u003c/mrow\u003e\u003c/mo\u003e\u003cmtext\u003e \u003c/mtext\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ec = m^e \\bmod n\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ec\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.7144em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathnormal inline\"\u003em\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.7144em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mathnormal mtight inline\"\u003ee\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.0556em;\"\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathrm inline\"\u003emod\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.0556em;\"\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e解密过程\u003c/strong\u003e：\u003cbr class=\"block\"\u003e\n\u003cspan class=\"katex-display inline\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmsup\u003e\u003cmi\u003ec\u003c/mi\u003e\u003cmi\u003ed\u003c/mi\u003e\u003c/msup\u003e\u003cmtext\u003e \u003c/mtext\u003e\u003cmo lspace=\"0.22em\" rspace=\"0.22em\"\u003e\u003cmrow\u003e\u003cmi mathvariant=\"normal\"\u003em\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003eo\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003ed\u003c/mi\u003e\u003c/mrow\u003e\u003c/mo\u003e\u003cmtext\u003e \u003c/mtext\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003em = c^d \\bmod n\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003em\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.8991em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathnormal inline\"\u003ec\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.8991em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mathnormal mtight inline\"\u003ed\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.0556em;\"\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathrm inline\"\u003emod\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.0556em;\"\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003eRSA正确性的数学证明\u003c/strong\u003e：\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e第一步：应用欧拉定理\u003c/strong\u003e\u003cbr class=\"block\"\u003e\n根据欧拉定理，对于互质的 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003em\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003em\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003em\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e 和 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003en\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e（即 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003egcd\u003c/mi\u003e\u003cmo\u003e⁡\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmo separator=\"true\"\u003e,\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\gcd(m,n) = 1\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mop inline\"\u003e\u003cspan style=\"margin-right:0.01389em;\" class=\"inline\"\u003eg\u003c/span\u003ecd\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003em\u003c/span\u003e\u003cspan class=\"mpunct inline\"\u003e,\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.1667em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e）：\u003cbr class=\"block\"\u003e\n\u003cspan class=\"katex-display inline\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsup\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003c/msup\u003e\u003cmo\u003e≡\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmspace\u003e\u003c/mspace\u003e\u003cmspace width=\"1em\"/\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmrow\u003e\u003cmi mathvariant=\"normal\"\u003em\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003eo\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003ed\u003c/mi\u003e\u003c/mrow\u003e\u003cmspace width=\"0.3333em\"/\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003em^{\\phi(n)} \\equiv 1 \\pmod{n}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.938em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathnormal inline\"\u003em\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.938em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mtight inline\"\u003e\u003cspan class=\"mord mathnormal mtight inline\"\u003eϕ\u003c/span\u003e\u003cspan class=\"mopen mtight inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight inline\"\u003en\u003c/span\u003e\u003cspan class=\"mclose mtight inline\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e≡\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003cspan class=\"mspace allowbreak inline\"\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:1em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathrm inline\"\u003emod\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.3333em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e第二步：利用私钥的定义\u003c/strong\u003e\u003cbr class=\"block\"\u003e\n由于 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ed\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ed\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ed\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e 是 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ee\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ee\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ee\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e 的模逆元，我们有：\u003cbr class=\"block\"\u003e\n\u003cspan class=\"katex-display inline\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ee\u003c/mi\u003e\u003cmo\u003e⋅\u003c/mo\u003e\u003cmi\u003ed\u003c/mi\u003e\u003cmo\u003e≡\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmspace\u003e\u003c/mspace\u003e\u003cmspace width=\"1em\"/\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmrow\u003e\u003cmi mathvariant=\"normal\"\u003em\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003eo\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003ed\u003c/mi\u003e\u003c/mrow\u003e\u003cmspace width=\"0.3333em\"/\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ee \\cdot d \\equiv 1 \\pmod{\\phi(n)}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4445em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ee\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e⋅\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ed\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e≡\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003cspan class=\"mspace allowbreak inline\"\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:1em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathrm inline\"\u003emod\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.3333em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003eϕ\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e这意味着存在某个整数 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ek\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ek\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\" style=\"margin-right:0.03148em;\"\u003ek\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e，使得：\u003cbr class=\"block\"\u003e\n\u003cspan class=\"katex-display inline\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ee\u003c/mi\u003e\u003cmo\u003e⋅\u003c/mo\u003e\u003cmi\u003ed\u003c/mi\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmi\u003ek\u003c/mi\u003e\u003cmo\u003e⋅\u003c/mo\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ee \\cdot d = 1 + k \\cdot \\phi(n)\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4445em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ee\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e⋅\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ed\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.7278em;vertical-align:-0.0833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e+\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\" style=\"margin-right:0.03148em;\"\u003ek\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e⋅\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003eϕ\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e第三步：验证解密过程\u003c/strong\u003e\u003cbr class=\"block\"\u003e\n现在我们证明解密确实能恢复原始消息：\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cspan class=\"katex-display inline\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsup\u003e\u003cmi\u003ec\u003c/mi\u003e\u003cmi\u003ed\u003c/mi\u003e\u003c/msup\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmsup\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmi\u003ee\u003c/mi\u003e\u003c/msup\u003e\u003cmsup\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmi\u003ed\u003c/mi\u003e\u003c/msup\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmsup\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003ee\u003c/mi\u003e\u003cmi\u003ed\u003c/mi\u003e\u003c/mrow\u003e\u003c/msup\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmsup\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmrow\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmi\u003ek\u003c/mi\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003c/msup\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmsup\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/msup\u003e\u003cmo\u003e⋅\u003c/mo\u003e\u003cmsup\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003ek\u003c/mi\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003c/msup\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmo\u003e⋅\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmsup\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003c/msup\u003e\u003cmsup\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmi\u003ek\u003c/mi\u003e\u003c/msup\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ec^d = (m^e)^d = m^{ed} = m^{1 + k\\phi(n)} = m^1 \\cdot m^{k\\phi(n)} = m \\cdot (m^{\\phi(n)})^k\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.8991em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathnormal inline\"\u003ec\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.8991em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mathnormal mtight inline\"\u003ed\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1.1491em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathnormal inline\"\u003em\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.7144em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mathnormal mtight inline\"\u003ee\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.8991em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mathnormal mtight inline\"\u003ed\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.8991em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathnormal inline\"\u003em\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.8991em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mtight inline\"\u003e\u003cspan class=\"mord mathnormal mtight inline\"\u003ee\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight inline\"\u003ed\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.938em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathnormal inline\"\u003em\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.938em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mtight inline\"\u003e\u003cspan class=\"mord mtight inline\"\u003e1\u003c/span\u003e\u003cspan class=\"mbin mtight inline\"\u003e+\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight inline\" style=\"margin-right:0.03148em;\"\u003ek\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight inline\"\u003eϕ\u003c/span\u003e\u003cspan class=\"mopen mtight inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight inline\"\u003en\u003c/span\u003e\u003cspan class=\"mclose mtight inline\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.8641em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathnormal inline\"\u003em\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.8641em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mtight inline\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e⋅\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.938em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathnormal inline\"\u003em\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.938em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mtight inline\"\u003e\u003cspan class=\"mord mathnormal mtight inline\" style=\"margin-right:0.03148em;\"\u003ek\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight inline\"\u003eϕ\u003c/span\u003e\u003cspan class=\"mopen mtight inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight inline\"\u003en\u003c/span\u003e\u003cspan class=\"mclose mtight inline\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4445em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003em\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e⋅\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1.188em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathnormal inline\"\u003em\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.938em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mtight inline\"\u003e\u003cspan class=\"mord mathnormal mtight inline\"\u003eϕ\u003c/span\u003e\u003cspan class=\"mopen mtight inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight inline\"\u003en\u003c/span\u003e\u003cspan class=\"mclose mtight inline\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.8991em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mathnormal mtight inline\" style=\"margin-right:0.03148em;\"\u003ek\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e根据欧拉定理，\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsup\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003c/msup\u003e\u003cmo\u003e≡\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmspace\u003e\u003c/mspace\u003e\u003cmspace width=\"0.4444em\"/\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmrow\u003e\u003cmi mathvariant=\"normal\"\u003em\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003eo\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003ed\u003c/mi\u003e\u003c/mrow\u003e\u003cmspace width=\"0.3333em\"/\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003em^{\\phi(n)} \\equiv 1 \\pmod{n}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.888em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathnormal inline\"\u003em\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.888em;\"\u003e\u003cspan style=\"top:-3.063em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mtight inline\"\u003e\u003cspan class=\"mord mathnormal mtight inline\"\u003eϕ\u003c/span\u003e\u003cspan class=\"mopen mtight inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight inline\"\u003en\u003c/span\u003e\u003cspan class=\"mclose mtight inline\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e≡\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003cspan class=\"mspace allowbreak inline\"\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.4444em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathrm inline\"\u003emod\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.3333em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e，因此：\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cspan class=\"katex-display inline\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmo\u003e⋅\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmsup\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003eϕ\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003c/msup\u003e\u003cmsup\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmi\u003ek\u003c/mi\u003e\u003c/msup\u003e\u003cmo\u003e≡\u003c/mo\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmo\u003e⋅\u003c/mo\u003e\u003cmsup\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmi\u003ek\u003c/mi\u003e\u003c/msup\u003e\u003cmo\u003e≡\u003c/mo\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmspace\u003e\u003c/mspace\u003e\u003cmspace width=\"1em\"/\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmrow\u003e\u003cmi mathvariant=\"normal\"\u003em\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003eo\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003ed\u003c/mi\u003e\u003c/mrow\u003e\u003cmspace width=\"0.3333em\"/\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003em \\cdot (m^{\\phi(n)})^k \\equiv m \\cdot 1^k \\equiv m \\pmod{n}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4445em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003em\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e⋅\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1.188em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathnormal inline\"\u003em\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.938em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mtight inline\"\u003e\u003cspan class=\"mord mathnormal mtight inline\"\u003eϕ\u003c/span\u003e\u003cspan class=\"mopen mtight inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal mtight inline\"\u003en\u003c/span\u003e\u003cspan class=\"mclose mtight inline\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.8991em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mathnormal mtight inline\" style=\"margin-right:0.03148em;\"\u003ek\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e≡\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4445em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003em\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e⋅\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.8991em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord inline\"\u003e1\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.8991em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mathnormal mtight inline\" style=\"margin-right:0.03148em;\"\u003ek\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e≡\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003em\u003c/span\u003e\u003cspan class=\"mspace allowbreak inline\"\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:1em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathrm inline\"\u003emod\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.3333em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e结论\u003c/strong\u003e：\u003cbr class=\"block\"\u003e\n\u003cspan class=\"katex-display inline\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsup\u003e\u003cmi\u003ec\u003c/mi\u003e\u003cmi\u003ed\u003c/mi\u003e\u003c/msup\u003e\u003cmo\u003e≡\u003c/mo\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmspace\u003e\u003c/mspace\u003e\u003cmspace width=\"1em\"/\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmrow\u003e\u003cmi mathvariant=\"normal\"\u003em\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003eo\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003ed\u003c/mi\u003e\u003c/mrow\u003e\u003cmspace width=\"0.3333em\"/\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ec^d \\equiv m \\pmod{n}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.8991em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathnormal inline\"\u003ec\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.8991em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mathnormal mtight inline\"\u003ed\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e≡\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003em\u003c/span\u003e\u003cspan class=\"mspace allowbreak inline\"\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:1em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathrm inline\"\u003emod\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.3333em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003en\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e具体数值验证\u003c/strong\u003e：\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e设明文 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e123\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003em = 123\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003em\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e123\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e加密：\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ec\u003c/mi\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmsup\u003e\u003cmn\u003e123\u003c/mn\u003e\u003cmn\u003e17\u003c/mn\u003e\u003c/msup\u003e\u003cmtext\u003e \u003c/mtext\u003e\u003cmo lspace=\"0.22em\" rspace=\"0.22em\"\u003e\u003cmrow\u003e\u003cmi mathvariant=\"normal\"\u003em\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003eo\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003ed\u003c/mi\u003e\u003c/mrow\u003e\u003c/mo\u003e\u003cmtext\u003e \u003c/mtext\u003e\u003cmn\u003e3233\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ec = 123^{17} \\bmod 3233\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ec\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.8141em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e12\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord inline\"\u003e3\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.8141em;\"\u003e\u003cspan style=\"top:-3.063em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mtight inline\"\u003e\u003cspan class=\"mord mtight inline\"\u003e17\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.0556em;\"\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathrm inline\"\u003emod\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.0556em;\"\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e3233\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e解密：\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsup\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\"\u003e′\u003c/mo\u003e\u003c/msup\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmsup\u003e\u003cmi\u003ec\u003c/mi\u003e\u003cmn\u003e2753\u003c/mn\u003e\u003c/msup\u003e\u003cmtext\u003e \u003c/mtext\u003e\u003cmo lspace=\"0.22em\" rspace=\"0.22em\"\u003e\u003cmrow\u003e\u003cmi mathvariant=\"normal\"\u003em\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003eo\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003ed\u003c/mi\u003e\u003c/mrow\u003e\u003c/mo\u003e\u003cmtext\u003e \u003c/mtext\u003e\u003cmn\u003e3233\u003c/mn\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e123\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003em\u0026#x27; = c^{2753} \\bmod 3233 = 123\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.7519em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathnormal inline\"\u003em\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.7519em;\"\u003e\u003cspan style=\"top:-3.063em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mtight inline\"\u003e\u003cspan class=\"mord mtight inline\"\u003e′\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.8141em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathnormal inline\"\u003ec\u003c/span\u003e\u003cspan class=\"msupsub inline\"\u003e\u003cspan class=\"vlist-t inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.8141em;\"\u003e\u003cspan style=\"top:-3.063em;margin-right:0.05em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight inline\"\u003e\u003cspan class=\"mord mtight inline\"\u003e\u003cspan class=\"mord mtight inline\"\u003e2753\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.0556em;\"\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord mathrm inline\"\u003emod\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.0556em;\"\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e3233\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e123\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e重要说明\u003c/strong\u003e：本例子使用小质数仅为演示目的。在实际应用中，RSA使用1024位或2048位的大质数，此时通常选择 \u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ee\u003c/mi\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e65537\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ee = 65537\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003ee\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e65537\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e，因为它在保证安全性的同时具有良好的计算性能。\u003c/p\u003e\n\u003ch2 id=\"rsa在web安全中的角色定位\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#rsa在web安全中的角色定位\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to RSA在Web安全中的角色定位\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            RSA在Web安全中的角色定位\n        \u003c/h2\u003e\n\u003ch3 id=\"对称加密-vs-非对称加密的选择策略\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#对称加密-vs-非对称加密的选择策略\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 对称加密 vs 非对称加密的选择策略\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            对称加密 vs 非对称加密的选择策略\n        \u003c/h3\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e在现代Web应用中，RSA通常不用于大量数据的加密，而是扮演着\u0026quot;密钥保护者\u0026quot;的角色：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"\" data-code=\"%E4%BC%A0%E7%BB%9F%E7%9A%84%E5%9B%B0%E5%A2%83%EF%BC%9A%0A%E7%94%A8%E6%88%B7%20--%5B%E6%98%8E%E6%96%87API%E5%AF%86%E9%92%A5%5D--%3E%20%E6%9C%8D%E5%8A%A1%E5%99%A8%20%20%E2%9D%8C%20%E4%B8%8D%E5%AE%89%E5%85%A8%0A%E7%94%A8%E6%88%B7%20--%5B%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%5D--%3E%20%E6%9C%8D%E5%8A%A1%E5%99%A8%20%20%20%20%E2%9D%8C%20%E5%AF%86%E9%92%A5%E5%88%86%E5%8F%91%E9%97%AE%E9%A2%98%0ARSA%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%9A%0A%E7%94%A8%E6%88%B7%20--%5BRSA%E5%85%AC%E9%92%A5%E5%8A%A0%E5%AF%86%5D--%3E%20%E6%9C%8D%E5%8A%A1%E5%99%A8%20--%5BRSA%E7%A7%81%E9%92%A5%E8%A7%A3%E5%AF%86%5D--%3E%20%E5%AE%89%E5%85%A8%E5%AD%98%E5%82%A8%20%20%E2%9C%85\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ecode\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-comment inline\"\u003e传统的困境：\u003c/span\u003e\n\u003cspan class=\"hljs-comment inline\"\u003e用户\u003c/span\u003e \u003cspan class=\"hljs-literal inline\"\u003e--\u003c/span\u003e\u003cspan class=\"hljs-title inline\"\u003e[\u003c/span\u003e\u003cspan class=\"hljs-comment inline\"\u003e明文API密钥\u003c/span\u003e\u003cspan class=\"hljs-title inline\"\u003e]\u003c/span\u003e\u003cspan class=\"hljs-literal inline\"\u003e--\u003c/span\u003e\u0026gt; \u003cspan class=\"hljs-comment inline\"\u003e服务器  ❌ 不安全\u003c/span\u003e\n\u003cspan class=\"hljs-comment inline\"\u003e用户\u003c/span\u003e \u003cspan class=\"hljs-literal inline\"\u003e--\u003c/span\u003e\u003cspan class=\"hljs-title inline\"\u003e[\u003c/span\u003e\u003cspan class=\"hljs-comment inline\"\u003e对称加密\u003c/span\u003e\u003cspan class=\"hljs-title inline\"\u003e]\u003c/span\u003e\u003cspan class=\"hljs-literal inline\"\u003e--\u003c/span\u003e\u0026gt; \u003cspan class=\"hljs-comment inline\"\u003e服务器    ❌ 密钥分发问题\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment inline\"\u003eRSA的解决方案：\u003c/span\u003e\n\u003cspan class=\"hljs-comment inline\"\u003e用户\u003c/span\u003e \u003cspan class=\"hljs-literal inline\"\u003e--\u003c/span\u003e\u003cspan class=\"hljs-title inline\"\u003e[\u003c/span\u003e\u003cspan class=\"hljs-comment inline\"\u003eRSA公钥加密\u003c/span\u003e\u003cspan class=\"hljs-title inline\"\u003e]\u003c/span\u003e\u003cspan class=\"hljs-literal inline\"\u003e--\u003c/span\u003e\u0026gt; \u003cspan class=\"hljs-comment inline\"\u003e服务器\u003c/span\u003e \u003cspan class=\"hljs-literal inline\"\u003e--\u003c/span\u003e\u003cspan class=\"hljs-title inline\"\u003e[\u003c/span\u003e\u003cspan class=\"hljs-comment inline\"\u003eRSA私钥解密\u003c/span\u003e\u003cspan class=\"hljs-title inline\"\u003e]\u003c/span\u003e\u003cspan class=\"hljs-literal inline\"\u003e--\u003c/span\u003e\u0026gt; \u003cspan class=\"hljs-comment inline\"\u003e安全存储  ✅\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e性能对比\u003c/strong\u003e：\u003c/p\u003e\n\u003ctable class=\"w-full border-collapse mb-4 shadow-sm rounded-lg overflow-hidden\"\u003e\n\u003cthead class=\"bg-surface\"\u003e\n\u003ctr class=\"border-b border-gray-200\"\u003e\u003cth class=\"px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface\"\u003e加密方式\u003c/th\u003e\u003cth class=\"px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface\"\u003e加密速度\u003c/th\u003e\u003cth class=\"px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface\"\u003e解密速度\u003c/th\u003e\u003cth class=\"px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface\"\u003e密钥分发\u003c/th\u003e\u003cth class=\"px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface\"\u003e适用场景\u003c/th\u003e\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody class=\"bg-background divide-y divide-gray-200\"\u003e\n\u003ctr class=\"border-b border-gray-200\"\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003eAES-256\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e极快\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e极快\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e困难\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e大量数据\u003c/td\u003e\u003c/tr\u003e\n\u003ctr class=\"border-b border-gray-200\"\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003eRSA-2048\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e慢\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e极慢\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e简单\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e小量数据/密钥交换\u003c/td\u003e\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch3 id=\"rsa-oaep填充方案的安全性\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#rsa-oaep填充方案的安全性\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to RSA-OAEP填充方案的安全性\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            RSA-OAEP填充方案的安全性\n        \u003c/h3\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e为什么需要填充？\u003c/strong\u003e\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e如果直接使用原始RSA：\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e相同明文总是产生相同密文\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e容易受到选择明文攻击\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e明文长度信息泄露\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003eOAEP填充的工作原理\u003c/strong\u003e：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"\" data-code=\"%E6%98%8E%E6%96%87%20%E2%86%92%20%E6%B7%BB%E5%8A%A0%E9%9A%8F%E6%9C%BA%E6%95%B0%20%E2%86%92%20%E6%8E%A9%E7%A0%81%E7%94%9F%E6%88%90%20%E2%86%92%20%E6%9C%80%E7%BB%88%E5%AF%86%E6%96%87\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ecode\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode\u003e明文 → 添加随机数 → 掩码生成 → 最终密文\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003eOAEP确保：\u003c/p\u003e\n\u003col class=\"list-decimal list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e随机性\u003c/strong\u003e：相同明文每次加密结果不同\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e完整性\u003c/strong\u003e：任何篡改都会导致解密失败\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e语义安全\u003c/strong\u003e：攻击者无法从密文推断明文信息\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"questions-party安全架构设计\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#questions-party安全架构设计\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to Questions Party安全架构设计\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            Questions Party安全架构设计\n        \u003c/h3\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e更新API Key：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"\" data-code=\"%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5API%E5%AF%86%E9%92%A5%20%E2%86%92%20%E5%89%8D%E7%AB%AFRSA%E5%8A%A0%E5%AF%86%20%E2%86%92%20HTTPS%E4%BC%A0%E8%BE%93%20%E2%86%92%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%98%E5%82%A8%EF%BC%88%E5%AD%98%E5%82%A8%E7%9A%84%E6%98%AF%E5%AF%86%E6%96%87%EF%BC%89\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ecode\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode\u003e用户输入API密钥 → 前端RSA加密 → HTTPS传输 → 数据库存储（存储的是密文）\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e使用API Key发送请求：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"\" data-code=\"%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%E8%AF%B7%E6%B1%82%E5%86%85%E5%AE%B9%20%E2%86%92%20HTTPS%E4%BC%A0%E8%BE%93%20%E2%86%92%20%E5%90%8E%E7%AB%AFRSA%E8%A7%A3%E5%AF%86%20%E2%86%92%20%E4%BD%BF%E7%94%A8%E8%A7%A3%E5%AF%86%E5%90%8E%E7%9A%84%E6%98%8E%E6%96%87Key%E8%B0%83%E7%94%A8%E5%A4%A7%E6%A8%A1%E5%9E%8BAPI%20%E2%86%92%20%E8%A7%A3%E6%9E%90%E5%93%8D%E5%BA%94%E5%B9%B6%E8%BF%94%E5%9B%9E\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ecode\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode\u003e用户输入请求内容 → HTTPS传输 → 后端RSA解密 → 使用解密后的明文\u003cspan class=\"hljs-built_in inline\"\u003eKey\u003c/span\u003e调用大模型API → 解析响应并返回\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch2 id=\"questions-party项目中的rsa实现架构\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#questions-party项目中的rsa实现架构\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to Questions Party项目中的RSA实现架构\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            Questions Party项目中的RSA实现架构\n        \u003c/h2\u003e\n\u003ch3 id=\"整体安全架构设计\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#整体安全架构设计\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 整体安全架构设计\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            整体安全架构设计\n        \u003c/h3\u003e\n\u003cdiv class=\"mermaid block\" id=\"mermaid-1767322173316-bvetpq0\"\u003egraph TB\n    subgraph \"前端浏览器\"\n        A[用户输入API密钥] --\u003e B[获取RSA公钥]\n        B --\u003e C[前端RSA加密]\n        C --\u003e D[HTTPS传输]\n    end\n    \n    subgraph \"后端服务器\"\n        D --\u003e E[接收加密数据]\n        E --\u003e G[数据库存储]\n    end\n    \n    subgraph \"密钥管理\"\n        H[环境变量文件] --\u003e I[RSA密钥对]\n        I --\u003e J[公钥分发]\n        I --\u003e K[私钥保护]\n    end\n    \n    J --\u003e B\n    K --\u003e G\u003c/div\u003e\n\u003ch3 id=\"前后端分离架构下的加密策略\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#前后端分离架构下的加密策略\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 前后端分离架构下的加密策略\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            前后端分离架构下的加密策略\n        \u003c/h3\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e前端职责\u003c/strong\u003e：\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e获取公钥\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e加密敏感数据\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e传输加密数据\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e后端职责\u003c/strong\u003e：\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e密钥对管理\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e公钥分发\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e存储加密数据\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e安全边界\u003c/strong\u003e：\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e私钥永远不离开服务器\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e公钥可以自由分发\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e敏感数据只在必要时解密\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"密钥管理和分发机制\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#密钥管理和分发机制\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 密钥管理和分发机制\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            密钥管理和分发机制\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"const%20jsrsasign%20%3D%20require('jsrsasign')%3B%0Aconst%20%7B%20KEYUTIL%20%7D%20%3D%20jsrsasign%3B%0Aconst%20crypto%20%3D%20require('crypto')%3B%0Aclass%20RSACrypto%20%7B%0Aconstructor()%20%7B%0Athis.keySize%20%3D%202048%3B%0Athis.initializeKeys()%3B%0A%7D%0A%2F%2F%20%E4%BB%8E%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%88%9D%E5%A7%8B%E5%8C%96RSA%E5%AF%86%E9%92%A5%E5%AF%B9%E6%88%96%E7%94%9F%E6%88%90%E6%96%B0%E7%9A%84%E5%AF%86%E9%92%A5%E5%AF%B9%0AinitializeKeys()%20%7B%0Aif%20(process.env.RSA_PUBLIC_KEY%20%26%26%20process.env.RSA_PRIVATE_KEY)%20%7B%0A%2F%2F%20%E5%A4%84%E7%90%86%E8%BD%AC%E4%B9%89%E5%92%8C%E9%9D%9E%E8%BD%AC%E4%B9%89%E7%9A%84%E6%8D%A2%E8%A1%8C%E7%AC%A6%EF%BC%88%E5%85%BC%E5%AE%B9%E6%80%A7%E8%80%83%E8%99%91%EF%BC%89%0Athis.publicKeyPEM%20%3D%20process.env.RSA_PUBLIC_KEY.includes('%5C%5Cn')%0A%3F%20process.env.RSA_PUBLIC_KEY.replace(%2F%5C%5Cn%2Fg%2C%20'%5Cn')%0A%3A%20process.env.RSA_PUBLIC_KEY%3B%0Athis.privateKeyPEM%20%3D%20process.env.RSA_PRIVATE_KEY.includes('%5C%5Cn')%0A%3F%20process.env.RSA_PRIVATE_KEY.replace(%2F%5C%5Cn%2Fg%2C%20'%5Cn')%0A%3A%20process.env.RSA_PRIVATE_KEY%3B%0A%7D%20else%20%7B%0Aconsole.warn('RSA%20keys%20not%20found%20in%20environment.%20Generating%20new%20keys...')%3B%0Aconst%20keyPair%20%3D%20this.generateKeyPair()%3B%0Athis.publicKeyPEM%20%3D%20keyPair.publicKeyPEM%3B%0Athis.privateKeyPEM%20%3D%20keyPair.privateKeyPEM%3B%0Aconsole.log('Generated%20RSA%20Public%20Key%3A'%2C%20this.publicKeyPEM)%3B%0Aconsole.log('Generated%20RSA%20Private%20Key%3A'%2C%20this.privateKeyPEM)%3B%0Aconsole.log('Please%20add%20these%20keys%20to%20your%20.env%20file%3A')%3B%0Aconsole.log('RSA_PUBLIC_KEY%3D%22'%20%2B%20this.publicKeyPEM.replace(%2F%5Cn%2Fg%2C%20'%5C%5Cn')%20%2B%20'%22')%3B%0Aconsole.log('RSA_PRIVATE_KEY%3D%22'%20%2B%20this.privateKeyPEM.replace(%2F%5Cn%2Fg%2C%20'%5C%5Cn')%20%2B%20'%22')%3B%0A%7D%0A%7D%0A%2F%2F%20RSA%E5%AF%86%E9%92%A5%E5%AF%B9%E7%94%9F%E6%88%90%EF%BC%9A%E4%BD%BF%E7%94%A8jsrsasign%E7%94%9F%E6%88%90%E6%A0%87%E5%87%86%E6%A0%BC%E5%BC%8F%E5%AF%86%E9%92%A5%0AgenerateKeyPair(keySize%20%3D%202048)%20%7B%0Atry%20%7B%0Aconst%20keyPair%20%3D%20KEYUTIL.generateKeypair('RSA'%2C%20keySize)%3B%0Aconst%20publicKeyPEM%20%3D%20KEYUTIL.getPEM(keyPair.pubKeyObj)%3B%20%20%20%20%20%20%20%2F%2F%20%E5%85%AC%E9%92%A5PEM%E6%A0%BC%E5%BC%8F%0Aconst%20privateKeyPEM%20%3D%20KEYUTIL.getPEM(keyPair.prvKeyObj%2C%20'PKCS8PRV')%3B%20%20%2F%2F%20%E7%A7%81%E9%92%A5PKCS8%E6%A0%BC%E5%BC%8F%0Areturn%20%7B%20publicKeyPEM%2C%20privateKeyPEM%20%7D%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60RSA%20key%20generation%20failed%3A%20%24%7Berror.message%7D%60)%3B%0A%7D%0A%7D%0A%2F%2F%20%E5%85%AC%E9%92%A5%E5%88%86%E5%8F%91%E6%8E%A5%E5%8F%A3%EF%BC%9A%E4%BE%9B%E5%89%8D%E7%AB%AF%E8%8E%B7%E5%8F%96%E5%85%AC%E9%92%A5%0AgetPublicKey()%20%7B%0Areturn%20this.publicKeyPEM%3B%0A%7D%0A%2F%2F%20RSA-OAEP%E5%8A%A0%E5%AF%86%E5%AE%9E%E7%8E%B0%EF%BC%9A%E4%BD%BF%E7%94%A8Node.js%20crypto%E6%A8%A1%E5%9D%97%E7%A1%AE%E4%BF%9D%E6%9C%80%E4%BD%B3%E6%80%A7%E8%83%BD%E5%92%8C%E5%AE%89%E5%85%A8%E6%80%A7%0Aencrypt(plaintext)%20%7B%0Atry%20%7B%0A%2F%2F%20%E8%BE%93%E5%85%A5%E9%AA%8C%E8%AF%81%EF%BC%9A%E7%A1%AE%E4%BF%9D%E6%98%8E%E6%96%87%E6%9C%89%E6%95%88%0Aif%20(!plaintext%20%7C%7C%20typeof%20plaintext%20!%3D%3D%20'string')%20%7B%0Athrow%20new%20Error('Invalid%20plaintext%20for%20encryption')%3B%0A%7D%0A%2F%2F%20UTF-8%E7%BC%96%E7%A0%81%E8%BD%AC%E6%8D%A2%EF%BC%9A%E7%A1%AE%E4%BF%9D%E4%B8%AD%E6%96%87%E7%AD%89%E5%AD%97%E7%AC%A6%E6%AD%A3%E7%A1%AE%E5%A4%84%E7%90%86%0Aconst%20buffer%20%3D%20Buffer.from(plaintext%2C%20'utf8')%3B%0A%2F%2F%20%E6%A0%B8%E5%BF%83%E5%8A%A0%E5%AF%86%E9%80%BB%E8%BE%91%EF%BC%9A%E4%BD%BF%E7%94%A8OAEP%E5%A1%AB%E5%85%85%E7%9A%84RSA%E5%8A%A0%E5%AF%86%0A%2F%2F%20%E9%80%89%E6%8B%A9Node.js%20crypto%E8%80%8C%E9%9D%9Ejsrsasign%E7%9A%84%E5%8E%9F%E5%9B%A0%EF%BC%9A%E6%9B%B4%E5%8F%AF%E9%9D%A0%E7%9A%84OAEP%E5%AE%9E%E7%8E%B0%0Aconst%20encrypted%20%3D%20crypto.publicEncrypt(%0A%7B%0Akey%3A%20this.publicKeyPEM%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20PEM%E6%A0%BC%E5%BC%8F%E5%85%AC%E9%92%A5%0Apadding%3A%20crypto.constants.RSA_PKCS1_OAEP_PADDING%2C%20%20%20%2F%2F%20OAEP%E5%A1%AB%E5%85%85%EF%BC%8C%E9%98%B2%E6%AD%A2%E5%A1%AB%E5%85%85%E6%94%BB%E5%87%BB%0AoaepHash%3A%20'sha256'%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20SHA-256%E5%93%88%E5%B8%8C%E5%87%BD%E6%95%B0%0A%7D%2C%0Abuffer%0A)%3B%0A%2F%2F%20Base64%E7%BC%96%E7%A0%81%EF%BC%9A%E4%BE%BF%E4%BA%8E%E7%BD%91%E7%BB%9C%E4%BC%A0%E8%BE%93%E5%92%8C%E5%AD%98%E5%82%A8%0Areturn%20encrypted.toString('base64')%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60RSA%20encryption%20failed%3A%20%24%7Berror.message%7D%60)%3B%0A%7D%0A%7D%0A%2F%2F%20RSA-OAEP%E8%A7%A3%E5%AF%86%E5%AE%9E%E7%8E%B0%EF%BC%9A%E4%B8%B4%E6%97%B6%E8%A7%A3%E5%AF%86%E7%AD%96%E7%95%A5%E7%9A%84%E6%A0%B8%E5%BF%83%0Adecrypt(encryptedData)%20%7B%0Atry%20%7B%0A%2F%2F%20%E8%BE%93%E5%85%A5%E9%AA%8C%E8%AF%81%EF%BC%9A%E7%A1%AE%E4%BF%9D%E5%AF%86%E6%96%87%E6%A0%BC%E5%BC%8F%E6%AD%A3%E7%A1%AE%0Aif%20(!encryptedData%20%7C%7C%20typeof%20encryptedData%20!%3D%3D%20'string')%20%7B%0Athrow%20new%20Error('Invalid%20encrypted%20data%20for%20decryption')%3B%0A%7D%0A%2F%2F%20Base64%E8%A7%A3%E7%A0%81%EF%BC%9A%E6%81%A2%E5%A4%8D%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AF%86%E6%96%87%0Aconst%20encryptedBuffer%20%3D%20Buffer.from(encryptedData%2C%20'base64')%3B%0A%2F%2F%20%E6%A0%B8%E5%BF%83%E8%A7%A3%E5%AF%86%E9%80%BB%E8%BE%91%EF%BC%9A%E4%BD%BF%E7%94%A8%E7%A7%81%E9%92%A5%E8%A7%A3%E5%AF%86%0Aconst%20decrypted%20%3D%20crypto.privateDecrypt(%0A%7B%0Akey%3A%20this.privateKeyPEM%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20PEM%E6%A0%BC%E5%BC%8F%E7%A7%81%E9%92%A5%0Apadding%3A%20crypto.constants.RSA_PKCS1_OAEP_PADDING%2C%20%20%20%2F%2F%20%E4%B8%8E%E5%8A%A0%E5%AF%86%E4%BF%9D%E6%8C%81%E4%B8%80%E8%87%B4%E7%9A%84%E5%A1%AB%E5%85%85%0AoaepHash%3A%20'sha256'%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%B8%8E%E5%8A%A0%E5%AF%86%E4%BF%9D%E6%8C%81%E4%B8%80%E8%87%B4%E7%9A%84%E5%93%88%E5%B8%8C%0A%7D%2C%0AencryptedBuffer%0A)%3B%0A%2F%2F%20UTF-8%E8%A7%A3%E7%A0%81%EF%BC%9A%E6%81%A2%E5%A4%8D%E5%8E%9F%E5%A7%8B%E5%AD%97%E7%AC%A6%E4%B8%B2%0Areturn%20decrypted.toString('utf8')%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60RSA%20decryption%20failed%3A%20%24%7Berror.message%7D%60)%3B%0A%7D%0A%7D%0A%2F%2F%20%E7%81%B5%E6%B4%BB%E5%8A%A0%E5%AF%86%E6%8E%A5%E5%8F%A3%EF%BC%9A%E6%94%AF%E6%8C%81%E4%BD%BF%E7%94%A8%E4%BB%BB%E6%84%8F%E5%85%AC%E9%92%A5%E5%8A%A0%E5%AF%86%EF%BC%88%E6%B5%8B%E8%AF%95%E7%94%A8%EF%BC%89%0AencryptWithPublicKey(plaintext%2C%20publicKeyPEM)%20%7B%0Atry%20%7B%0Aif%20(!plaintext%20%7C%7C%20typeof%20plaintext%20!%3D%3D%20'string')%20%7B%0Athrow%20new%20Error('Invalid%20plaintext%20for%20encryption')%3B%0A%7D%0Aconst%20buffer%20%3D%20Buffer.from(plaintext%2C%20'utf8')%3B%0A%2F%2F%20%E4%BD%BF%E7%94%A8%E5%A4%96%E9%83%A8%E6%8F%90%E4%BE%9B%E7%9A%84%E5%85%AC%E9%92%A5%E8%BF%9B%E8%A1%8C%E5%8A%A0%E5%AF%86%0Aconst%20encrypted%20%3D%20crypto.publicEncrypt(%0A%7B%0Akey%3A%20publicKeyPEM%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%A4%96%E9%83%A8%E5%85%AC%E9%92%A5%0Apadding%3A%20crypto.constants.RSA_PKCS1_OAEP_PADDING%2C%0AoaepHash%3A%20'sha256'%2C%0A%7D%2C%0Abuffer%0A)%3B%0Areturn%20encrypted.toString('base64')%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60RSA%20encryption%20with%20provided%20key%20failed%3A%20%24%7Berror.message%7D%60)%3B%0A%7D%0A%7D%0A%2F%2F%20%E5%AF%86%E9%92%A5%E9%AA%8C%E8%AF%81%E5%B7%A5%E5%85%B7%EF%BC%9A%E7%A1%AE%E4%BF%9D%E5%AF%86%E9%92%A5%E6%A0%BC%E5%BC%8F%E6%AD%A3%E7%A1%AE%0AvalidateKey(keyPEM%2C%20isPrivate%20%3D%20false)%20%7B%0Atry%20%7B%0Aconst%20keyObj%20%3D%20KEYUTIL.getKey(keyPEM)%3B%0Areturn%20keyObj%20%26%26%20(isPrivate%20%3F%20keyObj.isPrivate%20%3A%20keyObj.isPublic)%3B%0A%7D%20catch%20(error)%20%7B%0Areturn%20false%3B%20%20%20%2F%2F%20%E9%AA%8C%E8%AF%81%E5%A4%B1%E8%B4%A5%E8%BF%94%E5%9B%9Efalse%E8%80%8C%E9%9D%9E%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8%0A%7D%0A%7D%0A%7D%0A%2F%2F%20%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E5%AF%BC%E5%87%BA%EF%BC%9A%E5%85%A8%E5%B1%80%E5%94%AF%E4%B8%80%E5%AE%9E%E4%BE%8B%EF%BC%8C%E8%8A%82%E7%9C%81%E5%86%85%E5%AD%98%E5%B9%B6%E4%BF%9D%E8%AF%81%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%0Aconst%20rsaCrypto%20%3D%20new%20RSACrypto()%3B%0A%2F%2F%20%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%87%BA%EF%BC%9A%E6%8F%90%E4%BE%9B%E5%A4%9A%E7%A7%8D%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F%0Amodule.exports%20%3D%20%7B%0ARSACrypto%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%AF%BC%E5%87%BA%E7%B1%BB%EF%BC%88%E7%94%A8%E4%BA%8E%E6%89%A9%E5%B1%95%EF%BC%89%0ArsaCrypto%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%AF%BC%E5%87%BA%E5%8D%95%E4%BE%8B%E5%AE%9E%E4%BE%8B%0AgenerateKeyPair%3A%20(keySize)%20%3D%3E%20rsaCrypto.generateKeyPair(keySize)%2C%20%20%20%20%20%2F%2F%20%E4%BE%BF%E5%88%A9%E5%87%BD%E6%95%B0%0Aencrypt%3A%20(plaintext)%20%3D%3E%20rsaCrypto.encrypt(plaintext)%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%BE%BF%E5%88%A9%E5%87%BD%E6%95%B0%0Adecrypt%3A%20(encryptedData)%20%3D%3E%20rsaCrypto.decrypt(encryptedData)%2C%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%BE%BF%E5%88%A9%E5%87%BD%E6%95%B0%0AgetPublicKey%3A%20()%20%3D%3E%20rsaCrypto.getPublicKey()%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%BE%BF%E5%88%A9%E5%87%BD%E6%95%B0%0AencryptWithPublicKey%3A%20(plaintext%2C%20publicKey)%20%3D%3E%20rsaCrypto.encryptWithPublicKey(plaintext%2C%20publicKey)%2C%0AvalidateKey%3A%20(keyPEM%2C%20isPrivate)%20%3D%3E%20rsaCrypto.validateKey(keyPEM%2C%20isPrivate)%0A%7D%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e jsrsasign = \u003cspan class=\"hljs-built_in inline\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;jsrsasign\u0026#x27;\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e { \u003cspan class=\"hljs-variable constant_ inline\"\u003eKEYUTIL\u003c/span\u003e } = jsrsasign;\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e crypto = \u003cspan class=\"hljs-built_in inline\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;crypto\u0026#x27;\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword inline\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eRSACrypto\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_ inline\"\u003econstructor\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003ekeySize\u003c/span\u003e = \u003cspan class=\"hljs-number inline\"\u003e2048\u003c/span\u003e;\n    \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003einitializeKeys\u003c/span\u003e();\n  }\n\n  \u003cspan class=\"hljs-comment inline\"\u003e// 从环境变量初始化RSA密钥对或生成新的密钥对\u003c/span\u003e\n  \u003cspan class=\"hljs-title function_ inline\"\u003einitializeKeys\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (process.\u003cspan class=\"hljs-property inline\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eRSA_PUBLIC_KEY\u003c/span\u003e \u0026amp;\u0026amp; process.\u003cspan class=\"hljs-property inline\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eRSA_PRIVATE_KEY\u003c/span\u003e) {\n      \u003cspan class=\"hljs-comment inline\"\u003e// 处理转义和非转义的换行符（兼容性考虑）\u003c/span\u003e\n      \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epublicKeyPEM\u003c/span\u003e = process.\u003cspan class=\"hljs-property inline\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eRSA_PUBLIC_KEY\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eincludes\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\\\\n\u0026#x27;\u003c/span\u003e) \n        ? process.\u003cspan class=\"hljs-property inline\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eRSA_PUBLIC_KEY\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003ereplace\u003c/span\u003e(\u003cspan class=\"hljs-regexp inline\"\u003e/\\\\n/g\u003c/span\u003e, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\\n\u0026#x27;\u003c/span\u003e)\n        : process.\u003cspan class=\"hljs-property inline\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eRSA_PUBLIC_KEY\u003c/span\u003e;\n      \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eprivateKeyPEM\u003c/span\u003e = process.\u003cspan class=\"hljs-property inline\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eRSA_PRIVATE_KEY\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eincludes\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\\\\n\u0026#x27;\u003c/span\u003e)\n        ? process.\u003cspan class=\"hljs-property inline\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eRSA_PRIVATE_KEY\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003ereplace\u003c/span\u003e(\u003cspan class=\"hljs-regexp inline\"\u003e/\\\\n/g\u003c/span\u003e, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\\n\u0026#x27;\u003c/span\u003e)\n        : process.\u003cspan class=\"hljs-property inline\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eRSA_PRIVATE_KEY\u003c/span\u003e;\n    } \u003cspan class=\"hljs-keyword inline\"\u003eelse\u003c/span\u003e {\n      \u003cspan class=\"hljs-variable language_ inline\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003ewarn\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;RSA keys not found in environment. Generating new keys...\u0026#x27;\u003c/span\u003e);\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e keyPair = \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003egenerateKeyPair\u003c/span\u003e();\n      \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epublicKeyPEM\u003c/span\u003e = keyPair.\u003cspan class=\"hljs-property inline\"\u003epublicKeyPEM\u003c/span\u003e;\n      \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eprivateKeyPEM\u003c/span\u003e = keyPair.\u003cspan class=\"hljs-property inline\"\u003eprivateKeyPEM\u003c/span\u003e;\n      \n      \u003cspan class=\"hljs-variable language_ inline\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;Generated RSA Public Key:\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epublicKeyPEM\u003c/span\u003e);\n      \u003cspan class=\"hljs-variable language_ inline\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;Generated RSA Private Key:\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eprivateKeyPEM\u003c/span\u003e);\n      \u003cspan class=\"hljs-variable language_ inline\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;Please add these keys to your .env file:\u0026#x27;\u003c/span\u003e);\n      \u003cspan class=\"hljs-variable language_ inline\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;RSA_PUBLIC_KEY=\u0026quot;\u0026#x27;\u003c/span\u003e + \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epublicKeyPEM\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003ereplace\u003c/span\u003e(\u003cspan class=\"hljs-regexp inline\"\u003e/\\n/g\u003c/span\u003e, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\\\\n\u0026#x27;\u003c/span\u003e) + \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026quot;\u0026#x27;\u003c/span\u003e);\n      \u003cspan class=\"hljs-variable language_ inline\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;RSA_PRIVATE_KEY=\u0026quot;\u0026#x27;\u003c/span\u003e + \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eprivateKeyPEM\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003ereplace\u003c/span\u003e(\u003cspan class=\"hljs-regexp inline\"\u003e/\\n/g\u003c/span\u003e, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\\\\n\u0026#x27;\u003c/span\u003e) + \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026quot;\u0026#x27;\u003c/span\u003e);\n    }\n  }\n\n  \u003cspan class=\"hljs-comment inline\"\u003e// RSA密钥对生成：使用jsrsasign生成标准格式密钥\u003c/span\u003e\n  \u003cspan class=\"hljs-title function_ inline\"\u003egenerateKeyPair\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003ekeySize = \u003cspan class=\"hljs-number inline\"\u003e2048\u003c/span\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e keyPair = \u003cspan class=\"hljs-variable constant_ inline\"\u003eKEYUTIL\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003egenerateKeypair\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;RSA\u0026#x27;\u003c/span\u003e, keySize);\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e publicKeyPEM = \u003cspan class=\"hljs-variable constant_ inline\"\u003eKEYUTIL\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003egetPEM\u003c/span\u003e(keyPair.\u003cspan class=\"hljs-property inline\"\u003epubKeyObj\u003c/span\u003e);       \u003cspan class=\"hljs-comment inline\"\u003e// 公钥PEM格式\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e privateKeyPEM = \u003cspan class=\"hljs-variable constant_ inline\"\u003eKEYUTIL\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003egetPEM\u003c/span\u003e(keyPair.\u003cspan class=\"hljs-property inline\"\u003eprvKeyObj\u003c/span\u003e, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;PKCS8PRV\u0026#x27;\u003c/span\u003e);  \u003cspan class=\"hljs-comment inline\"\u003e// 私钥PKCS8格式\u003c/span\u003e\n      \n      \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e { publicKeyPEM, privateKeyPEM };\n    } \u003cspan class=\"hljs-keyword inline\"\u003ecatch\u003c/span\u003e (error) {\n      \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`RSA key generation failed: \u003cspan class=\"hljs-subst inline\"\u003e${error.message}\u003c/span\u003e`\u003c/span\u003e);\n    }\n  }\n\n  \u003cspan class=\"hljs-comment inline\"\u003e// 公钥分发接口：供前端获取公钥\u003c/span\u003e\n  \u003cspan class=\"hljs-title function_ inline\"\u003egetPublicKey\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epublicKeyPEM\u003c/span\u003e;\n  }\n\n  \u003cspan class=\"hljs-comment inline\"\u003e// RSA-OAEP加密实现：使用Node.js crypto模块确保最佳性能和安全性\u003c/span\u003e\n  \u003cspan class=\"hljs-title function_ inline\"\u003eencrypt\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003eplaintext\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n      \u003cspan class=\"hljs-comment inline\"\u003e// 输入验证：确保明文有效\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!plaintext || \u003cspan class=\"hljs-keyword inline\"\u003etypeof\u003c/span\u003e plaintext !== \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;string\u0026#x27;\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;Invalid plaintext for encryption\u0026#x27;\u003c/span\u003e);\n      }\n\n      \u003cspan class=\"hljs-comment inline\"\u003e// UTF-8编码转换：确保中文等字符正确处理\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e buffer = \u003cspan class=\"hljs-title class_ inline\"\u003eBuffer\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003efrom\u003c/span\u003e(plaintext, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;utf8\u0026#x27;\u003c/span\u003e);\n      \n      \u003cspan class=\"hljs-comment inline\"\u003e// 核心加密逻辑：使用OAEP填充的RSA加密\u003c/span\u003e\n      \u003cspan class=\"hljs-comment inline\"\u003e// 选择Node.js crypto而非jsrsasign的原因：更可靠的OAEP实现\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e encrypted = crypto.\u003cspan class=\"hljs-title function_ inline\"\u003epublicEncrypt\u003c/span\u003e(\n        {\n          \u003cspan class=\"hljs-attr inline\"\u003ekey\u003c/span\u003e: \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epublicKeyPEM\u003c/span\u003e,                              \u003cspan class=\"hljs-comment inline\"\u003e// PEM格式公钥\u003c/span\u003e\n          \u003cspan class=\"hljs-attr inline\"\u003epadding\u003c/span\u003e: crypto.\u003cspan class=\"hljs-property inline\"\u003econstants\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eRSA_PKCS1_OAEP_PADDING\u003c/span\u003e,   \u003cspan class=\"hljs-comment inline\"\u003e// OAEP填充，防止填充攻击\u003c/span\u003e\n          \u003cspan class=\"hljs-attr inline\"\u003eoaepHash\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;sha256\u0026#x27;\u003c/span\u003e,                                  \u003cspan class=\"hljs-comment inline\"\u003e// SHA-256哈希函数\u003c/span\u003e\n        },\n        buffer\n      );\n\n      \u003cspan class=\"hljs-comment inline\"\u003e// Base64编码：便于网络传输和存储\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e encrypted.\u003cspan class=\"hljs-title function_ inline\"\u003etoString\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;base64\u0026#x27;\u003c/span\u003e);\n    } \u003cspan class=\"hljs-keyword inline\"\u003ecatch\u003c/span\u003e (error) {\n      \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`RSA encryption failed: \u003cspan class=\"hljs-subst inline\"\u003e${error.message}\u003c/span\u003e`\u003c/span\u003e);\n    }\n  }\n\n  \u003cspan class=\"hljs-comment inline\"\u003e// RSA-OAEP解密实现：临时解密策略的核心\u003c/span\u003e\n  \u003cspan class=\"hljs-title function_ inline\"\u003edecrypt\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003eencryptedData\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n      \u003cspan class=\"hljs-comment inline\"\u003e// 输入验证：确保密文格式正确\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!encryptedData || \u003cspan class=\"hljs-keyword inline\"\u003etypeof\u003c/span\u003e encryptedData !== \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;string\u0026#x27;\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;Invalid encrypted data for decryption\u0026#x27;\u003c/span\u003e);\n      }\n\n      \u003cspan class=\"hljs-comment inline\"\u003e// Base64解码：恢复二进制密文\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e encryptedBuffer = \u003cspan class=\"hljs-title class_ inline\"\u003eBuffer\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003efrom\u003c/span\u003e(encryptedData, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;base64\u0026#x27;\u003c/span\u003e);\n      \n      \u003cspan class=\"hljs-comment inline\"\u003e// 核心解密逻辑：使用私钥解密\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e decrypted = crypto.\u003cspan class=\"hljs-title function_ inline\"\u003eprivateDecrypt\u003c/span\u003e(\n        {\n          \u003cspan class=\"hljs-attr inline\"\u003ekey\u003c/span\u003e: \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eprivateKeyPEM\u003c/span\u003e,                             \u003cspan class=\"hljs-comment inline\"\u003e// PEM格式私钥\u003c/span\u003e\n          \u003cspan class=\"hljs-attr inline\"\u003epadding\u003c/span\u003e: crypto.\u003cspan class=\"hljs-property inline\"\u003econstants\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eRSA_PKCS1_OAEP_PADDING\u003c/span\u003e,   \u003cspan class=\"hljs-comment inline\"\u003e// 与加密保持一致的填充\u003c/span\u003e\n          \u003cspan class=\"hljs-attr inline\"\u003eoaepHash\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;sha256\u0026#x27;\u003c/span\u003e,                                  \u003cspan class=\"hljs-comment inline\"\u003e// 与加密保持一致的哈希\u003c/span\u003e\n        },\n        encryptedBuffer\n      );\n\n      \u003cspan class=\"hljs-comment inline\"\u003e// UTF-8解码：恢复原始字符串\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e decrypted.\u003cspan class=\"hljs-title function_ inline\"\u003etoString\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;utf8\u0026#x27;\u003c/span\u003e);\n    } \u003cspan class=\"hljs-keyword inline\"\u003ecatch\u003c/span\u003e (error) {\n      \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`RSA decryption failed: \u003cspan class=\"hljs-subst inline\"\u003e${error.message}\u003c/span\u003e`\u003c/span\u003e);\n    }\n  }\n\n  \u003cspan class=\"hljs-comment inline\"\u003e// 灵活加密接口：支持使用任意公钥加密（测试用）\u003c/span\u003e\n  \u003cspan class=\"hljs-title function_ inline\"\u003eencryptWithPublicKey\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003eplaintext, publicKeyPEM\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n      \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!plaintext || \u003cspan class=\"hljs-keyword inline\"\u003etypeof\u003c/span\u003e plaintext !== \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;string\u0026#x27;\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;Invalid plaintext for encryption\u0026#x27;\u003c/span\u003e);\n      }\n\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e buffer = \u003cspan class=\"hljs-title class_ inline\"\u003eBuffer\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003efrom\u003c/span\u003e(plaintext, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;utf8\u0026#x27;\u003c/span\u003e);\n      \n      \u003cspan class=\"hljs-comment inline\"\u003e// 使用外部提供的公钥进行加密\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e encrypted = crypto.\u003cspan class=\"hljs-title function_ inline\"\u003epublicEncrypt\u003c/span\u003e(\n        {\n          \u003cspan class=\"hljs-attr inline\"\u003ekey\u003c/span\u003e: publicKeyPEM,                                   \u003cspan class=\"hljs-comment inline\"\u003e// 外部公钥\u003c/span\u003e\n          \u003cspan class=\"hljs-attr inline\"\u003epadding\u003c/span\u003e: crypto.\u003cspan class=\"hljs-property inline\"\u003econstants\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eRSA_PKCS1_OAEP_PADDING\u003c/span\u003e,\n          \u003cspan class=\"hljs-attr inline\"\u003eoaepHash\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;sha256\u0026#x27;\u003c/span\u003e,\n        },\n        buffer\n      );\n\n      \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e encrypted.\u003cspan class=\"hljs-title function_ inline\"\u003etoString\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;base64\u0026#x27;\u003c/span\u003e);\n    } \u003cspan class=\"hljs-keyword inline\"\u003ecatch\u003c/span\u003e (error) {\n      \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`RSA encryption with provided key failed: \u003cspan class=\"hljs-subst inline\"\u003e${error.message}\u003c/span\u003e`\u003c/span\u003e);\n    }\n  }\n\n  \u003cspan class=\"hljs-comment inline\"\u003e// 密钥验证工具：确保密钥格式正确\u003c/span\u003e\n  \u003cspan class=\"hljs-title function_ inline\"\u003evalidateKey\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003ekeyPEM, isPrivate = \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e keyObj = \u003cspan class=\"hljs-variable constant_ inline\"\u003eKEYUTIL\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003egetKey\u003c/span\u003e(keyPEM);\n      \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e keyObj \u0026amp;\u0026amp; (isPrivate ? keyObj.\u003cspan class=\"hljs-property inline\"\u003eisPrivate\u003c/span\u003e : keyObj.\u003cspan class=\"hljs-property inline\"\u003eisPublic\u003c/span\u003e);\n    } \u003cspan class=\"hljs-keyword inline\"\u003ecatch\u003c/span\u003e (error) {\n      \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e;   \u003cspan class=\"hljs-comment inline\"\u003e// 验证失败返回false而非抛出异常\u003c/span\u003e\n    }\n  }\n}\n\n\u003cspan class=\"hljs-comment inline\"\u003e// 单例模式导出：全局唯一实例，节省内存并保证缓存一致性\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e rsaCrypto = \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eRSACrypto\u003c/span\u003e();\n\n\u003cspan class=\"hljs-comment inline\"\u003e// 模块导出：提供多种使用方式\u003c/span\u003e\n\u003cspan class=\"hljs-variable language_ inline\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eexports\u003c/span\u003e = {\n  \u003cspan class=\"hljs-title class_ inline\"\u003eRSACrypto\u003c/span\u003e,                                                    \u003cspan class=\"hljs-comment inline\"\u003e// 导出类（用于扩展）\u003c/span\u003e\n  rsaCrypto,                                                   \u003cspan class=\"hljs-comment inline\"\u003e// 导出单例实例\u003c/span\u003e\n  \u003cspan class=\"hljs-attr inline\"\u003egenerateKeyPair\u003c/span\u003e: \u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003ekeySize\u003c/span\u003e) =\u0026gt;\u003c/span\u003e rsaCrypto.\u003cspan class=\"hljs-title function_ inline\"\u003egenerateKeyPair\u003c/span\u003e(keySize),     \u003cspan class=\"hljs-comment inline\"\u003e// 便利函数\u003c/span\u003e\n  \u003cspan class=\"hljs-attr inline\"\u003eencrypt\u003c/span\u003e: \u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003eplaintext\u003c/span\u003e) =\u0026gt;\u003c/span\u003e rsaCrypto.\u003cspan class=\"hljs-title function_ inline\"\u003eencrypt\u003c/span\u003e(plaintext),                 \u003cspan class=\"hljs-comment inline\"\u003e// 便利函数\u003c/span\u003e\n  \u003cspan class=\"hljs-attr inline\"\u003edecrypt\u003c/span\u003e: \u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003eencryptedData\u003c/span\u003e) =\u0026gt;\u003c/span\u003e rsaCrypto.\u003cspan class=\"hljs-title function_ inline\"\u003edecrypt\u003c/span\u003e(encryptedData),         \u003cspan class=\"hljs-comment inline\"\u003e// 便利函数\u003c/span\u003e\n  \u003cspan class=\"hljs-attr inline\"\u003egetPublicKey\u003c/span\u003e: \u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e rsaCrypto.\u003cspan class=\"hljs-title function_ inline\"\u003egetPublicKey\u003c/span\u003e(),                         \u003cspan class=\"hljs-comment inline\"\u003e// 便利函数\u003c/span\u003e\n  \u003cspan class=\"hljs-attr inline\"\u003eencryptWithPublicKey\u003c/span\u003e: \u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003eplaintext, publicKey\u003c/span\u003e) =\u0026gt;\u003c/span\u003e rsaCrypto.\u003cspan class=\"hljs-title function_ inline\"\u003eencryptWithPublicKey\u003c/span\u003e(plaintext, publicKey),\n  \u003cspan class=\"hljs-attr inline\"\u003evalidateKey\u003c/span\u003e: \u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003ekeyPEM, isPrivate\u003c/span\u003e) =\u0026gt;\u003c/span\u003e rsaCrypto.\u003cspan class=\"hljs-title function_ inline\"\u003evalidateKey\u003c/span\u003e(keyPEM, isPrivate)\n};\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch3 id=\"密钥初始化设计\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#密钥初始化设计\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 密钥初始化设计\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            密钥初始化设计\n        \u003c/h3\u003e\n\u003col class=\"list-decimal list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e环境变量优先\u003c/strong\u003e：生产环境使用预配置的密钥\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e自动生成兜底\u003c/strong\u003e：开发环境自动生成临时密钥\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e格式兼容性\u003c/strong\u003e：处理转义字符的兼容性问题\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"加密数据的存储策略\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#加密数据的存储策略\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 加密数据的存储策略\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            加密数据的存储策略\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"%2F%2F%20%E4%BD%BF%E7%94%A8RSA%E8%A7%A3%E5%AF%86API%E5%AF%86%E9%92%A5%E7%9A%84%E6%96%B9%E6%B3%95%0AuserSchema.methods.decryptApiKey%20%3D%20function(encryptedKey%20%3D%20null)%20%7B%0Atry%20%7B%0Aconst%20keyToDecrypt%20%3D%20encryptedKey%20%7C%7C%20this.apiKey%3B%0Aif%20(!keyToDecrypt)%20%7B%0Areturn%20null%3B%0A%7D%0A%2F%2F%20%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E4%B8%BARSA%E5%8A%A0%E5%AF%86%EF%BC%88%E5%89%8D%E7%AB%AF%E4%BC%A0%E6%9D%A5%E7%9A%84base64%E6%A0%BC%E5%BC%8F%EF%BC%89%0Aif%20(keyToDecrypt.startsWith('rsa%3A'))%20%7B%0Aconst%20encryptedData%20%3D%20keyToDecrypt.substring(4)%3B%0Areturn%20decrypt(encryptedData)%3B%0A%7D%0A%2F%2F%20%E5%A6%82%E6%9E%9C%E4%B8%8D%E6%98%AF%E5%8A%A0%E5%AF%86%E7%9A%84%EF%BC%8C%E7%9B%B4%E6%8E%A5%E8%BF%94%E5%9B%9E%EF%BC%88%E5%BC%80%E5%8F%91%2F%E6%B5%8B%E8%AF%95%E7%94%A8%EF%BC%89%0Areturn%20keyToDecrypt%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60API%20key%20decryption%20failed%3A%20%24%7Berror.message%7D%60)%3B%0A%7D%0A%7D%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 使用RSA解密API密钥的方法\u003c/span\u003e\nuserSchema.\u003cspan class=\"hljs-property inline\"\u003emethods\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003edecryptApiKey\u003c/span\u003e = \u003cspan class=\"hljs-keyword inline\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003eencryptedKey = \u003cspan class=\"hljs-literal inline\"\u003enull\u003c/span\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e keyToDecrypt = encryptedKey || \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eapiKey\u003c/span\u003e;\n    \n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!keyToDecrypt) {\n      \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal inline\"\u003enull\u003c/span\u003e;\n    }\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 检查是否为RSA加密（前端传来的base64格式）\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (keyToDecrypt.\u003cspan class=\"hljs-title function_ inline\"\u003estartsWith\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;rsa:\u0026#x27;\u003c/span\u003e)) {\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e encryptedData = keyToDecrypt.\u003cspan class=\"hljs-title function_ inline\"\u003esubstring\u003c/span\u003e(\u003cspan class=\"hljs-number inline\"\u003e4\u003c/span\u003e);\n      \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003edecrypt\u003c/span\u003e(encryptedData);\n    }\n    \n    \u003cspan class=\"hljs-comment inline\"\u003e// 如果不是加密的，直接返回（开发/测试用）\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e keyToDecrypt;\n  } \u003cspan class=\"hljs-keyword inline\"\u003ecatch\u003c/span\u003e (error) {\n    \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`API key decryption failed: \u003cspan class=\"hljs-subst inline\"\u003e${error.message}\u003c/span\u003e`\u003c/span\u003e);\n  }\n};\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e存储策略\u003c/strong\u003e：\u003c/p\u003e\n\u003col class=\"list-decimal list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e前缀标识\u003c/strong\u003e：\u003ccode\u003ersa:\u003c/code\u003e前缀标识加密数据\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e兼容性处理\u003c/strong\u003e：支持明文存储（开发环境）\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"后端rsa密钥管理与加密服务\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#后端rsa密钥管理与加密服务\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 后端RSA密钥管理与加密服务\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            后端RSA密钥管理与加密服务\n        \u003c/h2\u003e\n\u003ch3 id=\"rsacrypto类的单例模式设计\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#rsacrypto类的单例模式设计\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to RSACrypto类的单例模式设计\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            RSACrypto类的单例模式设计\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"%2F%2F%20%E5%AF%BC%E5%87%BA%E5%8D%95%E4%BE%8B%E5%AE%9E%E4%BE%8B%0Aconst%20rsaCrypto%20%3D%20new%20RSACrypto()%3B%0Amodule.exports%20%3D%20%7B%0ARSACrypto%2C%0ArsaCrypto%2C%0AgenerateKeyPair%3A%20(keySize)%20%3D%3E%20rsaCrypto.generateKeyPair(keySize)%2C%0Aencrypt%3A%20(plaintext)%20%3D%3E%20rsaCrypto.encrypt(plaintext)%2C%0Adecrypt%3A%20(encryptedData)%20%3D%3E%20rsaCrypto.decrypt(encryptedData)%2C%0AgetPublicKey%3A%20()%20%3D%3E%20rsaCrypto.getPublicKey()%2C%0AencryptWithPublicKey%3A%20(plaintext%2C%20publicKey)%20%3D%3E%20rsaCrypto.encryptWithPublicKey(plaintext%2C%20publicKey)%2C%0AvalidateKey%3A%20(keyPEM%2C%20isPrivate)%20%3D%3E%20rsaCrypto.validateKey(keyPEM%2C%20isPrivate)%0A%7D%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 导出单例实例\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e rsaCrypto = \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eRSACrypto\u003c/span\u003e();\n\n\u003cspan class=\"hljs-variable language_ inline\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eexports\u003c/span\u003e = {\n  \u003cspan class=\"hljs-title class_ inline\"\u003eRSACrypto\u003c/span\u003e,\n  rsaCrypto,\n  \u003cspan class=\"hljs-attr inline\"\u003egenerateKeyPair\u003c/span\u003e: \u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003ekeySize\u003c/span\u003e) =\u0026gt;\u003c/span\u003e rsaCrypto.\u003cspan class=\"hljs-title function_ inline\"\u003egenerateKeyPair\u003c/span\u003e(keySize),\n  \u003cspan class=\"hljs-attr inline\"\u003eencrypt\u003c/span\u003e: \u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003eplaintext\u003c/span\u003e) =\u0026gt;\u003c/span\u003e rsaCrypto.\u003cspan class=\"hljs-title function_ inline\"\u003eencrypt\u003c/span\u003e(plaintext),\n  \u003cspan class=\"hljs-attr inline\"\u003edecrypt\u003c/span\u003e: \u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003eencryptedData\u003c/span\u003e) =\u0026gt;\u003c/span\u003e rsaCrypto.\u003cspan class=\"hljs-title function_ inline\"\u003edecrypt\u003c/span\u003e(encryptedData),\n  \u003cspan class=\"hljs-attr inline\"\u003egetPublicKey\u003c/span\u003e: \u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e rsaCrypto.\u003cspan class=\"hljs-title function_ inline\"\u003egetPublicKey\u003c/span\u003e(),\n  \u003cspan class=\"hljs-attr inline\"\u003eencryptWithPublicKey\u003c/span\u003e: \u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003eplaintext, publicKey\u003c/span\u003e) =\u0026gt;\u003c/span\u003e rsaCrypto.\u003cspan class=\"hljs-title function_ inline\"\u003eencryptWithPublicKey\u003c/span\u003e(plaintext, publicKey),\n  \u003cspan class=\"hljs-attr inline\"\u003evalidateKey\u003c/span\u003e: \u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003ekeyPEM, isPrivate\u003c/span\u003e) =\u0026gt;\u003c/span\u003e rsaCrypto.\u003cspan class=\"hljs-title function_ inline\"\u003evalidateKey\u003c/span\u003e(keyPEM, isPrivate)\n};\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch3 id=\"密钥初始化策略\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#密钥初始化策略\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 密钥初始化策略\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            密钥初始化策略\n        \u003c/h3\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e生成策略\u003c/strong\u003e：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"%2F%2F%20%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%EF%BC%9A%E4%BD%BF%E7%94%A8%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%0Aif%20(process.env.RSA_PUBLIC_KEY%20%26%26%20process.env.RSA_PRIVATE_KEY)%20%7B%0A%2F%2F%20%E4%BD%BF%E7%94%A8%E9%A2%84%E9%85%8D%E7%BD%AE%E7%9A%84%E5%AF%86%E9%92%A5%E5%AF%B9%0A%7D%20else%20%7B%0A%2F%2F%20%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%EF%BC%9A%E5%8A%A8%E6%80%81%E7%94%9F%E6%88%90%0Aconst%20keyPair%20%3D%20this.generateKeyPair()%3B%0A%7D\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 生产环境：使用环境变量\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (process.\u003cspan class=\"hljs-property inline\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eRSA_PUBLIC_KEY\u003c/span\u003e \u0026amp;\u0026amp; process.\u003cspan class=\"hljs-property inline\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eRSA_PRIVATE_KEY\u003c/span\u003e) {\n  \u003cspan class=\"hljs-comment inline\"\u003e// 使用预配置的密钥对\u003c/span\u003e\n} \u003cspan class=\"hljs-keyword inline\"\u003eelse\u003c/span\u003e {\n  \u003cspan class=\"hljs-comment inline\"\u003e// 开发环境：动态生成\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e keyPair = \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003egenerateKeyPair\u003c/span\u003e();\n}\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e密钥生成的数学过程\u003c/strong\u003e：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"%2F%2F%20%E7%94%9F%E6%88%90RSA%E5%AF%86%E9%92%A5%E5%AF%B9%0AgenerateKeyPair(keySize%20%3D%202048)%20%7B%0Atry%20%7B%0Aconst%20keyPair%20%3D%20KEYUTIL.generateKeypair('RSA'%2C%20keySize)%3B%0Aconst%20publicKeyPEM%20%3D%20KEYUTIL.getPEM(keyPair.pubKeyObj)%3B%0Aconst%20privateKeyPEM%20%3D%20KEYUTIL.getPEM(keyPair.prvKeyObj%2C%20'PKCS8PRV')%3B%0Areturn%20%7B%20publicKeyPEM%2C%20privateKeyPEM%20%7D%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60RSA%20key%20generation%20failed%3A%20%24%7Berror.message%7D%60)%3B%0A%7D%0A%7D\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 生成RSA密钥对\u003c/span\u003e\n\u003cspan class=\"hljs-title function_ inline\"\u003egenerateKeyPair\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003ekeySize = \u003cspan class=\"hljs-number inline\"\u003e2048\u003c/span\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e keyPair = \u003cspan class=\"hljs-variable constant_ inline\"\u003eKEYUTIL\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003egenerateKeypair\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;RSA\u0026#x27;\u003c/span\u003e, keySize);\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e publicKeyPEM = \u003cspan class=\"hljs-variable constant_ inline\"\u003eKEYUTIL\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003egetPEM\u003c/span\u003e(keyPair.\u003cspan class=\"hljs-property inline\"\u003epubKeyObj\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e privateKeyPEM = \u003cspan class=\"hljs-variable constant_ inline\"\u003eKEYUTIL\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003egetPEM\u003c/span\u003e(keyPair.\u003cspan class=\"hljs-property inline\"\u003eprvKeyObj\u003c/span\u003e, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;PKCS8PRV\u0026#x27;\u003c/span\u003e);\n    \n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e { publicKeyPEM, privateKeyPEM };\n  } \u003cspan class=\"hljs-keyword inline\"\u003ecatch\u003c/span\u003e (error) {\n    \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`RSA key generation failed: \u003cspan class=\"hljs-subst inline\"\u003e${error.message}\u003c/span\u003e`\u003c/span\u003e);\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch3 id=\"nodejs-crypto模块的oaep实现\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#nodejs-crypto模块的oaep实现\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to Node.js crypto模块的OAEP实现\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            Node.js crypto模块的OAEP实现\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"%2F%2F%20%E4%BD%BF%E7%94%A8RSA-OAEP%E5%92%8C%E5%85%AC%E9%92%A5%E5%8A%A0%E5%AF%86%E6%95%B0%E6%8D%AE%0Aencrypt(plaintext)%20%7B%0Atry%20%7B%0Aif%20(!plaintext%20%7C%7C%20typeof%20plaintext%20!%3D%3D%20'string')%20%7B%0Athrow%20new%20Error('Invalid%20plaintext%20for%20encryption')%3B%0A%7D%0A%2F%2F%20%E5%B0%86%E6%98%8E%E6%96%87%E8%BD%AC%E6%8D%A2%E4%B8%BABuffer%0Aconst%20buffer%20%3D%20Buffer.from(plaintext%2C%20'utf8')%3B%0A%2F%2F%20%E4%BD%BF%E7%94%A8Node.js%20crypto%E6%A8%A1%E5%9D%97%E8%BF%9B%E8%A1%8CRSA-OAEP%E5%8A%A0%E5%AF%86%EF%BC%88%E6%AF%94jsrsasign%E6%9B%B4%E5%8F%AF%E9%9D%A0%EF%BC%89%0Aconst%20encrypted%20%3D%20crypto.publicEncrypt(%0A%7B%0Akey%3A%20this.publicKeyPEM%2C%0Apadding%3A%20crypto.constants.RSA_PKCS1_OAEP_PADDING%2C%0AoaepHash%3A%20'sha256'%2C%0A%7D%2C%0Abuffer%0A)%3B%0Areturn%20encrypted.toString('base64')%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60RSA%20encryption%20failed%3A%20%24%7Berror.message%7D%60)%3B%0A%7D%0A%7D\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 使用RSA-OAEP和公钥加密数据\u003c/span\u003e\n\u003cspan class=\"hljs-title function_ inline\"\u003eencrypt\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003eplaintext\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!plaintext || \u003cspan class=\"hljs-keyword inline\"\u003etypeof\u003c/span\u003e plaintext !== \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;string\u0026#x27;\u003c/span\u003e) {\n      \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;Invalid plaintext for encryption\u0026#x27;\u003c/span\u003e);\n    }\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 将明文转换为Buffer\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e buffer = \u003cspan class=\"hljs-title class_ inline\"\u003eBuffer\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003efrom\u003c/span\u003e(plaintext, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;utf8\u0026#x27;\u003c/span\u003e);\n    \n    \u003cspan class=\"hljs-comment inline\"\u003e// 使用Node.js crypto模块进行RSA-OAEP加密（比jsrsasign更可靠）\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e encrypted = crypto.\u003cspan class=\"hljs-title function_ inline\"\u003epublicEncrypt\u003c/span\u003e(\n      {\n        \u003cspan class=\"hljs-attr inline\"\u003ekey\u003c/span\u003e: \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epublicKeyPEM\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr inline\"\u003epadding\u003c/span\u003e: crypto.\u003cspan class=\"hljs-property inline\"\u003econstants\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eRSA_PKCS1_OAEP_PADDING\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr inline\"\u003eoaepHash\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;sha256\u0026#x27;\u003c/span\u003e,\n      },\n      buffer\n    );\n\n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e encrypted.\u003cspan class=\"hljs-title function_ inline\"\u003etoString\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;base64\u0026#x27;\u003c/span\u003e);\n  } \u003cspan class=\"hljs-keyword inline\"\u003ecatch\u003c/span\u003e (error) {\n    \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`RSA encryption failed: \u003cspan class=\"hljs-subst inline\"\u003e${error.message}\u003c/span\u003e`\u003c/span\u003e);\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003eOAEP参数解析\u003c/strong\u003e：\u003c/p\u003e\n\u003col class=\"list-decimal list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003epadding: RSA_PKCS1_OAEP_PADDING\u003c/strong\u003e：使用OAEP填充方案\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003eoaepHash: ‘sha256’\u003c/strong\u003e：使用SHA-256作为哈希函数\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e输出格式\u003c/strong\u003e：Base64编码便于传输\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e为什么混合使用jsrsasign和crypto？\u003c/strong\u003e\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003ejsrsasign\u003c/strong\u003e：密钥生成和管理\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003ecrypto\u003c/strong\u003e：加密解密操作（性能更好）\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"前端rsa加密实现深度剖析\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#前端rsa加密实现深度剖析\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 前端RSA加密实现深度剖析\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            前端RSA加密实现深度剖析\n        \u003c/h2\u003e\n\u003ch3 id=\"web-crypto-api的使用\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#web-crypto-api的使用\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to Web Crypto API的使用\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            Web Crypto API的使用\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"%2F%2F%20%E4%BD%BF%E7%94%A8RSA-OAEP%E8%BF%9B%E8%A1%8C%E5%8A%A0%E5%AF%86%EF%BC%88%E4%B8%8E%E5%90%8E%E7%AB%AF%E5%85%BC%E5%AE%B9%EF%BC%89%0Aasync%20encrypt(plaintext%3A%20string)%3A%20Promisestring%3E%20%7B%0Aif%20(!this.publicKey)%20%7B%0Athrow%20new%20Error('Public%20key%20not%20set.%20Call%20setPublicKey()%20first.')%3B%0A%7D%0Aif%20(!plaintext%20%7C%7C%20typeof%20plaintext%20!%3D%3D%20'string')%20%7B%0Athrow%20new%20Error('Invalid%20plaintext%20for%20encryption')%3B%0A%7D%0Atry%20%7B%0A%2F%2F%20%E4%BD%BF%E7%94%A8Web%20Crypto%20API%E8%BF%9B%E8%A1%8CRSA-OAEP%E5%8A%A0%E5%AF%86%0A%2F%2F%20%E9%A6%96%E5%85%88%EF%BC%8C%E5%AF%BC%E5%85%A5%E5%85%AC%E9%92%A5%0Aconst%20publicKeyBuffer%20%3D%20this.pemToArrayBuffer(this.publicKey)%3B%0Aconst%20cryptoKey%20%3D%20await%20window.crypto.subtle.importKey(%0A'spki'%2C%0ApublicKeyBuffer%2C%0A%7B%0Aname%3A%20'RSA-OAEP'%2C%0Ahash%3A%20'SHA-256'%2C%0A%7D%2C%0Afalse%2C%0A%5B'encrypt'%5D%0A)%3B%0A%2F%2F%20%E5%8A%A0%E5%AF%86%E6%98%8E%E6%96%87%0Aconst%20plaintextBuffer%20%3D%20new%20TextEncoder().encode(plaintext)%3B%0Aconst%20encryptedBuffer%20%3D%20await%20window.crypto.subtle.encrypt(%0A%7B%0Aname%3A%20'RSA-OAEP'%2C%0A%7D%2C%0AcryptoKey%2C%0AplaintextBuffer%0A)%3B%0A%2F%2F%20%E8%BD%AC%E4%B8%BAbase64%E4%BB%A5%E5%8C%B9%E9%85%8D%E5%90%8E%E7%AB%AF%E6%A0%BC%E5%BC%8F%0Areturn%20this.arrayBufferToBase64(encryptedBuffer)%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60RSA%20encryption%20failed%3A%20%24%7Berror%20instanceof%20Error%20%3F%20error.message%20%3A%20'Unknown%20error'%7D%60)%3B%0A%7D%0A%7D\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 使用RSA-OAEP进行加密（与后端兼容）\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003eencrypt\u003c/span\u003e(\u003cspan class=\"hljs-attr inline\"\u003eplaintext\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e): \u003cspan class=\"hljs-title class_ inline\"\u003ePromise\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e\u0026gt; {\n  \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!\u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epublicKey\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;Public key not set. Call setPublicKey() first.\u0026#x27;\u003c/span\u003e);\n  }\n\n  \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!plaintext || \u003cspan class=\"hljs-keyword inline\"\u003etypeof\u003c/span\u003e plaintext !== \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;string\u0026#x27;\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;Invalid plaintext for encryption\u0026#x27;\u003c/span\u003e);\n  }\n\n  \u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment inline\"\u003e// 使用Web Crypto API进行RSA-OAEP加密\u003c/span\u003e\n    \u003cspan class=\"hljs-comment inline\"\u003e// 首先，导入公钥\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e publicKeyBuffer = \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003epemToArrayBuffer\u003c/span\u003e(\u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epublicKey\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e cryptoKey = \u003cspan class=\"hljs-keyword inline\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-variable language_ inline\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003ecrypto\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003esubtle\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eimportKey\u003c/span\u003e(\n      \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;spki\u0026#x27;\u003c/span\u003e,\n      publicKeyBuffer,\n      {\n        \u003cspan class=\"hljs-attr inline\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;RSA-OAEP\u0026#x27;\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr inline\"\u003ehash\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;SHA-256\u0026#x27;\u003c/span\u003e,\n      },\n      \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e,\n      [\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;encrypt\u0026#x27;\u003c/span\u003e]\n    );\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 加密明文\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e plaintextBuffer = \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eTextEncoder\u003c/span\u003e().\u003cspan class=\"hljs-title function_ inline\"\u003eencode\u003c/span\u003e(plaintext);\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e encryptedBuffer = \u003cspan class=\"hljs-keyword inline\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-variable language_ inline\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003ecrypto\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003esubtle\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eencrypt\u003c/span\u003e(\n      {\n        \u003cspan class=\"hljs-attr inline\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;RSA-OAEP\u0026#x27;\u003c/span\u003e,\n      },\n      cryptoKey,\n      plaintextBuffer\n    );\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 转为base64以匹配后端格式\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003earrayBufferToBase64\u003c/span\u003e(encryptedBuffer);\n  } \u003cspan class=\"hljs-keyword inline\"\u003ecatch\u003c/span\u003e (error) {\n    \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`RSA encryption failed: \u003cspan class=\"hljs-subst inline\"\u003e${error \u003cspan class=\"hljs-keyword inline\"\u003einstanceof\u003c/span\u003e \u003cspan class=\"hljs-built_in inline\"\u003eError\u003c/span\u003e ? error.message : \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;Unknown error\u0026#x27;\u003c/span\u003e}\u003c/span\u003e`\u003c/span\u003e);\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch3 id=\"pem格式密钥的处理\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#pem格式密钥的处理\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to PEM格式密钥的处理\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            PEM格式密钥的处理\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"%2F%2F%20%E8%BE%85%E5%8A%A9%E6%96%B9%E6%B3%95%EF%BC%9A%E5%B0%86PEM%E6%A0%BC%E5%BC%8F%E8%BD%AC%E6%8D%A2%E4%B8%BAArrayBuffer%0Aprivate%20pemToArrayBuffer(pem%3A%20string)%3A%20ArrayBuffer%20%7B%0A%2F%2F%20%E7%A7%BB%E9%99%A4%E5%A4%B4%E9%83%A8%E5%92%8C%E5%B0%BE%E9%83%A8%0Aconst%20pemHeader%20%3D%20'-----BEGIN%20PUBLIC%20KEY-----'%3B%0Aconst%20pemFooter%20%3D%20'-----END%20PUBLIC%20KEY-----'%3B%0Aconst%20pemContents%20%3D%20pem.replace(pemHeader%2C%20'').replace(pemFooter%2C%20'').replace(%2F%5Cs%2Fg%2C%20'')%3B%0A%2F%2F%20base64%E8%A7%A3%E7%A0%81%E4%B8%BA%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AD%97%E7%AC%A6%E4%B8%B2%0Aconst%20binaryString%20%3D%20atob(pemContents)%3B%0A%2F%2F%20%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%ACArrayBuffer%0Aconst%20bytes%20%3D%20new%20Uint8Array(binaryString.length)%3B%0Afor%20(let%20i%20%3D%200%3B%20i%20length%3B%20i%2B%2B)%20%7B%0Abytes%5Bi%5D%20%3D%20binaryString.charCodeAt(i)%3B%0A%7D%0Areturn%20bytes.buffer%3B%0A%7D\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 辅助方法：将PEM格式转换为ArrayBuffer\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003eprivate\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003epemToArrayBuffer\u003c/span\u003e(\u003cspan class=\"hljs-attr inline\"\u003epem\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e): \u003cspan class=\"hljs-title class_ inline\"\u003eArrayBuffer\u003c/span\u003e {\n  \u003cspan class=\"hljs-comment inline\"\u003e// 移除头部和尾部\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e pemHeader = \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;-----BEGIN PUBLIC KEY-----\u0026#x27;\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e pemFooter = \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;-----END PUBLIC KEY-----\u0026#x27;\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e pemContents = pem.\u003cspan class=\"hljs-title function_ inline\"\u003ereplace\u003c/span\u003e(pemHeader, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e).\u003cspan class=\"hljs-title function_ inline\"\u003ereplace\u003c/span\u003e(pemFooter, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e).\u003cspan class=\"hljs-title function_ inline\"\u003ereplace\u003c/span\u003e(\u003cspan class=\"hljs-regexp inline\"\u003e/\\s/g\u003c/span\u003e, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-comment inline\"\u003e// base64解码为二进制字符串\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e binaryString = \u003cspan class=\"hljs-title function_ inline\"\u003eatob\u003c/span\u003e(pemContents);\n\n  \u003cspan class=\"hljs-comment inline\"\u003e// 二进制字符串转ArrayBuffer\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e bytes = \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eUint8Array\u003c/span\u003e(binaryString.\u003cspan class=\"hljs-property inline\"\u003elength\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword inline\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword inline\"\u003elet\u003c/span\u003e i = \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e; i \u0026lt; binaryString.\u003cspan class=\"hljs-property inline\"\u003elength\u003c/span\u003e; i++) {\n    bytes[i] = binaryString.\u003cspan class=\"hljs-title function_ inline\"\u003echarCodeAt\u003c/span\u003e(i);\n  }\n\n  \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e bytes.\u003cspan class=\"hljs-property inline\"\u003ebuffer\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003ePEM格式解析\u003c/strong\u003e：\u003c/p\u003e\n\u003col class=\"list-decimal list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e头尾去除\u003c/strong\u003e：移除PEM格式的标识头\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e空白清理\u003c/strong\u003e：去除所有空白字符\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003eBase64解码\u003c/strong\u003e：将Base64字符串转换为二进制\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003eArrayBuffer转换\u003c/strong\u003e：转换为Web Crypto API需要的格式\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"arraybuffer和base64的转换\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#arraybuffer和base64的转换\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to ArrayBuffer和Base64的转换\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            ArrayBuffer和Base64的转换\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"%2F%2F%20%E8%BE%85%E5%8A%A9%E6%96%B9%E6%B3%95%EF%BC%9A%E5%B0%86ArrayBuffer%E8%BD%AC%E6%8D%A2%E4%B8%BAbase64%0Aprivate%20arrayBufferToBase64(buffer%3A%20ArrayBuffer)%3A%20string%20%7B%0Aconst%20bytes%20%3D%20new%20Uint8Array(buffer)%3B%0Alet%20binary%20%3D%20''%3B%0Afor%20(let%20i%20%3D%200%3B%20i%20byteLength%3B%20i%2B%2B)%20%7B%0Abinary%20%2B%3D%20String.fromCharCode(bytes%5Bi%5D)%3B%0A%7D%0Areturn%20btoa(binary)%3B%0A%7D\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 辅助方法：将ArrayBuffer转换为base64\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003eprivate\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003earrayBufferToBase64\u003c/span\u003e(\u003cspan class=\"hljs-attr inline\"\u003ebuffer\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eArrayBuffer\u003c/span\u003e): \u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e bytes = \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eUint8Array\u003c/span\u003e(buffer);\n  \u003cspan class=\"hljs-keyword inline\"\u003elet\u003c/span\u003e binary = \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword inline\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword inline\"\u003elet\u003c/span\u003e i = \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e; i \u0026lt; bytes.\u003cspan class=\"hljs-property inline\"\u003ebyteLength\u003c/span\u003e; i++) {\n    binary += \u003cspan class=\"hljs-title class_ inline\"\u003eString\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003efromCharCode\u003c/span\u003e(bytes[i]);\n  }\n  \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003ebtoa\u003c/span\u003e(binary);\n}\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e数据转换\u003c/strong\u003e：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"\" data-code=\"%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5(String)%20%E2%86%92%20TextEncoder%20%E2%86%92%20ArrayBuffer%20%E2%86%92%20Web%20Crypto%20API%20%E2%86%92%20ArrayBuffer%20%E2%86%92%20Base64%20%E2%86%92%20%E7%BD%91%E7%BB%9C%E4%BC%A0%E8%BE%93\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ecode\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode\u003e用户输入(\u003cspan class=\"hljs-built_in inline\"\u003eString\u003c/span\u003e) → TextEncoder → \u003cspan class=\"hljs-built_in inline\"\u003eArrayBuffer\u003c/span\u003e → Web Crypto API → \u003cspan class=\"hljs-built_in inline\"\u003eArrayBuffer\u003c/span\u003e → Base64 → 网络传输\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e转换步骤解释：\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003eTextEncoder\u003c/strong\u003e：将字符串转换为UTF-8字节\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003eArrayBuffer\u003c/strong\u003e：Web Crypto API的标准格式\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003eBase64\u003c/strong\u003e：网络传输的安全编码\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e降级策略\u003c/strong\u003e：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"%2F%2F%20%E6%A3%80%E6%9F%A5Web%20Crypto%20API%E6%94%AF%E6%8C%81%0Aif%20(!window.crypto%20%7C%7C%20!window.crypto.subtle)%20%7B%0A%2F%2F%20%E9%99%8D%E7%BA%A7%E5%88%B0jsrsasign%E5%AE%9E%E7%8E%B0%0Areturn%20this.jsrsasignEncrypt(plaintext)%3B%0A%7D\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 检查Web Crypto API支持\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!\u003cspan class=\"hljs-variable language_ inline\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003ecrypto\u003c/span\u003e || !\u003cspan class=\"hljs-variable language_ inline\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003ecrypto\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003esubtle\u003c/span\u003e) {\n  \u003cspan class=\"hljs-comment inline\"\u003e// 降级到jsrsasign实现\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003ejsrsasignEncrypt\u003c/span\u003e(plaintext);\n}\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch2 id=\"api密钥更新流程的完整实现\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#api密钥更新流程的完整实现\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to API密钥更新流程的完整实现\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            API密钥更新流程的完整实现\n        \u003c/h2\u003e\n\u003ch3 id=\"updateapikey接口的设计思路\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#updateapikey接口的设计思路\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to updateApiKey接口的设计思路\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            updateApiKey接口的设计思路\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"%2F%2F%20%40desc%20%20%20%20%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7API%E5%AF%86%E9%92%A5%0A%2F%2F%20%40route%20%20%20PUT%20%2Fapi%2Fauth%2Fapi-key%0A%2F%2F%20%40access%20%20Private%0Aexports.updateApiKey%20%3D%20async%20(req%2C%20res)%20%3D%3E%20%7B%0Atry%20%7B%0Aconst%20%7B%20apiKey%2C%20useCustomApiKey%20%7D%20%3D%20req.body%3B%0A%2F%2F%20%E6%A0%A1%E9%AA%8C%E8%BE%93%E5%85%A5%EF%BC%8C%E4%BB%85%E5%BD%93useCustomApiKey%E4%B8%BAtrue%E4%B8%94apiKey%E6%9C%89%E5%80%BC%E6%97%B6%E6%89%8D%E8%A6%81%E6%B1%82apiKey%0A%2F%2F%20%E5%85%81%E8%AE%B8useCustomApiKey%E4%B8%BAtrue%E4%BD%86apiKey%E4%B8%BA%E7%A9%BA%EF%BC%88%E7%94%A8%E6%88%B7%E6%89%93%E7%AE%97%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BD%86%E8%BF%98%E6%9C%AA%E8%BE%93%E5%85%A5%EF%BC%89%0Aif%20(useCustomApiKey%20%26%26%20apiKey%20%26%26%20apiKey.trim().length%20%3D%3D%3D%200)%20%7B%0Areturn%20res.status(400).json(%7B%0Asuccess%3A%20false%2C%0Amessage%3A%20req.t('auth.apiKeyRequired')%0A%7D)%3B%0A%7D%0Aconst%20user%20%3D%20await%20User.findById(req.user.id)%3B%0Aif%20(!user)%20%7B%0Areturn%20res.status(404).json(%7B%0Asuccess%3A%20false%2C%0Amessage%3A%20req.t('auth.userNotFound')%0A%7D)%3B%0A%7D%0A%2F%2F%20%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7API%E5%AF%86%E9%92%A5%E8%AE%BE%E7%BD%AE%0Aif%20(useCustomApiKey)%20%7B%0A%2F%2F%20%E5%A6%82%E6%9E%9CapiKey%E6%9C%89%E5%80%BC%E4%B8%94%E9%9D%9E%E7%A9%BA%EF%BC%8C%E7%9B%B4%E6%8E%A5%E5%AD%98%E5%82%A8%E5%89%8D%E7%AB%AF%E5%8A%A0%E5%AF%86%E5%90%8E%E7%9A%84API%E5%AF%86%E9%92%A5%0A%2F%2F%20%E5%89%8D%E7%AB%AF%E5%8F%91%E9%80%81%E5%B8%A6%E6%9C%89'rsa%3A'%E5%89%8D%E7%BC%80%E7%9A%84RSA%E5%8A%A0%E5%AF%86API%E5%AF%86%E9%92%A5%E2%80%94%E2%80%94%E6%AD%A4%E5%A4%84%E4%B8%8D%E5%81%9A%E8%A7%A3%E5%AF%86%0Aif%20(apiKey%20%26%26%20apiKey.trim().length%20%3E%200)%20%7B%0Auser.apiKey%20%3D%20apiKey.trim()%3B%20%2F%2F%20%E7%9B%B4%E6%8E%A5%E5%AD%98%E5%82%A8%E5%8A%A0%E5%AF%86%E6%95%B0%E6%8D%AE%0A%7D%20else%20%7B%0Auser.apiKey%20%3D%20undefined%3B%0A%7D%0Auser.useCustomApiKey%20%3D%20true%3B%0A%7D%20else%20%7B%0Auser.apiKey%20%3D%20undefined%3B%0Auser.useCustomApiKey%20%3D%20false%3B%0A%7D%0Aawait%20user.save()%3B%0Ares.status(200).json(%7B%0Asuccess%3A%20true%2C%0Amessage%3A%20req.t('auth.apiKeyUpdatedSuccessfully')%2C%0AuseCustomApiKey%3A%20user.useCustomApiKey%0A%7D)%3B%0A%7D%20catch%20(error)%20%7B%0Ares.status(500).json(%7B%0Asuccess%3A%20false%2C%0Amessage%3A%20req.t('auth.serverError')%0A%7D)%3B%0A%7D%0A%7D%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// @desc    更新用户API密钥\u003c/span\u003e\n\u003cspan class=\"hljs-comment inline\"\u003e// @route   PUT /api/auth/api-key\u003c/span\u003e\n\u003cspan class=\"hljs-comment inline\"\u003e// @access  Private\u003c/span\u003e\n\u003cspan class=\"hljs-built_in inline\"\u003eexports\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eupdateApiKey\u003c/span\u003e = \u003cspan class=\"hljs-title function_ inline\"\u003easync\u003c/span\u003e (req, res) =\u0026gt; {\n  \u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e { apiKey, useCustomApiKey } = req.\u003cspan class=\"hljs-property inline\"\u003ebody\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 校验输入，仅当useCustomApiKey为true且apiKey有值时才要求apiKey\u003c/span\u003e\n    \u003cspan class=\"hljs-comment inline\"\u003e// 允许useCustomApiKey为true但apiKey为空（用户打算自定义但还未输入）\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (useCustomApiKey \u0026amp;\u0026amp; apiKey \u0026amp;\u0026amp; apiKey.\u003cspan class=\"hljs-title function_ inline\"\u003etrim\u003c/span\u003e().\u003cspan class=\"hljs-property inline\"\u003elength\u003c/span\u003e === \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e) {\n      \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e res.\u003cspan class=\"hljs-title function_ inline\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number inline\"\u003e400\u003c/span\u003e).\u003cspan class=\"hljs-title function_ inline\"\u003ejson\u003c/span\u003e({\n        \u003cspan class=\"hljs-attr inline\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr inline\"\u003emessage\u003c/span\u003e: req.\u003cspan class=\"hljs-title function_ inline\"\u003et\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;auth.apiKeyRequired\u0026#x27;\u003c/span\u003e)\n      });\n    }\n\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e user = \u003cspan class=\"hljs-keyword inline\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eUser\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003efindById\u003c/span\u003e(req.\u003cspan class=\"hljs-property inline\"\u003euser\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eid\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!user) {\n      \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e res.\u003cspan class=\"hljs-title function_ inline\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number inline\"\u003e404\u003c/span\u003e).\u003cspan class=\"hljs-title function_ inline\"\u003ejson\u003c/span\u003e({\n        \u003cspan class=\"hljs-attr inline\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr inline\"\u003emessage\u003c/span\u003e: req.\u003cspan class=\"hljs-title function_ inline\"\u003et\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;auth.userNotFound\u0026#x27;\u003c/span\u003e)\n      });\n    }\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 更新用户API密钥设置\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (useCustomApiKey) {\n      \u003cspan class=\"hljs-comment inline\"\u003e// 如果apiKey有值且非空，直接存储前端加密后的API密钥\u003c/span\u003e\n      \u003cspan class=\"hljs-comment inline\"\u003e// 前端发送带有\u0026#x27;rsa:\u0026#x27;前缀的RSA加密API密钥——此处不做解密\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (apiKey \u0026amp;\u0026amp; apiKey.\u003cspan class=\"hljs-title function_ inline\"\u003etrim\u003c/span\u003e().\u003cspan class=\"hljs-property inline\"\u003elength\u003c/span\u003e \u0026gt; \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e) {\n        user.\u003cspan class=\"hljs-property inline\"\u003eapiKey\u003c/span\u003e = apiKey.\u003cspan class=\"hljs-title function_ inline\"\u003etrim\u003c/span\u003e(); \u003cspan class=\"hljs-comment inline\"\u003e// 直接存储加密数据\u003c/span\u003e\n      } \u003cspan class=\"hljs-keyword inline\"\u003eelse\u003c/span\u003e {\n        user.\u003cspan class=\"hljs-property inline\"\u003eapiKey\u003c/span\u003e = \u003cspan class=\"hljs-literal inline\"\u003eundefined\u003c/span\u003e;\n      }\n      user.\u003cspan class=\"hljs-property inline\"\u003euseCustomApiKey\u003c/span\u003e = \u003cspan class=\"hljs-literal inline\"\u003etrue\u003c/span\u003e;\n    } \u003cspan class=\"hljs-keyword inline\"\u003eelse\u003c/span\u003e {\n      user.\u003cspan class=\"hljs-property inline\"\u003eapiKey\u003c/span\u003e = \u003cspan class=\"hljs-literal inline\"\u003eundefined\u003c/span\u003e;\n      user.\u003cspan class=\"hljs-property inline\"\u003euseCustomApiKey\u003c/span\u003e = \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e;\n    }\n\n    \u003cspan class=\"hljs-keyword inline\"\u003eawait\u003c/span\u003e user.\u003cspan class=\"hljs-title function_ inline\"\u003esave\u003c/span\u003e();\n\n    res.\u003cspan class=\"hljs-title function_ inline\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number inline\"\u003e200\u003c/span\u003e).\u003cspan class=\"hljs-title function_ inline\"\u003ejson\u003c/span\u003e({\n      \u003cspan class=\"hljs-attr inline\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal inline\"\u003etrue\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr inline\"\u003emessage\u003c/span\u003e: req.\u003cspan class=\"hljs-title function_ inline\"\u003et\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;auth.apiKeyUpdatedSuccessfully\u0026#x27;\u003c/span\u003e),\n      \u003cspan class=\"hljs-attr inline\"\u003euseCustomApiKey\u003c/span\u003e: user.\u003cspan class=\"hljs-property inline\"\u003euseCustomApiKey\u003c/span\u003e\n    });\n  } \u003cspan class=\"hljs-keyword inline\"\u003ecatch\u003c/span\u003e (error) {\n    res.\u003cspan class=\"hljs-title function_ inline\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number inline\"\u003e500\u003c/span\u003e).\u003cspan class=\"hljs-title function_ inline\"\u003ejson\u003c/span\u003e({\n      \u003cspan class=\"hljs-attr inline\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr inline\"\u003emessage\u003c/span\u003e: req.\u003cspan class=\"hljs-title function_ inline\"\u003et\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;auth.serverError\u0026#x27;\u003c/span\u003e)\n    });\n  }\n};\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch3 id=\"前端加密-→-传输-→-后端解密的完整流程\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#前端加密-→-传输-→-后端解密的完整流程\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 前端加密 → 传输 → 后端解密的完整流程\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            前端加密 → 传输 → 后端解密的完整流程\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"const%20updateApiKey%20%3D%20async%20(apiKey%3A%20string%2C%20shouldUseCustomKey%3A%20boolean)%20%3D%3E%20%7B%0Aloading.value%20%3D%20true%0Atry%20%7B%0A%2F%2F%20%E5%8A%A0%E5%AF%86%E5%89%8D%E8%8E%B7%E5%8F%96%E6%9C%80%E6%96%B0%E5%85%AC%E9%92%A5%0Aif%20(shouldUseCustomKey%20%26%26%20apiKey)%20%7B%0Aconst%20keyResult%20%3D%20await%20fetchPublicKey()%0Aif%20(!keyResult.success)%20%7B%0Atoast.error(t('apiKey.publicKeyFetchFailed'))%0Areturn%20%7Bsuccess%3A%20false%2C%20message%3A%20t('apiKey.publicKeyFetchError')%7D%0A%7D%0A%7D%0A%2F%2F%20%E5%A6%82%E6%9E%9C%E6%9C%89%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AF%86%E9%92%A5%E4%B8%94%E6%9C%89apiKey%EF%BC%8C%E8%BF%9B%E8%A1%8C%E5%8A%A0%E5%AF%86%0Alet%20encryptedApiKey%20%3D%20''%0Aif%20(shouldUseCustomKey%20%26%26%20apiKey%20%26%26%20publicKey.value)%20%7B%0Atry%20%7B%0Aconst%20encrypted%20%3D%20await%20rsaCrypto.encrypt(apiKey)%0AencryptedApiKey%20%3D%20'rsa%3A'%20%2B%20encrypted%0A%7D%20catch%20(encryptError)%20%7B%0Atoast.error(t('apiKey.encryptionFailed'))%0Aconsole.error(encryptedApiKey)%0Areturn%20%7Bsuccess%3A%20false%2C%20message%3A%20t('apiKey.encryptionError')%7D%0A%7D%0A%7D%0Aconst%20response%20%3D%20await%20aiConfigAPI.updateApiKey(%7B%0AapiKey%3A%20shouldUseCustomKey%20%3F%20encryptedApiKey%20%3A%20''%2C%0AuseCustomApiKey%3A%20shouldUseCustomKey%0A%7D)%0Aif%20(response.data.success)%20%7B%0AuseCustomApiKey.value%20%3D%20response.data.useCustomApiKey%0AhasCustomApiKey.value%20%3D%20shouldUseCustomKey%20%26%26%20!!apiKey%0AcustomApiKey.value%20%3D%20apiKey%0Atoast.success(t('apiKey.updateSuccess'))%0Areturn%20%7Bsuccess%3A%20true%7D%0A%7D%20else%20%7B%0Aconst%20message%20%3D%20response.data.message%20%7C%7C%20t('common.error')%0Atoast.error(message)%0Areturn%20%7Bsuccess%3A%20false%2C%20message%7D%0A%7D%0A%7D%20catch%20(error%3A%20any)%20%7B%0Aconst%20message%20%3D%20error.response%3F.data%3F.message%20%7C%7C%20t('common.error')%0Atoast.error(message)%0Areturn%20%7Bsuccess%3A%20false%2C%20message%7D%0A%7D%20finally%20%7B%0Aloading.value%20%3D%20false%0A%7D%0A%7D\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003eupdateApiKey\u003c/span\u003e = \u003cspan class=\"hljs-keyword inline\"\u003easync\u003c/span\u003e (\u003cspan class=\"hljs-params inline\"\u003e\u003cspan class=\"hljs-attr inline\"\u003eapiKey\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e, \u003cspan class=\"hljs-attr inline\"\u003eshouldUseCustomKey\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003eboolean\u003c/span\u003e\u003c/span\u003e) =\u0026gt; {\n  loading.\u003cspan class=\"hljs-property inline\"\u003evalue\u003c/span\u003e = \u003cspan class=\"hljs-literal inline\"\u003etrue\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment inline\"\u003e// 加密前获取最新公钥\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (shouldUseCustomKey \u0026amp;\u0026amp; apiKey) {\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e keyResult = \u003cspan class=\"hljs-keyword inline\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003efetchPublicKey\u003c/span\u003e()\n      \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!keyResult.\u003cspan class=\"hljs-property inline\"\u003esuccess\u003c/span\u003e) {\n        toast.\u003cspan class=\"hljs-title function_ inline\"\u003eerror\u003c/span\u003e(\u003cspan class=\"hljs-title function_ inline\"\u003et\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;apiKey.publicKeyFetchFailed\u0026#x27;\u003c/span\u003e))\n        \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e {\u003cspan class=\"hljs-attr inline\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e, \u003cspan class=\"hljs-attr inline\"\u003emessage\u003c/span\u003e: \u003cspan class=\"hljs-title function_ inline\"\u003et\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;apiKey.publicKeyFetchError\u0026#x27;\u003c/span\u003e)}\n      }\n    }\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 如果有自定义密钥且有apiKey，进行加密\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003elet\u003c/span\u003e encryptedApiKey = \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (shouldUseCustomKey \u0026amp;\u0026amp; apiKey \u0026amp;\u0026amp; publicKey.\u003cspan class=\"hljs-property inline\"\u003evalue\u003c/span\u003e) {\n      \u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e encrypted = \u003cspan class=\"hljs-keyword inline\"\u003eawait\u003c/span\u003e rsaCrypto.\u003cspan class=\"hljs-title function_ inline\"\u003eencrypt\u003c/span\u003e(apiKey)\n        encryptedApiKey = \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;rsa:\u0026#x27;\u003c/span\u003e + encrypted\n      } \u003cspan class=\"hljs-keyword inline\"\u003ecatch\u003c/span\u003e (encryptError) {\n        toast.\u003cspan class=\"hljs-title function_ inline\"\u003eerror\u003c/span\u003e(\u003cspan class=\"hljs-title function_ inline\"\u003et\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;apiKey.encryptionFailed\u0026#x27;\u003c/span\u003e))\n        \u003cspan class=\"hljs-variable language_ inline\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eerror\u003c/span\u003e(encryptedApiKey)\n        \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e {\u003cspan class=\"hljs-attr inline\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e, \u003cspan class=\"hljs-attr inline\"\u003emessage\u003c/span\u003e: \u003cspan class=\"hljs-title function_ inline\"\u003et\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;apiKey.encryptionError\u0026#x27;\u003c/span\u003e)}\n      }\n    }\n\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e response = \u003cspan class=\"hljs-keyword inline\"\u003eawait\u003c/span\u003e aiConfigAPI.\u003cspan class=\"hljs-title function_ inline\"\u003eupdateApiKey\u003c/span\u003e({\n      \u003cspan class=\"hljs-attr inline\"\u003eapiKey\u003c/span\u003e: shouldUseCustomKey ? encryptedApiKey : \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr inline\"\u003euseCustomApiKey\u003c/span\u003e: shouldUseCustomKey\n    })\n\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (response.\u003cspan class=\"hljs-property inline\"\u003edata\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003esuccess\u003c/span\u003e) {\n      useCustomApiKey.\u003cspan class=\"hljs-property inline\"\u003evalue\u003c/span\u003e = response.\u003cspan class=\"hljs-property inline\"\u003edata\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003euseCustomApiKey\u003c/span\u003e\n      hasCustomApiKey.\u003cspan class=\"hljs-property inline\"\u003evalue\u003c/span\u003e = shouldUseCustomKey \u0026amp;\u0026amp; !!apiKey\n      customApiKey.\u003cspan class=\"hljs-property inline\"\u003evalue\u003c/span\u003e = apiKey\n      toast.\u003cspan class=\"hljs-title function_ inline\"\u003esuccess\u003c/span\u003e(\u003cspan class=\"hljs-title function_ inline\"\u003et\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;apiKey.updateSuccess\u0026#x27;\u003c/span\u003e))\n      \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e {\u003cspan class=\"hljs-attr inline\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal inline\"\u003etrue\u003c/span\u003e}\n    } \u003cspan class=\"hljs-keyword inline\"\u003eelse\u003c/span\u003e {\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e message = response.\u003cspan class=\"hljs-property inline\"\u003edata\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003emessage\u003c/span\u003e || \u003cspan class=\"hljs-title function_ inline\"\u003et\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;common.error\u0026#x27;\u003c/span\u003e)\n      toast.\u003cspan class=\"hljs-title function_ inline\"\u003eerror\u003c/span\u003e(message)\n      \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e {\u003cspan class=\"hljs-attr inline\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e, message}\n    }\n  } \u003cspan class=\"hljs-keyword inline\"\u003ecatch\u003c/span\u003e (\u003cspan class=\"hljs-attr inline\"\u003eerror\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003eany\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e message = error.\u003cspan class=\"hljs-property inline\"\u003eresponse\u003c/span\u003e?.\u003cspan class=\"hljs-property inline\"\u003edata\u003c/span\u003e?.\u003cspan class=\"hljs-property inline\"\u003emessage\u003c/span\u003e || \u003cspan class=\"hljs-title function_ inline\"\u003et\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;common.error\u0026#x27;\u003c/span\u003e)\n    toast.\u003cspan class=\"hljs-title function_ inline\"\u003eerror\u003c/span\u003e(message)\n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e {\u003cspan class=\"hljs-attr inline\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e, message}\n  } \u003cspan class=\"hljs-keyword inline\"\u003efinally\u003c/span\u003e {\n    loading.\u003cspan class=\"hljs-property inline\"\u003evalue\u003c/span\u003e = \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e完整流程的数据变化\u003c/strong\u003e：\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e更新API密钥时\u003c/strong\u003e：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"\" data-code=\"%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%3A%20%22sk-1234567890abcdef%22%0A%E2%86%93%0A%E5%89%8D%E7%AB%AF%E5%8A%A0%E5%AF%86%3A%20%22rsa%3ABase64EncryptedData...%22%0A%E2%86%93%0AHTTPS%E4%BC%A0%E8%BE%93%3A%20%5BTLS%E5%8A%A0%E5%AF%86%E7%9A%84RSA%E5%8A%A0%E5%AF%86%E6%95%B0%E6%8D%AE%5D%0A%E2%86%93%0A%E5%90%8E%E7%AB%AF%E6%8E%A5%E6%94%B6%3A%20%22rsa%3ABase64EncryptedData...%22%0A%E2%86%93%0A%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%98%E5%82%A8%3A%20%22rsa%3ABase64EncryptedData...%22%20(%E7%9B%B4%E6%8E%A5%E5%AD%98%E5%82%A8%E5%AF%86%E6%96%87)\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ecode\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-section inline\"\u003e用户输入: \u0026quot;sk-1234567890abcdef\u0026quot;\u003c/span\u003e\n  ↓\n\u003cspan class=\"hljs-section inline\"\u003e前端加密: \u0026quot;rsa:Base64EncryptedData...\u0026quot;\u003c/span\u003e\n  ↓\n\u003cspan class=\"hljs-section inline\"\u003eHTTPS传输: [TLS加密的RSA加密数据]\u003c/span\u003e\n  ↓\n\u003cspan class=\"hljs-section inline\"\u003e后端接收: \u0026quot;rsa:Base64EncryptedData...\u0026quot;\u003c/span\u003e\n  ↓\n\u003cspan class=\"hljs-section inline\"\u003e数据库存储: \u0026quot;rsa:Base64EncryptedData...\u0026quot; (直接存储密文)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e使用API密钥调用模型时\u003c/strong\u003e：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"\" data-code=\"%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E5%8F%96%3A%20%22rsa%3ABase64EncryptedData...%22%0A%E2%86%93%0A%E4%B8%B4%E6%97%B6%E8%A7%A3%E5%AF%86%3A%20%22sk-1234567890abcdef%22%0A%E2%86%93%0A%E8%B0%83%E7%94%A8%E5%A4%A7%E6%A8%A1%E5%9E%8BAPI%3A%20%E4%BD%BF%E7%94%A8%E6%98%8E%E6%96%87%E5%AF%86%E9%92%A5%0A%E2%86%93%0A%E8%A7%A3%E5%AF%86%E5%90%8E%E7%AB%8B%E5%8D%B3%E6%B8%85%E7%90%86%3A%20%E6%98%8E%E6%96%87%E5%AF%86%E9%92%A5%E4%BB%8E%E5%86%85%E5%AD%98%E9%94%80%E6%AF%81\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ecode\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-section inline\"\u003e数据库读取: \u0026quot;rsa:Base64EncryptedData...\u0026quot;\u003c/span\u003e\n  ↓\n\u003cspan class=\"hljs-section inline\"\u003e临时解密: \u0026quot;sk-1234567890abcdef\u0026quot;\u003c/span\u003e\n  ↓\n\u003cspan class=\"hljs-section inline\"\u003e调用大模型API: 使用明文密钥\u003c/span\u003e\n  ↓\n\u003cspan class=\"hljs-section inline\"\u003e解密后立即清理: 明文密钥从内存销毁\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch3 id=\"错误处理和用户体验优化\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#错误处理和用户体验优化\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 错误处理和用户体验优化\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            错误处理和用户体验优化\n        \u003c/h3\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e多层错误处理\u003c/strong\u003e：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"%2F%2F%20%E5%B1%82%E7%BA%A71%EF%BC%9A%E5%8A%A0%E5%AF%86%E5%A4%B1%E8%B4%A5%0Atry%20%7B%0Aconst%20encrypted%20%3D%20await%20rsaCrypto.encrypt(apiKey)%0AencryptedApiKey%20%3D%20'rsa%3A'%20%2B%20encrypted%0A%7D%20catch%20(encryptError)%20%7B%0Atoast.error(t('apiKey.encryptionFailed'))%0Areturn%20%7Bsuccess%3A%20false%2C%20message%3A%20t('apiKey.encryptionError')%7D%0A%7D%0A%2F%2F%20%E5%B1%82%E7%BA%A72%EF%BC%9A%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%A4%B1%E8%B4%A5%0Atry%20%7B%0Aconst%20response%20%3D%20await%20aiConfigAPI.updateApiKey(%7B...%7D)%0A%7D%20catch%20(error%3A%20any)%20%7B%0Aconst%20message%20%3D%20error.response%3F.data%3F.message%20%7C%7C%20t('common.error')%0Atoast.error(message)%0Areturn%20%7Bsuccess%3A%20false%2C%20message%7D%0A%7D\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 层级1：加密失败\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e encrypted = \u003cspan class=\"hljs-keyword inline\"\u003eawait\u003c/span\u003e rsaCrypto.\u003cspan class=\"hljs-title function_ inline\"\u003eencrypt\u003c/span\u003e(apiKey)\n  encryptedApiKey = \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;rsa:\u0026#x27;\u003c/span\u003e + encrypted\n} \u003cspan class=\"hljs-keyword inline\"\u003ecatch\u003c/span\u003e (encryptError) {\n  toast.\u003cspan class=\"hljs-title function_ inline\"\u003eerror\u003c/span\u003e(\u003cspan class=\"hljs-title function_ inline\"\u003et\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;apiKey.encryptionFailed\u0026#x27;\u003c/span\u003e))\n  \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e {\u003cspan class=\"hljs-attr inline\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e, \u003cspan class=\"hljs-attr inline\"\u003emessage\u003c/span\u003e: \u003cspan class=\"hljs-title function_ inline\"\u003et\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;apiKey.encryptionError\u0026#x27;\u003c/span\u003e)}\n}\n\n\u003cspan class=\"hljs-comment inline\"\u003e// 层级2：网络请求失败\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e response = \u003cspan class=\"hljs-keyword inline\"\u003eawait\u003c/span\u003e aiConfigAPI.\u003cspan class=\"hljs-title function_ inline\"\u003eupdateApiKey\u003c/span\u003e({...})\n} \u003cspan class=\"hljs-keyword inline\"\u003ecatch\u003c/span\u003e (\u003cspan class=\"hljs-attr inline\"\u003eerror\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003eany\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e message = error.\u003cspan class=\"hljs-property inline\"\u003eresponse\u003c/span\u003e?.\u003cspan class=\"hljs-property inline\"\u003edata\u003c/span\u003e?.\u003cspan class=\"hljs-property inline\"\u003emessage\u003c/span\u003e || \u003cspan class=\"hljs-title function_ inline\"\u003et\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;common.error\u0026#x27;\u003c/span\u003e)\n  toast.\u003cspan class=\"hljs-title function_ inline\"\u003eerror\u003c/span\u003e(message)\n  \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e {\u003cspan class=\"hljs-attr inline\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e, message}\n}\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch2 id=\"数据存储与解密策略\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#数据存储与解密策略\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 数据存储与解密策略\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            数据存储与解密策略\n        \u003c/h2\u003e\n\u003ch3 id=\"加密数据的数据库存储格式\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#加密数据的数据库存储格式\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 加密数据的数据库存储格式\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            加密数据的数据库存储格式\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"%2F%2F%20%E8%87%AA%E5%AE%9A%E4%B9%89API%E5%AF%86%E9%92%A5%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%8C%E6%9C%AA%E8%AE%BE%E7%BD%AE%E6%97%B6%E4%BD%BF%E7%94%A8%E5%B9%B3%E5%8F%B0%E9%BB%98%E8%AE%A4%EF%BC%89%0A%2F%2F%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%98%E5%82%A8%E4%B8%BA%E5%8A%A0%E5%AF%86%E5%BD%A2%E5%BC%8F%0AapiKey%3A%20%7B%0Atype%3A%20String%2C%0Arequired%3A%20false%2C%0Atrim%3A%20true%0A%7D%2C%0A%2F%2F%20%E6%98%AF%E5%90%A6%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89API%E5%AF%86%E9%92%A5%0AuseCustomApiKey%3A%20%7B%0Atype%3A%20Boolean%2C%0Adefault%3A%20false%0A%7D%2C\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 自定义API密钥（可选，未设置时使用平台默认）\u003c/span\u003e\n\u003cspan class=\"hljs-comment inline\"\u003e// 数据库存储为加密形式\u003c/span\u003e\n\u003cspan class=\"hljs-attr inline\"\u003eapiKey\u003c/span\u003e: {\n  \u003cspan class=\"hljs-attr inline\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eString\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr inline\"\u003erequired\u003c/span\u003e: \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr inline\"\u003etrim\u003c/span\u003e: \u003cspan class=\"hljs-literal inline\"\u003etrue\u003c/span\u003e\n},\n\u003cspan class=\"hljs-comment inline\"\u003e// 是否使用自定义API密钥\u003c/span\u003e\n\u003cspan class=\"hljs-attr inline\"\u003euseCustomApiKey\u003c/span\u003e: {\n  \u003cspan class=\"hljs-attr inline\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eBoolean\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr inline\"\u003edefault\u003c/span\u003e: \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e\n},\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e数据库存储的数据格式\u003c/strong\u003e：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"%2F%2F%20%E7%94%A8%E6%88%B7%E6%96%87%E6%A1%A3%E7%A4%BA%E4%BE%8B%0A%7B%0A_id%3A%20ObjectId(%22...%22)%2C%0Ausername%3A%20%22testuser%22%2C%0Aemail%3A%20%22test%40example.com%22%2C%0AapiKey%3A%20%22rsa%3ABase64EncodedEncryptedData...%22%2C%20%20%2F%2F%20%E5%8A%A0%E5%AF%86%E5%AD%98%E5%82%A8%0AuseCustomApiKey%3A%20true%2C%0A%2F%2F%20...%20%E5%85%B6%E4%BB%96%E5%AD%97%E6%AE%B5%0A%7D\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 用户文档示例\u003c/span\u003e\n{\n  \u003cspan class=\"hljs-attr inline\"\u003e_id\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eObjectId\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026quot;...\u0026quot;\u003c/span\u003e),\n  \u003cspan class=\"hljs-attr inline\"\u003eusername\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026quot;testuser\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr inline\"\u003eemail\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026quot;test@example.com\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr inline\"\u003eapiKey\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026quot;rsa:Base64EncodedEncryptedData...\u0026quot;\u003c/span\u003e,  \u003cspan class=\"hljs-comment inline\"\u003e// 加密存储\u003c/span\u003e\n  \u003cspan class=\"hljs-attr inline\"\u003euseCustomApiKey\u003c/span\u003e: \u003cspan class=\"hljs-literal inline\"\u003etrue\u003c/span\u003e,\n  \u003cspan class=\"hljs-comment inline\"\u003e// ... 其他字段\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch3 id=\"rsa前缀的标识机制\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#rsa前缀的标识机制\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to rsa:前缀的标识机制\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            rsa:前缀的标识机制\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"%2F%2F%20%E4%BD%BF%E7%94%A8RSA%E8%A7%A3%E5%AF%86API%E5%AF%86%E9%92%A5%E7%9A%84%E6%96%B9%E6%B3%95%0AuserSchema.methods.decryptApiKey%20%3D%20function(encryptedKey%20%3D%20null)%20%7B%0Atry%20%7B%0Aconst%20keyToDecrypt%20%3D%20encryptedKey%20%7C%7C%20this.apiKey%3B%0Aif%20(!keyToDecrypt)%20%7B%0Areturn%20null%3B%0A%7D%0A%2F%2F%20%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E4%B8%BARSA%E5%8A%A0%E5%AF%86%EF%BC%88%E5%89%8D%E7%AB%AF%E4%BC%A0%E6%9D%A5%E7%9A%84base64%E6%A0%BC%E5%BC%8F%EF%BC%89%0Aif%20(keyToDecrypt.startsWith('rsa%3A'))%20%7B%0Aconst%20encryptedData%20%3D%20keyToDecrypt.substring(4)%3B%0Areturn%20decrypt(encryptedData)%3B%0A%7D%0A%2F%2F%20%E5%A6%82%E6%9E%9C%E4%B8%8D%E6%98%AF%E5%8A%A0%E5%AF%86%E7%9A%84%EF%BC%8C%E7%9B%B4%E6%8E%A5%E8%BF%94%E5%9B%9E%EF%BC%88%E5%BC%80%E5%8F%91%2F%E6%B5%8B%E8%AF%95%E7%94%A8%EF%BC%89%0Areturn%20keyToDecrypt%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60API%20key%20decryption%20failed%3A%20%24%7Berror.message%7D%60)%3B%0A%7D%0A%7D%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 使用RSA解密API密钥的方法\u003c/span\u003e\nuserSchema.\u003cspan class=\"hljs-property inline\"\u003emethods\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003edecryptApiKey\u003c/span\u003e = \u003cspan class=\"hljs-keyword inline\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003eencryptedKey = \u003cspan class=\"hljs-literal inline\"\u003enull\u003c/span\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e keyToDecrypt = encryptedKey || \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eapiKey\u003c/span\u003e;\n    \n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!keyToDecrypt) {\n      \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal inline\"\u003enull\u003c/span\u003e;\n    }\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 检查是否为RSA加密（前端传来的base64格式）\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (keyToDecrypt.\u003cspan class=\"hljs-title function_ inline\"\u003estartsWith\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;rsa:\u0026#x27;\u003c/span\u003e)) {\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e encryptedData = keyToDecrypt.\u003cspan class=\"hljs-title function_ inline\"\u003esubstring\u003c/span\u003e(\u003cspan class=\"hljs-number inline\"\u003e4\u003c/span\u003e);\n      \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003edecrypt\u003c/span\u003e(encryptedData);\n    }\n    \n    \u003cspan class=\"hljs-comment inline\"\u003e// 如果不是加密的，直接返回（开发/测试用）\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e keyToDecrypt;\n  } \u003cspan class=\"hljs-keyword inline\"\u003ecatch\u003c/span\u003e (error) {\n    \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`API key decryption failed: \u003cspan class=\"hljs-subst inline\"\u003e${error.message}\u003c/span\u003e`\u003c/span\u003e);\n  }\n};\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch3 id=\"解密时机的选择策略\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#解密时机的选择策略\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 解密时机的选择策略\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            解密时机的选择策略\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"%2F%2F%20%E8%8E%B7%E5%8F%96AI%E6%9C%8D%E5%8A%A1%E7%94%A8%E7%9A%84%E8%A7%A3%E5%AF%86%E5%90%8EAPI%E5%AF%86%E9%92%A5%E7%9A%84%E6%96%B9%E6%B3%95%0AuserSchema.methods.getDecryptedApiKey%20%3D%20function()%20%7B%0Aif%20(!this.apiKey%20%7C%7C%20!this.useCustomApiKey)%20%7B%0Areturn%20null%3B%0A%7D%0Areturn%20this.decryptApiKey()%3B%0A%7D%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 获取AI服务用的解密后API密钥的方法\u003c/span\u003e\nuserSchema.\u003cspan class=\"hljs-property inline\"\u003emethods\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003egetDecryptedApiKey\u003c/span\u003e = \u003cspan class=\"hljs-keyword inline\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!\u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eapiKey\u003c/span\u003e || !\u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003euseCustomApiKey\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal inline\"\u003enull\u003c/span\u003e;\n  }\n  \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003edecryptApiKey\u003c/span\u003e();\n};\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003eQuestions Party的选择\u003c/strong\u003e：\u003cstrong class=\"font-bold text-foreground\"\u003e按需临时解密\u003c/strong\u003e\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e存储时：直接存储加密数据，不解密\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e使用时：仅在调用大模型API时临时解密\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e解密后：立即清理内存中的明文数据\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e优势：最大化安全性，最小化明文暴露时间\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"内存中明文数据的生命周期管理\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#内存中明文数据的生命周期管理\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 内存中明文数据的生命周期管理\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            内存中明文数据的生命周期管理\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"%2F%2F%20%E8%8E%B7%E5%8F%96%E8%A7%A3%E5%AF%86%E5%90%8E%E7%9A%84%E5%B9%B3%E5%8F%B0API%E5%AF%86%E9%92%A5%E7%9A%84%E8%BE%85%E5%8A%A9%E5%87%BD%E6%95%B0%0Afunction%20getPlatformApiKey()%20%7B%0A%2F%2F%20%E4%BC%98%E5%85%88%E5%B0%9D%E8%AF%95%E8%8E%B7%E5%8F%96%E5%8A%A0%E5%AF%86%E7%9A%84API%E5%AF%86%E9%92%A5%0Aif%20(process.env.ENCRYPTED_PLATFORM_API_KEY)%20%7B%0Atry%20%7B%0Aconst%20%7Bdecrypt%7D%20%3D%20require('..%2Futils%2FrsaCrypto')%3B%0Aif%20(process.env.ENCRYPTED_PLATFORM_API_KEY.startsWith('rsa%3A'))%20%7B%0Aconst%20encryptedData%20%3D%20process.env.ENCRYPTED_PLATFORM_API_KEY.substring(4)%3B%0Areturn%20decrypt(encryptedData)%3B%0A%7D%0A%7D%20catch%20(error)%20%7B%0Aconsole.warn('Failed%20to%20decrypt%20platform%20API%20key%3A'%2C%20error.message)%3B%0A%7D%0A%7D%0A%2F%2F%20%E5%A6%82%E6%9E%9C%E6%9C%89%E8%A7%A3%E5%AF%86%E5%90%8E%E7%9A%84%E5%AF%86%E9%92%A5%E5%88%99%E8%BF%94%E5%9B%9E%EF%BC%8C%E5%90%A6%E5%88%99%E8%BF%94%E5%9B%9Enull%0Areturn%20null%3B%0A%7D\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 获取解密后的平台API密钥的辅助函数\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003egetPlatformApiKey\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-comment inline\"\u003e// 优先尝试获取加密的API密钥\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (process.\u003cspan class=\"hljs-property inline\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eENCRYPTED_PLATFORM_API_KEY\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n            \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e {decrypt} = \u003cspan class=\"hljs-built_in inline\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;../utils/rsaCrypto\u0026#x27;\u003c/span\u003e);\n\n            \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (process.\u003cspan class=\"hljs-property inline\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eENCRYPTED_PLATFORM_API_KEY\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003estartsWith\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;rsa:\u0026#x27;\u003c/span\u003e)) {\n                \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e encryptedData = process.\u003cspan class=\"hljs-property inline\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eENCRYPTED_PLATFORM_API_KEY\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003esubstring\u003c/span\u003e(\u003cspan class=\"hljs-number inline\"\u003e4\u003c/span\u003e);\n                \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003edecrypt\u003c/span\u003e(encryptedData);\n            }\n        } \u003cspan class=\"hljs-keyword inline\"\u003ecatch\u003c/span\u003e (error) {\n            \u003cspan class=\"hljs-variable language_ inline\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003ewarn\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;Failed to decrypt platform API key:\u0026#x27;\u003c/span\u003e, error.\u003cspan class=\"hljs-property inline\"\u003emessage\u003c/span\u003e);\n        }\n    }\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 如果有解密后的密钥则返回，否则返回null\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal inline\"\u003enull\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch2 id=\"安全性分析与攻击防护\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#安全性分析与攻击防护\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 安全性分析与攻击防护\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            安全性分析与攻击防护\n        \u003c/h2\u003e\n\u003ch3 id=\"常见的rsa攻击方式和防护措施\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#常见的rsa攻击方式和防护措施\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 常见的RSA攻击方式和防护措施\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            常见的RSA攻击方式和防护措施\n        \u003c/h3\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e1. 小公钥指数攻击\u003c/strong\u003e\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"%2F%2F%20%E2%9D%8C%20%E5%8D%B1%E9%99%A9%E7%9A%84%E9%80%89%E6%8B%A9%0Ae%20%3D%203%20%20%2F%2F%20%E5%A4%AA%E5%B0%8F%EF%BC%8C%E5%AE%B9%E6%98%93%E5%8F%97%E5%88%B0%E6%94%BB%E5%87%BB%0A%2F%2F%20%E2%9C%85%20%E5%AE%89%E5%85%A8%E7%9A%84%E9%80%89%E6%8B%A9%0Ae%20%3D%2065537%20%20%2F%2F%20%E8%B6%B3%E5%A4%9F%E5%A4%A7%EF%BC%8C%E8%AE%A1%E7%AE%97%E6%95%88%E7%8E%87%E9%AB%98\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// ❌ 危险的选择\u003c/span\u003e\ne = \u003cspan class=\"hljs-number inline\"\u003e3\u003c/span\u003e  \u003cspan class=\"hljs-comment inline\"\u003e// 太小，容易受到攻击\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment inline\"\u003e// ✅ 安全的选择\u003c/span\u003e\ne = \u003cspan class=\"hljs-number inline\"\u003e65537\u003c/span\u003e  \u003cspan class=\"hljs-comment inline\"\u003e// 足够大，计算效率高\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e2. 时间攻击\u003c/strong\u003e\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"%2F%2F%20%E2%9D%8C%20%E5%AE%B9%E6%98%93%E5%8F%97%E5%88%B0%E6%97%B6%E9%97%B4%E6%94%BB%E5%87%BB%0Afunction%20unsafeDecrypt(ciphertext)%20%7B%0A%2F%2F%20%E8%A7%A3%E5%AF%86%E6%97%B6%E9%97%B4%E4%B8%8E%E7%A7%81%E9%92%A5%E7%9B%B8%E5%85%B3%0Areturn%20privateKey.decrypt(ciphertext)%3B%0A%7D%0A%2F%2F%20%E2%9C%85%20%E4%BD%BF%E7%94%A8%E5%B8%B8%E6%95%B0%E6%97%B6%E9%97%B4%E7%AE%97%E6%B3%95%0Afunction%20safeDecrypt(ciphertext)%20%7B%0A%2F%2F%20Node.js%20crypto%E6%A8%A1%E5%9D%97%E5%B7%B2%E7%BB%8F%E5%AE%9E%E7%8E%B0%E4%BA%86%E6%97%B6%E9%97%B4%E6%94%BB%E5%87%BB%E9%98%B2%E6%8A%A4%0Areturn%20crypto.privateDecrypt(%7B%0Akey%3A%20privateKey%2C%0Apadding%3A%20crypto.constants.RSA_PKCS1_OAEP_PADDING%0A%7D%2C%20ciphertext)%3B%0A%7D\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// ❌ 容易受到时间攻击\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003eunsafeDecrypt\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003eciphertext\u003c/span\u003e) {\n  \u003cspan class=\"hljs-comment inline\"\u003e// 解密时间与私钥相关\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e privateKey.\u003cspan class=\"hljs-title function_ inline\"\u003edecrypt\u003c/span\u003e(ciphertext);\n}\n\n\u003cspan class=\"hljs-comment inline\"\u003e// ✅ 使用常数时间算法\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003esafeDecrypt\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003eciphertext\u003c/span\u003e) {\n  \u003cspan class=\"hljs-comment inline\"\u003e// Node.js crypto模块已经实现了时间攻击防护\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e crypto.\u003cspan class=\"hljs-title function_ inline\"\u003eprivateDecrypt\u003c/span\u003e({\n    \u003cspan class=\"hljs-attr inline\"\u003ekey\u003c/span\u003e: privateKey,\n    \u003cspan class=\"hljs-attr inline\"\u003epadding\u003c/span\u003e: crypto.\u003cspan class=\"hljs-property inline\"\u003econstants\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eRSA_PKCS1_OAEP_PADDING\u003c/span\u003e\n  }, ciphertext);\n}\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch3 id=\"填充攻击的原理和oaep的防护机制\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#填充攻击的原理和oaep的防护机制\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 填充攻击的原理和OAEP的防护机制\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            填充攻击的原理和OAEP的防护机制\n        \u003c/h3\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003ePKCS#1 v1.5填充的漏洞\u003c/strong\u003e：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"\" data-code=\"%E5%8E%9F%E5%A7%8BRSA%3A%20c%20%3D%20m%5Ee%20mod%20n%0APKCS%231%20v1.5%3A%2000%20%7C%7C%20BT%20%7C%7C%20PS%20%7C%7C%2000%20%7C%7C%20D%0A%E9%97%AE%E9%A2%98%EF%BC%9A%E5%A1%AB%E5%85%85%E6%A0%BC%E5%BC%8F%E5%9B%BA%E5%AE%9A%EF%BC%8C%E5%AE%B9%E6%98%93%E5%8F%97%E5%88%B0%E5%A1%AB%E5%85%85%E6%94%BB%E5%87%BB\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ecode\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode\u003e原始RSA: c = m^e \u003cspan class=\"hljs-keyword inline\"\u003emod\u003c/span\u003e n\nPKCS#\u003cspan class=\"hljs-number inline\"\u003e1\u003c/span\u003e v1\u003cspan class=\"hljs-number inline\"\u003e.5\u003c/span\u003e: \u003cspan class=\"hljs-number inline\"\u003e00\u003c/span\u003e |\u003cspan class=\"hljs-type inline\"\u003e| BT\u003c/span\u003e |\u003cspan class=\"hljs-type inline\"\u003e| PS\u003c/span\u003e |\u003cspan class=\"hljs-type inline\"\u003e| 00\u003c/span\u003e |\u003cspan class=\"hljs-type inline\"\u003e| D\u003c/span\u003e\n\n问题：填充格式固定，容易受到填充攻击\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003eOAEP填充的防护机制\u003c/strong\u003e：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"\" data-code=\"OAEP%3A%20%E4%BD%BF%E7%94%A8%E9%9A%8F%E6%9C%BA%E6%95%B0%E5%92%8C%E6%8E%A9%E7%A0%81%E7%94%9F%E6%88%90%E5%87%BD%E6%95%B0%0A%E7%BB%93%E6%9E%9C%EF%BC%9A%E7%9B%B8%E5%90%8C%E6%98%8E%E6%96%87%E6%AF%8F%E6%AC%A1%E5%8A%A0%E5%AF%86%E9%83%BD%E4%B8%8D%E5%90%8C\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ecode\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode\u003e\u003cspan class=\"hljs-symbol inline\"\u003eOAEP:\u003c/span\u003e 使用随机数和掩码生成函数\n结果：相同明文每次加密都不同\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e数学表示\u003c/strong\u003e：\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cspan class=\"katex-display inline\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmtext\u003eOAEP\u003c/mtext\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmo separator=\"true\"\u003e,\u003c/mo\u003e\u003cmi\u003er\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003eX\u003c/mi\u003e\u003cmo\u003e⊕\u003c/mo\u003e\u003cmi\u003eG\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003eY\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmi mathvariant=\"normal\"\u003e∥\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003eY\u003c/mi\u003e\u003cmo\u003e⊕\u003c/mo\u003e\u003cmi\u003eH\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003eX\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\text{OAEP}(m, r) = (X \\oplus G(Y)) \\| (Y \\oplus H(X))\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord text inline\"\u003e\u003cspan class=\"mord inline\"\u003eOAEP\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003em\u003c/span\u003e\u003cspan class=\"mpunct inline\"\u003e,\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.1667em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\" style=\"margin-right:0.02778em;\"\u003er\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e)\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\" style=\"margin-right:0.07847em;\"\u003eX\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e⊕\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003eG\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\" style=\"margin-right:0.22222em;\"\u003eY\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e))\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e∥\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\" style=\"margin-right:0.22222em;\"\u003eY\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e⊕\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\" style=\"margin-right:0.08125em;\"\u003eH\u003c/span\u003e\u003cspan class=\"mopen inline\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\" style=\"margin-right:0.07847em;\"\u003eX\u003c/span\u003e\u003cspan class=\"mclose inline\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e其中：\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003em\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003em\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003em\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e：原始消息\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003er\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003er\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\" style=\"margin-right:0.02778em;\"\u003er\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e：随机数\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eG\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eG\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003eG\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e，\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eH\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eH\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\" style=\"margin-right:0.08125em;\"\u003eH\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e：掩码生成函数\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"完整代码全解析\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#完整代码全解析\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 完整代码全解析\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            完整代码全解析\n        \u003c/h2\u003e\n\u003ch3 id=\"后端rsa密钥管理核心实现-srcutilsrsacryptojs\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#后端rsa密钥管理核心实现-srcutilsrsacryptojs\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 后端RSA密钥管理核心实现 (src/utils/rsaCrypto.js)\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            后端RSA密钥管理核心实现 (\u003ccode\u003esrc/utils/rsaCrypto.js\u003c/code\u003e)\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"%2F%2F%20%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%85%A5%EF%BC%9A%E5%AF%86%E9%92%A5%E7%94%9F%E6%88%90%E5%BA%93%E5%92%8CNode.js%E5%8E%9F%E7%94%9F%E5%8A%A0%E5%AF%86%E6%A8%A1%E5%9D%97%0Aconst%20jsrsasign%20%3D%20require('jsrsasign')%3B%20%20%20%20%2F%2F%20%E7%94%A8%E4%BA%8E%E5%AF%86%E9%92%A5%E7%94%9F%E6%88%90%E5%92%8C%E7%AE%A1%E7%90%86%0Aconst%20%7B%20KEYUTIL%20%7D%20%3D%20jsrsasign%3B%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%AF%86%E9%92%A5%E5%B7%A5%E5%85%B7%E7%B1%BB%0Aconst%20crypto%20%3D%20require('crypto')%3B%20%20%20%20%20%20%20%20%20%20%2F%2F%20Node.js%E5%8E%9F%E7%94%9F%E5%8A%A0%E5%AF%86%E6%A8%A1%E5%9D%97%EF%BC%8C%E6%80%A7%E8%83%BD%E6%9B%B4%E5%A5%BD%0Aclass%20RSACrypto%20%7B%0Aconstructor()%20%7B%0Athis.keySize%20%3D%202048%3B%0Athis.initializeKeys()%3B%0A%7D%0A%2F%2F%20%E4%BB%8E%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%88%9D%E5%A7%8B%E5%8C%96RSA%E5%AF%86%E9%92%A5%E5%AF%B9%E6%88%96%E7%94%9F%E6%88%90%E6%96%B0%E7%9A%84%E5%AF%86%E9%92%A5%E5%AF%B9%0AinitializeKeys()%20%7B%0Aif%20(process.env.RSA_PUBLIC_KEY%20%26%26%20process.env.RSA_PRIVATE_KEY)%20%7B%0A%2F%2F%20%E5%A4%84%E7%90%86%E8%BD%AC%E4%B9%89%E5%92%8C%E9%9D%9E%E8%BD%AC%E4%B9%89%E7%9A%84%E6%8D%A2%E8%A1%8C%E7%AC%A6%EF%BC%88%E5%85%BC%E5%AE%B9%E6%80%A7%E8%80%83%E8%99%91%EF%BC%89%0Athis.publicKeyPEM%20%3D%20process.env.RSA_PUBLIC_KEY.includes('%5C%5Cn')%0A%3F%20process.env.RSA_PUBLIC_KEY.replace(%2F%5C%5Cn%2Fg%2C%20'%5Cn')%0A%3A%20process.env.RSA_PUBLIC_KEY%3B%0Athis.privateKeyPEM%20%3D%20process.env.RSA_PRIVATE_KEY.includes('%5C%5Cn')%0A%3F%20process.env.RSA_PRIVATE_KEY.replace(%2F%5C%5Cn%2Fg%2C%20'%5Cn')%0A%3A%20process.env.RSA_PRIVATE_KEY%3B%0A%7D%20else%20%7B%0Aconsole.warn('RSA%20keys%20not%20found%20in%20environment.%20Generating%20new%20keys...')%3B%0Aconst%20keyPair%20%3D%20this.generateKeyPair()%3B%0Athis.publicKeyPEM%20%3D%20keyPair.publicKeyPEM%3B%0Athis.privateKeyPEM%20%3D%20keyPair.privateKeyPEM%3B%0Aconsole.log('Generated%20RSA%20Public%20Key%3A'%2C%20this.publicKeyPEM)%3B%0Aconsole.log('Generated%20RSA%20Private%20Key%3A'%2C%20this.privateKeyPEM)%3B%0Aconsole.log('Please%20add%20these%20keys%20to%20your%20.env%20file%3A')%3B%0Aconsole.log('RSA_PUBLIC_KEY%3D%22'%20%2B%20this.publicKeyPEM.replace(%2F%5Cn%2Fg%2C%20'%5C%5Cn')%20%2B%20'%22')%3B%0Aconsole.log('RSA_PRIVATE_KEY%3D%22'%20%2B%20this.privateKeyPEM.replace(%2F%5Cn%2Fg%2C%20'%5C%5Cn')%20%2B%20'%22')%3B%0A%7D%0A%7D%0A%2F%2F%20RSA%E5%AF%86%E9%92%A5%E5%AF%B9%E7%94%9F%E6%88%90%EF%BC%9A%E4%BD%BF%E7%94%A8jsrsasign%E7%94%9F%E6%88%90%E6%A0%87%E5%87%86%E6%A0%BC%E5%BC%8F%E5%AF%86%E9%92%A5%0AgenerateKeyPair(keySize%20%3D%202048)%20%7B%0Atry%20%7B%0Aconst%20keyPair%20%3D%20KEYUTIL.generateKeypair('RSA'%2C%20keySize)%3B%0Aconst%20publicKeyPEM%20%3D%20KEYUTIL.getPEM(keyPair.pubKeyObj)%3B%20%20%20%20%20%20%20%2F%2F%20%E5%85%AC%E9%92%A5PEM%E6%A0%BC%E5%BC%8F%0Aconst%20privateKeyPEM%20%3D%20KEYUTIL.getPEM(keyPair.prvKeyObj%2C%20'PKCS8PRV')%3B%20%20%2F%2F%20%E7%A7%81%E9%92%A5PKCS8%E6%A0%BC%E5%BC%8F%0Areturn%20%7B%20publicKeyPEM%2C%20privateKeyPEM%20%7D%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60RSA%20key%20generation%20failed%3A%20%24%7Berror.message%7D%60)%3B%0A%7D%0A%7D%0A%2F%2F%20%E5%85%AC%E9%92%A5%E5%88%86%E5%8F%91%E6%8E%A5%E5%8F%A3%EF%BC%9A%E4%BE%9B%E5%89%8D%E7%AB%AF%E8%8E%B7%E5%8F%96%E5%85%AC%E9%92%A5%0AgetPublicKey()%20%7B%0Areturn%20this.publicKeyPEM%3B%0A%7D%0A%2F%2F%20RSA-OAEP%E5%8A%A0%E5%AF%86%E5%AE%9E%E7%8E%B0%EF%BC%9A%E4%BD%BF%E7%94%A8Node.js%20crypto%E6%A8%A1%E5%9D%97%E7%A1%AE%E4%BF%9D%E6%9C%80%E4%BD%B3%E6%80%A7%E8%83%BD%E5%92%8C%E5%AE%89%E5%85%A8%E6%80%A7%0Aencrypt(plaintext)%20%7B%0Atry%20%7B%0A%2F%2F%20%E8%BE%93%E5%85%A5%E9%AA%8C%E8%AF%81%EF%BC%9A%E7%A1%AE%E4%BF%9D%E6%98%8E%E6%96%87%E6%9C%89%E6%95%88%0Aif%20(!plaintext%20%7C%7C%20typeof%20plaintext%20!%3D%3D%20'string')%20%7B%0Athrow%20new%20Error('Invalid%20plaintext%20for%20encryption')%3B%0A%7D%0A%2F%2F%20UTF-8%E7%BC%96%E7%A0%81%E8%BD%AC%E6%8D%A2%EF%BC%9A%E7%A1%AE%E4%BF%9D%E4%B8%AD%E6%96%87%E7%AD%89%E5%AD%97%E7%AC%A6%E6%AD%A3%E7%A1%AE%E5%A4%84%E7%90%86%0Aconst%20buffer%20%3D%20Buffer.from(plaintext%2C%20'utf8')%3B%0A%2F%2F%20%E6%A0%B8%E5%BF%83%E5%8A%A0%E5%AF%86%E9%80%BB%E8%BE%91%EF%BC%9A%E4%BD%BF%E7%94%A8OAEP%E5%A1%AB%E5%85%85%E7%9A%84RSA%E5%8A%A0%E5%AF%86%0A%2F%2F%20%E9%80%89%E6%8B%A9Node.js%20crypto%E8%80%8C%E9%9D%9Ejsrsasign%E7%9A%84%E5%8E%9F%E5%9B%A0%EF%BC%9A%E6%9B%B4%E5%8F%AF%E9%9D%A0%E7%9A%84OAEP%E5%AE%9E%E7%8E%B0%0Aconst%20encrypted%20%3D%20crypto.publicEncrypt(%0A%7B%0Akey%3A%20this.publicKeyPEM%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20PEM%E6%A0%BC%E5%BC%8F%E5%85%AC%E9%92%A5%0Apadding%3A%20crypto.constants.RSA_PKCS1_OAEP_PADDING%2C%20%20%20%2F%2F%20OAEP%E5%A1%AB%E5%85%85%EF%BC%8C%E9%98%B2%E6%AD%A2%E5%A1%AB%E5%85%85%E6%94%BB%E5%87%BB%0AoaepHash%3A%20'sha256'%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20SHA-256%E5%93%88%E5%B8%8C%E5%87%BD%E6%95%B0%0A%7D%2C%0Abuffer%0A)%3B%0A%2F%2F%20Base64%E7%BC%96%E7%A0%81%EF%BC%9A%E4%BE%BF%E4%BA%8E%E7%BD%91%E7%BB%9C%E4%BC%A0%E8%BE%93%E5%92%8C%E5%AD%98%E5%82%A8%0Areturn%20encrypted.toString('base64')%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60RSA%20encryption%20failed%3A%20%24%7Berror.message%7D%60)%3B%0A%7D%0A%7D%0A%2F%2F%20RSA-OAEP%E8%A7%A3%E5%AF%86%E5%AE%9E%E7%8E%B0%EF%BC%9A%E4%B8%B4%E6%97%B6%E8%A7%A3%E5%AF%86%E7%AD%96%E7%95%A5%E7%9A%84%E6%A0%B8%E5%BF%83%0Adecrypt(encryptedData)%20%7B%0Atry%20%7B%0A%2F%2F%20%E8%BE%93%E5%85%A5%E9%AA%8C%E8%AF%81%EF%BC%9A%E7%A1%AE%E4%BF%9D%E5%AF%86%E6%96%87%E6%A0%BC%E5%BC%8F%E6%AD%A3%E7%A1%AE%0Aif%20(!encryptedData%20%7C%7C%20typeof%20encryptedData%20!%3D%3D%20'string')%20%7B%0Athrow%20new%20Error('Invalid%20encrypted%20data%20for%20decryption')%3B%0A%7D%0A%2F%2F%20Base64%E8%A7%A3%E7%A0%81%EF%BC%9A%E6%81%A2%E5%A4%8D%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AF%86%E6%96%87%0Aconst%20encryptedBuffer%20%3D%20Buffer.from(encryptedData%2C%20'base64')%3B%0A%2F%2F%20%E6%A0%B8%E5%BF%83%E8%A7%A3%E5%AF%86%E9%80%BB%E8%BE%91%EF%BC%9A%E4%BD%BF%E7%94%A8%E7%A7%81%E9%92%A5%E8%A7%A3%E5%AF%86%0Aconst%20decrypted%20%3D%20crypto.privateDecrypt(%0A%7B%0Akey%3A%20this.privateKeyPEM%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20PEM%E6%A0%BC%E5%BC%8F%E7%A7%81%E9%92%A5%0Apadding%3A%20crypto.constants.RSA_PKCS1_OAEP_PADDING%2C%20%20%20%2F%2F%20%E4%B8%8E%E5%8A%A0%E5%AF%86%E4%BF%9D%E6%8C%81%E4%B8%80%E8%87%B4%E7%9A%84%E5%A1%AB%E5%85%85%0AoaepHash%3A%20'sha256'%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%B8%8E%E5%8A%A0%E5%AF%86%E4%BF%9D%E6%8C%81%E4%B8%80%E8%87%B4%E7%9A%84%E5%93%88%E5%B8%8C%0A%7D%2C%0AencryptedBuffer%0A)%3B%0A%2F%2F%20UTF-8%E8%A7%A3%E7%A0%81%EF%BC%9A%E6%81%A2%E5%A4%8D%E5%8E%9F%E5%A7%8B%E5%AD%97%E7%AC%A6%E4%B8%B2%0Areturn%20decrypted.toString('utf8')%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60RSA%20decryption%20failed%3A%20%24%7Berror.message%7D%60)%3B%0A%7D%0A%7D%0A%2F%2F%20%E7%81%B5%E6%B4%BB%E5%8A%A0%E5%AF%86%E6%8E%A5%E5%8F%A3%EF%BC%9A%E6%94%AF%E6%8C%81%E4%BD%BF%E7%94%A8%E4%BB%BB%E6%84%8F%E5%85%AC%E9%92%A5%E5%8A%A0%E5%AF%86%EF%BC%88%E6%B5%8B%E8%AF%95%E7%94%A8%EF%BC%89%0AencryptWithPublicKey(plaintext%2C%20publicKeyPEM)%20%7B%0Atry%20%7B%0Aif%20(!plaintext%20%7C%7C%20typeof%20plaintext%20!%3D%3D%20'string')%20%7B%0Athrow%20new%20Error('Invalid%20plaintext%20for%20encryption')%3B%0A%7D%0Aconst%20buffer%20%3D%20Buffer.from(plaintext%2C%20'utf8')%3B%0A%2F%2F%20%E4%BD%BF%E7%94%A8%E5%A4%96%E9%83%A8%E6%8F%90%E4%BE%9B%E7%9A%84%E5%85%AC%E9%92%A5%E8%BF%9B%E8%A1%8C%E5%8A%A0%E5%AF%86%0Aconst%20encrypted%20%3D%20crypto.publicEncrypt(%0A%7B%0Akey%3A%20publicKeyPEM%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%A4%96%E9%83%A8%E5%85%AC%E9%92%A5%0Apadding%3A%20crypto.constants.RSA_PKCS1_OAEP_PADDING%2C%0AoaepHash%3A%20'sha256'%2C%0A%7D%2C%0Abuffer%0A)%3B%0Areturn%20encrypted.toString('base64')%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60RSA%20encryption%20with%20provided%20key%20failed%3A%20%24%7Berror.message%7D%60)%3B%0A%7D%0A%7D%0A%2F%2F%20%E5%AF%86%E9%92%A5%E9%AA%8C%E8%AF%81%E5%B7%A5%E5%85%B7%EF%BC%9A%E7%A1%AE%E4%BF%9D%E5%AF%86%E9%92%A5%E6%A0%BC%E5%BC%8F%E6%AD%A3%E7%A1%AE%0AvalidateKey(keyPEM%2C%20isPrivate%20%3D%20false)%20%7B%0Atry%20%7B%0Aconst%20keyObj%20%3D%20KEYUTIL.getKey(keyPEM)%3B%0Areturn%20keyObj%20%26%26%20(isPrivate%20%3F%20keyObj.isPrivate%20%3A%20keyObj.isPublic)%3B%0A%7D%20catch%20(error)%20%7B%0Areturn%20false%3B%20%20%20%2F%2F%20%E9%AA%8C%E8%AF%81%E5%A4%B1%E8%B4%A5%E8%BF%94%E5%9B%9Efalse%E8%80%8C%E9%9D%9E%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8%0A%7D%0A%7D%0A%7D%0A%2F%2F%20%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E5%AF%BC%E5%87%BA%EF%BC%9A%E5%85%A8%E5%B1%80%E5%94%AF%E4%B8%80%E5%AE%9E%E4%BE%8B%EF%BC%8C%E8%8A%82%E7%9C%81%E5%86%85%E5%AD%98%E5%B9%B6%E4%BF%9D%E8%AF%81%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%0Aconst%20rsaCrypto%20%3D%20new%20RSACrypto()%3B%0A%2F%2F%20%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%87%BA%EF%BC%9A%E6%8F%90%E4%BE%9B%E5%A4%9A%E7%A7%8D%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F%0Amodule.exports%20%3D%20%7B%0ARSACrypto%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%AF%BC%E5%87%BA%E7%B1%BB%EF%BC%88%E7%94%A8%E4%BA%8E%E6%89%A9%E5%B1%95%EF%BC%89%0ArsaCrypto%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%AF%BC%E5%87%BA%E5%8D%95%E4%BE%8B%E5%AE%9E%E4%BE%8B%0AgenerateKeyPair%3A%20(keySize)%20%3D%3E%20rsaCrypto.generateKeyPair(keySize)%2C%20%20%20%20%20%2F%2F%20%E4%BE%BF%E5%88%A9%E5%87%BD%E6%95%B0%0Aencrypt%3A%20(plaintext)%20%3D%3E%20rsaCrypto.encrypt(plaintext)%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%BE%BF%E5%88%A9%E5%87%BD%E6%95%B0%0Adecrypt%3A%20(encryptedData)%20%3D%3E%20rsaCrypto.decrypt(encryptedData)%2C%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%BE%BF%E5%88%A9%E5%87%BD%E6%95%B0%0AgetPublicKey%3A%20()%20%3D%3E%20rsaCrypto.getPublicKey()%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%BE%BF%E5%88%A9%E5%87%BD%E6%95%B0%0AencryptWithPublicKey%3A%20(plaintext%2C%20publicKey)%20%3D%3E%20rsaCrypto.encryptWithPublicKey(plaintext%2C%20publicKey)%2C%0AvalidateKey%3A%20(keyPEM%2C%20isPrivate)%20%3D%3E%20rsaCrypto.validateKey(keyPEM%2C%20isPrivate)%0A%7D%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 模块导入：密钥生成库和Node.js原生加密模块\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e jsrsasign = \u003cspan class=\"hljs-built_in inline\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;jsrsasign\u0026#x27;\u003c/span\u003e);    \u003cspan class=\"hljs-comment inline\"\u003e// 用于密钥生成和管理\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e { \u003cspan class=\"hljs-variable constant_ inline\"\u003eKEYUTIL\u003c/span\u003e } = jsrsasign;            \u003cspan class=\"hljs-comment inline\"\u003e// 密钥工具类\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e crypto = \u003cspan class=\"hljs-built_in inline\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;crypto\u0026#x27;\u003c/span\u003e);          \u003cspan class=\"hljs-comment inline\"\u003e// Node.js原生加密模块，性能更好\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword inline\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eRSACrypto\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_ inline\"\u003econstructor\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003ekeySize\u003c/span\u003e = \u003cspan class=\"hljs-number inline\"\u003e2048\u003c/span\u003e;\n    \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003einitializeKeys\u003c/span\u003e();\n  }\n\n  \u003cspan class=\"hljs-comment inline\"\u003e// 从环境变量初始化RSA密钥对或生成新的密钥对\u003c/span\u003e\n  \u003cspan class=\"hljs-title function_ inline\"\u003einitializeKeys\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (process.\u003cspan class=\"hljs-property inline\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eRSA_PUBLIC_KEY\u003c/span\u003e \u0026amp;\u0026amp; process.\u003cspan class=\"hljs-property inline\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eRSA_PRIVATE_KEY\u003c/span\u003e) {\n      \u003cspan class=\"hljs-comment inline\"\u003e// 处理转义和非转义的换行符（兼容性考虑）\u003c/span\u003e\n      \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epublicKeyPEM\u003c/span\u003e = process.\u003cspan class=\"hljs-property inline\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eRSA_PUBLIC_KEY\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eincludes\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\\\\n\u0026#x27;\u003c/span\u003e) \n        ? process.\u003cspan class=\"hljs-property inline\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eRSA_PUBLIC_KEY\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003ereplace\u003c/span\u003e(\u003cspan class=\"hljs-regexp inline\"\u003e/\\\\n/g\u003c/span\u003e, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\\n\u0026#x27;\u003c/span\u003e)\n        : process.\u003cspan class=\"hljs-property inline\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eRSA_PUBLIC_KEY\u003c/span\u003e;\n      \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eprivateKeyPEM\u003c/span\u003e = process.\u003cspan class=\"hljs-property inline\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eRSA_PRIVATE_KEY\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eincludes\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\\\\n\u0026#x27;\u003c/span\u003e)\n        ? process.\u003cspan class=\"hljs-property inline\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eRSA_PRIVATE_KEY\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003ereplace\u003c/span\u003e(\u003cspan class=\"hljs-regexp inline\"\u003e/\\\\n/g\u003c/span\u003e, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\\n\u0026#x27;\u003c/span\u003e)\n        : process.\u003cspan class=\"hljs-property inline\"\u003eenv\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eRSA_PRIVATE_KEY\u003c/span\u003e;\n    } \u003cspan class=\"hljs-keyword inline\"\u003eelse\u003c/span\u003e {\n      \u003cspan class=\"hljs-variable language_ inline\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003ewarn\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;RSA keys not found in environment. Generating new keys...\u0026#x27;\u003c/span\u003e);\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e keyPair = \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003egenerateKeyPair\u003c/span\u003e();\n      \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epublicKeyPEM\u003c/span\u003e = keyPair.\u003cspan class=\"hljs-property inline\"\u003epublicKeyPEM\u003c/span\u003e;\n      \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eprivateKeyPEM\u003c/span\u003e = keyPair.\u003cspan class=\"hljs-property inline\"\u003eprivateKeyPEM\u003c/span\u003e;\n      \n      \u003cspan class=\"hljs-variable language_ inline\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;Generated RSA Public Key:\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epublicKeyPEM\u003c/span\u003e);\n      \u003cspan class=\"hljs-variable language_ inline\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;Generated RSA Private Key:\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eprivateKeyPEM\u003c/span\u003e);\n      \u003cspan class=\"hljs-variable language_ inline\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;Please add these keys to your .env file:\u0026#x27;\u003c/span\u003e);\n      \u003cspan class=\"hljs-variable language_ inline\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;RSA_PUBLIC_KEY=\u0026quot;\u0026#x27;\u003c/span\u003e + \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epublicKeyPEM\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003ereplace\u003c/span\u003e(\u003cspan class=\"hljs-regexp inline\"\u003e/\\n/g\u003c/span\u003e, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\\\\n\u0026#x27;\u003c/span\u003e) + \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026quot;\u0026#x27;\u003c/span\u003e);\n      \u003cspan class=\"hljs-variable language_ inline\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;RSA_PRIVATE_KEY=\u0026quot;\u0026#x27;\u003c/span\u003e + \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eprivateKeyPEM\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003ereplace\u003c/span\u003e(\u003cspan class=\"hljs-regexp inline\"\u003e/\\n/g\u003c/span\u003e, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\\\\n\u0026#x27;\u003c/span\u003e) + \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026quot;\u0026#x27;\u003c/span\u003e);\n    }\n  }\n\n  \u003cspan class=\"hljs-comment inline\"\u003e// RSA密钥对生成：使用jsrsasign生成标准格式密钥\u003c/span\u003e\n  \u003cspan class=\"hljs-title function_ inline\"\u003egenerateKeyPair\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003ekeySize = \u003cspan class=\"hljs-number inline\"\u003e2048\u003c/span\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e keyPair = \u003cspan class=\"hljs-variable constant_ inline\"\u003eKEYUTIL\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003egenerateKeypair\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;RSA\u0026#x27;\u003c/span\u003e, keySize);\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e publicKeyPEM = \u003cspan class=\"hljs-variable constant_ inline\"\u003eKEYUTIL\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003egetPEM\u003c/span\u003e(keyPair.\u003cspan class=\"hljs-property inline\"\u003epubKeyObj\u003c/span\u003e);       \u003cspan class=\"hljs-comment inline\"\u003e// 公钥PEM格式\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e privateKeyPEM = \u003cspan class=\"hljs-variable constant_ inline\"\u003eKEYUTIL\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003egetPEM\u003c/span\u003e(keyPair.\u003cspan class=\"hljs-property inline\"\u003eprvKeyObj\u003c/span\u003e, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;PKCS8PRV\u0026#x27;\u003c/span\u003e);  \u003cspan class=\"hljs-comment inline\"\u003e// 私钥PKCS8格式\u003c/span\u003e\n      \n      \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e { publicKeyPEM, privateKeyPEM };\n    } \u003cspan class=\"hljs-keyword inline\"\u003ecatch\u003c/span\u003e (error) {\n      \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`RSA key generation failed: \u003cspan class=\"hljs-subst inline\"\u003e${error.message}\u003c/span\u003e`\u003c/span\u003e);\n    }\n  }\n\n  \u003cspan class=\"hljs-comment inline\"\u003e// 公钥分发接口：供前端获取公钥\u003c/span\u003e\n  \u003cspan class=\"hljs-title function_ inline\"\u003egetPublicKey\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epublicKeyPEM\u003c/span\u003e;\n  }\n\n  \u003cspan class=\"hljs-comment inline\"\u003e// RSA-OAEP加密实现：使用Node.js crypto模块确保最佳性能和安全性\u003c/span\u003e\n  \u003cspan class=\"hljs-title function_ inline\"\u003eencrypt\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003eplaintext\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n      \u003cspan class=\"hljs-comment inline\"\u003e// 输入验证：确保明文有效\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!plaintext || \u003cspan class=\"hljs-keyword inline\"\u003etypeof\u003c/span\u003e plaintext !== \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;string\u0026#x27;\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;Invalid plaintext for encryption\u0026#x27;\u003c/span\u003e);\n      }\n\n      \u003cspan class=\"hljs-comment inline\"\u003e// UTF-8编码转换：确保中文等字符正确处理\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e buffer = \u003cspan class=\"hljs-title class_ inline\"\u003eBuffer\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003efrom\u003c/span\u003e(plaintext, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;utf8\u0026#x27;\u003c/span\u003e);\n      \n      \u003cspan class=\"hljs-comment inline\"\u003e// 核心加密逻辑：使用OAEP填充的RSA加密\u003c/span\u003e\n      \u003cspan class=\"hljs-comment inline\"\u003e// 选择Node.js crypto而非jsrsasign的原因：更可靠的OAEP实现\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e encrypted = crypto.\u003cspan class=\"hljs-title function_ inline\"\u003epublicEncrypt\u003c/span\u003e(\n        {\n          \u003cspan class=\"hljs-attr inline\"\u003ekey\u003c/span\u003e: \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epublicKeyPEM\u003c/span\u003e,                              \u003cspan class=\"hljs-comment inline\"\u003e// PEM格式公钥\u003c/span\u003e\n          \u003cspan class=\"hljs-attr inline\"\u003epadding\u003c/span\u003e: crypto.\u003cspan class=\"hljs-property inline\"\u003econstants\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eRSA_PKCS1_OAEP_PADDING\u003c/span\u003e,   \u003cspan class=\"hljs-comment inline\"\u003e// OAEP填充，防止填充攻击\u003c/span\u003e\n          \u003cspan class=\"hljs-attr inline\"\u003eoaepHash\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;sha256\u0026#x27;\u003c/span\u003e,                                  \u003cspan class=\"hljs-comment inline\"\u003e// SHA-256哈希函数\u003c/span\u003e\n        },\n        buffer\n      );\n\n      \u003cspan class=\"hljs-comment inline\"\u003e// Base64编码：便于网络传输和存储\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e encrypted.\u003cspan class=\"hljs-title function_ inline\"\u003etoString\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;base64\u0026#x27;\u003c/span\u003e);\n    } \u003cspan class=\"hljs-keyword inline\"\u003ecatch\u003c/span\u003e (error) {\n      \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`RSA encryption failed: \u003cspan class=\"hljs-subst inline\"\u003e${error.message}\u003c/span\u003e`\u003c/span\u003e);\n    }\n  }\n\n  \u003cspan class=\"hljs-comment inline\"\u003e// RSA-OAEP解密实现：临时解密策略的核心\u003c/span\u003e\n  \u003cspan class=\"hljs-title function_ inline\"\u003edecrypt\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003eencryptedData\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n      \u003cspan class=\"hljs-comment inline\"\u003e// 输入验证：确保密文格式正确\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!encryptedData || \u003cspan class=\"hljs-keyword inline\"\u003etypeof\u003c/span\u003e encryptedData !== \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;string\u0026#x27;\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;Invalid encrypted data for decryption\u0026#x27;\u003c/span\u003e);\n      }\n\n      \u003cspan class=\"hljs-comment inline\"\u003e// Base64解码：恢复二进制密文\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e encryptedBuffer = \u003cspan class=\"hljs-title class_ inline\"\u003eBuffer\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003efrom\u003c/span\u003e(encryptedData, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;base64\u0026#x27;\u003c/span\u003e);\n      \n      \u003cspan class=\"hljs-comment inline\"\u003e// 核心解密逻辑：使用私钥解密\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e decrypted = crypto.\u003cspan class=\"hljs-title function_ inline\"\u003eprivateDecrypt\u003c/span\u003e(\n        {\n          \u003cspan class=\"hljs-attr inline\"\u003ekey\u003c/span\u003e: \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eprivateKeyPEM\u003c/span\u003e,                             \u003cspan class=\"hljs-comment inline\"\u003e// PEM格式私钥\u003c/span\u003e\n          \u003cspan class=\"hljs-attr inline\"\u003epadding\u003c/span\u003e: crypto.\u003cspan class=\"hljs-property inline\"\u003econstants\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eRSA_PKCS1_OAEP_PADDING\u003c/span\u003e,   \u003cspan class=\"hljs-comment inline\"\u003e// 与加密保持一致的填充\u003c/span\u003e\n          \u003cspan class=\"hljs-attr inline\"\u003eoaepHash\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;sha256\u0026#x27;\u003c/span\u003e,                                  \u003cspan class=\"hljs-comment inline\"\u003e// 与加密保持一致的哈希\u003c/span\u003e\n        },\n        encryptedBuffer\n      );\n\n      \u003cspan class=\"hljs-comment inline\"\u003e// UTF-8解码：恢复原始字符串\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e decrypted.\u003cspan class=\"hljs-title function_ inline\"\u003etoString\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;utf8\u0026#x27;\u003c/span\u003e);\n    } \u003cspan class=\"hljs-keyword inline\"\u003ecatch\u003c/span\u003e (error) {\n      \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`RSA decryption failed: \u003cspan class=\"hljs-subst inline\"\u003e${error.message}\u003c/span\u003e`\u003c/span\u003e);\n    }\n  }\n\n  \u003cspan class=\"hljs-comment inline\"\u003e// 灵活加密接口：支持使用任意公钥加密（测试用）\u003c/span\u003e\n  \u003cspan class=\"hljs-title function_ inline\"\u003eencryptWithPublicKey\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003eplaintext, publicKeyPEM\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n      \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!plaintext || \u003cspan class=\"hljs-keyword inline\"\u003etypeof\u003c/span\u003e plaintext !== \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;string\u0026#x27;\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;Invalid plaintext for encryption\u0026#x27;\u003c/span\u003e);\n      }\n\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e buffer = \u003cspan class=\"hljs-title class_ inline\"\u003eBuffer\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003efrom\u003c/span\u003e(plaintext, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;utf8\u0026#x27;\u003c/span\u003e);\n      \n      \u003cspan class=\"hljs-comment inline\"\u003e// 使用外部提供的公钥进行加密\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e encrypted = crypto.\u003cspan class=\"hljs-title function_ inline\"\u003epublicEncrypt\u003c/span\u003e(\n        {\n          \u003cspan class=\"hljs-attr inline\"\u003ekey\u003c/span\u003e: publicKeyPEM,                                   \u003cspan class=\"hljs-comment inline\"\u003e// 外部公钥\u003c/span\u003e\n          \u003cspan class=\"hljs-attr inline\"\u003epadding\u003c/span\u003e: crypto.\u003cspan class=\"hljs-property inline\"\u003econstants\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eRSA_PKCS1_OAEP_PADDING\u003c/span\u003e,\n          \u003cspan class=\"hljs-attr inline\"\u003eoaepHash\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;sha256\u0026#x27;\u003c/span\u003e,\n        },\n        buffer\n      );\n\n      \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e encrypted.\u003cspan class=\"hljs-title function_ inline\"\u003etoString\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;base64\u0026#x27;\u003c/span\u003e);\n    } \u003cspan class=\"hljs-keyword inline\"\u003ecatch\u003c/span\u003e (error) {\n      \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`RSA encryption with provided key failed: \u003cspan class=\"hljs-subst inline\"\u003e${error.message}\u003c/span\u003e`\u003c/span\u003e);\n    }\n  }\n\n  \u003cspan class=\"hljs-comment inline\"\u003e// 密钥验证工具：确保密钥格式正确\u003c/span\u003e\n  \u003cspan class=\"hljs-title function_ inline\"\u003evalidateKey\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003ekeyPEM, isPrivate = \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e keyObj = \u003cspan class=\"hljs-variable constant_ inline\"\u003eKEYUTIL\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003egetKey\u003c/span\u003e(keyPEM);\n      \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e keyObj \u0026amp;\u0026amp; (isPrivate ? keyObj.\u003cspan class=\"hljs-property inline\"\u003eisPrivate\u003c/span\u003e : keyObj.\u003cspan class=\"hljs-property inline\"\u003eisPublic\u003c/span\u003e);\n    } \u003cspan class=\"hljs-keyword inline\"\u003ecatch\u003c/span\u003e (error) {\n      \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e;   \u003cspan class=\"hljs-comment inline\"\u003e// 验证失败返回false而非抛出异常\u003c/span\u003e\n    }\n  }\n}\n\n\u003cspan class=\"hljs-comment inline\"\u003e// 单例模式导出：全局唯一实例，节省内存并保证缓存一致性\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e rsaCrypto = \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eRSACrypto\u003c/span\u003e();\n\n\u003cspan class=\"hljs-comment inline\"\u003e// 模块导出：提供多种使用方式\u003c/span\u003e\n\u003cspan class=\"hljs-variable language_ inline\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eexports\u003c/span\u003e = {\n  \u003cspan class=\"hljs-title class_ inline\"\u003eRSACrypto\u003c/span\u003e,                                                    \u003cspan class=\"hljs-comment inline\"\u003e// 导出类（用于扩展）\u003c/span\u003e\n  rsaCrypto,                                                   \u003cspan class=\"hljs-comment inline\"\u003e// 导出单例实例\u003c/span\u003e\n  \u003cspan class=\"hljs-attr inline\"\u003egenerateKeyPair\u003c/span\u003e: \u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003ekeySize\u003c/span\u003e) =\u0026gt;\u003c/span\u003e rsaCrypto.\u003cspan class=\"hljs-title function_ inline\"\u003egenerateKeyPair\u003c/span\u003e(keySize),     \u003cspan class=\"hljs-comment inline\"\u003e// 便利函数\u003c/span\u003e\n  \u003cspan class=\"hljs-attr inline\"\u003eencrypt\u003c/span\u003e: \u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003eplaintext\u003c/span\u003e) =\u0026gt;\u003c/span\u003e rsaCrypto.\u003cspan class=\"hljs-title function_ inline\"\u003eencrypt\u003c/span\u003e(plaintext),                 \u003cspan class=\"hljs-comment inline\"\u003e// 便利函数\u003c/span\u003e\n  \u003cspan class=\"hljs-attr inline\"\u003edecrypt\u003c/span\u003e: \u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003eencryptedData\u003c/span\u003e) =\u0026gt;\u003c/span\u003e rsaCrypto.\u003cspan class=\"hljs-title function_ inline\"\u003edecrypt\u003c/span\u003e(encryptedData),         \u003cspan class=\"hljs-comment inline\"\u003e// 便利函数\u003c/span\u003e\n  \u003cspan class=\"hljs-attr inline\"\u003egetPublicKey\u003c/span\u003e: \u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e rsaCrypto.\u003cspan class=\"hljs-title function_ inline\"\u003egetPublicKey\u003c/span\u003e(),                         \u003cspan class=\"hljs-comment inline\"\u003e// 便利函数\u003c/span\u003e\n  \u003cspan class=\"hljs-attr inline\"\u003eencryptWithPublicKey\u003c/span\u003e: \u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003eplaintext, publicKey\u003c/span\u003e) =\u0026gt;\u003c/span\u003e rsaCrypto.\u003cspan class=\"hljs-title function_ inline\"\u003eencryptWithPublicKey\u003c/span\u003e(plaintext, publicKey),\n  \u003cspan class=\"hljs-attr inline\"\u003evalidateKey\u003c/span\u003e: \u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003ekeyPEM, isPrivate\u003c/span\u003e) =\u0026gt;\u003c/span\u003e rsaCrypto.\u003cspan class=\"hljs-title function_ inline\"\u003evalidateKey\u003c/span\u003e(keyPEM, isPrivate)\n};\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch3 id=\"前端rsa加密核心实现-srcutilsrsacryptots\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#前端rsa加密核心实现-srcutilsrsacryptots\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 前端RSA加密核心实现 (src/utils/rsaCrypto.ts)\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            前端RSA加密核心实现 (\u003ccode\u003esrc/utils/rsaCrypto.ts\u003c/code\u003e)\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"import%20*%20as%20jsrsasign%20from%20'jsrsasign'%3B%20%20%20%2F%2F%20RSA%E5%AF%86%E9%92%A5%E6%93%8D%E4%BD%9C%E5%BA%93%0Aconst%20%7BKEYUTIL%7D%20%3D%20jsrsasign%3B%0Aexport%20class%20RSACrypto%20%7B%0Aprivate%20publicKey%3A%20string%20%7C%20null%20%3D%20null%3B%20%20%20%2F%2F%20%E5%AD%98%E5%82%A8%E4%BB%8E%E5%90%8E%E7%AB%AF%E8%8E%B7%E5%8F%96%E7%9A%84%E5%85%AC%E9%92%A5%0A%2F%2F%20%E9%9D%99%E6%80%81%E5%B7%A5%E5%85%B7%E6%96%B9%E6%B3%95%EF%BC%9A%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AE%9A%E5%85%AC%E9%92%A5%E5%8A%A0%E5%AF%86%EF%BC%88%E6%B5%8B%E8%AF%95%E7%94%A8%EF%BC%89%0Astatic%20async%20encryptWithKey(plaintext%3A%20string%2C%20publicKeyPEM%3A%20string)%3A%20Promisestring%3E%20%7B%0Aconst%20rsa%20%3D%20new%20RSACrypto()%3B%0Arsa.setPublicKey(publicKeyPEM)%3B%0Areturn%20await%20rsa.encrypt(plaintext)%3B%0A%7D%0A%2F%2F%20%E9%9D%99%E6%80%81%E5%AE%89%E5%85%A8%E9%AA%8C%E8%AF%81%EF%BC%9A%E7%A1%AE%E4%BF%9D%E5%85%AC%E9%92%A5%E6%A0%BC%E5%BC%8F%E6%AD%A3%E7%A1%AE%E4%B8%94%E4%B8%8D%E5%8C%85%E5%90%AB%E7%A7%81%E9%92%A5%E4%BF%A1%E6%81%AF%0Astatic%20validatePublicKey(keyPEM%3A%20string)%3A%20boolean%20%7B%0Atry%20%7B%0Aconst%20keyObj%20%3D%20KEYUTIL.getKey(keyPEM)%3B%0A%2F%2F%20%E5%85%B3%E9%94%AE%E5%AE%89%E5%85%A8%E6%A3%80%E6%9F%A5%EF%BC%9ARSA%E5%85%AC%E9%92%A5%E5%8F%AA%E5%BA%94%E5%8C%85%E5%90%AB%E6%A8%A1%E6%95%B0(n)%E5%92%8C%E5%85%AC%E9%92%A5%E6%8C%87%E6%95%B0(e)%0A%2F%2F%20%E7%BB%9D%E5%AF%B9%E4%B8%8D%E8%83%BD%E5%8C%85%E5%90%AB%E7%A7%81%E9%92%A5%E6%8C%87%E6%95%B0(d)%20-%20%E8%BF%99%E6%98%AF%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4%E7%9A%84%E6%A0%B8%E5%BF%83%0Areturn%20keyObj%20%26%26%0A'n'%20in%20keyObj%20%26%26%20%20%20%20%2F%2F%20%E6%A8%A1%E6%95%B0n%E5%BF%85%E9%A1%BB%E5%AD%98%E5%9C%A8%0A'e'%20in%20keyObj%20%26%26%20%20%20%20%2F%2F%20%E5%85%AC%E9%92%A5%E6%8C%87%E6%95%B0e%E5%BF%85%E9%A1%BB%E5%AD%98%E5%9C%A8%0A!('d'%20in%20keyObj)%3B%20%20%20%2F%2F%20%E7%A7%81%E9%92%A5%E6%8C%87%E6%95%B0d%E7%BB%9D%E5%AF%B9%E4%B8%8D%E8%83%BD%E5%AD%98%E5%9C%A8%EF%BC%81%0A%7D%20catch%20%7B%0Areturn%20false%3B%20%20%20%2F%2F%20%E8%A7%A3%E6%9E%90%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%AE%89%E5%85%A8%E6%8B%92%E7%BB%9D%0A%7D%0A%7D%0A%2F%2F%20%E5%AF%86%E9%92%A5%E8%AE%BE%E7%BD%AE%EF%BC%9A%E6%8E%A5%E6%94%B6%E5%90%8E%E7%AB%AF%E5%88%86%E5%8F%91%E7%9A%84%E5%85%AC%E9%92%A5%0AsetPublicKey(publicKeyPEM%3A%20string)%20%7B%0Athis.publicKey%20%3D%20publicKeyPEM%3B%0A%7D%0A%2F%2F%20%E5%AF%86%E9%92%A5%E8%8E%B7%E5%8F%96%EF%BC%9A%E8%BF%94%E5%9B%9E%E5%BD%93%E5%89%8D%E8%AE%BE%E7%BD%AE%E7%9A%84%E5%85%AC%E9%92%A5%0AgetPublicKey()%3A%20string%20%7C%20null%20%7B%0Areturn%20this.publicKey%3B%0A%7D%0A%2F%2F%20%E6%A0%B8%E5%BF%83%E5%8A%A0%E5%AF%86%E6%96%B9%E6%B3%95%EF%BC%9A%E4%BD%BF%E7%94%A8Web%20Crypto%20API%E5%AE%9E%E7%8E%B0RSA-OAEP%E5%8A%A0%E5%AF%86%0Aasync%20encrypt(plaintext%3A%20string)%3A%20Promisestring%3E%20%7B%0A%2F%2F%20%E5%89%8D%E7%BD%AE%E6%A3%80%E6%9F%A5%EF%BC%9A%E7%A1%AE%E4%BF%9D%E5%85%AC%E9%92%A5%E5%B7%B2%E8%AE%BE%E7%BD%AE%0Aif%20(!this.publicKey)%20%7B%0Athrow%20new%20Error('Public%20key%20not%20set.%20Call%20setPublicKey()%20first.')%3B%0A%7D%0A%2F%2F%20%E8%BE%93%E5%85%A5%E9%AA%8C%E8%AF%81%EF%BC%9A%E7%A1%AE%E4%BF%9D%E6%98%8E%E6%96%87%E6%9C%89%E6%95%88%0Aif%20(!plaintext%20%7C%7C%20typeof%20plaintext%20!%3D%3D%20'string')%20%7B%0Athrow%20new%20Error('Invalid%20plaintext%20for%20encryption')%3B%0A%7D%0Atry%20%7B%0A%2F%2F%20%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9APEM%E6%A0%BC%E5%BC%8F%E5%AF%86%E9%92%A5%E8%BD%AC%E6%8D%A2%E4%B8%BAWeb%20Crypto%20API%E9%9C%80%E8%A6%81%E7%9A%84ArrayBuffer%0Aconst%20publicKeyBuffer%20%3D%20this.pemToArrayBuffer(this.publicKey)%3B%0A%2F%2F%20%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E5%AF%BC%E5%85%A5%E5%85%AC%E9%92%A5%E5%88%B0Web%20Crypto%20API%0A%2F%2F%20%E4%BD%BF%E7%94%A8%E6%A0%87%E5%87%86%E7%9A%84SPKI%E6%A0%BC%E5%BC%8F%E5%92%8CRSA-OAEP%E7%AE%97%E6%B3%95%0Aconst%20cryptoKey%20%3D%20await%20window.crypto.subtle.importKey(%0A'spki'%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Subject%20Public%20Key%20Info%E6%A0%BC%E5%BC%8F%0ApublicKeyBuffer%2C%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AF%86%E9%92%A5%E6%95%B0%E6%8D%AE%0A%7B%0Aname%3A%20'RSA-OAEP'%2C%20%20%20%20%20%20%20%2F%2F%20%E7%AE%97%E6%B3%95%E5%90%8D%E7%A7%B0%EF%BC%8C%E4%B8%8E%E5%90%8E%E7%AB%AF%E4%BF%9D%E6%8C%81%E4%B8%80%E8%87%B4%0Ahash%3A%20'SHA-256'%2C%20%20%20%20%20%20%20%20%2F%2F%20%E5%93%88%E5%B8%8C%E5%87%BD%E6%95%B0%EF%BC%8C%E4%B8%8E%E5%90%8E%E7%AB%AF%E4%BF%9D%E6%8C%81%E4%B8%80%E8%87%B4%0A%7D%2C%0Afalse%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%B8%8D%E5%85%81%E8%AE%B8%E6%8F%90%E5%8F%96%E5%AF%86%E9%92%A5%EF%BC%88%E5%AE%89%E5%85%A8%E8%80%83%E8%99%91%EF%BC%89%0A%5B'encrypt'%5D%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%8F%AA%E5%85%81%E8%AE%B8%E5%8A%A0%E5%AF%86%E6%93%8D%E4%BD%9C%0A)%3B%0A%2F%2F%20%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E6%98%8E%E6%96%87%E7%BC%96%E7%A0%81%E5%92%8C%E5%8A%A0%E5%AF%86%0Aconst%20plaintextBuffer%20%3D%20new%20TextEncoder().encode(plaintext)%3B%20%20%2F%2F%20UTF-8%E7%BC%96%E7%A0%81%0Aconst%20encryptedBuffer%20%3D%20await%20window.crypto.subtle.encrypt(%0A%7B%0Aname%3A%20'RSA-OAEP'%2C%20%20%20%20%20%20%2F%2F%20%E4%BD%BF%E7%94%A8OAEP%E5%A1%AB%E5%85%85%0A%7D%2C%0AcryptoKey%2C%0AplaintextBuffer%0A)%3B%0A%2F%2F%20%E7%AC%AC%E5%9B%9B%E6%AD%A5%EF%BC%9ABase64%E7%BC%96%E7%A0%81%E4%BB%A5%E5%8C%B9%E9%85%8D%E5%90%8E%E7%AB%AF%E6%A0%BC%E5%BC%8F%0Areturn%20this.arrayBufferToBase64(encryptedBuffer)%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60RSA%20encryption%20failed%3A%20%24%7Berror%20instanceof%20Error%20%3F%20error.message%20%3A%20'Unknown%20error'%7D%60)%3B%0A%7D%0A%7D%0A%2F%2F%20%E7%A7%81%E6%9C%89%E5%B7%A5%E5%85%B7%E6%96%B9%E6%B3%95%EF%BC%9APEM%E6%A0%BC%E5%BC%8F%E8%BD%ACArrayBuffer%0Aprivate%20pemToArrayBuffer(pem%3A%20string)%3A%20ArrayBuffer%20%7B%0A%2F%2F%20%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E7%A7%BB%E9%99%A4PEM%E6%A0%BC%E5%BC%8F%E7%9A%84%E5%A4%B4%E5%B0%BE%E6%A0%87%E8%AF%86%E5%92%8C%E6%89%80%E6%9C%89%E7%A9%BA%E7%99%BD%E5%AD%97%E7%AC%A6%0Aconst%20pemHeader%20%3D%20'-----BEGIN%20PUBLIC%20KEY-----'%3B%0Aconst%20pemFooter%20%3D%20'-----END%20PUBLIC%20KEY-----'%3B%0Aconst%20pemContents%20%3D%20pem.replace(pemHeader%2C%20'')%0A.replace(pemFooter%2C%20'')%0A.replace(%2F%5Cs%2Fg%2C%20'')%3B%20%20%20%2F%2F%20%E7%A7%BB%E9%99%A4%E6%89%80%E6%9C%89%E7%A9%BA%E7%99%BD%E5%AD%97%E7%AC%A6%0A%2F%2F%20%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9ABase64%E8%A7%A3%E7%A0%81%E4%B8%BA%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AD%97%E7%AC%A6%E4%B8%B2%0Aconst%20binaryString%20%3D%20atob(pemContents)%3B%0A%2F%2F%20%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%ACArrayBuffer%EF%BC%88Web%20Crypto%20API%E6%A0%87%E5%87%86%E6%A0%BC%E5%BC%8F%EF%BC%89%0Aconst%20bytes%20%3D%20new%20Uint8Array(binaryString.length)%3B%0Afor%20(let%20i%20%3D%200%3B%20i%20length%3B%20i%2B%2B)%20%7B%0Abytes%5Bi%5D%20%3D%20binaryString.charCodeAt(i)%3B%20%20%20%2F%2F%20%E9%80%90%E5%AD%97%E8%8A%82%E8%BD%AC%E6%8D%A2%0A%7D%0Areturn%20bytes.buffer%3B%0A%7D%0A%2F%2F%20%E7%A7%81%E6%9C%89%E5%B7%A5%E5%85%B7%E6%96%B9%E6%B3%95%EF%BC%9AArrayBuffer%E8%BD%ACBase64%EF%BC%88%E7%BD%91%E7%BB%9C%E4%BC%A0%E8%BE%93%E6%A0%BC%E5%BC%8F%EF%BC%89%0Aprivate%20arrayBufferToBase64(buffer%3A%20ArrayBuffer)%3A%20string%20%7B%0Aconst%20bytes%20%3D%20new%20Uint8Array(buffer)%3B%0Alet%20binary%20%3D%20''%3B%0A%2F%2F%20%E9%80%90%E5%AD%97%E8%8A%82%E8%BD%AC%E6%8D%A2%E4%B8%BA%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AD%97%E7%AC%A6%E4%B8%B2%0Afor%20(let%20i%20%3D%200%3B%20i%20byteLength%3B%20i%2B%2B)%20%7B%0Abinary%20%2B%3D%20String.fromCharCode(bytes%5Bi%5D)%3B%0A%7D%0Areturn%20btoa(binary)%3B%20%20%20%2F%2F%20Base64%E7%BC%96%E7%A0%81%0A%7D%0A%7D%0A%2F%2F%20%E5%AF%BC%E5%87%BA%E5%8D%95%E4%BE%8B%E5%AE%9E%E4%BE%8B%EF%BC%9A%E5%85%A8%E5%B1%80%E5%94%AF%E4%B8%80%EF%BC%8C%E4%BE%BF%E4%BA%8E%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%0Aexport%20const%20rsaCrypto%20%3D%20new%20RSACrypto()%3B%0A%2F%2F%20%E5%AF%BC%E5%87%BA%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%EF%BC%9A%E4%BE%BF%E4%BA%8E%E7%9B%B4%E6%8E%A5%E8%B0%83%E7%94%A8%0Aexport%20const%20encryptWithKey%20%3D%20RSACrypto.encryptWithKey%3B%0Aexport%20const%20validatePublicKey%20%3D%20RSACrypto.validatePublicKey%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-keyword inline\"\u003eimport\u003c/span\u003e * \u003cspan class=\"hljs-keyword inline\"\u003eas\u003c/span\u003e jsrsasign \u003cspan class=\"hljs-keyword inline\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;jsrsasign\u0026#x27;\u003c/span\u003e;   \u003cspan class=\"hljs-comment inline\"\u003e// RSA密钥操作库\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e {\u003cspan class=\"hljs-variable constant_ inline\"\u003eKEYUTIL\u003c/span\u003e} = jsrsasign;\n\n\u003cspan class=\"hljs-keyword inline\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eRSACrypto\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword inline\"\u003eprivate\u003c/span\u003e \u003cspan class=\"hljs-attr inline\"\u003epublicKey\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e | \u003cspan class=\"hljs-literal inline\"\u003enull\u003c/span\u003e = \u003cspan class=\"hljs-literal inline\"\u003enull\u003c/span\u003e;   \u003cspan class=\"hljs-comment inline\"\u003e// 存储从后端获取的公钥\u003c/span\u003e\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 静态工具方法：使用指定公钥加密（测试用）\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003estatic\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003eencryptWithKey\u003c/span\u003e(\u003cspan class=\"hljs-attr inline\"\u003eplaintext\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e, \u003cspan class=\"hljs-attr inline\"\u003epublicKeyPEM\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e): \u003cspan class=\"hljs-title class_ inline\"\u003ePromise\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e\u0026gt; {\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e rsa = \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eRSACrypto\u003c/span\u003e();\n        rsa.\u003cspan class=\"hljs-title function_ inline\"\u003esetPublicKey\u003c/span\u003e(publicKeyPEM);\n        \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003eawait\u003c/span\u003e rsa.\u003cspan class=\"hljs-title function_ inline\"\u003eencrypt\u003c/span\u003e(plaintext);\n    }\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 静态安全验证：确保公钥格式正确且不包含私钥信息\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003estatic\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003evalidatePublicKey\u003c/span\u003e(\u003cspan class=\"hljs-attr inline\"\u003ekeyPEM\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e): \u003cspan class=\"hljs-built_in inline\"\u003eboolean\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n            \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e keyObj = \u003cspan class=\"hljs-variable constant_ inline\"\u003eKEYUTIL\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003egetKey\u003c/span\u003e(keyPEM);\n            \u003cspan class=\"hljs-comment inline\"\u003e// 关键安全检查：RSA公钥只应包含模数(n)和公钥指数(e)\u003c/span\u003e\n            \u003cspan class=\"hljs-comment inline\"\u003e// 绝对不能包含私钥指数(d) - 这是安全防护的核心\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e keyObj \u0026amp;\u0026amp; \n                   \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;n\u0026#x27;\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003ein\u003c/span\u003e keyObj \u0026amp;\u0026amp;    \u003cspan class=\"hljs-comment inline\"\u003e// 模数n必须存在\u003c/span\u003e\n                   \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;e\u0026#x27;\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003ein\u003c/span\u003e keyObj \u0026amp;\u0026amp;    \u003cspan class=\"hljs-comment inline\"\u003e// 公钥指数e必须存在\u003c/span\u003e\n                   !(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;d\u0026#x27;\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003ein\u003c/span\u003e keyObj);   \u003cspan class=\"hljs-comment inline\"\u003e// 私钥指数d绝对不能存在！\u003c/span\u003e\n        } \u003cspan class=\"hljs-keyword inline\"\u003ecatch\u003c/span\u003e {\n            \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e;   \u003cspan class=\"hljs-comment inline\"\u003e// 解析失败，安全拒绝\u003c/span\u003e\n        }\n    }\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 密钥设置：接收后端分发的公钥\u003c/span\u003e\n    \u003cspan class=\"hljs-title function_ inline\"\u003esetPublicKey\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003cspan class=\"hljs-attr inline\"\u003epublicKeyPEM\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e\u003c/span\u003e) {\n        \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epublicKey\u003c/span\u003e = publicKeyPEM;\n    }\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 密钥获取：返回当前设置的公钥\u003c/span\u003e\n    \u003cspan class=\"hljs-title function_ inline\"\u003egetPublicKey\u003c/span\u003e(): \u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e | \u003cspan class=\"hljs-literal inline\"\u003enull\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epublicKey\u003c/span\u003e;\n    }\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 核心加密方法：使用Web Crypto API实现RSA-OAEP加密\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003eencrypt\u003c/span\u003e(\u003cspan class=\"hljs-attr inline\"\u003eplaintext\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e): \u003cspan class=\"hljs-title class_ inline\"\u003ePromise\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e\u0026gt; {\n        \u003cspan class=\"hljs-comment inline\"\u003e// 前置检查：确保公钥已设置\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!\u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epublicKey\u003c/span\u003e) {\n            \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;Public key not set. Call setPublicKey() first.\u0026#x27;\u003c/span\u003e);\n        }\n\n        \u003cspan class=\"hljs-comment inline\"\u003e// 输入验证：确保明文有效\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!plaintext || \u003cspan class=\"hljs-keyword inline\"\u003etypeof\u003c/span\u003e plaintext !== \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;string\u0026#x27;\u003c/span\u003e) {\n            \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;Invalid plaintext for encryption\u0026#x27;\u003c/span\u003e);\n        }\n\n        \u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n            \u003cspan class=\"hljs-comment inline\"\u003e// 第一步：PEM格式密钥转换为Web Crypto API需要的ArrayBuffer\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e publicKeyBuffer = \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003epemToArrayBuffer\u003c/span\u003e(\u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epublicKey\u003c/span\u003e);\n\n            \u003cspan class=\"hljs-comment inline\"\u003e// 第二步：导入公钥到Web Crypto API\u003c/span\u003e\n            \u003cspan class=\"hljs-comment inline\"\u003e// 使用标准的SPKI格式和RSA-OAEP算法\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e cryptoKey = \u003cspan class=\"hljs-keyword inline\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-variable language_ inline\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003ecrypto\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003esubtle\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eimportKey\u003c/span\u003e(\n                \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;spki\u0026#x27;\u003c/span\u003e,                     \u003cspan class=\"hljs-comment inline\"\u003e// Subject Public Key Info格式\u003c/span\u003e\n                publicKeyBuffer,            \u003cspan class=\"hljs-comment inline\"\u003e// 二进制密钥数据\u003c/span\u003e\n                {\n                    \u003cspan class=\"hljs-attr inline\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;RSA-OAEP\u0026#x27;\u003c/span\u003e,       \u003cspan class=\"hljs-comment inline\"\u003e// 算法名称，与后端保持一致\u003c/span\u003e\n                    \u003cspan class=\"hljs-attr inline\"\u003ehash\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;SHA-256\u0026#x27;\u003c/span\u003e,        \u003cspan class=\"hljs-comment inline\"\u003e// 哈希函数，与后端保持一致\u003c/span\u003e\n                },\n                \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e,                      \u003cspan class=\"hljs-comment inline\"\u003e// 不允许提取密钥（安全考虑）\u003c/span\u003e\n                [\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;encrypt\u0026#x27;\u003c/span\u003e]                 \u003cspan class=\"hljs-comment inline\"\u003e// 只允许加密操作\u003c/span\u003e\n            );\n\n            \u003cspan class=\"hljs-comment inline\"\u003e// 第三步：明文编码和加密\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e plaintextBuffer = \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eTextEncoder\u003c/span\u003e().\u003cspan class=\"hljs-title function_ inline\"\u003eencode\u003c/span\u003e(plaintext);  \u003cspan class=\"hljs-comment inline\"\u003e// UTF-8编码\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e encryptedBuffer = \u003cspan class=\"hljs-keyword inline\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-variable language_ inline\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003ecrypto\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003esubtle\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eencrypt\u003c/span\u003e(\n                {\n                    \u003cspan class=\"hljs-attr inline\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;RSA-OAEP\u0026#x27;\u003c/span\u003e,      \u003cspan class=\"hljs-comment inline\"\u003e// 使用OAEP填充\u003c/span\u003e\n                },\n                cryptoKey,\n                plaintextBuffer\n            );\n\n            \u003cspan class=\"hljs-comment inline\"\u003e// 第四步：Base64编码以匹配后端格式\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003earrayBufferToBase64\u003c/span\u003e(encryptedBuffer);\n        } \u003cspan class=\"hljs-keyword inline\"\u003ecatch\u003c/span\u003e (error) {\n            \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`RSA encryption failed: \u003cspan class=\"hljs-subst inline\"\u003e${error \u003cspan class=\"hljs-keyword inline\"\u003einstanceof\u003c/span\u003e \u003cspan class=\"hljs-built_in inline\"\u003eError\u003c/span\u003e ? error.message : \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;Unknown error\u0026#x27;\u003c/span\u003e}\u003c/span\u003e`\u003c/span\u003e);\n        }\n    }\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 私有工具方法：PEM格式转ArrayBuffer\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003eprivate\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003epemToArrayBuffer\u003c/span\u003e(\u003cspan class=\"hljs-attr inline\"\u003epem\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e): \u003cspan class=\"hljs-title class_ inline\"\u003eArrayBuffer\u003c/span\u003e {\n        \u003cspan class=\"hljs-comment inline\"\u003e// 第一步：移除PEM格式的头尾标识和所有空白字符\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e pemHeader = \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;-----BEGIN PUBLIC KEY-----\u0026#x27;\u003c/span\u003e;\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e pemFooter = \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;-----END PUBLIC KEY-----\u0026#x27;\u003c/span\u003e;\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e pemContents = pem.\u003cspan class=\"hljs-title function_ inline\"\u003ereplace\u003c/span\u003e(pemHeader, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e)\n                              .\u003cspan class=\"hljs-title function_ inline\"\u003ereplace\u003c/span\u003e(pemFooter, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e)\n                              .\u003cspan class=\"hljs-title function_ inline\"\u003ereplace\u003c/span\u003e(\u003cspan class=\"hljs-regexp inline\"\u003e/\\s/g\u003c/span\u003e, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e);   \u003cspan class=\"hljs-comment inline\"\u003e// 移除所有空白字符\u003c/span\u003e\n\n        \u003cspan class=\"hljs-comment inline\"\u003e// 第二步：Base64解码为二进制字符串\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e binaryString = \u003cspan class=\"hljs-title function_ inline\"\u003eatob\u003c/span\u003e(pemContents);\n\n        \u003cspan class=\"hljs-comment inline\"\u003e// 第三步：二进制字符串转ArrayBuffer（Web Crypto API标准格式）\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e bytes = \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eUint8Array\u003c/span\u003e(binaryString.\u003cspan class=\"hljs-property inline\"\u003elength\u003c/span\u003e);\n        \u003cspan class=\"hljs-keyword inline\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword inline\"\u003elet\u003c/span\u003e i = \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e; i \u0026lt; binaryString.\u003cspan class=\"hljs-property inline\"\u003elength\u003c/span\u003e; i++) {\n            bytes[i] = binaryString.\u003cspan class=\"hljs-title function_ inline\"\u003echarCodeAt\u003c/span\u003e(i);   \u003cspan class=\"hljs-comment inline\"\u003e// 逐字节转换\u003c/span\u003e\n        }\n\n        \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e bytes.\u003cspan class=\"hljs-property inline\"\u003ebuffer\u003c/span\u003e;\n    }\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 私有工具方法：ArrayBuffer转Base64（网络传输格式）\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003eprivate\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003earrayBufferToBase64\u003c/span\u003e(\u003cspan class=\"hljs-attr inline\"\u003ebuffer\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eArrayBuffer\u003c/span\u003e): \u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e bytes = \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eUint8Array\u003c/span\u003e(buffer);\n        \u003cspan class=\"hljs-keyword inline\"\u003elet\u003c/span\u003e binary = \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e;\n        \u003cspan class=\"hljs-comment inline\"\u003e// 逐字节转换为二进制字符串\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword inline\"\u003elet\u003c/span\u003e i = \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e; i \u0026lt; bytes.\u003cspan class=\"hljs-property inline\"\u003ebyteLength\u003c/span\u003e; i++) {\n            binary += \u003cspan class=\"hljs-title class_ inline\"\u003eString\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003efromCharCode\u003c/span\u003e(bytes[i]);\n        }\n        \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003ebtoa\u003c/span\u003e(binary);   \u003cspan class=\"hljs-comment inline\"\u003e// Base64编码\u003c/span\u003e\n    }\n}\n\n\u003cspan class=\"hljs-comment inline\"\u003e// 导出单例实例：全局唯一，便于状态管理\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e rsaCrypto = \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eRSACrypto\u003c/span\u003e();\n\n\u003cspan class=\"hljs-comment inline\"\u003e// 导出工具函数：便于直接调用\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e encryptWithKey = \u003cspan class=\"hljs-title class_ inline\"\u003eRSACrypto\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eencryptWithKey\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword inline\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e validatePublicKey = \u003cspan class=\"hljs-title class_ inline\"\u003eRSACrypto\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003evalidatePublicKey\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch3 id=\"用户模型解密逻辑核心实现-srcmodelsuserjs\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#用户模型解密逻辑核心实现-srcmodelsuserjs\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 用户模型解密逻辑核心实现 (src/models/User.js)\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            用户模型解密逻辑核心实现 (\u003ccode\u003esrc/models/User.js\u003c/code\u003e)\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"%2F%2F%20%E4%BD%BF%E7%94%A8RSA%E8%A7%A3%E5%AF%86API%E5%AF%86%E9%92%A5%E7%9A%84%E6%96%B9%E6%B3%95%0AuserSchema.methods.decryptApiKey%20%3D%20function(encryptedKey%20%3D%20null)%20%7B%0Atry%20%7B%0Aconst%20keyToDecrypt%20%3D%20encryptedKey%20%7C%7C%20this.apiKey%3B%0Aif%20(!keyToDecrypt)%20%7B%0Areturn%20null%3B%0A%7D%0A%2F%2F%20%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E4%B8%BARSA%E5%8A%A0%E5%AF%86%EF%BC%88%E5%89%8D%E7%AB%AF%E4%BC%A0%E6%9D%A5%E7%9A%84base64%E6%A0%BC%E5%BC%8F%EF%BC%89%0Aif%20(keyToDecrypt.startsWith('rsa%3A'))%20%7B%0Aconst%20encryptedData%20%3D%20keyToDecrypt.substring(4)%3B%0Areturn%20decrypt(encryptedData)%3B%0A%7D%0A%2F%2F%20%E5%A6%82%E6%9E%9C%E4%B8%8D%E6%98%AF%E5%8A%A0%E5%AF%86%E7%9A%84%EF%BC%8C%E7%9B%B4%E6%8E%A5%E8%BF%94%E5%9B%9E%EF%BC%88%E5%BC%80%E5%8F%91%2F%E6%B5%8B%E8%AF%95%E7%94%A8%EF%BC%89%0Areturn%20keyToDecrypt%3B%0A%7D%20catch%20(error)%20%7B%0Athrow%20new%20Error(%60API%20key%20decryption%20failed%3A%20%24%7Berror.message%7D%60)%3B%0A%7D%0A%7D%3B%0A%2F%2F%20%E6%8C%89%E9%9C%80%E8%A7%A3%E5%AF%86%E7%9A%84%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5%EF%BC%9A%E5%8F%AA%E5%9C%A8%E7%9C%9F%E6%AD%A3%E9%9C%80%E8%A6%81%E6%97%B6%E6%89%8D%E8%A7%A3%E5%AF%86%0AuserSchema.methods.getDecryptedApiKey%20%3D%20function()%20%7B%0A%2F%2F%20%E5%8F%8C%E9%87%8D%E5%AE%89%E5%85%A8%E6%A3%80%E6%9F%A5%EF%BC%9A%E5%BF%85%E9%A1%BB%E5%90%8C%E6%97%B6%E6%BB%A1%E8%B6%B3%E6%9C%89%E5%AF%86%E9%92%A5%E4%B8%94%E5%90%AF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AF%86%E9%92%A5%0Aif%20(!this.apiKey%20%7C%7C%20!this.useCustomApiKey)%20%7B%0Areturn%20null%3B%20%20%20%2F%2F%20%E4%B8%8D%E6%BB%A1%E8%B6%B3%E6%9D%A1%E4%BB%B6%EF%BC%8C%E8%BF%94%E5%9B%9Enull%0A%7D%0A%2F%2F%20%E4%B8%B4%E6%97%B6%E8%A7%A3%E5%AF%86%EF%BC%9A%E8%B0%83%E7%94%A8%E8%A7%A3%E5%AF%86%E6%96%B9%E6%B3%95%E8%8E%B7%E5%8F%96%E6%98%8E%E6%96%87%E5%AF%86%E9%92%A5%0Areturn%20this.decryptApiKey()%3B%0A%7D%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 使用RSA解密API密钥的方法\u003c/span\u003e\nuserSchema.\u003cspan class=\"hljs-property inline\"\u003emethods\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003edecryptApiKey\u003c/span\u003e = \u003cspan class=\"hljs-keyword inline\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003eencryptedKey = \u003cspan class=\"hljs-literal inline\"\u003enull\u003c/span\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e keyToDecrypt = encryptedKey || \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eapiKey\u003c/span\u003e;\n    \n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!keyToDecrypt) {\n      \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal inline\"\u003enull\u003c/span\u003e;\n    }\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 检查是否为RSA加密（前端传来的base64格式）\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (keyToDecrypt.\u003cspan class=\"hljs-title function_ inline\"\u003estartsWith\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;rsa:\u0026#x27;\u003c/span\u003e)) {\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e encryptedData = keyToDecrypt.\u003cspan class=\"hljs-title function_ inline\"\u003esubstring\u003c/span\u003e(\u003cspan class=\"hljs-number inline\"\u003e4\u003c/span\u003e);\n      \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003edecrypt\u003c/span\u003e(encryptedData);\n    }\n    \n    \u003cspan class=\"hljs-comment inline\"\u003e// 如果不是加密的，直接返回（开发/测试用）\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e keyToDecrypt;\n  } \u003cspan class=\"hljs-keyword inline\"\u003ecatch\u003c/span\u003e (error) {\n    \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`API key decryption failed: \u003cspan class=\"hljs-subst inline\"\u003e${error.message}\u003c/span\u003e`\u003c/span\u003e);\n  }\n};\n\n\u003cspan class=\"hljs-comment inline\"\u003e// 按需解密的安全策略：只在真正需要时才解密\u003c/span\u003e\nuserSchema.\u003cspan class=\"hljs-property inline\"\u003emethods\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003egetDecryptedApiKey\u003c/span\u003e = \u003cspan class=\"hljs-keyword inline\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-comment inline\"\u003e// 双重安全检查：必须同时满足有密钥且启用自定义密钥\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!\u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eapiKey\u003c/span\u003e || !\u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003euseCustomApiKey\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal inline\"\u003enull\u003c/span\u003e;   \u003cspan class=\"hljs-comment inline\"\u003e// 不满足条件，返回null\u003c/span\u003e\n  }\n  \u003cspan class=\"hljs-comment inline\"\u003e// 临时解密：调用解密方法获取明文密钥\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003edecryptApiKey\u003c/span\u003e();\n};\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch3 id=\"认证控制器密钥管理核心实现-srccontrollersauthcontrollerjs\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#认证控制器密钥管理核心实现-srccontrollersauthcontrollerjs\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 认证控制器密钥管理核心实现 (src/controllers/authController.js)\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            认证控制器密钥管理核心实现 (\u003ccode\u003esrc/controllers/authController.js\u003c/code\u003e)\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"%2F%2F%20API%E6%8E%A5%E5%8F%A3%EF%BC%9A%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7API%E5%AF%86%E9%92%A5%0A%2F%2F%20%40desc%20%20%20%20%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7API%E5%AF%86%E9%92%A5%0A%2F%2F%20%40route%20%20%20PUT%20%2Fapi%2Fauth%2Fapi-key%0A%2F%2F%20%40access%20%20Private%20(%E9%9C%80%E8%A6%81%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81)%0Aexports.updateApiKey%20%3D%20async%20(req%2C%20res)%20%3D%3E%20%7B%0Atry%20%7B%0Aconst%20%7B%20apiKey%2C%20useCustomApiKey%20%7D%20%3D%20req.body%3B%0A%2F%2F%20%E8%BE%93%E5%85%A5%E9%AA%8C%E8%AF%81%E7%9A%84%E8%BE%B9%E7%95%8C%E6%9D%A1%E4%BB%B6%E5%A4%84%E7%90%86%EF%BC%9A%E7%B2%BE%E7%A1%AE%E7%9A%84%E9%AA%8C%E8%AF%81%E9%80%BB%E8%BE%91%0A%2F%2F%20%E5%8F%AA%E6%9C%89%E5%9C%A8%E6%98%8E%E7%A1%AE%E8%A6%81%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AF%86%E9%92%A5%E4%B8%94%E6%8F%90%E4%BE%9B%E4%BA%86%E7%A9%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%97%B6%E6%89%8D%E6%8A%A5%E9%94%99%0A%2F%2F%20%E5%85%81%E8%AE%B8%E8%AE%BE%E7%BD%AEuseCustomApiKey%20%3D%20true%E4%BD%86%E6%9A%82%E4%B8%8D%E6%8F%90%E4%BE%9B%E5%AF%86%E9%92%A5%E7%9A%84%E6%83%85%E5%86%B5%0Aif%20(useCustomApiKey%20%26%26%20apiKey%20%26%26%20apiKey.trim().length%20%3D%3D%3D%200)%20%7B%0Areturn%20res.status(400).json(%7B%0Asuccess%3A%20false%2C%0Amessage%3A%20req.t('auth.apiKeyRequired')%20%20%20%2F%2F%20%E5%9B%BD%E9%99%85%E5%8C%96%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF%0A%7D)%3B%0A%7D%0A%2F%2F%20%E7%94%A8%E6%88%B7%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%EF%BC%9A%E7%A1%AE%E4%BF%9D%E7%94%A8%E6%88%B7%E5%AD%98%E5%9C%A8%0Aconst%20user%20%3D%20await%20User.findById(req.user.id)%3B%0Aif%20(!user)%20%7B%0Areturn%20res.status(404).json(%7B%0Asuccess%3A%20false%2C%0Amessage%3A%20req.t('auth.userNotFound')%0A%7D)%3B%0A%7D%0A%2F%2F%20%E5%AF%86%E9%92%A5%E6%9B%B4%E6%96%B0%E7%9A%84%E6%A0%B8%E5%BF%83%E9%80%BB%E8%BE%91%EF%BC%9A%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E7%9A%84%E5%8E%9F%E5%AD%90%E6%80%A7%E6%93%8D%E4%BD%9C%0Aif%20(useCustomApiKey)%20%7B%0A%2F%2F%20%E5%85%B3%E9%94%AE%E5%AE%89%E5%85%A8%E5%86%B3%E7%AD%96%EF%BC%9A%E7%9B%B4%E6%8E%A5%E5%AD%98%E5%82%A8%E5%89%8D%E7%AB%AF%E5%8A%A0%E5%AF%86%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%8C%E7%BB%9D%E4%B8%8D%E5%9C%A8%E6%AD%A4%E5%A4%84%E8%A7%A3%E5%AF%86%0A%2F%2F%20%E5%89%8D%E7%AB%AF%E5%8F%91%E9%80%81%E7%9A%84%E6%98%AFRSA%E5%8A%A0%E5%AF%86%E6%95%B0%E6%8D%AE%EF%BC%8C%E6%A0%BC%E5%BC%8F%E4%B8%BA%20'rsa%3ABase64EncryptedData'%0Aif%20(apiKey%20%26%26%20apiKey.trim().length%20%3E%200)%20%7B%0Auser.apiKey%20%3D%20apiKey.trim()%3B%20%20%20%2F%2F%20%E7%9B%B4%E6%8E%A5%E5%AD%98%E5%82%A8%E5%AF%86%E6%96%87%EF%BC%8C%E4%BF%9D%E6%8C%81%E5%8A%A0%E5%AF%86%E7%8A%B6%E6%80%81%0A%7D%20else%20%7B%0Auser.apiKey%20%3D%20undefined%3B%20%20%20%20%20%20%20%2F%2F%20%E6%B8%85%E7%A9%BA%E5%AF%86%E9%92%A5%E6%95%B0%E6%8D%AE%0A%7D%0Auser.useCustomApiKey%20%3D%20true%3B%20%20%20%20%20%2F%2F%20%E5%90%AF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AF%86%E9%92%A5%E6%A0%87%E5%BF%97%0A%7D%20else%20%7B%0A%2F%2F%20%E7%A6%81%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AF%86%E9%92%A5%EF%BC%9A%E5%90%8C%E6%97%B6%E6%B8%85%E7%A9%BA%E5%AF%86%E9%92%A5%E6%95%B0%E6%8D%AE%E5%92%8C%E6%A0%87%E5%BF%97%E4%BD%8D%EF%BC%8C%E7%A1%AE%E4%BF%9D%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7%0Auser.apiKey%20%3D%20undefined%3B%0Auser.useCustomApiKey%20%3D%20false%3B%0A%7D%0A%2F%2F%20%E5%8E%9F%E5%AD%90%E6%80%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C%EF%BC%9A%E7%A1%AE%E4%BF%9D%E7%8A%B6%E6%80%81%E5%8F%98%E6%9B%B4%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7%0Aawait%20user.save()%3B%0A%2F%2F%20%E6%88%90%E5%8A%9F%E5%93%8D%E5%BA%94%EF%BC%9A%E8%BF%94%E5%9B%9E%E6%93%8D%E4%BD%9C%E7%BB%93%E6%9E%9C%E5%92%8C%E6%96%B0%E7%8A%B6%E6%80%81%0Ares.status(200).json(%7B%0Asuccess%3A%20true%2C%0Amessage%3A%20req.t('auth.apiKeyUpdatedSuccessfully')%2C%0AuseCustomApiKey%3A%20user.useCustomApiKey%20%20%20%20%2F%2F%20%E8%BF%94%E5%9B%9E%E5%BD%93%E5%89%8D%E7%8A%B6%E6%80%81%E4%BE%9B%E5%89%8D%E7%AB%AF%E7%A1%AE%E8%AE%A4%0A%7D)%3B%0A%7D%20catch%20(error)%20%7B%0A%2F%2F%20%E7%BB%9F%E4%B8%80%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%EF%BC%9A%E8%AE%B0%E5%BD%95%E9%94%99%E8%AF%AF%E5%B9%B6%E8%BF%94%E5%9B%9E%E7%94%A8%E6%88%B7%E5%8F%8B%E5%A5%BD%E7%9A%84%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF%0Ares.status(500).json(%7B%0Asuccess%3A%20false%2C%0Amessage%3A%20req.t('auth.serverError')%0A%7D)%3B%0A%7D%0A%7D%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// API接口：更新用户API密钥\u003c/span\u003e\n\u003cspan class=\"hljs-comment inline\"\u003e// @desc    更新用户API密钥\u003c/span\u003e\n\u003cspan class=\"hljs-comment inline\"\u003e// @route   PUT /api/auth/api-key\u003c/span\u003e\n\u003cspan class=\"hljs-comment inline\"\u003e// @access  Private (需要身份验证)\u003c/span\u003e\n\u003cspan class=\"hljs-built_in inline\"\u003eexports\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eupdateApiKey\u003c/span\u003e = \u003cspan class=\"hljs-title function_ inline\"\u003easync\u003c/span\u003e (req, res) =\u0026gt; {\n  \u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e { apiKey, useCustomApiKey } = req.\u003cspan class=\"hljs-property inline\"\u003ebody\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 输入验证的边界条件处理：精确的验证逻辑\u003c/span\u003e\n    \u003cspan class=\"hljs-comment inline\"\u003e// 只有在明确要使用自定义密钥且提供了空字符串时才报错\u003c/span\u003e\n    \u003cspan class=\"hljs-comment inline\"\u003e// 允许设置useCustomApiKey = true但暂不提供密钥的情况\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (useCustomApiKey \u0026amp;\u0026amp; apiKey \u0026amp;\u0026amp; apiKey.\u003cspan class=\"hljs-title function_ inline\"\u003etrim\u003c/span\u003e().\u003cspan class=\"hljs-property inline\"\u003elength\u003c/span\u003e === \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e) {\n      \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e res.\u003cspan class=\"hljs-title function_ inline\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number inline\"\u003e400\u003c/span\u003e).\u003cspan class=\"hljs-title function_ inline\"\u003ejson\u003c/span\u003e({\n        \u003cspan class=\"hljs-attr inline\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr inline\"\u003emessage\u003c/span\u003e: req.\u003cspan class=\"hljs-title function_ inline\"\u003et\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;auth.apiKeyRequired\u0026#x27;\u003c/span\u003e)   \u003cspan class=\"hljs-comment inline\"\u003e// 国际化错误信息\u003c/span\u003e\n      });\n    }\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 用户身份验证：确保用户存在\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e user = \u003cspan class=\"hljs-keyword inline\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eUser\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003efindById\u003c/span\u003e(req.\u003cspan class=\"hljs-property inline\"\u003euser\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eid\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!user) {\n      \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e res.\u003cspan class=\"hljs-title function_ inline\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number inline\"\u003e404\u003c/span\u003e).\u003cspan class=\"hljs-title function_ inline\"\u003ejson\u003c/span\u003e({\n        \u003cspan class=\"hljs-attr inline\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr inline\"\u003emessage\u003c/span\u003e: req.\u003cspan class=\"hljs-title function_ inline\"\u003et\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;auth.userNotFound\u0026#x27;\u003c/span\u003e)\n      });\n    }\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 密钥更新的核心逻辑：状态管理的原子性操作\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (useCustomApiKey) {\n      \u003cspan class=\"hljs-comment inline\"\u003e// 关键安全决策：直接存储前端加密的数据，绝不在此处解密\u003c/span\u003e\n      \u003cspan class=\"hljs-comment inline\"\u003e// 前端发送的是RSA加密数据，格式为 \u0026#x27;rsa:Base64EncryptedData\u0026#x27;\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (apiKey \u0026amp;\u0026amp; apiKey.\u003cspan class=\"hljs-title function_ inline\"\u003etrim\u003c/span\u003e().\u003cspan class=\"hljs-property inline\"\u003elength\u003c/span\u003e \u0026gt; \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e) {\n        user.\u003cspan class=\"hljs-property inline\"\u003eapiKey\u003c/span\u003e = apiKey.\u003cspan class=\"hljs-title function_ inline\"\u003etrim\u003c/span\u003e();   \u003cspan class=\"hljs-comment inline\"\u003e// 直接存储密文，保持加密状态\u003c/span\u003e\n      } \u003cspan class=\"hljs-keyword inline\"\u003eelse\u003c/span\u003e {\n        user.\u003cspan class=\"hljs-property inline\"\u003eapiKey\u003c/span\u003e = \u003cspan class=\"hljs-literal inline\"\u003eundefined\u003c/span\u003e;       \u003cspan class=\"hljs-comment inline\"\u003e// 清空密钥数据\u003c/span\u003e\n      }\n      user.\u003cspan class=\"hljs-property inline\"\u003euseCustomApiKey\u003c/span\u003e = \u003cspan class=\"hljs-literal inline\"\u003etrue\u003c/span\u003e;     \u003cspan class=\"hljs-comment inline\"\u003e// 启用自定义密钥标志\u003c/span\u003e\n    } \u003cspan class=\"hljs-keyword inline\"\u003eelse\u003c/span\u003e {\n      \u003cspan class=\"hljs-comment inline\"\u003e// 禁用自定义密钥：同时清空密钥数据和标志位，确保数据一致性\u003c/span\u003e\n      user.\u003cspan class=\"hljs-property inline\"\u003eapiKey\u003c/span\u003e = \u003cspan class=\"hljs-literal inline\"\u003eundefined\u003c/span\u003e;\n      user.\u003cspan class=\"hljs-property inline\"\u003euseCustomApiKey\u003c/span\u003e = \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e;\n    }\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 原子性数据库操作：确保状态变更的一致性\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003eawait\u003c/span\u003e user.\u003cspan class=\"hljs-title function_ inline\"\u003esave\u003c/span\u003e();\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 成功响应：返回操作结果和新状态\u003c/span\u003e\n    res.\u003cspan class=\"hljs-title function_ inline\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number inline\"\u003e200\u003c/span\u003e).\u003cspan class=\"hljs-title function_ inline\"\u003ejson\u003c/span\u003e({\n      \u003cspan class=\"hljs-attr inline\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal inline\"\u003etrue\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr inline\"\u003emessage\u003c/span\u003e: req.\u003cspan class=\"hljs-title function_ inline\"\u003et\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;auth.apiKeyUpdatedSuccessfully\u0026#x27;\u003c/span\u003e),\n      \u003cspan class=\"hljs-attr inline\"\u003euseCustomApiKey\u003c/span\u003e: user.\u003cspan class=\"hljs-property inline\"\u003euseCustomApiKey\u003c/span\u003e    \u003cspan class=\"hljs-comment inline\"\u003e// 返回当前状态供前端确认\u003c/span\u003e\n    });\n  } \u003cspan class=\"hljs-keyword inline\"\u003ecatch\u003c/span\u003e (error) {\n    \u003cspan class=\"hljs-comment inline\"\u003e// 统一错误处理：记录错误并返回用户友好的错误信息\u003c/span\u003e\n    res.\u003cspan class=\"hljs-title function_ inline\"\u003estatus\u003c/span\u003e(\u003cspan class=\"hljs-number inline\"\u003e500\u003c/span\u003e).\u003cspan class=\"hljs-title function_ inline\"\u003ejson\u003c/span\u003e({\n      \u003cspan class=\"hljs-attr inline\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr inline\"\u003emessage\u003c/span\u003e: req.\u003cspan class=\"hljs-title function_ inline\"\u003et\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;auth.serverError\u0026#x27;\u003c/span\u003e)\n    });\n  }\n};\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e代码架构的核心设计原则\u003c/strong\u003e：\u003c/p\u003e\n\u003col class=\"list-decimal list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e安全优先原则\u003c/strong\u003e：后端永不存储明文密钥，只在使用时临时解密\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e职责分离原则\u003c/strong\u003e：前端负责加密，后端负责存储和按需解密\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e数据一致性原则\u003c/strong\u003e：确保密钥数据和使用标志的原子性更新\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e错误处理原则\u003c/strong\u003e：每个层级都有详细的错误处理和国际化支持\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e向前兼容原则\u003c/strong\u003e：支持开发环境的调试需求，保持系统灵活性\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e通过这些代码的详细解析，我们可以看到Questions Party项目在RSA实现上的每一个细节都经过了深思熟虑，既保证了安全性，又兼顾了可维护性和易用性。整个架构体现了现代Web安全开发的最佳实践。\u003c/p\u003e\n\u003ch2 id=\"完整的端到端加密流程追踪\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#完整的端到端加密流程追踪\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 完整的端到端加密流程追踪\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            完整的端到端加密流程追踪\n        \u003c/h2\u003e\n\u003ch3 id=\"从用户输入到数据库存储的完整追踪\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#从用户输入到数据库存储的完整追踪\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 从用户输入到数据库存储的完整追踪\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            从用户输入到数据库存储的完整追踪\n        \u003c/h3\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003eAPI密钥更新流程\u003c/strong\u003e：\u003c/p\u003e\n\u003cdiv class=\"mermaid block\" id=\"mermaid-1767322173316-7ncmf7i\"\u003esequenceDiagram\n    participant U as 用户\n    participant F as 前端\n    participant B as 后端\n    participant D as 数据库\n    \n    U-\u003e\u003eF: 输入API密钥\n    F-\u003e\u003eB: 获取RSA公钥\n    B-\u003e\u003eF: 返回公钥\n    F-\u003e\u003eF: RSA加密密钥\n    F-\u003e\u003eB: 发送加密数据\n    B-\u003e\u003eD: 直接存储加密数据\n    D-\u003e\u003eB: 确认存储\n    B-\u003e\u003eF: 返回成功状态\n    F-\u003e\u003eU: 显示成功消息\u003c/div\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003eAPI密钥使用流程\u003c/strong\u003e：\u003c/p\u003e\n\u003cdiv class=\"mermaid block\" id=\"mermaid-1767322173316-oj7lz3i\"\u003esequenceDiagram\n    participant U as 用户\n    participant F as 前端\n    participant B as 后端\n    participant D as 数据库\n    participant A as 大模型API\n    \n    U-\u003e\u003eF: 发送请求\n    F-\u003e\u003eB: 请求处理\n    B-\u003e\u003eD: 读取加密密钥\n    D-\u003e\u003eB: 返回加密数据\n    B-\u003e\u003eB: 临时解密密钥\n    B-\u003e\u003eA: 使用明文密钥调用API\n    A-\u003e\u003eB: 返回API响应\n    B-\u003e\u003eB: 清理明文密钥\n    B-\u003e\u003eF: 返回处理结果\n    F-\u003e\u003eU: 显示结果\u003c/div\u003e\n\u003ch3 id=\"每一步的数据状态变化\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#每一步的数据状态变化\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 每一步的数据状态变化\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            每一步的数据状态变化\n        \u003c/h3\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003eAPI密钥更新流程的数据状态\u003c/strong\u003e：\u003c/p\u003e\n\u003ctable class=\"w-full border-collapse mb-4 shadow-sm rounded-lg overflow-hidden\"\u003e\n\u003cthead class=\"bg-surface\"\u003e\n\u003ctr class=\"border-b border-gray-200\"\u003e\u003cth class=\"px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface\"\u003e步骤\u003c/th\u003e\u003cth class=\"px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface\"\u003e位置\u003c/th\u003e\u003cth class=\"px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface\"\u003e数据状态\u003c/th\u003e\u003cth class=\"px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface\"\u003e格式\u003c/th\u003e\u003cth class=\"px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface\"\u003e安全性\u003c/th\u003e\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody class=\"bg-background divide-y divide-gray-200\"\u003e\n\u003ctr class=\"border-b border-gray-200\"\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e1\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e用户输入\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e明文\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003eString\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e低\u003c/td\u003e\u003c/tr\u003e\n\u003ctr class=\"border-b border-gray-200\"\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e2\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e前端内存\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e明文\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003eString\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e低\u003c/td\u003e\u003c/tr\u003e\n\u003ctr class=\"border-b border-gray-200\"\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e3\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e前端加密\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e密文\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003eBase64\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e高\u003c/td\u003e\u003c/tr\u003e\n\u003ctr class=\"border-b border-gray-200\"\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e4\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e网络传输\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e密文+TLS\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003eEncrypted\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e极高\u003c/td\u003e\u003c/tr\u003e\n\u003ctr class=\"border-b border-gray-200\"\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e5\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e后端接收\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e密文\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003eBase64\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e高\u003c/td\u003e\u003c/tr\u003e\n\u003ctr class=\"border-b border-gray-200\"\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e6\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e数据库存储\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e密文\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003ersa:Base64\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e高\u003c/td\u003e\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003eAPI密钥使用流程的数据状态\u003c/strong\u003e：\u003c/p\u003e\n\u003ctable class=\"w-full border-collapse mb-4 shadow-sm rounded-lg overflow-hidden\"\u003e\n\u003cthead class=\"bg-surface\"\u003e\n\u003ctr class=\"border-b border-gray-200\"\u003e\u003cth class=\"px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface\"\u003e步骤\u003c/th\u003e\u003cth class=\"px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface\"\u003e位置\u003c/th\u003e\u003cth class=\"px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface\"\u003e数据状态\u003c/th\u003e\u003cth class=\"px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface\"\u003e格式\u003c/th\u003e\u003cth class=\"px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface\"\u003e安全性\u003c/th\u003e\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody class=\"bg-background divide-y divide-gray-200\"\u003e\n\u003ctr class=\"border-b border-gray-200\"\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e1\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e数据库读取\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e密文\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003ersa:Base64\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e高\u003c/td\u003e\u003c/tr\u003e\n\u003ctr class=\"border-b border-gray-200\"\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e2\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e后端临时解密\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e明文\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003eString\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e中\u003c/td\u003e\u003c/tr\u003e\n\u003ctr class=\"border-b border-gray-200\"\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e3\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e调用大模型API\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e明文\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003eString\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e中\u003c/td\u003e\u003c/tr\u003e\n\u003ctr class=\"border-b border-gray-200\"\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e4\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e内存清理\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e已销毁\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e-\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e极高\u003c/td\u003e\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch3 id=\"调试和监控的最佳实践\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#调试和监控的最佳实践\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 调试和监控的最佳实践\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            调试和监控的最佳实践\n        \u003c/h3\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e日志记录策略\u003c/strong\u003e：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"%2F%2F%20%E2%9C%85%20%E5%AE%89%E5%85%A8%E7%9A%84%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%0Aconsole.log('API%20key%20updated%20for%20user%3A'%2C%20user.id)%3B%0Aconsole.log('Using%20custom%20API%20key%3A'%2C%20user.useCustomApiKey)%3B%0A%2F%2F%20%E2%9D%8C%20%E5%8D%B1%E9%99%A9%E7%9A%84%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%0Aconsole.log('API%20key%3A'%2C%20apiKey)%3B%20%20%2F%2F%20%E6%B0%B8%E8%BF%9C%E4%B8%8D%E8%A6%81%E8%AE%B0%E5%BD%95%E6%95%8F%E6%84%9F%E6%95%B0%E6%8D%AE%0Aconsole.log('Decrypted%20key%3A'%2C%20decryptedKey)%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// ✅ 安全的日志记录\u003c/span\u003e\n\u003cspan class=\"hljs-variable language_ inline\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;API key updated for user:\u0026#x27;\u003c/span\u003e, user.\u003cspan class=\"hljs-property inline\"\u003eid\u003c/span\u003e);\n\u003cspan class=\"hljs-variable language_ inline\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;Using custom API key:\u0026#x27;\u003c/span\u003e, user.\u003cspan class=\"hljs-property inline\"\u003euseCustomApiKey\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment inline\"\u003e// ❌ 危险的日志记录\u003c/span\u003e\n\u003cspan class=\"hljs-variable language_ inline\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;API key:\u0026#x27;\u003c/span\u003e, apiKey);  \u003cspan class=\"hljs-comment inline\"\u003e// 永远不要记录敏感数据\u003c/span\u003e\n\u003cspan class=\"hljs-variable language_ inline\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;Decrypted key:\u0026#x27;\u003c/span\u003e, decryptedKey);\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e监控指标\u003c/strong\u003e：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"const%20securityMetrics%20%3D%20%7B%0AencryptionSuccessRate%3A%20'99.9%25'%2C%0AdecryptionErrorRate%3A%20'0.1%25'%2C%0AkeyRotationFrequency%3A%20'90%20days'%2C%0AsuspiciousActivityCount%3A%200%0A%7D%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e securityMetrics = {\n  \u003cspan class=\"hljs-attr inline\"\u003eencryptionSuccessRate\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;99.9%\u0026#x27;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr inline\"\u003edecryptionErrorRate\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;0.1%\u0026#x27;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr inline\"\u003ekeyRotationFrequency\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;90 days\u0026#x27;\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr inline\"\u003esuspiciousActivityCount\u003c/span\u003e: \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e\n};\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch2 id=\"系统架构总结与最佳实践\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#系统架构总结与最佳实践\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 系统架构总结与最佳实践\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            系统架构总结与最佳实践\n        \u003c/h2\u003e\n\u003ch3 id=\"rsa在现代web应用中的完整架构\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#rsa在现代web应用中的完整架构\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to RSA在现代Web应用中的完整架构\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            RSA在现代Web应用中的完整架构\n        \u003c/h3\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e通过对Questions Party项目的深入分析，我们可以总结出一套完整的RSA加密架构：\u003c/p\u003e\n\u003cdiv class=\"mermaid block\" id=\"mermaid-1767322173316-osw3zw5\"\u003egraph TB\n    subgraph \"安全边界\"\n        subgraph \"前端安全域\"\n            A[用户输入] --\u003e B[数据验证]\n            B --\u003e C[获取公钥]\n            C --\u003e D[RSA加密]\n            D --\u003e E[安全传输]\n        end\n        \n        subgraph \"传输安全域\"\n            E --\u003e F[HTTPS隧道]\n            F --\u003e G[TLS终结]\n        end\n        \n        subgraph \"后端安全域\"\n            G --\u003e H[数据接收]\n            H --\u003e I[身份验证]\n            I --\u003e J[直接存储密文]\n            J --\u003e K[按需临时解密]\n            K --\u003e L[业务处理]\n            L --\u003e M[内存清理]\n        end\n        \n        subgraph \"存储安全域\"\n            M --\u003e N[数据库]\n            N --\u003e O[备份加密]\n        end\n    end\n    \n    subgraph \"密钥管理域\"\n        P[密钥生成] --\u003e Q[密钥分发]\n        Q --\u003e R[密钥轮换]\n        R --\u003e S[密钥销毁]\n    end\n    \n    Q --\u003e C\n    P --\u003e K\u003c/div\u003e\n\u003ch2 id=\"写在最后\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#写在最后\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 写在最后\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            写在最后\n        \u003c/h2\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e在设计安全性加密架构的时候，我会假设：前端代码被逆向了，而中间传输被拦截了，它们的算法、数据完全暴露在攻击者的眼中，只有后端是安全的。在这种情况下，怎样的加密流程才能够确保安全呢？\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e倘若只有后端是安全的，那么要解决这个问题，只能从后端下手。即——我需要有某个安全的东西来对解密这一步进行把关，确保明文密钥只会临时存在于后端，将攻击者窃取密钥的可能性降到最低。\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e后来我想到了非对称加密。\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cem class=\"italic text-foreground\"\u003e愿你的加密如古老行星上的瘢痕般无法预测。公钥和私钥各为彼岸的一端，渡过中间长长的未知之河，带着你心中的信息安然来到彼岸吧。密钥如夜空中的双子星，公钥照亮世界，私钥守护自己；愿你的加密如古代的密语，只有真正理解的人才能解读其中的奥秘。在这个数字化的时代，让我们用代码编织更安全的未来，用数学构筑更牢固的防线！\u003c/em\u003e 🔐✨\u003c/p\u003e\n"])</script><script>self.__next_f.push([1,"d:[\"$\",\"$L1d\",null,{\"htmlContent\":\"$1e\",\"frontMatter\":{\"title\":\"密钥双刃剑：RSA加密在现代Web应用中的安全防护之道\",\"description\":\"从数学原理到工程实践——解析Questions Party中的端到端加密实现\",\"date\":\"2025-06-22\",\"author\":\"MilkWind\",\"tags\":[\"RSA\"],\"references\":{}},\"readingTime\":\"44 min read\",\"category\":\"questions-party\",\"tocItems\":[{\"id\":\"密钥双刃剑：rsa加密在现代web应用中的安全防护之道\",\"text\":\"密钥双刃剑：RSA加密在现代Web应用中的安全防护之道\",\"level\":1},{\"id\":\"rsa算法的数学基础\",\"text\":\"RSA算法的数学基础\",\"level\":2},{\"id\":\"大数分解的数学难题\",\"text\":\"大数分解的数学难题\",\"level\":3},{\"id\":\"欧拉函数和模运算\",\"text\":\"欧拉函数和模运算\",\"level\":3},{\"id\":\"公钥私钥的数学生成过程\",\"text\":\"公钥私钥的数学生成过程\",\"level\":3},{\"id\":\"扩展欧几里得算法详解\",\"text\":\"扩展欧几里得算法详解\",\"level\":3},{\"id\":\"加密解密的数学原理\",\"text\":\"加密解密的数学原理\",\"level\":3},{\"id\":\"rsa在web安全中的角色定位\",\"text\":\"RSA在Web安全中的角色定位\",\"level\":2},{\"id\":\"对称加密-vs-非对称加密的选择策略\",\"text\":\"对称加密 vs 非对称加密的选择策略\",\"level\":3},{\"id\":\"rsa-oaep填充方案的安全性\",\"text\":\"RSA-OAEP填充方案的安全性\",\"level\":3},{\"id\":\"questions-party安全架构设计\",\"text\":\"Questions Party安全架构设计\",\"level\":3},{\"id\":\"questions-party项目中的rsa实现架构\",\"text\":\"Questions Party项目中的RSA实现架构\",\"level\":2},{\"id\":\"整体安全架构设计\",\"text\":\"整体安全架构设计\",\"level\":3},{\"id\":\"前后端分离架构下的加密策略\",\"text\":\"前后端分离架构下的加密策略\",\"level\":3},{\"id\":\"密钥管理和分发机制\",\"text\":\"密钥管理和分发机制\",\"level\":3},{\"id\":\"密钥初始化设计\",\"text\":\"密钥初始化设计\",\"level\":3},{\"id\":\"加密数据的存储策略\",\"text\":\"加密数据的存储策略\",\"level\":3},{\"id\":\"后端rsa密钥管理与加密服务\",\"text\":\"后端RSA密钥管理与加密服务\",\"level\":2},{\"id\":\"rsacrypto类的单例模式设计\",\"text\":\"RSACrypto类的单例模式设计\",\"level\":3},{\"id\":\"密钥初始化策略\",\"text\":\"密钥初始化策略\",\"level\":3},{\"id\":\"nodejs-crypto模块的oaep实现\",\"text\":\"Node.js crypto模块的OAEP实现\",\"level\":3},{\"id\":\"前端rsa加密实现深度剖析\",\"text\":\"前端RSA加密实现深度剖析\",\"level\":2},{\"id\":\"web-crypto-api的使用\",\"text\":\"Web Crypto API的使用\",\"level\":3},{\"id\":\"pem格式密钥的处理\",\"text\":\"PEM格式密钥的处理\",\"level\":3},{\"id\":\"arraybuffer和base64的转换\",\"text\":\"ArrayBuffer和Base64的转换\",\"level\":3},{\"id\":\"api密钥更新流程的完整实现\",\"text\":\"API密钥更新流程的完整实现\",\"level\":2},{\"id\":\"updateapikey接口的设计思路\",\"text\":\"updateApiKey接口的设计思路\",\"level\":3},{\"id\":\"前端加密-→-传输-→-后端解密的完整流程\",\"text\":\"前端加密 → 传输 → 后端解密的完整流程\",\"level\":3},{\"id\":\"错误处理和用户体验优化\",\"text\":\"错误处理和用户体验优化\",\"level\":3},{\"id\":\"数据存储与解密策略\",\"text\":\"数据存储与解密策略\",\"level\":2},{\"id\":\"加密数据的数据库存储格式\",\"text\":\"加密数据的数据库存储格式\",\"level\":3},{\"id\":\"rsa前缀的标识机制\",\"text\":\"rsa:前缀的标识机制\",\"level\":3},{\"id\":\"解密时机的选择策略\",\"text\":\"解密时机的选择策略\",\"level\":3},{\"id\":\"内存中明文数据的生命周期管理\",\"text\":\"内存中明文数据的生命周期管理\",\"level\":3},{\"id\":\"安全性分析与攻击防护\",\"text\":\"安全性分析与攻击防护\",\"level\":2},{\"id\":\"常见的rsa攻击方式和防护措施\",\"text\":\"常见的RSA攻击方式和防护措施\",\"level\":3},{\"id\":\"填充攻击的原理和oaep的防护机制\",\"text\":\"填充攻击的原理和OAEP的防护机制\",\"level\":3},{\"id\":\"完整代码全解析\",\"text\":\"完整代码全解析\",\"level\":2},{\"id\":\"后端rsa密钥管理核心实现-srcutilsrsacryptojs\",\"text\":\"后端RSA密钥管理核心实现 (src/utils/rsaCrypto.js)\",\"level\":3},{\"id\":\"前端rsa加密核心实现-srcutilsrsacryptots\",\"text\":\"前端RSA加密核心实现 (src/utils/rsaCrypto.ts)\",\"level\":3},{\"id\":\"用户模型解密逻辑核心实现-srcmodelsuserjs\",\"text\":\"用户模型解密逻辑核心实现 (src/models/User.js)\",\"level\":3},{\"id\":\"认证控制器密钥管理核心实现-srccontrollersauthcontrollerjs\",\"text\":\"认证控制器密钥管理核心实现 (src/controllers/authController.js)\",\"level\":3},{\"id\":\"完整的端到端加密流程追踪\",\"text\":\"完整的端到端加密流程追踪\",\"level\":2},{\"id\":\"从用户输入到数据库存储的完整追踪\",\"text\":\"从用户输入到数据库存储的完整追踪\",\"level\":3},{\"id\":\"每一步的数据状态变化\",\"text\":\"每一步的数据状态变化\",\"level\":3},{\"id\":\"调试和监控的最佳实践\",\"text\":\"调试和监控的最佳实践\",\"level\":3},{\"id\":\"系统架构总结与最佳实践\",\"text\":\"系统架构总结与最佳实践\",\"level\":2},{\"id\":\"rsa在现代web应用中的完整架构\",\"text\":\"RSA在现代Web应用中的完整架构\",\"level\":3},{\"id\":\"写在最后\",\"text\":\"写在最后\",\"level\":2}],\"translations\":{\"common\":{\"welcome\":\"欢迎\",\"loading\":\"加载中...\",\"error\":\"出现了一些问题\",\"retry\":\"重试\",\"theme\":\"主题\",\"language\":\"语言\",\"light\":\"浅色\",\"dark\":\"深色\"},\"navigation\":{\"home\":\"首页\",\"personal\":\"个人\",\"works\":\"作品\",\"contributions\":\"贡献\",\"documents\":\"文档\",\"about\":\"关于\",\"contact\":\"联系\"},\"personal\":{\"technicalSkills\":\"技术技能\",\"email\":\"邮箱\",\"github\":\"代码仓库\",\"resume\":\"简历\",\"codeRepository\":\"代码仓库\",\"loadingPersonalInfo\":\"加载个人信息中...\",\"loadingResume\":\"加载简历中...\",\"closeResume\":\"关闭简历\",\"emailCopied\":\"邮箱已复制到剪贴板！\",\"galaxyDefaultDescription\":\"精通全栈开发技术，具备跨平台架构能力，擅长AI技术整合与高性能系统优化\",\"skillGalaxy\":\"技能星系\",\"stirGalaxy\":\"搅动星系\",\"stirring\":\"搅动中...\",\"fullStackEngineer\":\"MilkWind - 全栈工程师\",\"professionalProfile\":\"关于我\"},\"documents\":{\"technicalDocuments\":\"技术文档\",\"description\":\"基本原理、代码拆分以及一些碎碎念。\",\"articles\":\"文章\",\"categories\":\"分类\",\"allCategories\":\"所有分类\",\"noArticlesFound\":\"未找到文章\",\"noArticlesAvailable\":\"中文暂无文章。\",\"noArticlesInCategory\":\"该分类下未找到文章。\",\"readMore\":\"阅读更多\",\"loadingDocuments\":\"加载文档中...\",\"backToDocuments\":\"← 返回文档\",\"documentNotFound\":\"文档未找到\",\"documentNotFoundDescription\":\"请求的文档无法找到。\",\"technicalInsights\":\"技术拆解\",\"untitledDocument\":\"无标题文档\",\"byAuthor\":\"作者：\",\"search\":\"搜索文章...\",\"searchByTags\":\"按标签筛选\",\"searching\":\"搜索中...\",\"noSearchResults\":\"没有找到符合搜索条件的文章\",\"clearSearch\":\"清除搜索\",\"selectedTags\":\"已选标签\",\"allTags\":\"所有标签\",\"searchInTitle\":\"在标题、描述和内容中搜索\",\"enterImmersiveMode\":\"沉浸阅读\",\"exitImmersiveMode\":\"退出沉浸模式\",\"immersiveReading\":\"沉浸阅读模式\",\"exploreContent\":\"按分类探索内容\",\"browseBy\":\"浏览方式\",\"exploreAll\":\"所有内容汇总\",\"categoryDescription\":\"该分类下的文章\",\"totalArticles\":\"文章\",\"totalCategories\":\"分类\",\"foundArticles\":\"找到文章\",\"categoriesWithResults\":\"有结果的分类\"},\"works\":{\"workCases\":\"作品案例\",\"projects\":\"作品集\",\"loadingProjects\":\"加载项目中...\",\"grid\":\"网格\",\"stack\":\"堆叠\",\"of\":\"共\",\"workCasesPageTitle\":\"作品案例页面\",\"pageWorkingCorrectly\":\"此页面运行正常！路由配置正确。\",\"try3DVersion\":\"尝试3D版本\",\"dragToScroll\":\"拖拽滚动\",\"dragToChange\":\"拖拽切换\",\"swipeCards\":\"切换卡片\",\"keyboardNav\":\"键盘导航\"},\"contributions\":{\"contributionCases\":\"开源项目\",\"contributions\":\"贡献\",\"loadingContributions\":\"加载贡献中...\",\"grid\":\"网格\",\"stack\":\"堆叠\",\"of\":\"共\",\"contributionCasesPageTitle\":\"贡献案例页面\",\"pageWorkingCorrectly\":\"此页面运行正常！路由配置正确。\",\"try3DVersion\":\"尝试3D版本\",\"dragToScroll\":\"拖拽滚动\",\"dragToChange\":\"拖拽切换\",\"swipeCards\":\"切换卡片\",\"keyboardNav\":\"键盘导航\"},\"contribution\":{\"contributionPreview\":\"贡献预览\",\"accessible\":\"可访问\",\"code\":\"代码\",\"maintenance\":\"维护\",\"enhancement\":\"增强\",\"documentation\":\"文档\",\"community\":\"社区\",\"moreItems\":\"更多\",\"technicalDetails\":\"技术详情\",\"technologies\":\"技术栈：\",\"contributionDetail\":\"贡献详情\",\"description\":\"描述：\",\"seeDetails\":\"查看详情\",\"github\":\"代码仓库\",\"viewContribution\":\"查看贡献\",\"viewCode\":\"查看代码\"},\"project\":{\"projectPreview\":\"项目预览\",\"accessible\":\"可访问\",\"tool\":\"工具\",\"plugin\":\"插件\",\"toy\":\"小玩意\",\"moreItems\":\"更多\",\"technicalDetails\":\"技术详情\",\"technologies\":\"技术栈：\",\"description\":\"描述：\",\"seeDetails\":\"查看详情\",\"github\":\"GitHub\",\"gitee\":\"Gitee\",\"viewLiveDemo\":\"查看演示\",\"viewCode\":\"查看代码\",\"access\":\"访问\",\"videos\":\"视频\",\"watchVideo\":\"观看视频\",\"hasVideo\":\"有视频\"},\"codeblock\":{\"copy\":\"复制\",\"copySuccess\":\"代码已复制到剪贴板！\",\"copyError\":\"复制代码失败\",\"copyTooltip\":\"复制代码\"},\"toc\":{\"contents\":\"目录\",\"autoScroll\":\"自动滚动到章节\",\"collapse\":\"折叠\",\"expand\":\"展开\"},\"loading\":{\"loading\":\"加载中\",\"preparingExperience\":\"准备体验中\"}},\"lang\":\"zh\",\"theme\":\"light\"}]\n"])</script><script>self.__next_f.push([1,"12:null\n"])</script><script>self.__next_f.push([1,"18:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n11:null\n"])</script><script>self.__next_f.push([1,"1c:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"密钥双刃剑：RSA加密在现代Web应用中的安全防护之道 | Interactive Portfolio\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"从数学原理到工程实践——解析Questions Party中的端到端加密实现\"}],[\"$\",\"meta\",\"2\",{\"name\":\"author\",\"content\":\"Developer\"}],[\"$\",\"meta\",\"3\",{\"name\":\"keywords\",\"content\":\"portfolio,3D,interactive,web development,Three.js,Next.js\"}],[\"$\",\"meta\",\"4\",{\"property\":\"og:title\",\"content\":\"密钥双刃剑：RSA加密在现代Web应用中的安全防护之道 | Interactive Portfolio\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:description\",\"content\":\"从数学原理到工程实践——解析Questions Party中的端到端加密实现\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"7\",{\"property\":\"article:published_time\",\"content\":\"2025-06-22\"}],[\"$\",\"meta\",\"8\",{\"property\":\"article:tag\",\"content\":\"RSA\"}],[\"$\",\"meta\",\"9\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"10\",{\"name\":\"twitter:title\",\"content\":\"密钥双刃剑：RSA加密在现代Web应用中的安全防护之道 | Interactive Portfolio\"}],[\"$\",\"meta\",\"11\",{\"name\":\"twitter:description\",\"content\":\"从数学原理到工程实践——解析Questions Party中的端到端加密实现\"}],[\"$\",\"link\",\"12\",{\"rel\":\"icon\",\"href\":\"/MilkWind-Website/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"32x32\"}]],\"error\":null,\"digest\":\"$undefined\"}\n14:{\"metadata\":\"$1c:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script></body></html>