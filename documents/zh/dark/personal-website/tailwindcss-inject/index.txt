1:"$Sreact.fragment"
2:I[38735,["46","static/chunks/46-72724587da45cdb8.js","7177","static/chunks/app/layout-af4a6e723c0ff668.js"],"default"]
3:I[19945,["46","static/chunks/46-72724587da45cdb8.js","7177","static/chunks/app/layout-af4a6e723c0ff668.js"],"default"]
4:I[65337,["46","static/chunks/46-72724587da45cdb8.js","7177","static/chunks/app/layout-af4a6e723c0ff668.js"],"default"]
5:I[96190,["46","static/chunks/46-72724587da45cdb8.js","7177","static/chunks/app/layout-af4a6e723c0ff668.js"],"ClientProviders"]
6:I[87555,[],""]
7:I[51901,["8039","static/chunks/app/error-dda32be1d095a86c.js"],"default"]
8:I[31295,[],""]
9:I[6874,["6874","static/chunks/6874-fbe9a08eb79b991c.js","4345","static/chunks/app/not-found-9ff98b2ccf24cac7.js"],""]
a:I[94970,[],"ClientSegmentRoot"]
b:I[44065,["206","static/chunks/206-4f4cbf4d7156f437.js","3092","static/chunks/app/documents/layout-28408791defde09e.js"],"default"]
e:I[59665,[],"MetadataBoundary"]
10:I[59665,[],"OutletBoundary"]
13:I[74911,[],"AsyncMetadataOutlet"]
15:I[39460,["2415","static/chunks/2415-689c103fb3d2c28d.js","8610","static/chunks/8610-7bd3f91f3cf2a4d6.js","5650","static/chunks/app/documents/loading-1fa3f98b6e5a8e78.js"],"default"]
16:I[88610,["2415","static/chunks/2415-689c103fb3d2c28d.js","8610","static/chunks/8610-7bd3f91f3cf2a4d6.js","4209","static/chunks/app/loading-68f227fb49b3ac8c.js"],"default"]
17:I[59665,[],"ViewportBoundary"]
19:I[26614,[],""]
:HL["/_next/static/css/f034c804622acb16.css","style"]
:HL["/_next/static/css/b226d7ef8e491b72.css","style"]
:HL["/_next/static/css/5eacd01f773eed7f.css","style"]
0:{"P":null,"b":"8iYUZMse8Ho5_L3OUpHmO","p":"","c":["","documents","zh","dark","personal-website","tailwindcss-inject",""],"i":false,"f":[[["",{"children":["documents",{"children":[["slug","zh/dark/personal-website/tailwindcss-inject","c"],{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/f034c804622acb16.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}],["$","link","1",{"rel":"stylesheet","href":"/_next/static/css/b226d7ef8e491b72.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","suppressHydrationWarning":true,"children":["$","body",null,{"className":"__variable_d4c88d __variable_7b4e2b __variable_c3272d font-sans antialiased min-h-screen bg-background text-foreground","suppressHydrationWarning":true,"children":[["$","$L2",null,{}],["$","$L3",null,{}],["$","$L4",null,{}],["$","$L5",null,{"children":["$","$L6",null,{"parallelRouterKey":"children","error":"$7","errorStyles":[],"errorScripts":[],"template":["$","$L8",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","div",null,{"className":"z-10 relative min-h-screen flex items-center justify-center bg-background p-8","children":["$","div",null,{"className":"text-center max-w-md","children":[["$","div",null,{"className":"text-8xl font-bold text-primary mb-4","children":"404"}],["$","h2",null,{"className":"text-2xl font-bold text-foreground mb-4","children":"Page Not Found"}],["$","p",null,{"className":"text-foreground/70 mb-8","children":"The page you're looking for doesn't exist or has been moved to a different location."}],["$","div",null,{"className":"flex flex-col sm:flex-row gap-4 justify-center","children":[["$","$L9",null,{"href":"/","className":"px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary/80 transition-colors","children":"Go Home"}],["$","$L9",null,{"href":"/works","className":"px-6 py-2 border border-primary text-primary rounded-lg hover:bg-primary/10 transition-colors","children":"View Works"}]]}],["$","div",null,{"className":"absolute inset-0 overflow-hidden pointer-events-none -z-10","children":[["$","div",null,{"className":"absolute top-1/4 left-1/4 w-2 h-2 bg-primary/20 rounded-full animate-float"}],["$","div",null,{"className":"absolute top-3/4 right-1/4 w-3 h-3 bg-accent/20 rounded-full animate-float","style":{"animationDelay":"1s"}}],["$","div",null,{"className":"absolute bottom-1/4 left-1/3 w-1 h-1 bg-secondary/20 rounded-full animate-float","style":{"animationDelay":"2s"}}]]}]]}]}],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]}]]}]}]]}],{"children":["documents",["$","$1","c",{"children":[null,["$","$La",null,{"Component":"$b","slots":{"children":["$","$L6",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L8",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]},"params":{},"promise":"$@c"}]]}],{"children":[["slug","zh/dark/personal-website/tailwindcss-inject","c"],["$","$1","c",{"children":[null,["$","$L6",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L8",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":["$Ld",["$","$Le",null,{"children":"$Lf"}],[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/5eacd01f773eed7f.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","$L10",null,{"children":["$L11","$L12",["$","$L13",null,{"promise":"$@14"}]]}]]}],{},null,false]},null,false]},[["$","$L15","l",{}],[],[]],false]},[["$","$L16","l",{}],[],[]],false],["$","$1","h",{"children":[null,["$","$1","BBN1NwUv9COkXyanYNXri",{"children":[["$","$L17",null,{"children":"$L18"}],null]}],null]}],false]],"m":"$undefined","G":["$19","$undefined"],"s":false,"S":true}
1a:"$Sreact.suspense"
1b:I[74911,[],"AsyncMetadata"]
c:{}
f:["$","$1a",null,{"fallback":null,"children":["$","$L1b",null,{"promise":"$@1c"}]}]
1d:I[57340,["5584","static/chunks/b498d07c-095637f0f10883c6.js","2415","static/chunks/2415-689c103fb3d2c28d.js","6874","static/chunks/6874-fbe9a08eb79b991c.js","9554","static/chunks/9554-b714f9de28e85d30.js","1873","static/chunks/app/documents/%5B...slug%5D/page-8f3efa7e6c6c5377.js"],"DocumentPageClient"]
1e:T35763,<h1 id="样式注入：tailwindcss-preflight破坏后的浴火重生" class="group relative text-4xl font-bold mt-8 mb-4 text-foreground leading-tight">
            <a href="#样式注入：tailwindcss-preflight破坏后的浴火重生" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 样式注入：TailwindCSS Preflight破坏后的浴火重生">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            样式注入：TailwindCSS Preflight破坏后的浴火重生
        </h1>
<p class="text-base leading-7 mb-4 text-foreground">鱼和熊掌不可兼得。——那不可能，我全都要！</p>
<p class="text-base leading-7 mb-4 text-foreground">想象一个阳光明媚的春天…当你满怀期待地将精心编写的MDX文档渲染到页面上，却发现所有的标题、段落、代码块居然都变成了毫无样式的&quot;裸体HTML&quot;！那么——恭喜你，遇到了TailwindCSS Preflight的&quot;腹黑一面&quot;。这个看似无害的CSS重置机制，就像是一个过于热心的清洁工，把你家里的所有装饰都当成垃圾扔掉啦！</p>
<p class="text-base leading-7 mb-4 text-foreground">为此，你最便捷的解决办法也许是哄着TailwindCSS ：&quot;好好好，CSS的渲染大权在你手上，我按你的来行了吧！委屈一下MDX，在她身上插点你的东西吧！&quot;</p>
<p class="text-base leading-7 mb-4 text-foreground">如果你想歪了，那是你的问题，与我无关（摊手，欠揍脸）</p>
<p class="text-base leading-7 mb-4 text-foreground">于是…当当当当！样式注入系统，应运而生！</p>
<p class="text-base leading-7 mb-4 text-foreground">回归正题，在这篇文章中，我将从问题的根源开始，逐步深入每一个技术细节，全面剖析这个让文档重获样式的涅槃之术吧。（真有这么高大上么？）</p>
<h2 id="问题根源分析：preflight的双刃剑效应" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#问题根源分析：preflight的双刃剑效应" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 问题根源分析：Preflight的双刃剑效应">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            问题根源分析：Preflight的双刃剑效应
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">在深入解决方案之前，我们需要理解Preflight的工作机制。</p>
<h3 id="tailwindcss-preflight机制解析" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#tailwindcss-preflight机制解析" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to TailwindCSS Preflight机制解析">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            TailwindCSS Preflight机制解析
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="css" data-code="%2F*%20Preflight%E9%87%8D%E7%BD%AE%E6%A0%B7%E5%BC%8F%E7%A4%BA%E4%BE%8B%20*%2F%0Ah1%2C%20h2%2C%20h3%2C%20h4%2C%20h5%2C%20h6%20%7B%0Afont-size%3A%20inherit%3B%0Afont-weight%3A%20inherit%3B%0A%7D%0Ap%2C%20blockquote%2C%20dl%2C%20dd%2C%20h1%2C%20h2%2C%20h3%2C%20h4%2C%20h5%2C%20h6%2C%20hr%2C%20figure%2C%20p%2C%20pre%20%7B%0Amargin%3A%200%3B%0A%7D%0Aol%2C%20ul%20%7B%0Alist-style%3A%20none%3B%0Amargin%3A%200%3B%0Apadding%3A%200%3B%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">css</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-css"><span class="hljs-comment inline">/* Preflight重置样式示例 */</span>
<span class="hljs-selector-tag inline">h1</span>, <span class="hljs-selector-tag inline">h2</span>, <span class="hljs-selector-tag inline">h3</span>, <span class="hljs-selector-tag inline">h4</span>, <span class="hljs-selector-tag inline">h5</span>, <span class="hljs-selector-tag inline">h6</span> {
  <span class="hljs-attribute inline">font-size</span>: inherit;
  <span class="hljs-attribute inline">font-weight</span>: inherit;
}

<span class="hljs-selector-tag inline">p</span>, <span class="hljs-selector-tag inline">blockquote</span>, <span class="hljs-selector-tag inline">dl</span>, <span class="hljs-selector-tag inline">dd</span>, <span class="hljs-selector-tag inline">h1</span>, <span class="hljs-selector-tag inline">h2</span>, <span class="hljs-selector-tag inline">h3</span>, <span class="hljs-selector-tag inline">h4</span>, <span class="hljs-selector-tag inline">h5</span>, <span class="hljs-selector-tag inline">h6</span>, hr, <span class="hljs-selector-tag inline">figure</span>, <span class="hljs-selector-tag inline">p</span>, pre {
  <span class="hljs-attribute inline">margin</span>: <span class="hljs-number inline">0</span>;
}

<span class="hljs-selector-tag inline">ol</span>, <span class="hljs-selector-tag inline">ul</span> {
  <span class="hljs-attribute inline">list-style</span>: none;
  <span class="hljs-attribute inline">margin</span>: <span class="hljs-number inline">0</span>;
  <span class="hljs-attribute inline">padding</span>: <span class="hljs-number inline">0</span>;
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">Preflight的设计初衷</strong>是消除浏览器默认样式的差异，提供一个&quot;干净的画布&quot;。这个想法本身很棒——在不同浏览器中保持一致的起点，避免各种奇怪的默认样式差异。</p>
<p class="text-base leading-7 mb-4 text-foreground">但是！当我们使用Remarkable将MDX转换为HTML时，生成的是语义化的HTML结构：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="html" data-code="h1%3E%E6%A0%87%E9%A2%98h1%3E%0Ap%3E%E6%AE%B5%E8%90%BD%E5%86%85%E5%AE%B9p%3E%0Acode%3E%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5code%3E%0Aul%3E%0Ali%3E%E5%88%97%E8%A1%A8%E9%A1%B9li%3E%0Aul%3E">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">html</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-html"><span class="hljs-tag inline">&lt;<span class="hljs-name inline">h1</span>&gt;</span>标题<span class="hljs-tag inline">&lt;/<span class="hljs-name inline">h1</span>&gt;</span>
<span class="hljs-tag inline">&lt;<span class="hljs-name inline">p</span>&gt;</span>段落内容<span class="hljs-tag inline">&lt;/<span class="hljs-name inline">p</span>&gt;</span>
<span class="hljs-tag inline">&lt;<span class="hljs-name inline">code</span>&gt;</span>代码片段<span class="hljs-tag inline">&lt;/<span class="hljs-name inline">code</span>&gt;</span>
<span class="hljs-tag inline">&lt;<span class="hljs-name inline">ul</span>&gt;</span>
  <span class="hljs-tag inline">&lt;<span class="hljs-name inline">li</span>&gt;</span>列表项<span class="hljs-tag inline">&lt;/<span class="hljs-name inline">li</span>&gt;</span>
<span class="hljs-tag inline">&lt;/<span class="hljs-name inline">ul</span>&gt;</span>
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">这些HTML标签本来应该有浏览器的默认样式，让它们看起来像&quot;标题&quot;、&quot;段落&quot;、&quot;代码&quot;。但Preflight一上场，直接把所有默认样式都重置了——所有文字看起来都一样，没有层次，没有重点，像是一篇渲染出了问题的文档。</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">为什么不能简单地关闭Preflight</strong>？</p>
<p class="text-base leading-7 mb-4 text-foreground">关闭Preflight看似是最简单的解决方案，但这会带来更大的问题：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed">不同浏览器的默认样式差异会重新出现</li>
<li class="text-foreground leading-relaxed">你的其他UI组件可能会出现意想不到的样式问题</li>
<li class="text-foreground leading-relaxed">TailwindCSS的许多工具类是基于重置后的基础样式设计的</li>
</ul>
<h3 id="mdx到html的渲染链路" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#mdx到html的渲染链路" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to MDX到HTML的渲染链路">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            MDX到HTML的渲染链路
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">总结一下问题发生的完整链路：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="MDX%E6%BA%90%E6%96%87%E4%BB%B6%20%E2%86%92%20Remarkable%E8%A7%A3%E6%9E%90%20%E2%86%92%20HTML%E5%AD%97%E7%AC%A6%E4%B8%B2%20%E2%86%92%20Preflight%E9%87%8D%E7%BD%AE%20%E2%86%92%20%E6%A0%B7%E5%BC%8F%E4%B8%A2%E5%A4%B1%E7%9A%84%E7%BB%93%E6%9E%9C">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-variable constant_ inline">MDX</span>源文件 → <span class="hljs-title class_ inline">Remarkable</span>解析 → <span class="hljs-variable constant_ inline">HTML</span>字符串 → <span class="hljs-title class_ inline">Preflight</span>重置 → 样式丢失的结果
</code></pre>
            </div>
        
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">MDX源文件</strong>：包含语义化的Markdown语法</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Remarkable解析</strong>：生成纯净的HTML结构，没有任何CSS类名</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">HTML字符串</strong>：插入到React组件中渲染</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Preflight重置</strong>：TailwindCSS的基础层移除所有默认样式</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">最终结果</strong>：一堆没有样式的HTML元素</li>
</ol>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">为什么传统的CSS类名方案在这里失效</strong>？</p>
<p class="text-base leading-7 mb-4 text-foreground">你可能会想：&quot;为什么不直接给这些标签加上CSS类名？&quot; 问题在于：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed">Remarkable生成的是字符串形式的HTML，不是React组件</li>
<li class="text-foreground leading-relaxed">我们无法在Markdown语法中为每个标签手动添加类名</li>
<li class="text-foreground leading-relaxed">即使能添加，也会让Markdown失去简洁性</li>
</ul>
<p class="text-base leading-7 mb-4 text-foreground">这就引出了样式注入的必要性——我们需要一个系统，能够自动为生成的HTML标签添加合适的TailwindCSS类名。</p>
<h2 id="样式映射配置设计" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#样式映射配置设计" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 样式映射配置设计">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            样式映射配置设计
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">在开始编写复杂的注入算法之前，我们需要设计一个样式分明（<del class="line-through opacity-60">我想怎么写就怎么写，一切样式皆由我控！</del>自由度非常高）的配置系统。</p>
<h3 id="json配置文件" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#json配置文件" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to JSON配置文件">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            JSON配置文件
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="json" data-code="%7B%0A%22h1%22%3A%20%22text-4xl%20font-bold%20mt-8%20mb-4%20text-foreground%20leading-tight%22%2C%0A%22h2%22%3A%20%22text-3xl%20font-semibold%20mt-6%20mb-3%20text-foreground%20leading-tight%22%2C%0A%22p%22%3A%20%22text-base%20leading-7%20mb-4%20text-foreground%22%2C%0A%22code%22%3A%20%22bg-surface%20text-primary%20px-1.5%20py-0.5%20rounded%20text-sm%20font-mono%22%2C%0A%22ul%22%3A%20%22list-disc%20list-inside%20mb-4%20pl-6%20space-y-2%22%2C%0A%22li%22%3A%20%22text-foreground%20leading-relaxed%22%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">json</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-json"><span class="hljs-punctuation inline">{</span>
  <span class="hljs-attr inline">&quot;h1&quot;</span><span class="hljs-punctuation inline">:</span> <span class="hljs-string inline">&quot;text-4xl font-bold mt-8 mb-4 text-foreground leading-tight&quot;</span><span class="hljs-punctuation inline">,</span>
  <span class="hljs-attr inline">&quot;h2&quot;</span><span class="hljs-punctuation inline">:</span> <span class="hljs-string inline">&quot;text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight&quot;</span><span class="hljs-punctuation inline">,</span>
  <span class="hljs-attr inline">&quot;p&quot;</span><span class="hljs-punctuation inline">:</span> <span class="hljs-string inline">&quot;text-base leading-7 mb-4 text-foreground&quot;</span><span class="hljs-punctuation inline">,</span>
  <span class="hljs-attr inline">&quot;code&quot;</span><span class="hljs-punctuation inline">:</span> <span class="hljs-string inline">&quot;bg-surface text-primary px-1.5 py-0.5 rounded text-sm font-mono&quot;</span><span class="hljs-punctuation inline">,</span>
  <span class="hljs-attr inline">&quot;ul&quot;</span><span class="hljs-punctuation inline">:</span> <span class="hljs-string inline">&quot;list-disc list-inside mb-4 pl-6 space-y-2&quot;</span><span class="hljs-punctuation inline">,</span>
  <span class="hljs-attr inline">&quot;li&quot;</span><span class="hljs-punctuation inline">:</span> <span class="hljs-string inline">&quot;text-foreground leading-relaxed&quot;</span>
<span class="hljs-punctuation inline">}</span>
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">标签到样式类的映射策略</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">每个HTML标签对应一个TailwindCSS类名字符串，这种一对一的映射关系简单直接，避免了复杂的条件判断。</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">主题系统适配的设计考虑</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">注意每个样式类都使用了主题系统的颜色变量：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="" data-code="text-foreground%0Abg-surface%0Atext-primary">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">code</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code><span class="hljs-keyword inline">text</span>-foreground
bg-<span class="hljs-keyword inline">surface</span>
<span class="hljs-keyword inline">text</span>-primary
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">这些类名映射到CSS自定义属性，确保在主题切换时，文档内容能够无缝适配新的颜色方案。</p>
<h2 id="核心注入算法：正则表达式驱动的捕获与替换" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#核心注入算法：正则表达式驱动的捕获与替换" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 核心注入算法：正则表达式驱动的捕获与替换">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            核心注入算法：正则表达式驱动的捕获与替换
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">从我个人体感上来说，至少95%的匹配需求正则可以用AI来生成。（扣脑袋，沉思状）</p>
<h3 id="标签匹配的正则魔法" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#标签匹配的正则魔法" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 标签匹配的正则魔法">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            标签匹配的正则魔法
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20tagRegex%20%3D%20new%20RegExp(%60%24%7Btag%7D(%5C%5Cs%5B%5E%3E%5D*)%3F(%3F%3A%3E%7C%5C%5Cs*%2F%3E)%60%2C%20'gi')%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> tagRegex = <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">RegExp</span>(<span class="hljs-string inline">`&lt;<span class="hljs-subst inline">${tag}</span>(\\s[^&gt;]*)?(?:&gt;|\\s*/&gt;)`</span>, <span class="hljs-string inline">&#x27;gi&#x27;</span>);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">逐字符解析正则表达式：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><code>&lt;${tag}</code>：匹配开始的尖括号和标签名</li>
<li class="text-foreground leading-relaxed"><code>(\\s[^&gt;]*)?</code>：可选的属性部分
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><code>\\s</code>：至少一个空白字符</li>
<li class="text-foreground leading-relaxed"><code>[^&gt;]*</code>：任意数量的非<code>&gt;</code>字符（属性内容）</li>
<li class="text-foreground leading-relaxed"><code>?</code>：整个属性部分是可选的</li>
</ul></li>
<li class="text-foreground leading-relaxed"><code>(?:&gt;|\\s*/&gt;)</code>：非捕获组，匹配结束部分
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><code>&gt;</code>：普通标签的结束</li>
<li class="text-foreground leading-relaxed"><code>|</code>：或者</li>
<li class="text-foreground leading-relaxed"><code>\\s*/&gt;</code>：自闭合标签的结束（可能有空格）</li>
</ul></li>
<li class="text-foreground leading-relaxed"><code>gi</code>：全局匹配，忽略大小写</li>
</ul>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">为什么要匹配开始标签而不是整个标签对</strong>？</p>
<p class="text-base leading-7 mb-4 text-foreground">因为我们只需要在开始标签中添加<code>class</code>属性，闭合标签不需要修改。这种设计可以避免考虑到复杂的嵌套匹配，而且支持自闭合标签（如<code>&lt;img/&gt;</code>、<code>&lt;br/&gt;</code>）</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">自闭合标签和普通标签的不同处理</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">正则表达式中的<code>(?:&gt;|\\s*/&gt;</code>部分同时处理了这两种情况，无需额外的条件判断。</p>
<h3 id="类名注入算法" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#类名注入算法" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 类名注入算法">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            类名注入算法
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="styledContent%20%3D%20styledContent.replace(tagRegex%2C%20(match)%20%3D%3E%20%7B%0A%2F%2F%20%E9%98%B2%E9%87%8D%E5%A4%8D%E6%B3%A8%E5%85%A5%E6%A3%80%E6%9F%A5%0Aif%20(match.includes(classes.split('%20')%5B0%5D))%20%7B%0Areturn%20match%3B%0A%7D%0A%2F%2F%20%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E5%B7%B2%E6%9C%89class%E5%B1%9E%E6%80%A7%0Aconst%20classMatch%20%3D%20match.match(%2Fclass%3D%5B%22'%5D(%5B%5E%22'%5D*)%5B%22'%5D%2F)%3B%0Aif%20(classMatch)%20%7B%0A%2F%2F%20%E5%90%88%E5%B9%B6%E7%8E%B0%E6%9C%89%E7%B1%BB%E5%90%8D%E7%9A%84%E9%80%BB%E8%BE%91%0Aconst%20existingClasses%20%3D%20classMatch%5B1%5D%3B%0Aconst%20newClasses%20%3D%20classes.split('%20').filter(cls%20%3D%3E%20!existingClasses.includes(cls)).join('%20')%3B%0Aif%20(newClasses)%20%7B%0Areturn%20match.replace(%2Fclass%3D%5B%22'%5D(%5B%5E%22'%5D*)%5B%22'%5D%2F%2C%20%60class%3D%22%241%20%24%7BnewClasses%7D%22%60)%3B%0A%7D%0Areturn%20match%3B%0A%7D%20else%20%7B%0A%2F%2F%20%E6%B7%BB%E5%8A%A0%E6%96%B0%E7%B1%BB%E5%90%8D%E7%9A%84%E9%80%BB%E8%BE%91%0Aif%20(match.endsWith('%2F%3E'))%20%7B%0A%2F%2F%20%E8%87%AA%E9%97%AD%E5%90%88%E6%A0%87%E7%AD%BE%0Areturn%20match.replace(%2F%5Cs*%5C%2F%3E%24%2F%2C%20%60%20class%3D%22%24%7Bclasses%7D%22%20%2F%3E%60)%3B%0A%7D%20else%20%7B%0A%2F%2F%20%E6%99%AE%E9%80%9A%E5%BC%80%E5%A7%8B%E6%A0%87%E7%AD%BE%0Areturn%20match.replace(%2F%3E%24%2F%2C%20%60%20class%3D%22%24%7Bclasses%7D%22%3E%60)%3B%0A%7D%0A%7D%0A%7D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript">styledContent = styledContent.<span class="hljs-title function_ inline">replace</span>(tagRegex, <span class="hljs-function inline">(<span class="hljs-params inline">match</span>) =&gt;</span> {
    <span class="hljs-comment inline">// 防重复注入检查</span>
    <span class="hljs-keyword inline">if</span> (match.<span class="hljs-title function_ inline">includes</span>(classes.<span class="hljs-title function_ inline">split</span>(<span class="hljs-string inline">&#x27; &#x27;</span>)[<span class="hljs-number inline">0</span>])) {
        <span class="hljs-keyword inline">return</span> match;
    }

    <span class="hljs-comment inline">// 检查是否已有class属性</span>
    <span class="hljs-keyword inline">const</span> classMatch = match.<span class="hljs-title function_ inline">match</span>(<span class="hljs-regexp inline">/class=[&quot;&#x27;]([^&quot;&#x27;]*)[&quot;&#x27;]/</span>);

    <span class="hljs-keyword inline">if</span> (classMatch) {
        <span class="hljs-comment inline">// 合并现有类名的逻辑</span>
        <span class="hljs-keyword inline">const</span> existingClasses = classMatch[<span class="hljs-number inline">1</span>];
        <span class="hljs-keyword inline">const</span> newClasses = classes.<span class="hljs-title function_ inline">split</span>(<span class="hljs-string inline">&#x27; &#x27;</span>).<span class="hljs-title function_ inline">filter</span>(<span class="hljs-function inline"><span class="hljs-params inline">cls</span> =&gt;</span> !existingClasses.<span class="hljs-title function_ inline">includes</span>(cls)).<span class="hljs-title function_ inline">join</span>(<span class="hljs-string inline">&#x27; &#x27;</span>);
        <span class="hljs-keyword inline">if</span> (newClasses) {
            <span class="hljs-keyword inline">return</span> match.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/class=[&quot;&#x27;]([^&quot;&#x27;]*)[&quot;&#x27;]/</span>, <span class="hljs-string inline">`class=&quot;$1 <span class="hljs-subst inline">${newClasses}</span>&quot;`</span>);
        }
        <span class="hljs-keyword inline">return</span> match;
    } <span class="hljs-keyword inline">else</span> {
        <span class="hljs-comment inline">// 添加新类名的逻辑</span>
        <span class="hljs-keyword inline">if</span> (match.<span class="hljs-title function_ inline">endsWith</span>(<span class="hljs-string inline">&#x27;/&gt;&#x27;</span>)) {
            <span class="hljs-comment inline">// 自闭合标签</span>
            <span class="hljs-keyword inline">return</span> match.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/\s*\/&gt;$/</span>, <span class="hljs-string inline">` class=&quot;<span class="hljs-subst inline">${classes}</span>&quot; /&gt;`</span>);
        } <span class="hljs-keyword inline">else</span> {
            <span class="hljs-comment inline">// 普通开始标签</span>
            <span class="hljs-keyword inline">return</span> match.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&gt;$/</span>, <span class="hljs-string inline">` class=&quot;<span class="hljs-subst inline">${classes}</span>&quot;&gt;`</span>);
        }
    }
});
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">类名合并vs新增的判断逻辑</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">系统首先检查标签是否已有<code>class</code>属性：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">有</strong>：将新类名与现有类名合并，避免重复</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">无</strong>：直接添加新的<code>class</code>属性</li>
</ul>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">重复类名的去重算法</strong>：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20newClasses%20%3D%20classes.split('%20').filter(cls%20%3D%3E%20!existingClasses.includes(cls)).join('%20')%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> newClasses = classes.<span class="hljs-title function_ inline">split</span>(<span class="hljs-string inline">&#x27; &#x27;</span>).<span class="hljs-title function_ inline">filter</span>(<span class="hljs-function inline"><span class="hljs-params inline">cls</span> =&gt;</span> !existingClasses.<span class="hljs-title function_ inline">includes</span>(cls)).<span class="hljs-title function_ inline">join</span>(<span class="hljs-string inline">&#x27; &#x27;</span>);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">这行代码确保了不会添加重复的类名。</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">属性引号的处理</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">正则表达式<code>/class=[&quot;']([^&quot;']*)[&quot;']/</code>同时支持单引号和双引号，保证了不同情况的兼容性。</p>
<h3 id="防重复注入的保护机制" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#防重复注入的保护机制" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 防重复注入的保护机制">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            防重复注入的保护机制
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="if%20(match.includes(classes.split('%20')%5B0%5D))%20%7B%0Areturn%20match%3B%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">if</span> (match.<span class="hljs-title function_ inline">includes</span>(classes.<span class="hljs-title function_ inline">split</span>(<span class="hljs-string inline">&#x27; &#x27;</span>)[<span class="hljs-number inline">0</span>])) {
    <span class="hljs-keyword inline">return</span> match;
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">为什么检查第一个类名就够了</strong>？</p>
<p class="text-base leading-7 mb-4 text-foreground">这是一个仅存在两种情况（注入过/没注入过）下可采用的判断方式。假设算法为<code>h1</code>标签注入的类名是<code>&quot;text-4xl font-bold mt-8 mb-4&quot;</code>，而在检查时，只需检查<code>text-4xl</code>是否已存在即可。</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">性能优化vs准确性的权衡</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">虽然理论上可能存在误判（其他地方也使用了<code>text-4xl</code>），但在实际应用中，这种概率极低，而性能提升是显著的。</p>
<h2 id="代码块增强：这个小盒子才是代码永远的家" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#代码块增强：这个小盒子才是代码永远的家" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 代码块增强：这个小盒子才是代码永远的家">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            代码块增强：这个小盒子才是代码永远的家
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">普通的样式注入只能给人凑合看看，但对于代码块，程序员的执着会要求更多功能——语法高亮、复制功能、主题切换，以及现代化的交互体验。</p>
<h3 id="代码块识别与解构" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#代码块识别与解构" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 代码块识别与解构">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            代码块识别与解构
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20preCodeRegex%20%3D%20%2F%5D*%3F)%3E(%5B%5Cs%5CS%5D*%3F)%2Fg%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> preCodeRegex = <span class="hljs-regexp inline">/&lt;pre&gt;&lt;code([^&gt;]*?)&gt;([\s\S]*?)&lt;\/code&gt;&lt;\/pre&gt;/g</span>;
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">嵌套标签的正则匹配挑战</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">代码块的HTML结构是嵌套的：<code>&lt;pre&gt;&lt;code&gt;内容&lt;/code&gt;&lt;/pre&gt;</code>。这个正则表达式需要：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed">精确匹配开始的<code>&lt;pre&gt;&lt;code&gt;</code></li>
<li class="text-foreground leading-relaxed">捕获<code>&lt;code&gt;</code>标签的属性（包含语言信息）</li>
<li class="text-foreground leading-relaxed">捕获代码内容（可能包含换行符）</li>
<li class="text-foreground leading-relaxed">匹配结束的<code>&lt;/code&gt;&lt;/pre&gt;</code></li>
</ul>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">非贪婪匹配的重要性</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground"><code>([\s\S]*?)</code>中的<code>?</code>实现了非贪婪匹配，确保在有多个代码块时不会匹配过度。</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">属性提取的技巧</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground"><code>([^&gt;]*?)</code>捕获<code>&lt;code&gt;</code>标签内的所有属性，为后续的语言识别做准备。</p>
<h3 id="语言标识符的提取算法" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#语言标识符的提取算法" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 语言标识符的提取算法">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            语言标识符的提取算法
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20languageMatch%20%3D%20attributes.match(%2Fclass%3D%5B%22'%5D(%5B%5E%22'%5D*language-(%5B%5E%22'%5Cs%5D%2B)%5B%5E%22'%5D*)%5B%22'%5D%2F)%3B%0Aconst%20language%20%3D%20languageMatch%20%3F%20languageMatch%5B2%5D%20%3A%20''%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> languageMatch = attributes.<span class="hljs-title function_ inline">match</span>(<span class="hljs-regexp inline">/class=[&quot;&#x27;]([^&quot;&#x27;]*language-([^&quot;&#x27;\s]+)[^&quot;&#x27;]*)[&quot;&#x27;]/</span>);
<span class="hljs-keyword inline">const</span> language = languageMatch ? languageMatch[<span class="hljs-number inline">2</span>] : <span class="hljs-string inline">&#x27;&#x27;</span>;
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">highlight.js的类名规范解析</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">highlight.js使用<code>language-xxx</code>的类名格式来标识代码语言，如：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><code>language-typescript</code></li>
<li class="text-foreground leading-relaxed"><code>language-javascript</code></li>
<li class="text-foreground leading-relaxed"><code>language-python</code></li>
<li class="text-foreground leading-relaxed">…</li>
</ul>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">复杂正则表达式的分组捕获</strong>：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed">第一个捕获组<code>([^&quot;']*language-([^&quot;'\s]+)[^&quot;']*)</code>：捕获整个class属性值</li>
<li class="text-foreground leading-relaxed">第二个捕获组<code>([^&quot;'\s]+)</code>：捕获具体的语言名称</li>
</ul>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">默认值的优雅降级</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">如果无法识别语言，默认显示<code>'code'</code>，确保用户界面的一致性。</p>
<h3 id="html实体的还原处理" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#html实体的还原处理" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to HTML实体的还原处理">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            HTML实体的还原处理
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20cleanContent%20%3D%20content%0A.replace(%2F%26lt%3B%2Fg%2C%20')%0A.replace(%2F%26gt%3B%2Fg%2C%20'%3E')%0A.replace(%2F%26amp%3B%2Fg%2C%20'%26')%0A.replace(%2F%22%2Fg%2C%20'%22')%0A.replace(%2F'%2Fg%2C%20%22'%22)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> cleanContent = content
    .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&amp;lt;/g</span>, <span class="hljs-string inline">&#x27;&lt;&#x27;</span>)
    .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&amp;gt;/g</span>, <span class="hljs-string inline">&#x27;&gt;&#x27;</span>)
    .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&amp;amp;/g</span>, <span class="hljs-string inline">&#x27;&amp;&#x27;</span>)
    .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&amp;quot;/g</span>, <span class="hljs-string inline">&#x27;&quot;&#x27;</span>)
    .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&amp;#x27;/g</span>, <span class="hljs-string inline">&quot;&#x27;&quot;</span>);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">为什么需要HTML实体还原</strong>？</p>
<p class="text-base leading-7 mb-4 text-foreground">Remarkable在处理代码内容时，会将特殊字符转换为HTML实体以避免XSS攻击。但在复制功能中，用户期望的是原始代码，而不是HTML实体。</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">替换顺序的重要性</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">注意<code>&amp;amp;</code>的替换必须在最后，因为其他实体（如<code>&amp;lt;</code>）本身包含<code>&amp;</code>字符。错误的顺序会导致二次替换。</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">URL编码在data属性中的应用</strong>：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="data-code%3D%22%24%7BencodeURIComponent(cleanContent)%7D%22">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript">data-code=<span class="hljs-string inline">&quot;${encodeURIComponent(cleanContent)}&quot;</span>
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">清理后的代码通过URL编码存储在data属性中，确保复制功能能够获取到正确的内容。</p>
<h3 id="增强代码块的html结构设计" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#增强代码块的html结构设计" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 增强代码块的HTML结构设计">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            增强代码块的HTML结构设计
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">生成的增强代码块具有复杂的HTML结构：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="html" data-code="div%20class%3D%22enhanced-codeblock%20relative%20mb-6%20rounded-lg%20border%20bg-background%20border-gray-200...%22%3E%0Adiv%20class%3D%22codeblock-header%20flex%20items-center%20justify-between%20px-4%20py-2%20bg-surface...%22%3E%0Aspan%20class%3D%22codeblock-language%20text-xs%20font-medium%20text-foreground%20opacity-70...%22%3Etypescriptspan%3E%0Abutton%20class%3D%22codeblock-copy-btn%20inline-flex%20items-center%20bg-background%20hover%3Abg-surface%20text-foreground%20hover%3Atext-primary...%22%3E%0Abutton%3E%0Adiv%3E%0Apre%20class%3D%22codeblock-content%20p-4%20overflow-x-auto%20bg-surface%20text-foreground...%22%3E%0Acode%20class%3D%22language-typescript%22%3E%E5%8E%9F%E5%A7%8B%E4%BB%A3%E7%A0%81%E5%86%85%E5%AE%B9code%3E%0Apre%3E%0Adiv%3E">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">html</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-html"><span class="hljs-tag inline">&lt;<span class="hljs-name inline">div</span> <span class="hljs-attr inline">class</span>=<span class="hljs-string inline">&quot;enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200...&quot;</span>&gt;</span>
    <span class="hljs-tag inline">&lt;<span class="hljs-name inline">div</span> <span class="hljs-attr inline">class</span>=<span class="hljs-string inline">&quot;codeblock-header flex items-center justify-between px-4 py-2 bg-surface...&quot;</span>&gt;</span>
        <span class="hljs-tag inline">&lt;<span class="hljs-name inline">span</span> <span class="hljs-attr inline">class</span>=<span class="hljs-string inline">&quot;codeblock-language text-xs font-medium text-foreground opacity-70...&quot;</span>&gt;</span>typescript<span class="hljs-tag inline">&lt;/<span class="hljs-name inline">span</span>&gt;</span>
        <span class="hljs-tag inline">&lt;<span class="hljs-name inline">button</span> <span class="hljs-attr inline">class</span>=<span class="hljs-string inline">&quot;codeblock-copy-btn inline-flex items-center bg-background hover:bg-surface text-foreground hover:text-primary...&quot;</span>&gt;</span>
            <span class="hljs-comment inline">&lt;!-- SVG图标和文字 --&gt;</span>
        <span class="hljs-tag inline">&lt;/<span class="hljs-name inline">button</span>&gt;</span>
    <span class="hljs-tag inline">&lt;/<span class="hljs-name inline">div</span>&gt;</span>
    <span class="hljs-tag inline">&lt;<span class="hljs-name inline">pre</span> <span class="hljs-attr inline">class</span>=<span class="hljs-string inline">&quot;codeblock-content p-4 overflow-x-auto bg-surface text-foreground...&quot;</span>&gt;</span>
        <span class="hljs-tag inline">&lt;<span class="hljs-name inline">code</span> <span class="hljs-attr inline">class</span>=<span class="hljs-string inline">&quot;language-typescript&quot;</span>&gt;</span>原始代码内容<span class="hljs-tag inline">&lt;/<span class="hljs-name inline">code</span>&gt;</span>
    <span class="hljs-tag inline">&lt;/<span class="hljs-name inline">pre</span>&gt;</span>
<span class="hljs-tag inline">&lt;/<span class="hljs-name inline">div</span>&gt;</span>
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">CSS Grid vs Flexbox的布局选择</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">头部区域使用Flexbox（<code>flex items-center justify-between</code>）实现语言标识和复制按钮的两端对齐，这比Grid更适合这种一维布局。</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">主题系统的无缝切换机制</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">每个元素都使用了主题系统的颜色变量：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="css" data-code="bg-background%0Abg-surface%0Atext-foreground%0Atext-primary">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">css</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-css">bg-<span class="hljs-attribute inline">background</span>
bg-surface
<span class="hljs-selector-tag inline">text</span>-foreground
<span class="hljs-selector-tag inline">text</span>-primary
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">这些类名通过CSS自定义属性与主题系统连接，确保了主题切换时的自动适配。</p>
<h3 id="动态主题切换的实现机制" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#动态主题切换的实现机制" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 动态主题切换的实现机制">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            动态主题切换的实现机制
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">为了让代码块能够响应主题变化，还有一套动态CSS注入系统：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20%E4%B8%BB%E9%A2%98%E6%A3%80%E6%B5%8B%E4%B8%8ECSS%E6%B3%A8%E5%85%A5%0Afunction%20injectThemeCSS()%20%7B%0Aconst%20existingStyle%20%3D%20document.getElementById('codeblock-theme-styles')%3B%0Aif%20(existingStyle)%20%7B%0AexistingStyle.remove()%3B%0A%7D%0A%2F%2F%20%E6%A3%80%E6%B5%8B%E5%BD%93%E5%89%8D%E4%B8%BB%E9%A2%98%0Aconst%20isDark%20%3D%20document.documentElement.classList.contains('dark')%3B%0A%2F%2F%20%E7%94%9F%E6%88%90%E4%B8%BB%E9%A2%98%E7%9B%B8%E5%BA%94%E7%9A%84CSS%0Aconst%20themeStyles%20%3D%20%60%0A.enhanced-codeblock%20%7B%0Abackground-color%3A%20var(--color-background)%20!important%3B%0Aborder-color%3A%20%24%7BisDark%20%3F%20'%23374151'%20%3A%20'%23e5e7eb'%7D%20!important%3B%0A%7D%0A.codeblock-header%20%7B%0Abackground-color%3A%20var(--color-surface)%20!important%3B%0Aborder-bottom-color%3A%20%24%7BisDark%20%3F%20'%23374151'%20%3A%20'%23e5e7eb'%7D%20!important%3B%0A%7D%0A.codeblock-copy-btn%20%7B%0Abackground-color%3A%20var(--color-background)%20!important%3B%0Acolor%3A%20var(--color-foreground)%20!important%3B%0A%7D%0A.codeblock-copy-btn%3Ahover%20%7B%0Abackground-color%3A%20var(--color-surface)%20!important%3B%0Acolor%3A%20var(--color-primary)%20!important%3B%0A%7D%0A.codeblock-content%20%7B%0Abackground-color%3A%20var(--color-surface)%20!important%3B%0Acolor%3A%20var(--color-foreground)%20!important%3B%0A%7D%0A%60%3B%0A%2F%2F%20%E6%B3%A8%E5%85%A5%E5%88%B0%E6%96%87%E6%A1%A3%E5%A4%B4%E9%83%A8%0Aconst%20styleElement%20%3D%20document.createElement('style')%3B%0AstyleElement.id%20%3D%20'codeblock-theme-styles'%3B%0AstyleElement.textContent%20%3D%20themeStyles%3B%0Adocument.head.appendChild(styleElement)%3B%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// 主题检测与CSS注入</span>
<span class="hljs-keyword inline">function</span> <span class="hljs-title function_ inline">injectThemeCSS</span>(<span class="hljs-params inline"></span>) {
    <span class="hljs-keyword inline">const</span> existingStyle = <span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">getElementById</span>(<span class="hljs-string inline">&#x27;codeblock-theme-styles&#x27;</span>);
    <span class="hljs-keyword inline">if</span> (existingStyle) {
        existingStyle.<span class="hljs-title function_ inline">remove</span>();
    }
    
    <span class="hljs-comment inline">// 检测当前主题</span>
    <span class="hljs-keyword inline">const</span> isDark = <span class="hljs-variable language_ inline">document</span>.<span class="hljs-property inline">documentElement</span>.<span class="hljs-property inline">classList</span>.<span class="hljs-title function_ inline">contains</span>(<span class="hljs-string inline">&#x27;dark&#x27;</span>);
    
    <span class="hljs-comment inline">// 生成主题相应的CSS</span>
    <span class="hljs-keyword inline">const</span> themeStyles = <span class="hljs-string inline">`
        .enhanced-codeblock {
            background-color: var(--color-background) !important;
            border-color: <span class="hljs-subst inline">${isDark ? <span class="hljs-string inline">&#x27;#374151&#x27;</span> : <span class="hljs-string inline">&#x27;#e5e7eb&#x27;</span>}</span> !important;
        }
        .codeblock-header {
            background-color: var(--color-surface) !important;
            border-bottom-color: <span class="hljs-subst inline">${isDark ? <span class="hljs-string inline">&#x27;#374151&#x27;</span> : <span class="hljs-string inline">&#x27;#e5e7eb&#x27;</span>}</span> !important;
        }
        .codeblock-copy-btn {
            background-color: var(--color-background) !important;
            color: var(--color-foreground) !important;
        }
        .codeblock-copy-btn:hover {
            background-color: var(--color-surface) !important;
            color: var(--color-primary) !important;
        }
        .codeblock-content {
            background-color: var(--color-surface) !important;
            color: var(--color-foreground) !important;
        }
    `</span>;
    
    <span class="hljs-comment inline">// 注入到文档头部</span>
    <span class="hljs-keyword inline">const</span> styleElement = <span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">createElement</span>(<span class="hljs-string inline">&#x27;style&#x27;</span>);
    styleElement.<span class="hljs-property inline">id</span> = <span class="hljs-string inline">&#x27;codeblock-theme-styles&#x27;</span>;
    styleElement.<span class="hljs-property inline">textContent</span> = themeStyles;
    <span class="hljs-variable language_ inline">document</span>.<span class="hljs-property inline">head</span>.<span class="hljs-title function_ inline">appendChild</span>(styleElement);
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">主题变化监听机制</strong>：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20%E7%9B%91%E5%90%ACDOM%E5%8F%98%E5%8C%96%EF%BC%8C%E6%A3%80%E6%B5%8B%E4%B8%BB%E9%A2%98%E5%88%87%E6%8D%A2%0Aconst%20observer%20%3D%20new%20MutationObserver(function(mutations)%20%7B%0Amutations.forEach(function(mutation)%20%7B%0Aif%20(mutation.type%20%3D%3D%3D%20'attributes'%20%26%26%0Amutation.attributeName%20%3D%3D%3D%20'class'%20%26%26%0Amutation.target%20%3D%3D%3D%20document.documentElement)%20%7B%0AsetTimeout(injectThemeCSS%2C%2010)%3B%0A%7D%0A%7D)%3B%0A%7D)%3B%0Aobserver.observe(document.documentElement%2C%20%7B%0Aattributes%3A%20true%2C%0AattributeFilter%3A%20%5B'class'%5D%0A%7D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// 监听DOM变化，检测主题切换</span>
<span class="hljs-keyword inline">const</span> observer = <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">MutationObserver</span>(<span class="hljs-keyword inline">function</span>(<span class="hljs-params inline">mutations</span>) {
    mutations.<span class="hljs-title function_ inline">forEach</span>(<span class="hljs-keyword inline">function</span>(<span class="hljs-params inline">mutation</span>) {
        <span class="hljs-keyword inline">if</span> (mutation.<span class="hljs-property inline">type</span> === <span class="hljs-string inline">&#x27;attributes&#x27;</span> &amp;&amp; 
            mutation.<span class="hljs-property inline">attributeName</span> === <span class="hljs-string inline">&#x27;class&#x27;</span> &amp;&amp; 
            mutation.<span class="hljs-property inline">target</span> === <span class="hljs-variable language_ inline">document</span>.<span class="hljs-property inline">documentElement</span>) {
            <span class="hljs-built_in inline">setTimeout</span>(injectThemeCSS, <span class="hljs-number inline">10</span>);
        }
    });
});

observer.<span class="hljs-title function_ inline">observe</span>(<span class="hljs-variable language_ inline">document</span>.<span class="hljs-property inline">documentElement</span>, {
    <span class="hljs-attr inline">attributes</span>: <span class="hljs-literal inline">true</span>,
    <span class="hljs-attr inline">attributeFilter</span>: [<span class="hljs-string inline">&#x27;class&#x27;</span>]
});
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">为什么使用动态CSS注入而不是静态类名</strong>？</p>
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">实时响应</strong>：主题切换时立即更新样式，无需重新渲染组件</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">性能优化</strong>：避免大量的条件类名判断</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">灵活性</strong>：可以根据主题状态动态调整边框颜色等细节</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">优先级控制</strong>：使用<code>!important</code>确保主题样式优先于默认样式</li>
</ol>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">CSS自定义属性的优势</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">主题系统通过<code>ThemeProvider</code>在根元素上设置CSS自定义属性：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="Object.entries(currentTheme.colors).forEach((%5Bkey%2C%20value%5D)%20%3D%3E%20%7B%0Aroot.style.setProperty(%60--color-%24%7Bkey%7D%60%2C%20value)%3B%0A%7D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-title class_ inline">Object</span>.<span class="hljs-title function_ inline">entries</span>(currentTheme.<span class="hljs-property inline">colors</span>).<span class="hljs-title function_ inline">forEach</span>(<span class="hljs-function inline">(<span class="hljs-params inline">[key, value]</span>) =&gt;</span> {
    root.<span class="hljs-property inline">style</span>.<span class="hljs-title function_ inline">setProperty</span>(<span class="hljs-string inline">`--color-<span class="hljs-subst inline">${key}</span>`</span>, value);
});
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">这样代码块就能通过<code>var(--color-background)</code>、<code>var(--color-surface)</code>等方式自动获取当前主题的颜色值。</p>
<h2 id="客户端交互脚本：监视与提示" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#客户端交互脚本：监视与提示" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 客户端交互脚本：监视与提示">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            客户端交互脚本：监视与提示
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">增强代码块的复制、通知、动态功能初始化。</p>
<h3 id="可降级的复制功能" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#可降级的复制功能" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 可降级的复制功能">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            可降级的复制功能
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="if%20(navigator.clipboard%20%26%26%20navigator.clipboard.writeText)%20%7B%0Aawait%20navigator.clipboard.writeText(code)%3B%0A%7D%20else%20%7B%0A%2F%2F%20%E5%85%BC%E5%AE%B9%E6%80%A7%E9%99%8D%E7%BA%A7%E6%96%B9%E6%A1%88%0Aconst%20textArea%20%3D%20document.createElement('textarea')%3B%0AtextArea.value%20%3D%20code%3B%0AtextArea.style.position%20%3D%20'fixed'%3B%0AtextArea.style.left%20%3D%20'-999999px'%3B%0AtextArea.style.top%20%3D%20'-999999px'%3B%0Adocument.body.appendChild(textArea)%3B%0AtextArea.focus()%3B%0AtextArea.select()%3B%0Adocument.execCommand('copy')%3B%0AtextArea.remove()%3B%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">if</span> (navigator.<span class="hljs-property inline">clipboard</span> &amp;&amp; navigator.<span class="hljs-property inline">clipboard</span>.<span class="hljs-property inline">writeText</span>) {
    <span class="hljs-keyword inline">await</span> navigator.<span class="hljs-property inline">clipboard</span>.<span class="hljs-title function_ inline">writeText</span>(code);
} <span class="hljs-keyword inline">else</span> {
    <span class="hljs-comment inline">// 兼容性降级方案</span>
    <span class="hljs-keyword inline">const</span> textArea = <span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">createElement</span>(<span class="hljs-string inline">&#x27;textarea&#x27;</span>);
    textArea.<span class="hljs-property inline">value</span> = code;
    textArea.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">position</span> = <span class="hljs-string inline">&#x27;fixed&#x27;</span>;
    textArea.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">left</span> = <span class="hljs-string inline">&#x27;-999999px&#x27;</span>;
    textArea.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">top</span> = <span class="hljs-string inline">&#x27;-999999px&#x27;</span>;
    <span class="hljs-variable language_ inline">document</span>.<span class="hljs-property inline">body</span>.<span class="hljs-title function_ inline">appendChild</span>(textArea);
    textArea.<span class="hljs-title function_ inline">focus</span>();
    textArea.<span class="hljs-title function_ inline">select</span>();
    <span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">execCommand</span>(<span class="hljs-string inline">&#x27;copy&#x27;</span>);
    textArea.<span class="hljs-title function_ inline">remove</span>();
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">现代Clipboard API vs 传统方案 的对比</strong>：</p>
<table class="w-full border-collapse mb-4 shadow-sm rounded-lg overflow-hidden">
<thead class="bg-surface">
<tr class="border-b border-gray-200"><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">特性</th><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">Clipboard API</th><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">document.execCommand</th></tr>
</thead>
<tbody class="bg-background divide-y divide-gray-200">
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">安全性</td><td class="px-4 py-3 text-sm text-foreground">需要HTTPS或localhost</td><td class="px-4 py-3 text-sm text-foreground">相对宽松</td></tr>
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">异步支持</td><td class="px-4 py-3 text-sm text-foreground">原生Promise</td><td class="px-4 py-3 text-sm text-foreground">同步操作</td></tr>
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">浏览器支持</td><td class="px-4 py-3 text-sm text-foreground">现代浏览器</td><td class="px-4 py-3 text-sm text-foreground">广泛支持但已废弃</td></tr>
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">使用体验</td><td class="px-4 py-3 text-sm text-foreground">无需用户交互</td><td class="px-4 py-3 text-sm text-foreground">需要focus和select</td></tr>
</tbody>
</table>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">异步操作的错误处理</strong>：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="try%20%7B%0Aawait%20navigator.clipboard.writeText(code)%3B%0AshowToast('%E4%BB%A3%E7%A0%81%E5%B7%B2%E5%A4%8D%E5%88%B6%E5%88%B0%E5%89%AA%E8%B4%B4%E6%9D%BF%EF%BC%81'%2C%20'success')%3B%0A%7D%20catch%20(err)%20%7B%0Aconsole.error('Failed%20to%20copy%20code%3A'%2C%20err)%3B%0AshowToast('%E5%A4%8D%E5%88%B6%E5%A4%B1%E8%B4%A5'%2C%20'error')%3B%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">try</span> {
    <span class="hljs-keyword inline">await</span> navigator.<span class="hljs-property inline">clipboard</span>.<span class="hljs-title function_ inline">writeText</span>(code);
    <span class="hljs-title function_ inline">showToast</span>(<span class="hljs-string inline">&#x27;代码已复制到剪贴板！&#x27;</span>, <span class="hljs-string inline">&#x27;success&#x27;</span>);
} <span class="hljs-keyword inline">catch</span> (err) {
    <span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">error</span>(<span class="hljs-string inline">&#x27;Failed to copy code:&#x27;</span>, err);
    <span class="hljs-title function_ inline">showToast</span>(<span class="hljs-string inline">&#x27;复制失败&#x27;</span>, <span class="hljs-string inline">&#x27;error&#x27;</span>);
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">安全策略对复制功能的影响</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">现代浏览器的安全策略要求Clipboard API只能在安全上下文（HTTPS）中使用，这就是我们需要降级方案的原因。</p>
<h3 id="动态内容监听：mutationobserver" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#动态内容监听：mutationobserver" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 动态内容监听：MutationObserver">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            动态内容监听：MutationObserver
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20observer%20%3D%20new%20MutationObserver(function(mutations)%20%7B%0Alet%20shouldReinitialize%20%3D%20false%3B%0Amutations.forEach(function(mutation)%20%7B%0Amutation.addedNodes.forEach(function(node)%20%7B%0Aif%20(node.nodeType%20%3D%3D%3D%201%20%26%26%20(node.classList.contains('enhanced-codeblock')%20%7C%7C%20node.querySelector('.enhanced-codeblock')))%20%7B%0AshouldReinitialize%20%3D%20true%3B%0A%7D%0A%7D)%3B%0A%7D)%3B%0Aif%20(shouldReinitialize)%20%7B%0A%2F%2F%20%E9%98%B2%E6%8A%96%E6%9C%BA%E5%88%B6%0AclearTimeout(window%5B'__codeblock_reinit_timeout__'%5D)%3B%0Awindow%5B'__codeblock_reinit_timeout__'%5D%20%3D%20setTimeout(initializeCodeBlocks%2C%20100)%3B%0A%7D%0A%7D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> observer = <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">MutationObserver</span>(<span class="hljs-keyword inline">function</span>(<span class="hljs-params inline">mutations</span>) {
    <span class="hljs-keyword inline">let</span> shouldReinitialize = <span class="hljs-literal inline">false</span>;
    mutations.<span class="hljs-title function_ inline">forEach</span>(<span class="hljs-keyword inline">function</span>(<span class="hljs-params inline">mutation</span>) {
        mutation.<span class="hljs-property inline">addedNodes</span>.<span class="hljs-title function_ inline">forEach</span>(<span class="hljs-keyword inline">function</span>(<span class="hljs-params inline">node</span>) {
            <span class="hljs-keyword inline">if</span> (node.<span class="hljs-property inline">nodeType</span> === <span class="hljs-number inline">1</span> &amp;&amp; (node.<span class="hljs-property inline">classList</span>.<span class="hljs-title function_ inline">contains</span>(<span class="hljs-string inline">&#x27;enhanced-codeblock&#x27;</span>) || node.<span class="hljs-title function_ inline">querySelector</span>(<span class="hljs-string inline">&#x27;.enhanced-codeblock&#x27;</span>))) {
                shouldReinitialize = <span class="hljs-literal inline">true</span>;
            }
        });
    });
    
    <span class="hljs-keyword inline">if</span> (shouldReinitialize) {
        <span class="hljs-comment inline">// 防抖机制</span>
        <span class="hljs-built_in inline">clearTimeout</span>(<span class="hljs-variable language_ inline">window</span>[<span class="hljs-string inline">&#x27;__codeblock_reinit_timeout__&#x27;</span>]);
        <span class="hljs-variable language_ inline">window</span>[<span class="hljs-string inline">&#x27;__codeblock_reinit_timeout__&#x27;</span>] = <span class="hljs-built_in inline">setTimeout</span>(initializeCodeBlocks, <span class="hljs-number inline">100</span>);
    }
});
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">为什么需要DOM变化监听</strong>？</p>
<p class="text-base leading-7 mb-4 text-foreground">在React应用中，组件可能会动态更新内容。如果新添加了代码块，我们需要为它们重新绑定事件监听器。</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">防抖机制的性能优化</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">当DOM频繁变化时，防抖机制确保初始化函数不会被过度调用，避免性能问题与UI异常。</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">内存泄漏的防护策略</strong>：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="if%20(!window%5B'__codeblock_observers__'%5D)%20%7B%0Awindow%5B'__codeblock_observers__'%5D%20%3D%20new%20Set()%3B%0A%7D%0Aif%20(!window%5B'__codeblock_observers__'%5D.has(observerId))%20%7B%0Awindow%5B'__codeblock_observers__'%5D.add(observerId)%3B%0A%2F%2F%20%E5%88%9B%E5%BB%BA%E8%A7%82%E5%AF%9F%E8%80%85%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">if</span> (!<span class="hljs-variable language_ inline">window</span>[<span class="hljs-string inline">&#x27;__codeblock_observers__&#x27;</span>]) {
    <span class="hljs-variable language_ inline">window</span>[<span class="hljs-string inline">&#x27;__codeblock_observers__&#x27;</span>] = <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Set</span>();
}

<span class="hljs-keyword inline">if</span> (!<span class="hljs-variable language_ inline">window</span>[<span class="hljs-string inline">&#x27;__codeblock_observers__&#x27;</span>].<span class="hljs-title function_ inline">has</span>(observerId)) {
    <span class="hljs-variable language_ inline">window</span>[<span class="hljs-string inline">&#x27;__codeblock_observers__&#x27;</span>].<span class="hljs-title function_ inline">add</span>(observerId);
    <span class="hljs-comment inline">// 创建观察者</span>
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">使用全局Set来追踪已创建的观察者，避免重复创建导致的内存泄漏。</p>
<h3 id="toast通知系统的实现" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#toast通知系统的实现" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Toast通知系统的实现">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Toast通知系统的实现
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="function%20showToast(message%2C%20type%20%3D%20'success')%20%7B%0A%2F%2F%20%E7%A7%BB%E9%99%A4%E7%8E%B0%E6%9C%89%E9%80%9A%E7%9F%A5%0Aconst%20existingToasts%20%3D%20document.querySelectorAll('.copy-toast')%3B%0AexistingToasts.forEach(toast%20%3D%3E%20toast.remove())%3B%0A%2F%2F%20%E5%88%9B%E5%BB%BA%E6%96%B0%E9%80%9A%E7%9F%A5%0Aconst%20toast%20%3D%20document.createElement('div')%3B%0Atoast.className%20%3D%20'copy-toast%20fixed%20top-4%20right-4%20z-%5B9999%5D%20px-4%20py-2%20rounded-lg%20shadow-lg%20transition-all%20duration-300%20transform%20translate-x-full%20opacity-0'%3B%0A%2F%2F%20%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9C%0AsetTimeout(()%20%3D%3E%20%7B%0Atoast.classList.remove('translate-x-full'%2C%20'opacity-0')%3B%0A%7D%2C%2010)%3B%0A%2F%2F%20%E8%87%AA%E5%8A%A8%E7%A7%BB%E9%99%A4%0AsetTimeout(()%20%3D%3E%20%7B%0Atoast.classList.add('translate-x-full'%2C%20'opacity-0')%3B%0AsetTimeout(()%20%3D%3E%20toast.remove()%2C%20300)%3B%0A%7D%2C%203000)%3B%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">function</span> <span class="hljs-title function_ inline">showToast</span>(<span class="hljs-params inline">message, <span class="hljs-keyword inline">type</span> = <span class="hljs-string inline">&#x27;success&#x27;</span></span>) {
    <span class="hljs-comment inline">// 移除现有通知</span>
    <span class="hljs-keyword inline">const</span> existingToasts = <span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">querySelectorAll</span>(<span class="hljs-string inline">&#x27;.copy-toast&#x27;</span>);
    existingToasts.<span class="hljs-title function_ inline">forEach</span>(<span class="hljs-function inline"><span class="hljs-params inline">toast</span> =&gt;</span> toast.<span class="hljs-title function_ inline">remove</span>());
    
    <span class="hljs-comment inline">// 创建新通知</span>
    <span class="hljs-keyword inline">const</span> toast = <span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">createElement</span>(<span class="hljs-string inline">&#x27;div&#x27;</span>);
    toast.<span class="hljs-property inline">className</span> = <span class="hljs-string inline">&#x27;copy-toast fixed top-4 right-4 z-[9999] px-4 py-2 rounded-lg shadow-lg transition-all duration-300 transform translate-x-full opacity-0&#x27;</span>;
    
    <span class="hljs-comment inline">// 动画效果</span>
    <span class="hljs-built_in inline">setTimeout</span>(<span class="hljs-function inline">() =&gt;</span> {
        toast.<span class="hljs-property inline">classList</span>.<span class="hljs-title function_ inline">remove</span>(<span class="hljs-string inline">&#x27;translate-x-full&#x27;</span>, <span class="hljs-string inline">&#x27;opacity-0&#x27;</span>);
    }, <span class="hljs-number inline">10</span>);
    
    <span class="hljs-comment inline">// 自动移除</span>
    <span class="hljs-built_in inline">setTimeout</span>(<span class="hljs-function inline">() =&gt;</span> {
        toast.<span class="hljs-property inline">classList</span>.<span class="hljs-title function_ inline">add</span>(<span class="hljs-string inline">&#x27;translate-x-full&#x27;</span>, <span class="hljs-string inline">&#x27;opacity-0&#x27;</span>);
        <span class="hljs-built_in inline">setTimeout</span>(<span class="hljs-function inline">() =&gt;</span> toast.<span class="hljs-title function_ inline">remove</span>(), <span class="hljs-number inline">300</span>);
    }, <span class="hljs-number inline">3000</span>);
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">浮动提示的定位策略</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">使用<code>fixed top-4 right-4</code>将通知固定在视口右上角，确保在任何滚动位置都能看到。</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">CSS动画的性能考虑</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">使用<code>transform</code>而不是改变<code>top</code>/<code>right</code>值来实现动画，利用GPU加速提升性能。</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">Z-index层级的管理</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground"><code>z-[9999]</code>确保通知显示在所有其他元素之上，包括可能的模态框和下拉菜单。</p>
<h2 id="目录生成：文档导航构建" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#目录生成：文档导航构建" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 目录生成：文档导航构建">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            目录生成：文档导航构建
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">某种程度上来说这其实是JS逆向的一部分。</p>
<h3 id="标题提取正则" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#标题提取正则" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 标题提取正则">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            标题提取正则
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20headingRegex%20%3D%20%2F%5D*)%3F%3E%5B%5Cs%5CS%5D*%3F%2Fgi%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> headingRegex = <span class="hljs-regexp inline">/&lt;h([1-6])(?:\s[^&gt;]*)?&gt;[\s\S]*?&lt;\/h[1-6]&gt;/gi</span>;
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">多行内容匹配</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">标题内容可能包含换行符、嵌套HTML标签等复杂结构。<code>[\s\S]*?</code>确保能够匹配包含换行符的内容。</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">嵌套HTML处理</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">标题内可能包含<code>&lt;code&gt;</code>、<code>&lt;strong&gt;</code>等内联标签，正则表达式需要准确地匹配到完整的标题结构。</p>
<h3 id="文本内容的精确提取" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#文本内容的精确提取" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 文本内容的精确提取">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            文本内容的精确提取
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20text%20%3D%20tagContent%0A.replace(%2F%5D*%3E%2Fg%2C%20'')%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E7%A7%BB%E9%99%A4HTML%E6%A0%87%E7%AD%BE%0A.replace(%2F%26lt%3B%2Fg%2C%20')%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E8%A7%A3%E7%A0%81HTML%E5%AE%9E%E4%BD%93%0A.replace(%2F%26gt%3B%2Fg%2C%20'%3E')%0A.replace(%2F%26amp%3B%2Fg%2C%20'%26')%0A.replace(%2F%22%2Fg%2C%20'%22')%0A.replace(%2F'%2Fg%2C%20%22'%22)%0A.replace(%2F'%2Fg%2C%20%22'%22)%0A.replace(%2F%20%2Fg%2C%20'%20')%0A.replace(%2F%5Cs%2B%2Fg%2C%20'%20')%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E6%A0%87%E5%87%86%E5%8C%96%E7%A9%BA%E7%99%BD%E5%AD%97%E7%AC%A6%0A.trim()%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> text = tagContent
    .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&lt;[^&gt;]*&gt;/g</span>, <span class="hljs-string inline">&#x27;&#x27;</span>)           <span class="hljs-comment inline">// 移除HTML标签</span>
    .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&amp;lt;/g</span>, <span class="hljs-string inline">&#x27;&lt;&#x27;</span>)            <span class="hljs-comment inline">// 解码HTML实体</span>
    .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&amp;gt;/g</span>, <span class="hljs-string inline">&#x27;&gt;&#x27;</span>)
    .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&amp;amp;/g</span>, <span class="hljs-string inline">&#x27;&amp;&#x27;</span>)
    .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&amp;quot;/g</span>, <span class="hljs-string inline">&#x27;&quot;&#x27;</span>)
    .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&amp;#x27;/g</span>, <span class="hljs-string inline">&quot;&#x27;&quot;</span>)
    .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&amp;#39;/g</span>, <span class="hljs-string inline">&quot;&#x27;&quot;</span>)
    .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&amp;nbsp;/g</span>, <span class="hljs-string inline">&#x27; &#x27;</span>)
    .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/\s+/g</span>, <span class="hljs-string inline">&#x27; &#x27;</span>)              <span class="hljs-comment inline">// 标准化空白字符</span>
    .<span class="hljs-title function_ inline">trim</span>();
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">HTML标签剥离算法</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground"><code>/&lt;[^&gt;]*&gt;/g</code>移除所有HTML标签，保留纯文本内容作为目录项。</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">实体解码覆盖方案</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">涵盖了常见的HTML实体，确保目录文本的正确显示。</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">空白字符的标准化处理</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground"><code>\s+</code>匹配所有类型的空白字符（空格、制表符、换行符），统一替换为单个空格。</p>
<h3 id="id生成算法的设计" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#id生成算法的设计" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to ID生成算法的设计">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            ID生成算法的设计
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="let%20id%20%3D%20text%0A.toLowerCase()%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E8%BD%AC%E5%B0%8F%E5%86%99%0A.replace(%2F%5B%5E%5Cw%5Cs%5Cu00A0-%5CuFFFF-%5D%2Fg%2C%20'')%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%BF%9D%E7%95%99%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97%E5%92%8CUnicode%E5%AD%97%E7%AC%A6%0A.replace(%2F%5Cs%2B%2Fg%2C%20'-')%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E7%A9%BA%E6%A0%BC%E8%BD%AC%E8%BF%9E%E5%AD%97%E7%AC%A6%0A.replace(%2F-%2B%2Fg%2C%20'-')%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%A4%9A%E4%B8%AA%E8%BF%9E%E5%AD%97%E7%AC%A6%E5%90%88%E5%B9%B6%0A.replace(%2F%5E-%2B%7C-%2B%24%2Fg%2C%20'')%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E7%A7%BB%E9%99%A4%E9%A6%96%E5%B0%BE%E8%BF%9E%E5%AD%97%E7%AC%A6">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">let</span> id = text
    .<span class="hljs-title function_ inline">toLowerCase</span>()                                       <span class="hljs-comment inline">// 转小写</span>
    .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/[^\w\s\u00A0-\uFFFF-]/g</span>, <span class="hljs-string inline">&#x27;&#x27;</span>)               <span class="hljs-comment inline">// 保留字母数字和Unicode字符</span>
    .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/\s+/g</span>, <span class="hljs-string inline">&#x27;-&#x27;</span>)                                <span class="hljs-comment inline">// 空格转连字符</span>
    .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/-+/g</span>, <span class="hljs-string inline">&#x27;-&#x27;</span>)                                 <span class="hljs-comment inline">// 多个连字符合并</span>
    .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/^-+|-+$/g</span>, <span class="hljs-string inline">&#x27;&#x27;</span>);                            <span class="hljs-comment inline">// 移除首尾连字符</span>
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">URL安全的ID生成规则</strong>：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed">只保留字母、数字、Unicode字符（支持中文等）</li>
<li class="text-foreground leading-relaxed">空格转换为连字符</li>
<li class="text-foreground leading-relaxed">移除特殊字符避免URL问题</li>
</ul>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">国际化字符的支持策略</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground"><code>\u00A0-\uFFFF</code>范围涵盖了大部分Unicode字符，确保中文、日文等标题能够正确生成ID。</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">ID冲突的解决机制</strong>：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="let%20uniqueId%20%3D%20id%3B%0Alet%20counter%20%3D%201%3B%0Awhile%20(toc.some(item%20%3D%3E%20item.id%20%3D%3D%3D%20uniqueId))%20%7B%0AuniqueId%20%3D%20%60%24%7Bid%7D-%24%7Bcounter%7D%60%3B%0Acounter%2B%2B%3B%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">let</span> uniqueId = id;
<span class="hljs-keyword inline">let</span> counter = <span class="hljs-number inline">1</span>;
<span class="hljs-keyword inline">while</span> (toc.<span class="hljs-title function_ inline">some</span>(<span class="hljs-function inline"><span class="hljs-params inline">item</span> =&gt;</span> item.<span class="hljs-property inline">id</span> === uniqueId)) {
    uniqueId = <span class="hljs-string inline">`<span class="hljs-subst inline">${id}</span>-<span class="hljs-subst inline">${counter}</span>`</span>;
    counter++;
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">通过添加数字后缀确保ID的唯一性。</p>
<h2 id="锚点生成：可导航文档的实现" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#锚点生成：可导航文档的实现" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 锚点生成：可导航文档的实现">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            锚点生成：可导航文档的实现
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">斯塔拉格加费尔根才能成功召唤塔迪乌斯，缺少其中任何一个，另一个都是个废物白板…好吧塔迪乌斯即便召唤出来了也很一般，但总比没有好。</p>
<h3 id="锚点html结构设计" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#锚点html结构设计" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 锚点HTML结构设计">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            锚点HTML结构设计
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="return%20%60%24%7Btag%7D%20id%3D%22%24%7BtocItem.id%7D%22%20class%3D%22group%20relative%22%3E%0A%24%7BtocItem.id%7D%22%20class%3D%22absolute%20-left-6%20top-0%20opacity-0%20group-hover%3Aopacity-100%20transition-opacity%20text-primary%2F60%20hover%3Atext-primary%22%20aria-label%3D%22Link%20to%20%24%7BtocItem.text%7D%22%3E%0A%24%7Bcontent%7D%0A%24%7Btag%7D%3E%60%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">return</span> <span class="hljs-string inline">`&lt;<span class="hljs-subst inline">${tag}</span> id=&quot;<span class="hljs-subst inline">${tocItem.id}</span>&quot; class=&quot;group relative&quot;&gt;
    &lt;a href=&quot;#<span class="hljs-subst inline">${tocItem.id}</span>&quot; class=&quot;absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary&quot; aria-label=&quot;Link to <span class="hljs-subst inline">${tocItem.text}</span>&quot;&gt;
        &lt;svg class=&quot;w-5 h-5&quot; fill=&quot;currentColor&quot; viewBox=&quot;0 0 20 20&quot;&gt;
            &lt;path fill-rule=&quot;evenodd&quot; d=&quot;M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z&quot; clip-rule=&quot;evenodd&quot; /&gt;
        &lt;/svg&gt;
    &lt;/a&gt;
    <span class="hljs-subst inline">${content}</span>
&lt;/<span class="hljs-subst inline">${tag}</span>&gt;`</span>;
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">CSS Group选择器</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground"><code>group</code>类配合<code>group-hover:opacity-100</code>实现了&quot;只有在鼠标悬浮在标题上时，锚点链接才会显示&quot;的效果。</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">相对定位控制</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground"><code>absolute -left-6 top-0</code>将锚点图标定位在标题左侧6个单位的位置，相对而言，那儿至少是个空位。</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">SVG图标的选择和优化</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">使用链接图标的SVG版本，<code>fill=&quot;currentColor&quot;</code>确保图标颜色与文字颜色保持一致。</p>
<h3 id="可访问性的全面考虑" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#可访问性的全面考虑" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 可访问性的全面考虑">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            可访问性的全面考虑
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="html" data-code="aria-label%3D%22Link%20to%20%24%7BtocItem.text%7D%22">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">html</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-html">aria-label=&quot;Link to ${tocItem.text}&quot;
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">screen reader的支持</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground"><code>aria-label</code>为视觉障碍用户提供了链接的描述信息。</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">键盘导航的友好性</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">锚点链接可以通过Tab键聚焦，Enter键激活，确保键盘用户能够正常使用。</p>
<h2 id="完整源码全解析" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#完整源码全解析" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 完整源码全解析">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            完整源码全解析
        </h2>
<h3 id="样式注入核心模块" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#样式注入核心模块" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 样式注入核心模块">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            样式注入核心模块
        </h3>
<pre><code class="language-typescript"><span class="hljs-comment inline">// src/lib/utils/styleInject.ts</span>
<span class="hljs-keyword inline">import</span> markdownStyles <span class="hljs-keyword inline">from</span> <span class="hljs-string inline">&#x27;../../../public/styles/markdown.json&#x27;</span>;

<span class="hljs-comment inline">/**
 * 样式注入主函数：将Tailwind CSS类注入到HTML元素中
 * 解决Preflight重置样式后的显示问题
 */</span>
<span class="hljs-keyword inline">export</span> <span class="hljs-keyword inline">function</span> <span class="hljs-title function_ inline">styleInject</span>(<span class="hljs-params inline"><span class="hljs-attr inline">htmlContent</span>: <span class="hljs-built_in inline">string</span>, <span class="hljs-attr inline">translations</span>?: <span class="hljs-built_in inline">any</span></span>): <span class="hljs-built_in inline">string</span> {
    <span class="hljs-keyword inline">let</span> styledContent = htmlContent;

    <span class="hljs-comment inline">// 第一步：处理代码块增强功能</span>
    styledContent = <span class="hljs-title function_ inline">processCodeBlocks</span>(styledContent, translations);

    <span class="hljs-comment inline">// 第二步：为其他HTML标签注入样式类</span>
    <span class="hljs-title class_ inline">Object</span>.<span class="hljs-title function_ inline">entries</span>(markdownStyles).<span class="hljs-title function_ inline">forEach</span>(<span class="hljs-function inline">(<span class="hljs-params inline">[tag, classes]</span>) =&gt;</span> {
        <span class="hljs-keyword inline">if</span> (<span class="hljs-keyword inline">typeof</span> classes === <span class="hljs-string inline">&#x27;string&#x27;</span> &amp;&amp; classes.<span class="hljs-title function_ inline">trim</span>()) {
            <span class="hljs-comment inline">// 跳过已被增强代码块处理的标签</span>
            <span class="hljs-keyword inline">if</span> (tag === <span class="hljs-string inline">&#x27;pre&#x27;</span> || tag === <span class="hljs-string inline">&#x27;code&#x27;</span>) {
                <span class="hljs-keyword inline">return</span>;
            }

            <span class="hljs-comment inline">// 创建标签匹配的正则表达式</span>
            <span class="hljs-keyword inline">const</span> tagRegex = <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">RegExp</span>(<span class="hljs-string inline">`&lt;<span class="hljs-subst inline">${tag}</span>(\\s[^&gt;]*)?(?:&gt;|\\s*/&gt;)`</span>, <span class="hljs-string inline">&#x27;gi&#x27;</span>);

            styledContent = styledContent.<span class="hljs-title function_ inline">replace</span>(tagRegex, <span class="hljs-function inline">(<span class="hljs-params inline">match</span>) =&gt;</span> {
                <span class="hljs-comment inline">// 防止重复注入检查</span>
                <span class="hljs-keyword inline">if</span> (match.<span class="hljs-title function_ inline">includes</span>(classes.<span class="hljs-title function_ inline">split</span>(<span class="hljs-string inline">&#x27; &#x27;</span>)[<span class="hljs-number inline">0</span>])) {
                    <span class="hljs-keyword inline">return</span> match;
                }

                <span class="hljs-comment inline">// 检查是否已有class属性</span>
                <span class="hljs-keyword inline">const</span> classMatch = match.<span class="hljs-title function_ inline">match</span>(<span class="hljs-regexp inline">/class=[&quot;&#x27;]([^&quot;&#x27;]*)[&quot;&#x27;]/</span>);

                <span class="hljs-keyword inline">if</span> (classMatch) {
                    <span class="hljs-comment inline">// 合并现有类名</span>
                    <span class="hljs-keyword inline">const</span> existingClasses = classMatch[<span class="hljs-number inline">1</span>];
                    <span class="hljs-keyword inline">const</span> newClasses = classes.<span class="hljs-title function_ inline">split</span>(<span class="hljs-string inline">&#x27; &#x27;</span>).<span class="hljs-title function_ inline">filter</span>(<span class="hljs-function inline"><span class="hljs-params inline">cls</span> =&gt;</span> !existingClasses.<span class="hljs-title function_ inline">includes</span>(cls)).<span class="hljs-title function_ inline">join</span>(<span class="hljs-string inline">&#x27; &#x27;</span>);
                    <span class="hljs-keyword inline">if</span> (newClasses) {
                        <span class="hljs-keyword inline">return</span> match.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/class=[&quot;&#x27;]([^&quot;&#x27;]*)[&quot;&#x27;]/</span>, <span class="hljs-string inline">`class=&quot;$1 <span class="hljs-subst inline">${newClasses}</span>&quot;`</span>);
                    }
                    <span class="hljs-keyword inline">return</span> match;
                } <span class="hljs-keyword inline">else</span> {
                    <span class="hljs-comment inline">// 添加新的class属性</span>
                    <span class="hljs-keyword inline">if</span> (match.<span class="hljs-title function_ inline">endsWith</span>(<span class="hljs-string inline">&#x27;/&gt;&#x27;</span>)) {
                        <span class="hljs-keyword inline">return</span> match.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/\s*\/&gt;$/</span>, <span class="hljs-string inline">` class=&quot;<span class="hljs-subst inline">${classes}</span>&quot; /&gt;`</span>);
                    } <span class="hljs-keyword inline">else</span> {
                        <span class="hljs-keyword inline">return</span> match.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&gt;$/</span>, <span class="hljs-string inline">` class=&quot;<span class="hljs-subst inline">${classes}</span>&quot;&gt;`</span>);
                    }
                }
            });
        }
    });

    <span class="hljs-keyword inline">return</span> styledContent;
}

<span class="hljs-comment inline">/**
 * 代码块增强处理函数
 * 将普通代码块转换为带有复制功能和主题支持的增强代码块
 */</span>
<span class="hljs-keyword inline">export</span> <span class="hljs-keyword inline">function</span> <span class="hljs-title function_ inline">processCodeBlocks</span>(<span class="hljs-params inline"><span class="hljs-attr inline">htmlContent</span>: <span class="hljs-built_in inline">string</span>, <span class="hljs-attr inline">translations</span>?: <span class="hljs-built_in inline">any</span></span>): <span class="hljs-built_in inline">string</span> {
    <span class="hljs-keyword inline">const</span> preCodeRegex = <span class="hljs-regexp inline">/&lt;pre&gt;&lt;code([^&gt;]*?)&gt;([\s\S]*?)&lt;\/code&gt;&lt;\/pre&gt;/g</span>;
    <span class="hljs-keyword inline">return</span> htmlContent.<span class="hljs-title function_ inline">replace</span>(preCodeRegex, <span class="hljs-function inline">(<span class="hljs-params inline">match, attributes, content</span>) =&gt;</span> {
        <span class="hljs-comment inline">// 避免重复处理</span>
        <span class="hljs-keyword inline">if</span> (match.<span class="hljs-title function_ inline">includes</span>(<span class="hljs-string inline">&#x27;data-enhanced-codeblock&#x27;</span>)) {
            <span class="hljs-keyword inline">return</span> match;
        }

        <span class="hljs-comment inline">// 提取语言信息</span>
        <span class="hljs-keyword inline">const</span> languageMatch = attributes.<span class="hljs-title function_ inline">match</span>(<span class="hljs-regexp inline">/class=[&quot;&#x27;]([^&quot;&#x27;]*language-([^&quot;&#x27;\s]+)[^&quot;&#x27;]*)[&quot;&#x27;]/</span>);
        <span class="hljs-keyword inline">const</span> language = languageMatch ? languageMatch[<span class="hljs-number inline">2</span>] : <span class="hljs-string inline">&#x27;&#x27;</span>;

        <span class="hljs-comment inline">// 清理HTML实体</span>
        <span class="hljs-keyword inline">const</span> cleanContent = content
            .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&amp;lt;/g</span>, <span class="hljs-string inline">&#x27;&lt;&#x27;</span>)
            .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&amp;gt;/g</span>, <span class="hljs-string inline">&#x27;&gt;&#x27;</span>)
            .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&amp;amp;/g</span>, <span class="hljs-string inline">&#x27;&amp;&#x27;</span>)
            .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&amp;quot;/g</span>, <span class="hljs-string inline">&#x27;&quot;&#x27;</span>)
            .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&amp;#x27;/g</span>, <span class="hljs-string inline">&quot;&#x27;&quot;</span>);

        <span class="hljs-comment inline">// 获取国际化文本</span>
        <span class="hljs-keyword inline">const</span> copyText = translations?.<span class="hljs-property inline">codeblock</span>?.<span class="hljs-property inline">copy</span> || <span class="hljs-string inline">&#x27;Copy&#x27;</span>;
        <span class="hljs-keyword inline">const</span> copyTooltip = translations?.<span class="hljs-property inline">codeblock</span>?.<span class="hljs-property inline">copyTooltip</span> || <span class="hljs-string inline">&#x27;Copy code&#x27;</span>;

        <span class="hljs-comment inline">// 生成增强代码块HTML结构</span>
        <span class="hljs-keyword inline">return</span> <span class="hljs-string inline">`
            &lt;div class=&quot;enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm&quot; data-enhanced-codeblock=&quot;true&quot; data-language=&quot;<span class="hljs-subst inline">${language}</span>&quot; data-code=&quot;<span class="hljs-subst inline">${<span class="hljs-built_in inline">encodeURIComponent</span>(cleanContent)}</span>&quot;&gt;
                &lt;div class=&quot;codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700&quot;&gt;
                    &lt;span class=&quot;codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70&quot;&gt;<span class="hljs-subst inline">${language || <span class="hljs-string inline">&#x27;code&#x27;</span>}</span>&lt;/span&gt;
                    &lt;button class=&quot;codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95&quot; title=&quot;<span class="hljs-subst inline">${copyTooltip}</span>&quot;&gt;
                        &lt;svg class=&quot;copy-icon w-4 h-4&quot; fill=&quot;currentColor&quot; viewBox=&quot;0 0 20 20&quot;&gt;
                            &lt;path d=&quot;M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z&quot; /&gt;
                            &lt;path d=&quot;M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z&quot; /&gt;
                        &lt;/svg&gt;
                        &lt;svg class=&quot;copied-icon w-4 h-4 hidden&quot; fill=&quot;currentColor&quot; viewBox=&quot;0 0 20 20&quot;&gt;
                            &lt;path fill-rule=&quot;evenodd&quot; d=&quot;M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z&quot; clip-rule=&quot;evenodd&quot; /&gt;
                        &lt;/svg&gt;
                        &lt;span class=&quot;copy-text&quot;&gt;<span class="hljs-subst inline">${copyText}</span>&lt;/span&gt;
                    &lt;/button&gt;
                &lt;/div&gt;
                &lt;pre class=&quot;codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground&quot;&gt;&lt;code<span class="hljs-subst inline">${attributes}</span>&gt;<span class="hljs-subst inline">${content}</span>&lt;/code&gt;&lt;/pre&gt;
            &lt;/div&gt;
        `</span>;
    });
}

<span class="hljs-comment inline">/**
 * 生成客户端交互脚本
 * 包含复制功能、主题切换、DOM监听等
 */</span>
<span class="hljs-keyword inline">export</span> <span class="hljs-keyword inline">function</span> <span class="hljs-title function_ inline">getCodeBlockScript</span>(<span class="hljs-params inline"><span class="hljs-attr inline">translations</span>?: <span class="hljs-built_in inline">any</span></span>): <span class="hljs-built_in inline">string</span> {
    <span class="hljs-keyword inline">const</span> copySuccessText = translations?.<span class="hljs-property inline">codeblock</span>?.<span class="hljs-property inline">copySuccess</span> || <span class="hljs-string inline">&#x27;Code copied to clipboard!&#x27;</span>;
    <span class="hljs-keyword inline">const</span> copyErrorText = translations?.<span class="hljs-property inline">codeblock</span>?.<span class="hljs-property inline">copyError</span> || <span class="hljs-string inline">&#x27;Failed to copy code&#x27;</span>;
    
    <span class="hljs-keyword inline">return</span> <span class="hljs-string inline">`
        &lt;script&gt;
            (function() {
                // 主题CSS注入函数
                function injectThemeCSS() {
                    const existingStyle = document.getElementById(&#x27;codeblock-theme-styles&#x27;);
                    if (existingStyle) {
                        existingStyle.remove();
                    }
                    
                    const isDark = document.documentElement.classList.contains(&#x27;dark&#x27;);
                    
                    const themeStyles = \`
                        .enhanced-codeblock {
                            background-color: var(--color-background) !important;
                            border-color: \${isDark ? &#x27;#374151&#x27; : &#x27;#e5e7eb&#x27;} !important;
                        }
                        .codeblock-header {
                            background-color: var(--color-surface) !important;
                            border-bottom-color: \${isDark ? &#x27;#374151&#x27; : &#x27;#e5e7eb&#x27;} !important;
                        }
                        .codeblock-copy-btn {
                            background-color: var(--color-background) !important;
                            color: var(--color-foreground) !important;
                        }
                        .codeblock-copy-btn:hover {
                            background-color: var(--color-surface) !important;
                            color: var(--color-primary) !important;
                        }
                        .codeblock-content {
                            background-color: var(--color-surface) !important;
                            color: var(--color-foreground) !important;
                        }
                    \`;
                    
                    const styleElement = document.createElement(&#x27;style&#x27;);
                    styleElement.id = &#x27;codeblock-theme-styles&#x27;;
                    styleElement.textContent = themeStyles;
                    document.head.appendChild(styleElement);
                }
                
                // 复制功能初始化
                function initializeCodeBlocks() {
                    const codeBlocks = document.querySelectorAll(&#x27;.enhanced-codeblock&#x27;);
                    
                    codeBlocks.forEach(function(block, blockIndex) {
                        const copyBtn = block.querySelector(&#x27;.codeblock-copy-btn&#x27;);
                        if (!copyBtn || copyBtn.hasAttribute(&#x27;data-initialized&#x27;)) return;
                        
                        copyBtn.setAttribute(&#x27;data-initialized&#x27;, &#x27;true&#x27;);
                        
                        copyBtn.addEventListener(&#x27;click&#x27;, async function(e) {
                            e.preventDefault();
                            
                            try {
                                let code = block.getAttribute(&#x27;data-code&#x27;);
                                if (code) {
                                    code = decodeURIComponent(code);
                                } else {
                                    const codeElement = block.querySelector(&#x27;pre code&#x27;);
                                    if (codeElement) {
                                        code = codeElement.textContent || &#x27;&#x27;;
                                    }
                                }
                                
                                // 复制到剪贴板
                                if (navigator.clipboard &amp;&amp; navigator.clipboard.writeText) {
                                    await navigator.clipboard.writeText(code);
                                } else {
                                    // 降级方案
                                    const textArea = document.createElement(&#x27;textarea&#x27;);
                                    textArea.value = code;
                                    textArea.style.position = &#x27;fixed&#x27;;
                                    textArea.style.left = &#x27;-999999px&#x27;;
                                    document.body.appendChild(textArea);
                                    textArea.select();
                                    document.execCommand(&#x27;copy&#x27;);
                                    textArea.remove();
                                }
                                
                                showToast(&#x27;<span class="hljs-subst inline">${copySuccessText}</span>&#x27;, &#x27;success&#x27;);
                                
                            } catch (err) {
                                showToast(&#x27;<span class="hljs-subst inline">${copyErrorText}</span>&#x27;, &#x27;error&#x27;);
                            }
                        });
                    });
                }
                
                // Toast通知系统
                function showToast(message, type = &#x27;success&#x27;) {
                    const existingToasts = document.querySelectorAll(&#x27;.copy-toast&#x27;);
                    existingToasts.forEach(toast =&gt; toast.remove());
                    
                    const toast = document.createElement(&#x27;div&#x27;);
                    toast.className = &#x27;copy-toast fixed top-4 right-4 z-[9999] px-4 py-2 rounded-lg shadow-lg transition-all duration-300 transform translate-x-full opacity-0&#x27;;
                    
                    if (type === &#x27;success&#x27;) {
                        toast.className += &#x27; bg-green-500 text-white&#x27;;
                    } else {
                        toast.className += &#x27; bg-red-500 text-white&#x27;;
                    }
                    
                    toast.textContent = message;
                    document.body.appendChild(toast);
                    
                    setTimeout(() =&gt; {
                        toast.classList.remove(&#x27;translate-x-full&#x27;, &#x27;opacity-0&#x27;);
                    }, 10);
                    
                    setTimeout(() =&gt; {
                        toast.classList.add(&#x27;translate-x-full&#x27;, &#x27;opacity-0&#x27;);
                        setTimeout(() =&gt; toast.remove(), 300);
                    }, 3000);
                }
                
                // 初始化和监听
                if (document.readyState === &#x27;loading&#x27;) {
                    document.addEventListener(&#x27;DOMContentLoaded&#x27;, function() {
                        initializeCodeBlocks();
                        injectThemeCSS();
                    });
                } else {
                    initializeCodeBlocks();
                    injectThemeCSS();
                }
                
                // 主题变化监听
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === &#x27;attributes&#x27; &amp;&amp; 
                            mutation.attributeName === &#x27;class&#x27; &amp;&amp; 
                            mutation.target === document.documentElement) {
                            setTimeout(injectThemeCSS, 10);
                        }
                    });
                });
                
                observer.observe(document.documentElement, {
                    attributes: true,
                    attributeFilter: [&#x27;class&#x27;]
                });
            })();
        &lt;/script&gt;
    `</span>;
}

<span class="hljs-comment inline">/**
 * 提取目录结构
 */</span>
<span class="hljs-keyword inline">export</span> <span class="hljs-keyword inline">function</span> <span class="hljs-title function_ inline">extractTOC</span>(<span class="hljs-params inline"><span class="hljs-attr inline">htmlContent</span>: <span class="hljs-built_in inline">string</span></span>): <span class="hljs-title class_ inline">Array</span>&lt;{ <span class="hljs-attr inline">id</span>: <span class="hljs-built_in inline">string</span>, <span class="hljs-attr inline">text</span>: <span class="hljs-built_in inline">string</span>, <span class="hljs-attr inline">level</span>: <span class="hljs-built_in inline">number</span> }&gt; {
    <span class="hljs-keyword inline">const</span> <span class="hljs-attr inline">toc</span>: <span class="hljs-title class_ inline">Array</span>&lt;{ <span class="hljs-attr inline">id</span>: <span class="hljs-built_in inline">string</span>, <span class="hljs-attr inline">text</span>: <span class="hljs-built_in inline">string</span>, <span class="hljs-attr inline">level</span>: <span class="hljs-built_in inline">number</span> }&gt; = [];
    <span class="hljs-keyword inline">const</span> headingRegex = <span class="hljs-regexp inline">/&lt;h([1-6])(?:\s[^&gt;]*)?&gt;[\s\S]*?&lt;\/h[1-6]&gt;/gi</span>;
    <span class="hljs-keyword inline">let</span> match;

    <span class="hljs-keyword inline">while</span> ((match = headingRegex.<span class="hljs-title function_ inline">exec</span>(htmlContent)) !== <span class="hljs-literal inline">null</span>) {
        <span class="hljs-keyword inline">const</span> level = <span class="hljs-built_in inline">parseInt</span>(match[<span class="hljs-number inline">1</span>]);
        <span class="hljs-keyword inline">const</span> fullMatch = match[<span class="hljs-number inline">0</span>];
        <span class="hljs-keyword inline">const</span> tagContent = fullMatch.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&lt;h[1-6](?:\s[^&gt;]*)?&gt;|&lt;\/h[1-6]&gt;/gi</span>, <span class="hljs-string inline">&#x27;&#x27;</span>);

        <span class="hljs-keyword inline">const</span> text = tagContent
            .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&lt;[^&gt;]*&gt;/g</span>, <span class="hljs-string inline">&#x27;&#x27;</span>)
            .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&amp;lt;/g</span>, <span class="hljs-string inline">&#x27;&lt;&#x27;</span>)
            .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&amp;gt;/g</span>, <span class="hljs-string inline">&#x27;&gt;&#x27;</span>)
            .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&amp;amp;/g</span>, <span class="hljs-string inline">&#x27;&amp;&#x27;</span>)
            .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&amp;quot;/g</span>, <span class="hljs-string inline">&#x27;&quot;&#x27;</span>)
            .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&amp;#x27;/g</span>, <span class="hljs-string inline">&quot;&#x27;&quot;</span>)
            .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&amp;#39;/g</span>, <span class="hljs-string inline">&quot;&#x27;&quot;</span>)
            .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&amp;nbsp;/g</span>, <span class="hljs-string inline">&#x27; &#x27;</span>)
            .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/\s+/g</span>, <span class="hljs-string inline">&#x27; &#x27;</span>)
            .<span class="hljs-title function_ inline">trim</span>();

        <span class="hljs-keyword inline">if</span> (!text) <span class="hljs-keyword inline">continue</span>;

        <span class="hljs-keyword inline">let</span> id = text
            .<span class="hljs-title function_ inline">toLowerCase</span>()
            .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/[^\w\s\u00A0-\uFFFF-]/g</span>, <span class="hljs-string inline">&#x27;&#x27;</span>)
            .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/\s+/g</span>, <span class="hljs-string inline">&#x27;-&#x27;</span>)
            .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/-+/g</span>, <span class="hljs-string inline">&#x27;-&#x27;</span>)
            .<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/^-+|-+$/g</span>, <span class="hljs-string inline">&#x27;&#x27;</span>);

        <span class="hljs-keyword inline">let</span> uniqueId = id;
        <span class="hljs-keyword inline">let</span> counter = <span class="hljs-number inline">1</span>;
        <span class="hljs-keyword inline">while</span> (toc.<span class="hljs-title function_ inline">some</span>(<span class="hljs-function inline"><span class="hljs-params inline">item</span> =&gt;</span> item.<span class="hljs-property inline">id</span> === uniqueId)) {
            uniqueId = <span class="hljs-string inline">`<span class="hljs-subst inline">${id}</span>-<span class="hljs-subst inline">${counter}</span>`</span>;
            counter++;
        }

        <span class="hljs-keyword inline">if</span> (text &amp;&amp; uniqueId) {
            toc.<span class="hljs-title function_ inline">push</span>({<span class="hljs-attr inline">id</span>: uniqueId, text, level});
        }
    }

    <span class="hljs-keyword inline">return</span> toc;
}

<span class="hljs-comment inline">/**
 * 为标题添加锚点链接
 */</span>
<span class="hljs-keyword inline">export</span> <span class="hljs-keyword inline">function</span> <span class="hljs-title function_ inline">addHeadingAnchors</span>(<span class="hljs-params inline"><span class="hljs-attr inline">htmlContent</span>: <span class="hljs-built_in inline">string</span></span>): <span class="hljs-built_in inline">string</span> {
    <span class="hljs-keyword inline">const</span> tocItems = <span class="hljs-title function_ inline">extractTOC</span>(htmlContent);
    
    <span class="hljs-keyword inline">if</span> (tocItems.<span class="hljs-property inline">length</span> === <span class="hljs-number inline">0</span>) {
        <span class="hljs-keyword inline">return</span> htmlContent;
    }

    <span class="hljs-keyword inline">const</span> headingRegex = <span class="hljs-regexp inline">/&lt;h([1-6])(?:\s[^&gt;]*)?&gt;[\s\S]*?&lt;\/h[1-6]&gt;/gi</span>;
    <span class="hljs-keyword inline">let</span> tocIndex = <span class="hljs-number inline">0</span>;

    <span class="hljs-keyword inline">return</span> htmlContent.<span class="hljs-title function_ inline">replace</span>(headingRegex, <span class="hljs-function inline">(<span class="hljs-params inline">match, level</span>) =&gt;</span> {
        <span class="hljs-keyword inline">if</span> (tocIndex &gt;= tocItems.<span class="hljs-property inline">length</span>) <span class="hljs-keyword inline">return</span> match;
        <span class="hljs-keyword inline">if</span> (match.<span class="hljs-title function_ inline">includes</span>(<span class="hljs-string inline">&#x27; id=&#x27;</span>)) <span class="hljs-keyword inline">return</span> match;

        <span class="hljs-keyword inline">const</span> tocItem = tocItems[tocIndex];
        tocIndex++;

        <span class="hljs-keyword inline">const</span> tag = <span class="hljs-string inline">`h<span class="hljs-subst inline">${level}</span>`</span>;
        <span class="hljs-keyword inline">const</span> content = match.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/&lt;h[1-6](?:\s[^&gt;]*)?&gt;|&lt;\/h[1-6]&gt;/gi</span>, <span class="hljs-string inline">&#x27;&#x27;</span>);

        <span class="hljs-keyword inline">return</span> <span class="hljs-string inline">`&lt;<span class="hljs-subst inline">${tag}</span> id=&quot;<span class="hljs-subst inline">${tocItem.id}</span>&quot; class=&quot;group relative&quot;&gt;
            &lt;a href=&quot;#<span class="hljs-subst inline">${tocItem.id}</span>&quot; class=&quot;absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary&quot; aria-label=&quot;Link to <span class="hljs-subst inline">${tocItem.text}</span>&quot;&gt;
                &lt;svg class=&quot;w-5 h-5&quot; fill=&quot;currentColor&quot; viewBox=&quot;0 0 20 20&quot;&gt;
                    &lt;path fill-rule=&quot;evenodd&quot; d=&quot;M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z&quot; clip-rule=&quot;evenodd&quot; /&gt;
                &lt;/svg&gt;
            &lt;/a&gt;
            <span class="hljs-subst inline">${content}</span>
        &lt;/<span class="hljs-subst inline">${tag}</span>&gt;`</span>;
    });
}
</code></pre>
<h3 id="样式配置文件" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#样式配置文件" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 样式配置文件">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            样式配置文件
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="json" data-code="%2F%2F%20public%2Fstyles%2Fmarkdown.json%0A%7B%0A%22h1%22%3A%20%22text-4xl%20font-bold%20mt-8%20mb-4%20text-foreground%20leading-tight%22%2C%0A%22h2%22%3A%20%22text-3xl%20font-semibold%20mt-6%20mb-3%20text-foreground%20leading-tight%22%2C%0A%22h3%22%3A%20%22text-2xl%20font-semibold%20mt-5%20mb-2%20text-foreground%20leading-snug%22%2C%0A%22h4%22%3A%20%22text-xl%20font-medium%20mt-4%20mb-2%20text-foreground%20leading-snug%22%2C%0A%22p%22%3A%20%22text-base%20leading-7%20mb-4%20text-foreground%22%2C%0A%22code%22%3A%20%22bg-surface%20text-primary%20px-1.5%20py-0.5%20rounded%20text-sm%20font-mono%22%2C%0A%22pre%22%3A%20%22bg-surface%20text-foreground%20p-4%20rounded-lg%20overflow-x-auto%20mb-4%20font-mono%20text-sm%20leading-relaxed%20border%20border-gray-200%22%2C%0A%22ul%22%3A%20%22list-disc%20list-inside%20mb-4%20pl-6%20space-y-2%22%2C%0A%22ol%22%3A%20%22list-decimal%20list-inside%20mb-4%20pl-6%20space-y-2%22%2C%0A%22li%22%3A%20%22text-foreground%20leading-relaxed%22%2C%0A%22strong%22%3A%20%22font-bold%20text-foreground%22%2C%0A%22em%22%3A%20%22italic%20text-foreground%22%2C%0A%22a%22%3A%20%22text-primary%20hover%3Atext-accent%20underline%20transition-colors%20duration-200%22%2C%0A%22img%22%3A%20%22max-w-full%20h-auto%20rounded-lg%20shadow-sm%20my-4%20mx-auto%20block%22%2C%0A%22table%22%3A%20%22w-full%20border-collapse%20mb-4%20shadow-sm%20rounded-lg%20overflow-hidden%22%2C%0A%22th%22%3A%20%22px-4%20py-3%20text-left%20text-xs%20font-medium%20text-foreground%20uppercase%20tracking-wider%20bg-surface%22%2C%0A%22td%22%3A%20%22px-4%20py-3%20text-sm%20text-foreground%22%2C%0A%22blockquote%22%3A%20%22border-l-4%20border-primary%20pl-4%20py-2%20my-4%20bg-surface%20text-foreground%20italic%22%2C%0A%22hr%22%3A%20%22border-0%20h-px%20bg-gray-300%20my-8%22%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">json</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-json"><span class="hljs-comment inline">// public/styles/markdown.json</span>
<span class="hljs-punctuation inline">{</span>
  <span class="hljs-attr inline">&quot;h1&quot;</span><span class="hljs-punctuation inline">:</span> <span class="hljs-string inline">&quot;text-4xl font-bold mt-8 mb-4 text-foreground leading-tight&quot;</span><span class="hljs-punctuation inline">,</span>
  <span class="hljs-attr inline">&quot;h2&quot;</span><span class="hljs-punctuation inline">:</span> <span class="hljs-string inline">&quot;text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight&quot;</span><span class="hljs-punctuation inline">,</span>
  <span class="hljs-attr inline">&quot;h3&quot;</span><span class="hljs-punctuation inline">:</span> <span class="hljs-string inline">&quot;text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug&quot;</span><span class="hljs-punctuation inline">,</span>
  <span class="hljs-attr inline">&quot;h4&quot;</span><span class="hljs-punctuation inline">:</span> <span class="hljs-string inline">&quot;text-xl font-medium mt-4 mb-2 text-foreground leading-snug&quot;</span><span class="hljs-punctuation inline">,</span>
  <span class="hljs-attr inline">&quot;p&quot;</span><span class="hljs-punctuation inline">:</span> <span class="hljs-string inline">&quot;text-base leading-7 mb-4 text-foreground&quot;</span><span class="hljs-punctuation inline">,</span>
  <span class="hljs-attr inline">&quot;code&quot;</span><span class="hljs-punctuation inline">:</span> <span class="hljs-string inline">&quot;bg-surface text-primary px-1.5 py-0.5 rounded text-sm font-mono&quot;</span><span class="hljs-punctuation inline">,</span>
  <span class="hljs-attr inline">&quot;pre&quot;</span><span class="hljs-punctuation inline">:</span> <span class="hljs-string inline">&quot;bg-surface text-foreground p-4 rounded-lg overflow-x-auto mb-4 font-mono text-sm leading-relaxed border border-gray-200&quot;</span><span class="hljs-punctuation inline">,</span>
  <span class="hljs-attr inline">&quot;ul&quot;</span><span class="hljs-punctuation inline">:</span> <span class="hljs-string inline">&quot;list-disc list-inside mb-4 pl-6 space-y-2&quot;</span><span class="hljs-punctuation inline">,</span>
  <span class="hljs-attr inline">&quot;ol&quot;</span><span class="hljs-punctuation inline">:</span> <span class="hljs-string inline">&quot;list-decimal list-inside mb-4 pl-6 space-y-2&quot;</span><span class="hljs-punctuation inline">,</span> 
  <span class="hljs-attr inline">&quot;li&quot;</span><span class="hljs-punctuation inline">:</span> <span class="hljs-string inline">&quot;text-foreground leading-relaxed&quot;</span><span class="hljs-punctuation inline">,</span>
  <span class="hljs-attr inline">&quot;strong&quot;</span><span class="hljs-punctuation inline">:</span> <span class="hljs-string inline">&quot;font-bold text-foreground&quot;</span><span class="hljs-punctuation inline">,</span>
  <span class="hljs-attr inline">&quot;em&quot;</span><span class="hljs-punctuation inline">:</span> <span class="hljs-string inline">&quot;italic text-foreground&quot;</span><span class="hljs-punctuation inline">,</span>
  <span class="hljs-attr inline">&quot;a&quot;</span><span class="hljs-punctuation inline">:</span> <span class="hljs-string inline">&quot;text-primary hover:text-accent underline transition-colors duration-200&quot;</span><span class="hljs-punctuation inline">,</span>
  <span class="hljs-attr inline">&quot;img&quot;</span><span class="hljs-punctuation inline">:</span> <span class="hljs-string inline">&quot;max-w-full h-auto rounded-lg shadow-sm my-4 mx-auto block&quot;</span><span class="hljs-punctuation inline">,</span>
  <span class="hljs-attr inline">&quot;table&quot;</span><span class="hljs-punctuation inline">:</span> <span class="hljs-string inline">&quot;w-full border-collapse mb-4 shadow-sm rounded-lg overflow-hidden&quot;</span><span class="hljs-punctuation inline">,</span>
  <span class="hljs-attr inline">&quot;th&quot;</span><span class="hljs-punctuation inline">:</span> <span class="hljs-string inline">&quot;px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface&quot;</span><span class="hljs-punctuation inline">,</span>
  <span class="hljs-attr inline">&quot;td&quot;</span><span class="hljs-punctuation inline">:</span> <span class="hljs-string inline">&quot;px-4 py-3 text-sm text-foreground&quot;</span><span class="hljs-punctuation inline">,</span>
  <span class="hljs-attr inline">&quot;blockquote&quot;</span><span class="hljs-punctuation inline">:</span> <span class="hljs-string inline">&quot;border-l-4 border-primary pl-4 py-2 my-4 bg-surface text-foreground italic&quot;</span><span class="hljs-punctuation inline">,</span>
  <span class="hljs-attr inline">&quot;hr&quot;</span><span class="hljs-punctuation inline">:</span> <span class="hljs-string inline">&quot;border-0 h-px bg-gray-300 my-8&quot;</span>
<span class="hljs-punctuation inline">}</span>
</code></pre>
            </div>
        
<h3 id="服务端渲染集成" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#服务端渲染集成" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 服务端渲染集成">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            服务端渲染集成
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20src%2Fapp%2Fdocuments%2F%5B...slug%5D%2Fpage.tsx%0Aexport%20default%20async%20function%20DocumentPage(%7Bparams%7D%3A%20PageProps)%20%7B%0Atry%20%7B%0Aconst%20%7Bslug%7D%20%3D%20await%20params%3B%0Aconst%20%5Blang%2C%20category%2C%20fileName%5D%20%3D%20slug%3B%0Aconst%20%7Bcontent%2C%20frontMatter%2C%20readingTime%7D%20%3D%20getArticlesData(fileName%2C%20lang%2C%20false%2C%20category)%3B%0A%2F%2F%20%E9%85%8D%E7%BD%AERemarkable%E8%A7%A3%E6%9E%90%E5%99%A8%0Aconst%20md%20%3D%20new%20Remarkable(%7B%0Ahtml%3A%20true%2C%0Abreaks%3A%20true%2C%0Atypographer%3A%20true%2C%0Ahighlight%3A%20function%20(str%3A%20string%2C%20lang%3A%20string)%20%7B%0Aif%20(lang%20%26%26%20hljs.getLanguage(lang))%20%7B%0Atry%20%7B%0Areturn%20hljs.highlight(str%2C%20%7Blanguage%3A%20lang%7D).value%3B%0A%7D%20catch%20(err)%20%7B%7D%0A%7D%0Atry%20%7B%0Areturn%20hljs.highlightAuto(str).value%3B%0A%7D%20catch%20(err)%20%7B%7D%0Areturn%20''%3B%0A%7D%0A%7D)%0A.use(linkify)%0A.use(rkatex%2C%20%7Bdelimiter%3A%20'%24'%7D)%3B%0Alet%20htmlContent%20%3D%20md.render(content%2C%20frontMatter)%3B%0A%2F%2F%20%E5%8A%A0%E8%BD%BD%E5%9B%BD%E9%99%85%E5%8C%96%E6%96%87%E6%9C%AC%0Alet%20translations%20%3D%20null%3B%0Atry%20%7B%0Aconst%20translationsPath%20%3D%20path.join(process.cwd()%2C%20'public'%2C%20'locales'%2C%20lang%2C%20'common.json')%3B%0Aif%20(fs.existsSync(translationsPath))%20%7B%0Atranslations%20%3D%20JSON.parse(fs.readFileSync(translationsPath%2C%20'utf8'))%3B%0A%7D%0A%7D%20catch%20(error)%20%7B%0Aconsole.warn('Failed%20to%20load%20translations%3A'%2C%20error)%3B%0A%7D%0A%2F%2F%20%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B%EF%BC%9A%E6%8F%90%E5%8F%96%E7%9B%AE%E5%BD%95%20%E2%86%92%20%E6%B7%BB%E5%8A%A0%E9%94%9A%E7%82%B9%20%E2%86%92%20%E6%A0%B7%E5%BC%8F%E6%B3%A8%E5%85%A5%0Aconst%20tocItems%20%3D%20extractTOC(htmlContent)%3B%0AhtmlContent%20%3D%20addHeadingAnchors(htmlContent)%3B%0AhtmlContent%20%3D%20styleInject(htmlContent%2C%20translations)%3B%0Areturn%20(%0ADocumentPageClient%0AhtmlContent%3D%7BhtmlContent%7D%0AfrontMatter%3D%7BfrontMatter%7D%0AreadingTime%3D%7BreadingTime%7D%0Acategory%3D%7Bcategory%7D%0AtocItems%3D%7BtocItems%7D%0Atranslations%3D%7Btranslations%7D%0Alang%3D%7Blang%7D%0A%2F%3E%0A)%3B%0A%7D%20catch%20(error)%20%7B%0Aconsole.error('Error%20rendering%20document%3A'%2C%20error)%3B%0AnotFound()%3B%0A%7D%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// src/app/documents/[...slug]/page.tsx</span>
<span class="hljs-keyword inline">export</span> <span class="hljs-keyword inline">default</span> <span class="hljs-keyword inline">async</span> <span class="hljs-keyword inline">function</span> <span class="hljs-title function_ inline">DocumentPage</span>(<span class="hljs-params inline">{params}: <span class="hljs-title class_ inline">PageProps</span></span>) {
    <span class="hljs-keyword inline">try</span> {
        <span class="hljs-keyword inline">const</span> {slug} = <span class="hljs-keyword inline">await</span> params;
        <span class="hljs-keyword inline">const</span> [lang, category, fileName] = slug;
        <span class="hljs-keyword inline">const</span> {content, frontMatter, readingTime} = <span class="hljs-title function_ inline">getArticlesData</span>(fileName, lang, <span class="hljs-literal inline">false</span>, category);

        <span class="hljs-comment inline">// 配置Remarkable解析器</span>
        <span class="hljs-keyword inline">const</span> md = <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Remarkable</span>({
            <span class="hljs-attr inline">html</span>: <span class="hljs-literal inline">true</span>,
            <span class="hljs-attr inline">breaks</span>: <span class="hljs-literal inline">true</span>,
            <span class="hljs-attr inline">typographer</span>: <span class="hljs-literal inline">true</span>,
            <span class="hljs-attr inline">highlight</span>: <span class="hljs-keyword inline">function</span> (<span class="hljs-params inline"><span class="hljs-attr inline">str</span>: <span class="hljs-built_in inline">string</span>, <span class="hljs-attr inline">lang</span>: <span class="hljs-built_in inline">string</span></span>) {
                <span class="hljs-keyword inline">if</span> (lang &amp;&amp; hljs.<span class="hljs-title function_ inline">getLanguage</span>(lang)) {
                    <span class="hljs-keyword inline">try</span> {
                        <span class="hljs-keyword inline">return</span> hljs.<span class="hljs-title function_ inline">highlight</span>(str, {<span class="hljs-attr inline">language</span>: lang}).<span class="hljs-property inline">value</span>;
                    } <span class="hljs-keyword inline">catch</span> (err) {}
                }
                <span class="hljs-keyword inline">try</span> {
                    <span class="hljs-keyword inline">return</span> hljs.<span class="hljs-title function_ inline">highlightAuto</span>(str).<span class="hljs-property inline">value</span>;
                } <span class="hljs-keyword inline">catch</span> (err) {}
                <span class="hljs-keyword inline">return</span> <span class="hljs-string inline">&#x27;&#x27;</span>;
            }
        })
        .<span class="hljs-title function_ inline">use</span>(linkify)
        .<span class="hljs-title function_ inline">use</span>(rkatex, {<span class="hljs-attr inline">delimiter</span>: <span class="hljs-string inline">&#x27;$&#x27;</span>});

        <span class="hljs-keyword inline">let</span> htmlContent = md.<span class="hljs-title function_ inline">render</span>(content, frontMatter);

        <span class="hljs-comment inline">// 加载国际化文本</span>
        <span class="hljs-keyword inline">let</span> translations = <span class="hljs-literal inline">null</span>;
        <span class="hljs-keyword inline">try</span> {
            <span class="hljs-keyword inline">const</span> translationsPath = path.<span class="hljs-title function_ inline">join</span>(process.<span class="hljs-title function_ inline">cwd</span>(), <span class="hljs-string inline">&#x27;public&#x27;</span>, <span class="hljs-string inline">&#x27;locales&#x27;</span>, lang, <span class="hljs-string inline">&#x27;common.json&#x27;</span>);
            <span class="hljs-keyword inline">if</span> (fs.<span class="hljs-title function_ inline">existsSync</span>(translationsPath)) {
                translations = <span class="hljs-title class_ inline">JSON</span>.<span class="hljs-title function_ inline">parse</span>(fs.<span class="hljs-title function_ inline">readFileSync</span>(translationsPath, <span class="hljs-string inline">&#x27;utf8&#x27;</span>));
            }
        } <span class="hljs-keyword inline">catch</span> (error) {
            <span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">warn</span>(<span class="hljs-string inline">&#x27;Failed to load translations:&#x27;</span>, error);
        }

        <span class="hljs-comment inline">// 处理流程：提取目录 → 添加锚点 → 样式注入</span>
        <span class="hljs-keyword inline">const</span> tocItems = <span class="hljs-title function_ inline">extractTOC</span>(htmlContent);
        htmlContent = <span class="hljs-title function_ inline">addHeadingAnchors</span>(htmlContent);
        htmlContent = <span class="hljs-title function_ inline">styleInject</span>(htmlContent, translations);

        <span class="hljs-keyword inline">return</span> (
            <span class="language-xml inline"><span class="hljs-tag inline">&lt;<span class="hljs-name inline">DocumentPageClient</span>
                <span class="hljs-attr inline">htmlContent</span>=<span class="hljs-string inline">{htmlContent}</span>
                <span class="hljs-attr inline">frontMatter</span>=<span class="hljs-string inline">{frontMatter}</span>
                <span class="hljs-attr inline">readingTime</span>=<span class="hljs-string inline">{readingTime}</span>
                <span class="hljs-attr inline">category</span>=<span class="hljs-string inline">{category}</span>
                <span class="hljs-attr inline">tocItems</span>=<span class="hljs-string inline">{tocItems}</span>
                <span class="hljs-attr inline">translations</span>=<span class="hljs-string inline">{translations}</span>
                <span class="hljs-attr inline">lang</span>=<span class="hljs-string inline">{lang}</span>
            /&gt;</span></span>
        );
    } <span class="hljs-keyword inline">catch</span> (error) {
        <span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">error</span>(<span class="hljs-string inline">&#x27;Error rendering document:&#x27;</span>, error);
        <span class="hljs-title function_ inline">notFound</span>();
    }
}
</code></pre>
            </div>
        
<h3 id="客户端组件集成" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#客户端组件集成" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 客户端组件集成">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            客户端组件集成
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20src%2Fapp%2Fdocuments%2F%5B...slug%5D%2FDocumentPageClient.tsx%0Aexport%20function%20DocumentPageClient(%7B%0AhtmlContent%2C%0AfrontMatter%2C%0AreadingTime%2C%0Acategory%2C%0AtocItems%2C%0Atranslations%2C%0Alang%0A%7D%3A%20DocumentPageClientProps)%20%7B%0Aconst%20%7Bt%7D%20%3D%20useTranslation()%3B%0Aconst%20%5BformattedDate%2C%20setFormattedDate%5D%20%3D%20useStatestring%3E('')%3B%0A%2F%2F%20%E6%B3%A8%E5%85%A5%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BA%A4%E4%BA%92%E8%84%9A%E6%9C%AC%0AuseEffect(()%20%3D%3E%20%7B%0Aconst%20codeBlockScript%20%3D%20getCodeBlockScript(translations)%3B%0Aconst%20tempDiv%20%3D%20document.createElement('div')%3B%0AtempDiv.innerHTML%20%3D%20codeBlockScript%3B%0Aconst%20scriptElement%20%3D%20tempDiv.querySelector('script')%3B%0Aif%20(scriptElement)%20%7B%0Aconst%20newScript%20%3D%20document.createElement('script')%3B%0AnewScript.textContent%20%3D%20scriptElement.textContent%3B%0Adocument.head.appendChild(newScript)%3B%0Areturn%20()%20%3D%3E%20%7B%0Aif%20(document.head.contains(newScript))%20%7B%0Adocument.head.removeChild(newScript)%3B%0A%7D%0A%7D%3B%0A%7D%0A%7D%2C%20%5Btranslations%5D)%3B%0Areturn%20(%0Adiv%20className%3D%22relative%20z-30%20min-h-screen%20bg-background%22%3E%0Adiv%20className%3D%22container%20mx-auto%20px-4%20py-8%20max-w-4xl%22%3E%0Aarticle%20className%3D%22prose%20max-w-none%22%3E%0Adiv%0AclassName%3D%22prose-pre%3Ap-4%20prose-pre%3Abg-surface%20w-full%22%0AdangerouslySetInnerHTML%3D%7B%7B__html%3A%20htmlContent%7D%7D%0A%2F%3E%0Aarticle%3E%0Adiv%3E%0Adiv%3E%0ATableOfContents%20tocItems%3D%7BtocItems%7D%2F%3E%0A)%3B%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// src/app/documents/[...slug]/DocumentPageClient.tsx</span>
<span class="hljs-keyword inline">export</span> <span class="hljs-keyword inline">function</span> <span class="hljs-title function_ inline">DocumentPageClient</span>(<span class="hljs-params inline">{
    htmlContent,
    frontMatter,
    readingTime,
    category,
    tocItems,
    translations,
    lang
}: <span class="hljs-title class_ inline">DocumentPageClientProps</span></span>) {
    <span class="hljs-keyword inline">const</span> {t} = <span class="hljs-title function_ inline">useTranslation</span>();
    <span class="hljs-keyword inline">const</span> [formattedDate, setFormattedDate] = useState&lt;<span class="hljs-built_in inline">string</span>&gt;(<span class="hljs-string inline">&#x27;&#x27;</span>);

    <span class="hljs-comment inline">// 注入客户端交互脚本</span>
    <span class="hljs-title function_ inline">useEffect</span>(<span class="hljs-function inline">() =&gt;</span> {
        <span class="hljs-keyword inline">const</span> codeBlockScript = <span class="hljs-title function_ inline">getCodeBlockScript</span>(translations);
        <span class="hljs-keyword inline">const</span> tempDiv = <span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">createElement</span>(<span class="hljs-string inline">&#x27;div&#x27;</span>);
        tempDiv.<span class="hljs-property inline">innerHTML</span> = codeBlockScript;
        <span class="hljs-keyword inline">const</span> scriptElement = tempDiv.<span class="hljs-title function_ inline">querySelector</span>(<span class="hljs-string inline">&#x27;script&#x27;</span>);
        
        <span class="hljs-keyword inline">if</span> (scriptElement) {
            <span class="hljs-keyword inline">const</span> newScript = <span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">createElement</span>(<span class="hljs-string inline">&#x27;script&#x27;</span>);
            newScript.<span class="hljs-property inline">textContent</span> = scriptElement.<span class="hljs-property inline">textContent</span>;
            <span class="hljs-variable language_ inline">document</span>.<span class="hljs-property inline">head</span>.<span class="hljs-title function_ inline">appendChild</span>(newScript);
            
            <span class="hljs-keyword inline">return</span> <span class="hljs-function inline">() =&gt;</span> {
                <span class="hljs-keyword inline">if</span> (<span class="hljs-variable language_ inline">document</span>.<span class="hljs-property inline">head</span>.<span class="hljs-title function_ inline">contains</span>(newScript)) {
                    <span class="hljs-variable language_ inline">document</span>.<span class="hljs-property inline">head</span>.<span class="hljs-title function_ inline">removeChild</span>(newScript);
                }
            };
        }
    }, [translations]);

    <span class="hljs-keyword inline">return</span> (
        <span class="language-xml inline"><span class="hljs-tag inline">&lt;&gt;</span>
            <span class="hljs-tag inline">&lt;<span class="hljs-name inline">div</span> <span class="hljs-attr inline">className</span>=<span class="hljs-string inline">&quot;relative z-30 min-h-screen bg-background&quot;</span>&gt;</span>
                <span class="hljs-tag inline">&lt;<span class="hljs-name inline">div</span> <span class="hljs-attr inline">className</span>=<span class="hljs-string inline">&quot;container mx-auto px-4 py-8 max-w-4xl&quot;</span>&gt;</span>
                    <span class="hljs-tag inline">&lt;<span class="hljs-name inline">article</span> <span class="hljs-attr inline">className</span>=<span class="hljs-string inline">&quot;prose max-w-none&quot;</span>&gt;</span>
                        <span class="hljs-tag inline">&lt;<span class="hljs-name inline">div</span> 
                            <span class="hljs-attr inline">className</span>=<span class="hljs-string inline">&quot;prose-pre:p-4 prose-pre:bg-surface w-full&quot;</span>
                            <span class="hljs-attr inline">dangerouslySetInnerHTML</span>=<span class="hljs-string inline">{{__html:</span> <span class="hljs-attr inline">htmlContent</span>}}
                        /&gt;</span>
                    <span class="hljs-tag inline">&lt;/<span class="hljs-name inline">article</span>&gt;</span>
                <span class="hljs-tag inline">&lt;/<span class="hljs-name inline">div</span>&gt;</span>
            <span class="hljs-tag inline">&lt;/<span class="hljs-name inline">div</span>&gt;</span>
            <span class="hljs-tag inline">&lt;<span class="hljs-name inline">TableOfContents</span> <span class="hljs-attr inline">tocItems</span>=<span class="hljs-string inline">{tocItems}/</span>&gt;</span>
        <span class="hljs-tag inline">&lt;/&gt;</span></span>
    );
}
</code></pre>
            </div>
        
<h3 id="核心算法流程图" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#核心算法流程图" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 核心算法流程图">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            核心算法流程图
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="" data-code="MDX%E8%BE%93%E5%85%A5%20%E2%86%92%20Remarkable%E8%A7%A3%E6%9E%90%20%E2%86%92%20%E6%A0%B7%E5%BC%8F%E6%B3%A8%E5%85%A5%E7%B3%BB%E7%BB%9F%20%E2%86%92%20%E5%A2%9E%E5%BC%BAHTML%E8%BE%93%E5%87%BA%0A%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%0A%E5%8E%9F%E5%A7%8B%E8%AF%AD%E6%B3%95%20%20%20%20HTML%E5%AD%97%E7%AC%A6%E4%B8%B2%20%20%20%20%20%E6%A0%B7%E5%BC%8F%E7%B1%BB%E6%B3%A8%E5%85%A5%20%20%20%20%20%E5%AE%8C%E6%95%B4%E6%B8%B2%E6%9F%93%0A%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%0A%E8%AF%AD%E6%B3%95%E9%AB%98%E4%BA%AE%20%20%20%20%E4%BB%A3%E7%A0%81%E5%9D%97%E8%AF%86%E5%88%AB%20%20%20%20%20%E4%B8%BB%E9%A2%98%E9%80%82%E9%85%8D%20%20%20%20%20%20%20%E4%BA%A4%E4%BA%92%E5%8A%9F%E8%83%BD%0A%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%0A%E7%9B%AE%E5%BD%95%E6%8F%90%E5%8F%96%20%20%20%20%E9%94%9A%E7%82%B9%E7%94%9F%E6%88%90%20%20%20%20%20%20%20%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%84%9A%E6%9C%AC%20%20%20%20%20%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">code</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code>MDX输入 → Remarkable解析 → 样式注入系统 → 增强<span class="hljs-selector-tag inline">HTML</span>输出
    ↓           ↓              ↓              ↓
  原始语法    <span class="hljs-selector-tag inline">HTML</span>字符串     样式类注入     完整渲染
    ↓           ↓              ↓              ↓
  语法高亮    代码块识别     主题适配       交互功能
    ↓           ↓              ↓              ↓
  目录提取    锚点生成       客户端脚本     用户体验
</code></pre>
            </div>
        
<h3 id="关键实现原理总结" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#关键实现原理总结" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 关键实现原理总结">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            关键实现原理总结
        </h3>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">1. 正则表达式驱动的样式注入</strong></p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed">精确匹配HTML标签的开始部分</li>
<li class="text-foreground leading-relaxed">智能处理现有class属性的合并</li>
<li class="text-foreground leading-relaxed">支持自闭合标签的特殊处理</li>
</ul>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">2. 代码块增强的三层架构</strong></p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed">HTML结构层：语义化的增强代码块</li>
<li class="text-foreground leading-relaxed">样式层：动态主题适配CSS</li>
<li class="text-foreground leading-relaxed">交互层：复制功能和用户反馈</li>
</ul>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">3. 目录生成的文本处理算法</strong></p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed">多行内容的准确提取</li>
<li class="text-foreground leading-relaxed">HTML实体的完整解码</li>
<li class="text-foreground leading-relaxed">URL安全的ID生成策略</li>
</ul>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">4. 客户端脚本的内存管理</strong></p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed">防重复监听器的全局状态跟踪</li>
<li class="text-foreground leading-relaxed">自动清理机制避免内存泄漏</li>
<li class="text-foreground leading-relaxed">防抖优化减少不必要的重初始化</li>
</ul>
<h2 id="写在最后" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#写在最后" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 写在最后">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            写在最后
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">样式注入的整体方案的实现其实并不复杂，思路也较为简单，但正如那句话所说：<em class="italic text-foreground">“简单是复杂的终极形式”</em>。样式注入系统在复杂的技术实现背后，为用户呈现的是简单、美观、易用的文档体验。</p>
<p class="text-base leading-7 mb-4 text-foreground"><em class="italic text-foreground">愿你的文档如艺术品般优雅，在样式注入的加持下焕发出数字时代的璀璨光芒。</em> ✨</p>
d:["$","$L1d",null,{"htmlContent":"$1e","frontMatter":{"title":"样式注入：TailwindCSS Preflight破坏后的浴火重生","description":"深度解析MDX到HTML转换中的样式丢失问题及完整的样式注入解决方案实现","date":"2025-01-22","author":"MilkWind","tags":["MDX渲染"],"references":{}},"readingTime":"33 min read","category":"personal-website","tocItems":[{"id":"样式注入：tailwindcss-preflight破坏后的浴火重生","text":"样式注入：TailwindCSS Preflight破坏后的浴火重生","level":1},{"id":"问题根源分析：preflight的双刃剑效应","text":"问题根源分析：Preflight的双刃剑效应","level":2},{"id":"tailwindcss-preflight机制解析","text":"TailwindCSS Preflight机制解析","level":3},{"id":"mdx到html的渲染链路","text":"MDX到HTML的渲染链路","level":3},{"id":"样式映射配置设计","text":"样式映射配置设计","level":2},{"id":"json配置文件","text":"JSON配置文件","level":3},{"id":"核心注入算法：正则表达式驱动的捕获与替换","text":"核心注入算法：正则表达式驱动的捕获与替换","level":2},{"id":"标签匹配的正则魔法","text":"标签匹配的正则魔法","level":3},{"id":"类名注入算法","text":"类名注入算法","level":3},{"id":"防重复注入的保护机制","text":"防重复注入的保护机制","level":3},{"id":"代码块增强：这个小盒子才是代码永远的家","text":"代码块增强：这个小盒子才是代码永远的家","level":2},{"id":"代码块识别与解构","text":"代码块识别与解构","level":3},{"id":"语言标识符的提取算法","text":"语言标识符的提取算法","level":3},{"id":"html实体的还原处理","text":"HTML实体的还原处理","level":3},{"id":"增强代码块的html结构设计","text":"增强代码块的HTML结构设计","level":3},{"id":"动态主题切换的实现机制","text":"动态主题切换的实现机制","level":3},{"id":"客户端交互脚本：监视与提示","text":"客户端交互脚本：监视与提示","level":2},{"id":"可降级的复制功能","text":"可降级的复制功能","level":3},{"id":"动态内容监听：mutationobserver","text":"动态内容监听：MutationObserver","level":3},{"id":"toast通知系统的实现","text":"Toast通知系统的实现","level":3},{"id":"目录生成：文档导航构建","text":"目录生成：文档导航构建","level":2},{"id":"标题提取正则","text":"标题提取正则","level":3},{"id":"文本内容的精确提取","text":"文本内容的精确提取","level":3},{"id":"id生成算法的设计","text":"ID生成算法的设计","level":3},{"id":"锚点生成：可导航文档的实现","text":"锚点生成：可导航文档的实现","level":2},{"id":"锚点html结构设计","text":"锚点HTML结构设计","level":3},{"id":"可访问性的全面考虑","text":"可访问性的全面考虑","level":3},{"id":"完整源码全解析","text":"完整源码全解析","level":2},{"id":"样式注入核心模块","text":"样式注入核心模块","level":3},{"id":"样式配置文件","text":"样式配置文件","level":3},{"id":"服务端渲染集成","text":"服务端渲染集成","level":3},{"id":"客户端组件集成","text":"客户端组件集成","level":3},{"id":"核心算法流程图","text":"核心算法流程图","level":3},{"id":"关键实现原理总结","text":"关键实现原理总结","level":3},{"id":"写在最后","text":"写在最后","level":2}],"translations":{"common":{"welcome":"欢迎","loading":"加载中...","error":"出现了一些问题","retry":"重试","theme":"主题","language":"语言","light":"浅色","dark":"深色"},"navigation":{"home":"首页","personal":"个人","works":"作品","contributions":"贡献","documents":"文档","about":"关于","contact":"联系"},"personal":{"technicalSkills":"技术技能","email":"邮箱","github":"代码仓库","resume":"简历","codeRepository":"代码仓库","loadingPersonalInfo":"加载个人信息中...","loadingResume":"加载简历中...","closeResume":"关闭简历","emailCopied":"邮箱已复制到剪贴板！","galaxyDefaultDescription":"精通全栈开发技术，具备跨平台架构能力，擅长AI技术整合与高性能系统优化","skillGalaxy":"技能星系","stirGalaxy":"搅动星系","stirring":"搅动中...","fullStackEngineer":"MilkWind - 全栈工程师","professionalProfile":"关于我"},"documents":{"technicalDocuments":"技术文档","description":"基本原理、代码拆分以及一些碎碎念。","articles":"文章","categories":"分类","allCategories":"所有分类","noArticlesFound":"未找到文章","noArticlesAvailable":"中文暂无文章。","noArticlesInCategory":"该分类下未找到文章。","readMore":"阅读更多","loadingDocuments":"加载文档中...","backToDocuments":"← 返回文档","documentNotFound":"文档未找到","documentNotFoundDescription":"请求的文档无法找到。","technicalInsights":"技术拆解","untitledDocument":"无标题文档","byAuthor":"作者：","search":"搜索文章...","searchByTags":"按标签筛选","searching":"搜索中...","noSearchResults":"没有找到符合搜索条件的文章","clearSearch":"清除搜索","selectedTags":"已选标签","allTags":"所有标签","searchInTitle":"在标题、描述和内容中搜索","enterImmersiveMode":"沉浸阅读","exitImmersiveMode":"退出沉浸模式","immersiveReading":"沉浸阅读模式","exploreContent":"按分类探索内容","browseBy":"浏览方式","exploreAll":"所有内容汇总","categoryDescription":"该分类下的文章","totalArticles":"文章","totalCategories":"分类","foundArticles":"找到文章","categoriesWithResults":"有结果的分类"},"works":{"workCases":"作品案例","projects":"作品集","loadingProjects":"加载项目中...","grid":"网格","stack":"堆叠","of":"共","workCasesPageTitle":"作品案例页面","pageWorkingCorrectly":"此页面运行正常！路由配置正确。","try3DVersion":"尝试3D版本","dragToScroll":"拖拽滚动","dragToChange":"拖拽切换","swipeCards":"切换卡片","keyboardNav":"键盘导航"},"contributions":{"contributionCases":"开源项目","contributions":"贡献","loadingContributions":"加载贡献中...","grid":"网格","stack":"堆叠","of":"共","contributionCasesPageTitle":"贡献案例页面","pageWorkingCorrectly":"此页面运行正常！路由配置正确。","try3DVersion":"尝试3D版本","dragToScroll":"拖拽滚动","dragToChange":"拖拽切换","swipeCards":"切换卡片","keyboardNav":"键盘导航"},"contribution":{"contributionPreview":"贡献预览","accessible":"可访问","code":"代码","maintenance":"维护","enhancement":"增强","documentation":"文档","community":"社区","moreItems":"更多","technicalDetails":"技术详情","technologies":"技术栈：","contributionDetail":"贡献详情","description":"描述：","seeDetails":"查看详情","github":"代码仓库","viewContribution":"查看贡献","viewCode":"查看代码"},"project":{"projectPreview":"项目预览","accessible":"可访问","tool":"工具","plugin":"插件","toy":"小玩意","moreItems":"更多","technicalDetails":"技术详情","technologies":"技术栈：","description":"描述：","seeDetails":"查看详情","github":"GitHub","gitee":"Gitee","viewLiveDemo":"查看演示","viewCode":"查看代码","access":"访问","videos":"视频","watchVideo":"观看视频","hasVideo":"有视频"},"codeblock":{"copy":"复制","copySuccess":"代码已复制到剪贴板！","copyError":"复制代码失败","copyTooltip":"复制代码"},"toc":{"contents":"目录","autoScroll":"自动滚动到章节","collapse":"折叠","expand":"展开"},"loading":{"loading":"加载中","preparingExperience":"准备体验中"}},"lang":"zh","theme":"dark"}]
12:null
18:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
11:null
1c:{"metadata":[["$","title","0",{"children":"样式注入：TailwindCSS Preflight破坏后的浴火重生 | Interactive Portfolio"}],["$","meta","1",{"name":"description","content":"深度解析MDX到HTML转换中的样式丢失问题及完整的样式注入解决方案实现"}],["$","meta","2",{"name":"author","content":"Developer"}],["$","meta","3",{"name":"keywords","content":"portfolio,3D,interactive,web development,Three.js,Next.js"}],["$","meta","4",{"property":"og:title","content":"样式注入：TailwindCSS Preflight破坏后的浴火重生 | Interactive Portfolio"}],["$","meta","5",{"property":"og:description","content":"深度解析MDX到HTML转换中的样式丢失问题及完整的样式注入解决方案实现"}],["$","meta","6",{"property":"og:type","content":"article"}],["$","meta","7",{"property":"article:published_time","content":"2025-01-22"}],["$","meta","8",{"property":"article:tag","content":"MDX渲染"}],["$","meta","9",{"name":"twitter:card","content":"summary_large_image"}],["$","meta","10",{"name":"twitter:title","content":"样式注入：TailwindCSS Preflight破坏后的浴火重生 | Interactive Portfolio"}],["$","meta","11",{"name":"twitter:description","content":"深度解析MDX到HTML转换中的样式丢失问题及完整的样式注入解决方案实现"}],["$","link","12",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"32x32"}]],"error":null,"digest":"$undefined"}
14:{"metadata":"$1c:metadata","error":null,"digest":"$undefined"}
