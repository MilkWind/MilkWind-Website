<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/MilkWind-Website/_next/static/css/f034c804622acb16.css" data-precedence="next"/><link rel="stylesheet" href="/MilkWind-Website/_next/static/css/276b387d8ca46690.css" data-precedence="next"/><link rel="stylesheet" href="/MilkWind-Website/_next/static/css/5eacd01f773eed7f.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/MilkWind-Website/_next/static/chunks/webpack-3067cca20e80713b.js"/><script src="/MilkWind-Website/_next/static/chunks/4bd1b696-5119e10e90c1bd1b.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/1684-794bcba02d6f7373.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/main-app-c5f95d71e93250dc.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/46-268e24d727b280ef.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/app/layout-af4a6e723c0ff668.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/app/error-dda32be1d095a86c.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/6874-fbe9a08eb79b991c.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/app/not-found-9ff98b2ccf24cac7.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/206-4f4cbf4d7156f437.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/app/documents/layout-28408791defde09e.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/2415-689c103fb3d2c28d.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/8610-7bd3f91f3cf2a4d6.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/app/documents/loading-1fa3f98b6e5a8e78.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/app/loading-68f227fb49b3ac8c.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/b498d07c-095637f0f10883c6.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/9554-b714f9de28e85d30.js" async=""></script><script src="/MilkWind-Website/_next/static/chunks/app/documents/%5B...slug%5D/page-8f3efa7e6c6c5377.js" async=""></script><title>泡沫背景：从Canvas思维到DOM实现的粒子世界 | Interactive Portfolio</title><meta name="description" content="详细解析泡沫背景粒子系统的实现原理，从数学基础到交互优化"/><meta name="author" content="Developer"/><meta name="keywords" content="portfolio,3D,interactive,web development,Three.js,Next.js"/><meta property="og:title" content="泡沫背景：从Canvas思维到DOM实现的粒子世界 | Interactive Portfolio"/><meta property="og:description" content="详细解析泡沫背景粒子系统的实现原理，从数学基础到交互优化"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2025-06-22"/><meta property="article:tag" content="Canvas"/><meta property="article:tag" content="交互设计"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="泡沫背景：从Canvas思维到DOM实现的粒子世界 | Interactive Portfolio"/><meta name="twitter:description" content="详细解析泡沫背景粒子系统的实现原理，从数学基础到交互优化"/><link rel="icon" href="/MilkWind-Website/favicon.ico" type="image/x-icon" sizes="32x32"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="/MilkWind-Website/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__variable_9b7fb1 __variable_ca2a15 __variable_591dcc font-sans antialiased min-h-screen bg-background text-foreground"><div class="fixed inset-0 w-full h-full overflow-hidden pointer-events-none z-0" style="background:linear-gradient(135deg, hsl(210, 80%, 60%), hsl(180, 40%, 50%))"></div><div class="fixed top-20 right-5 z-50"><div class="w-16 h-16 rounded-full backdrop-blur-md border animate-pulse bg-surface/60 border-surface/40"></div></div><!--$--><style>
:root {
  --bprogress-color: #0066cc;
  --bprogress-height: 4px;
  --bprogress-spinner-size: 18px;
  --bprogress-spinner-animation-duration: 400ms;
  --bprogress-spinner-border-size: 2px;
  --bprogress-box-shadow: 0 0 10px #0066cc, 0 0 5px #0066cc;
  --bprogress-z-index: 99999;
  --bprogress-spinner-top: 15px;
  --bprogress-spinner-bottom: auto;
  --bprogress-spinner-right: 15px;
  --bprogress-spinner-left: auto;
}

.bprogress {
  width: 0;
  height: 0;
  pointer-events: none;
  z-index: var(--bprogress-z-index);
}

.bprogress .bar {
  background: var(--bprogress-color);
  position: fixed;
  z-index: var(--bprogress-z-index);
  top: 0;
  left: 0;
  width: 100%;
  height: var(--bprogress-height);
}

/* Fancy blur effect */
.bprogress .peg {
  display: block;
  position: absolute;
  right: 0;
  width: 100px;
  height: 100%;
  box-shadow: var(--bprogress-box-shadow);
  opacity: 1.0;
  transform: rotate(3deg) translate(0px, -4px);
}

/* Remove these to get rid of the spinner */
.bprogress .spinner {
  display: block;
  position: fixed;
  z-index: var(--bprogress-z-index);
  top: var(--bprogress-spinner-top);
  bottom: var(--bprogress-spinner-bottom);
  right: var(--bprogress-spinner-right);
  left: var(--bprogress-spinner-left);
}

.bprogress .spinner-icon {
  width: var(--bprogress-spinner-size);
  height: var(--bprogress-spinner-size);
  box-sizing: border-box;
  border: solid var(--bprogress-spinner-border-size) transparent;
  border-top-color: var(--bprogress-color);
  border-left-color: var(--bprogress-color);
  border-radius: 50%;
  -webkit-animation: bprogress-spinner var(--bprogress-spinner-animation-duration) linear infinite;
  animation: bprogress-spinner var(--bprogress-spinner-animation-duration) linear infinite;
}

.bprogress-custom-parent {
  overflow: hidden;
  position: relative;
}

.bprogress-custom-parent .bprogress .spinner,
.bprogress-custom-parent .bprogress .bar {
  position: absolute;
}

.bprogress .indeterminate {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: var(--bprogress-height);
  overflow: hidden;
}

.bprogress .indeterminate .inc,
.bprogress .indeterminate .dec {
  position: absolute;
  top: 0;
  height: 100%;
  background-color: var(--bprogress-color);
}

.bprogress .indeterminate .inc {
  animation: bprogress-indeterminate-increase 2s infinite;
}

.bprogress .indeterminate .dec {
  animation: bprogress-indeterminate-decrease 2s 0.5s infinite;
}

@-webkit-keyframes bprogress-spinner {
  0%   { -webkit-transform: rotate(0deg); transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); transform: rotate(360deg); }
}

@keyframes bprogress-spinner {
  0%   { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

@keyframes bprogress-indeterminate-increase {
  from { left: -5%; width: 5%; }
  to { left: 130%; width: 100%; }
}

@keyframes bprogress-indeterminate-decrease {
  from { left: -80%; width: 80%; }
  to { left: 110%; width: 10%; }
}
</style><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--><!--$--><div class="relative z-30 min-h-screen bg-background "><div class="container mx-auto px-4 py-8 max-w-4xl"><div class="mb-8"><a class="inline-flex items-center text-primary hover:text-primary/80 transition-colors" href="/MilkWind-Website/documents/">documents.backToDocuments</a></div><header class="mb-12"><div class="flex items-center gap-4 mb-4 text-sm text-foreground/60"><span class="px-3 py-1 bg-primary/20 text-primary rounded-full capitalize">personal website</span><span>36 min read</span></div><h1 class="font-bold mb-4 bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent text-4xl md:text-5xl">泡沫背景：从Canvas思维到DOM实现的粒子世界</h1><p class="text-xl text-foreground/80 max-w-3xl">详细解析泡沫背景粒子系统的实现原理，从数学基础到交互优化</p><div class="flex flex-wrap gap-2 mt-6"><span class="px-3 py-1 text-sm bg-accent/20 text-accent rounded-full">Canvas</span><span class="px-3 py-1 text-sm bg-accent/20 text-accent rounded-full">交互设计</span></div></header><article class="prose prose-headings:mt-8 prose-headings:font-semibold prose-headings:text-foreground prose-h1:text-5xl prose-h2:text-4xl prose-h3:text-3xl prose-h4:text-2xl prose-h5:text-xl prose-h6:text-lg max-w-none "><div class="prose-pre:p-4 prose-pre:bg-surface w-full"><h1 id="泡沫背景：从canvas思维到dom实现的粒子世界" class="group relative text-4xl font-bold mt-8 mb-4 text-foreground leading-tight">
            <a href="#泡沫背景：从canvas思维到dom实现的粒子世界" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 泡沫背景：从Canvas思维到DOM实现的粒子世界">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            泡沫背景：从Canvas思维到DOM实现的粒子世界
        </h1>
<p class="text-base leading-7 mb-4 text-foreground">序言——这是美观性计划的一部分。</p>
<p class="text-base leading-7 mb-4 text-foreground">在这篇文章中，我将从Canvas的思维模式开始，逐步展示如何用DOM + CSS的组合来创造出流畅的粒子动画效果，涵盖物理模拟、主题响应、性能优化等各个方面的实现细节。</p>
<h2 id="canvas思维在dom世界的转译" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#canvas思维在dom世界的转译" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Canvas思维在DOM世界的转译">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Canvas思维在DOM世界的转译
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">开始之前，我们先聊聊为什么要&quot;背叛&quot;Canvas，投靠DOM的怀抱。</p>
<h3 id="canvas-vs-dom：一场哲学选择" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#canvas-vs-dom：一场哲学选择" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Canvas vs DOM：一场哲学选择">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Canvas vs DOM：一场哲学选择
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">在Canvas的世界里，粒子系统的实现思路很直接：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="%2F%2F%20Canvas%E7%9A%84%E7%BB%8F%E5%85%B8%E5%A5%97%E8%B7%AF%0Afunction%20drawParticle(ctx%2C%20particle)%20%7B%0Actx.beginPath()%3B%0Actx.arc(particle.x%2C%20particle.y%2C%20particle.size%2C%200%2C%20Math.PI%20*%202)%3B%0Actx.fillStyle%20%3D%20particle.color%3B%0Actx.fill()%3B%0A%7D%0Afunction%20animateFrame()%20%7B%0Actx.clearRect(0%2C%200%2C%20canvas.width%2C%20canvas.height)%3B%0Aparticles.forEach(particle%20%3D%3E%20%7B%0AupdateParticle(particle)%3B%0AdrawParticle(ctx%2C%20particle)%3B%0A%7D)%3B%0ArequestAnimationFrame(animateFrame)%3B%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-comment inline">// Canvas的经典套路</span>
<span class="hljs-keyword inline">function</span> <span class="hljs-title function_ inline">drawParticle</span>(<span class="hljs-params inline">ctx, particle</span>) {
    ctx.<span class="hljs-title function_ inline">beginPath</span>();
    ctx.<span class="hljs-title function_ inline">arc</span>(particle.<span class="hljs-property inline">x</span>, particle.<span class="hljs-property inline">y</span>, particle.<span class="hljs-property inline">size</span>, <span class="hljs-number inline">0</span>, <span class="hljs-title class_ inline">Math</span>.<span class="hljs-property inline">PI</span> * <span class="hljs-number inline">2</span>);
    ctx.<span class="hljs-property inline">fillStyle</span> = particle.<span class="hljs-property inline">color</span>;
    ctx.<span class="hljs-title function_ inline">fill</span>();
}

<span class="hljs-keyword inline">function</span> <span class="hljs-title function_ inline">animateFrame</span>(<span class="hljs-params inline"></span>) {
    ctx.<span class="hljs-title function_ inline">clearRect</span>(<span class="hljs-number inline">0</span>, <span class="hljs-number inline">0</span>, canvas.<span class="hljs-property inline">width</span>, canvas.<span class="hljs-property inline">height</span>);
    particles.<span class="hljs-title function_ inline">forEach</span>(<span class="hljs-function inline"><span class="hljs-params inline">particle</span> =&gt;</span> {
        <span class="hljs-title function_ inline">updateParticle</span>(particle);
        <span class="hljs-title function_ inline">drawParticle</span>(ctx, particle);
    });
    <span class="hljs-title function_ inline">requestAnimationFrame</span>(animateFrame);
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">简洁明了，性能也不错。但我选择DOM的原因是：</p>
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed">这是第一点</li>
<li class="text-foreground leading-relaxed">这是第二点</li>
<li class="text-foreground leading-relaxed">这是第三点</li>
<li class="text-foreground leading-relaxed">这是第四点</li>
<li class="text-foreground leading-relaxed">这是…</li>
</ol>
<p class="text-base leading-7 mb-4 text-foreground">好吧不开玩笑了。实际上是：</p>
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">更好的可访问性</strong>: DOM元素天生支持屏幕阅读器和其他辅助技术</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">更容易的主题集成</strong>: CSS变量和主题系统无缝对接</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">更简单的事件处理</strong>: 每个粒子都是真实的DOM元素，事件处理更直观</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">GPU加速的transform</strong>: CSS的transform属性会自动触发GPU加速</li>
</ol>
<p class="text-base leading-7 mb-4 text-foreground">当然，代价就是复杂度的增加和一些性能上的权衡。<del class="line-through opacity-60">（主要是AI一开始给我的就是DOM方案导致我在这条路上越走越深）</del></p>
<h3 id="dom粒子的创建艺术" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#dom粒子的创建艺术" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to DOM粒子的创建艺术">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            DOM粒子的创建艺术
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">在DOM世界里，每个粒子都是一个真实的div元素：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20el%20%3D%20document.createElement('div')%3B%0Ael.style.position%20%3D%20'absolute'%3B%0Ael.style.borderRadius%20%3D%20'50%25'%3B%0Ael.style.backgroundColor%20%3D%20colors.particle%3B%0Ael.style.pointerEvents%20%3D%20'none'%3B%0Ael.style.willChange%20%3D%20'transform%2C%20opacity'%3B%0Acontainer.appendChild(el)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> el = <span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">createElement</span>(<span class="hljs-string inline">&#x27;div&#x27;</span>);
el.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">position</span> = <span class="hljs-string inline">&#x27;absolute&#x27;</span>;
el.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">borderRadius</span> = <span class="hljs-string inline">&#x27;50%&#x27;</span>;
el.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">backgroundColor</span> = colors.<span class="hljs-property inline">particle</span>;
el.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">pointerEvents</span> = <span class="hljs-string inline">&#x27;none&#x27;</span>;
el.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">willChange</span> = <span class="hljs-string inline">&#x27;transform, opacity&#x27;</span>;

container.<span class="hljs-title function_ inline">appendChild</span>(el);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">属性解释：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">position: absolute</strong>: 让粒子脱离文档流，可以自由定位</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">borderRadius: 50%</strong>: 把方形div变成圆形，模拟泡沫的形状</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">pointerEvents: none</strong>: 确保粒子不会干扰用户与页面的交互</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">willChange</strong>: 提示浏览器这个元素会频繁变化，开启优化</li>
</ul>
<h3 id="坐标系统的映射关系" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#坐标系统的映射关系" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 坐标系统的映射关系">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            坐标系统的映射关系
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">Canvas使用的是标准的笛卡尔坐标系，而DOM使用的是CSS坐标系。好在两者的映射关系很直接：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20Canvas%3A%20drawCircle(x%2C%20y%2C%20radius)%0A%2F%2F%20DOM%3A%20element.style.left%20%3D%20x%20%2B%20'px'%3B%20element.style.top%20%3D%20y%20%2B%20'px'%3B%0A%2F%2F%20%E6%88%91%E4%BB%AC%E7%9A%84%E5%AE%9E%E7%8E%B0%0Ap.el.style.transform%20%3D%20%60translate(%24%7Bp.x%7Dpx%2C%20%24%7Bp.y%7Dpx)%20scale(%24%7Bscale%7D)%60%3B%0Ap.el.style.opacity%20%3D%20opacity.toString()%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// Canvas: drawCircle(x, y, radius)</span>
<span class="hljs-comment inline">// DOM: element.style.left = x + &#x27;px&#x27;; element.style.top = y + &#x27;px&#x27;;</span>

<span class="hljs-comment inline">// 我们的实现</span>
p.<span class="hljs-property inline">el</span>.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">transform</span> = <span class="hljs-string inline">`translate(<span class="hljs-subst inline">${p.x}</span>px, <span class="hljs-subst inline">${p.y}</span>px) scale(<span class="hljs-subst inline">${scale}</span>)`</span>;
p.<span class="hljs-property inline">el</span>.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">opacity</span> = opacity.<span class="hljs-title function_ inline">toString</span>();
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">使用<code>transform</code>而不是直接修改<code>left/top</code>有个重要原因：<strong class="font-bold text-foreground">transform不会触发重排</strong>，只会触发重绘和合成，性能更好。</p>
<h2 id="粒子的生命周期与数据架构" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#粒子的生命周期与数据架构" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 粒子的生命周期与数据架构">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            粒子的生命周期与数据架构
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">现在让我们深入粒子系统的核心——数据结构设计。</p>
<h3 id="粒子接口设计" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#粒子接口设计" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 粒子接口设计">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            粒子接口设计
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="interface%20Particle%20%7B%0Ael%3A%20HTMLDivElement%3B%20%20%20%20%2F%2F%20DOM%E5%85%83%E7%B4%A0%E5%BC%95%E7%94%A8%0Ax%3A%20number%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20X%E5%9D%90%E6%A0%87%0Ay%3A%20number%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Y%E5%9D%90%E6%A0%87%0Avx%3A%20number%3B%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20X%E6%96%B9%E5%90%91%E9%80%9F%E5%BA%A6%0Avy%3A%20number%3B%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Y%E6%96%B9%E5%90%91%E9%80%9F%E5%BA%A6%0Asize%3A%20number%3B%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E7%B2%92%E5%AD%90%E5%A4%A7%E5%B0%8F%0Adepth%3A%20number%3B%20%20%20%20%20%20%20%20%20%2F%2F%20%E6%B7%B1%E5%BA%A6%E5%B1%82%E6%AC%A1(0-1)%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">interface</span> <span class="hljs-title class_ inline">Particle</span> {
  <span class="hljs-attr inline">el</span>: <span class="hljs-title class_ inline">HTMLDivElement</span>;    <span class="hljs-comment inline">// DOM元素引用</span>
  <span class="hljs-attr inline">x</span>: <span class="hljs-built_in inline">number</span>;             <span class="hljs-comment inline">// X坐标</span>
  <span class="hljs-attr inline">y</span>: <span class="hljs-built_in inline">number</span>;             <span class="hljs-comment inline">// Y坐标  </span>
  <span class="hljs-attr inline">vx</span>: <span class="hljs-built_in inline">number</span>;            <span class="hljs-comment inline">// X方向速度</span>
  <span class="hljs-attr inline">vy</span>: <span class="hljs-built_in inline">number</span>;            <span class="hljs-comment inline">// Y方向速度</span>
  <span class="hljs-attr inline">size</span>: <span class="hljs-built_in inline">number</span>;          <span class="hljs-comment inline">// 粒子大小</span>
  <span class="hljs-attr inline">depth</span>: <span class="hljs-built_in inline">number</span>;         <span class="hljs-comment inline">// 深度层次(0-1)</span>
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">字段解释：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">el</strong>: 直接存储DOM元素引用，避免频繁的DOM查询</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">x, y</strong>: 当前的精确位置（可以是小数）</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">vx, vy</strong>: 速度向量，用于模拟物理运动</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">size</strong>: 粒子的基础大小，会结合depth计算最终显示大小</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">depth</strong>: 这是视觉深度的关键，控制着粒子的大小、透明度和运动速度</li>
</ul>
<h3 id="粒子初始化的随机化策略" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#粒子初始化的随机化策略" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 粒子初始化的随机化策略">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            粒子初始化的随机化策略
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20initializeParticles%20%3D%20useCallback(()%20%3D%3E%20%7B%0Aconst%20width%20%3D%20window.innerWidth%3B%0Aconst%20height%20%3D%20window.innerHeight%3B%0Aconst%20colors%20%3D%20getThemeColors()%3B%0Afor%20(let%20i%20%3D%200%3B%20i%20NUM_PARTICLES%3B%20i%2B%2B)%20%7B%0Aconst%20size%20%3D%202%20%2B%20Math.random()%20*%204%3B%20%20%20%20%20%20%2F%2F%202-6px%E7%9A%84%E9%9A%8F%E6%9C%BA%E5%A4%A7%E5%B0%8F%0Aconst%20depth%20%3D%20Math.random()%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%200-1%E7%9A%84%E9%9A%8F%E6%9C%BA%E6%B7%B1%E5%BA%A6%0Aconst%20x%20%3D%20Math.random()%20*%20width%3B%20%20%20%20%20%20%20%20%20%2F%2F%20%E9%9A%8F%E6%9C%BAX%E4%BD%8D%E7%BD%AE%0Aconst%20y%20%3D%20Math.random()%20*%20height%3B%20%20%20%20%20%20%20%20%2F%2F%20%E9%9A%8F%E6%9C%BAY%E4%BD%8D%E7%BD%AE%0Aconst%20particle%20%3D%20%7B%0Ael%2C%20x%2C%20y%2C%0Avx%3A%200%2C%20vy%3A%200%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%88%9D%E5%A7%8B%E9%80%9F%E5%BA%A6%E4%B8%BA0%0Asize%2C%20depth%0A%7D%3B%0AparticlesRef.current.push(particle)%3B%0A%7D%0A%7D%2C%20%5BgetThemeColors%5D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> initializeParticles = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-keyword inline">const</span> width = <span class="hljs-variable language_ inline">window</span>.<span class="hljs-property inline">innerWidth</span>;
    <span class="hljs-keyword inline">const</span> height = <span class="hljs-variable language_ inline">window</span>.<span class="hljs-property inline">innerHeight</span>;
    <span class="hljs-keyword inline">const</span> colors = <span class="hljs-title function_ inline">getThemeColors</span>();

    <span class="hljs-keyword inline">for</span> (<span class="hljs-keyword inline">let</span> i = <span class="hljs-number inline">0</span>; i &lt; <span class="hljs-variable constant_ inline">NUM_PARTICLES</span>; i++) {
        <span class="hljs-keyword inline">const</span> size = <span class="hljs-number inline">2</span> + <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">random</span>() * <span class="hljs-number inline">4</span>;      <span class="hljs-comment inline">// 2-6px的随机大小</span>
        <span class="hljs-keyword inline">const</span> depth = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">random</span>();             <span class="hljs-comment inline">// 0-1的随机深度</span>
        <span class="hljs-keyword inline">const</span> x = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">random</span>() * width;         <span class="hljs-comment inline">// 随机X位置</span>
        <span class="hljs-keyword inline">const</span> y = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">random</span>() * height;        <span class="hljs-comment inline">// 随机Y位置</span>

        <span class="hljs-keyword inline">const</span> particle = {
            el, x, y,
            <span class="hljs-attr inline">vx</span>: <span class="hljs-number inline">0</span>, <span class="hljs-attr inline">vy</span>: <span class="hljs-number inline">0</span>,                        <span class="hljs-comment inline">// 初始速度为0</span>
            size, depth
        };
        
        particlesRef.<span class="hljs-property inline">current</span>.<span class="hljs-title function_ inline">push</span>(particle);
    }
}, [getThemeColors]);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">为什么初始速度为0</strong>？让粒子从静止开始，只在受到外力（动画效果）时才运动，更符合物理直觉。</p>
<h3 id="动画循环的时间精度控制" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#动画循环的时间精度控制" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 动画循环的时间精度控制">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            动画循环的时间精度控制
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">这是整个系统的心脏——动画循环：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20animate%20%3D%20useCallback(()%20%3D%3E%20%7B%0Aconst%20mouse%20%3D%20mouseRef.current%3B%0Aconst%20width%20%3D%20window.innerWidth%3B%0Aconst%20height%20%3D%20window.innerHeight%3B%0Afor%20(let%20p%20of%20particlesRef.current)%20%7B%0A%2F%2F%20%E5%9F%BA%E7%A1%80%E6%BC%82%E7%A7%BB%EF%BC%88%E6%A8%A1%E6%8B%9F%E6%B5%81%E4%BD%93%E8%BF%90%E5%8A%A8%EF%BC%89%0Ap.vx%20%2B%3D%200.01%20*%20p.depth%3B%0Ap.vy%20%2B%3D%200.005%20*%20p.depth%3B%0A%2F%2F%20%E4%BA%A4%E4%BA%92%E5%8A%9B%E5%9C%BA%E8%AE%A1%E7%AE%97%0Aif%20(mouse.down)%20%7B%0Aconst%20dx%20%3D%20p.x%20-%20mouse.x%3B%0Aconst%20dy%20%3D%20p.y%20-%20mouse.y%3B%0Aconst%20dist%20%3D%20Math.sqrt(dx%20*%20dx%20%2B%20dy%20*%20dy)%3B%0Aif%20(dist%20100)%20%7B%0Aconst%20baseForce%20%3D%20100%20%2F%20(dist%20%2B%2010)%3B%0Aconst%20force%20%3D%20baseForce%20*%20p.depth%3B%0Ap.vx%20%2B%3D%20force%20*%20(dx%20%2F%20dist)%3B%0Ap.vy%20%2B%3D%20force%20*%20(dy%20%2F%20dist)%3B%0A%7D%0A%7D%0A%2F%2F%20%E5%BA%94%E7%94%A8%E6%91%A9%E6%93%A6%E5%8A%9B%0Ap.vx%20*%3D%200.95%3B%0Ap.vy%20*%3D%200.95%3B%0A%2F%2F%20%E6%9B%B4%E6%96%B0%E4%BD%8D%E7%BD%AE%0Ap.x%20%2B%3D%20p.vx%3B%0Ap.y%20%2B%3D%20p.vy%3B%0A%2F%2F%20%E8%BE%B9%E7%95%8C%E7%8E%AF%E7%BB%95%0Aif%20(p.x%2010)%20p.x%20%3D%20width%20%2B%2010%3B%0Aif%20(p.x%20%3E%20width%20%2B%2010)%20p.x%20%3D%20-10%3B%0Aif%20(p.y%2010)%20p.y%20%3D%20height%20%2B%2010%3B%0Aif%20(p.y%20%3E%20height%20%2B%2010)%20p.y%20%3D%20-10%3B%0A%2F%2F%20%E8%A7%86%E8%A7%89%E6%95%88%E6%9E%9C%E6%9B%B4%E6%96%B0%0Aconst%20scale%20%3D%200.6%20%2B%200.4%20*%20p.depth%3B%0Aconst%20opacity%20%3D%200.4%20%2B%200.6%20*%20p.depth%3B%0Ap.el.style.transform%20%3D%20%60translate(%24%7Bp.x%7Dpx%2C%20%24%7Bp.y%7Dpx)%20scale(%24%7Bscale%7D)%60%3B%0Ap.el.style.opacity%20%3D%20opacity.toString()%3B%0A%7D%0AanimationRef.current%20%3D%20requestAnimationFrame(animate)%3B%0A%7D%2C%20%5B%5D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> animate = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-keyword inline">const</span> mouse = mouseRef.<span class="hljs-property inline">current</span>;
    <span class="hljs-keyword inline">const</span> width = <span class="hljs-variable language_ inline">window</span>.<span class="hljs-property inline">innerWidth</span>;
    <span class="hljs-keyword inline">const</span> height = <span class="hljs-variable language_ inline">window</span>.<span class="hljs-property inline">innerHeight</span>;

    <span class="hljs-keyword inline">for</span> (<span class="hljs-keyword inline">let</span> p <span class="hljs-keyword inline">of</span> particlesRef.<span class="hljs-property inline">current</span>) {
        <span class="hljs-comment inline">// 基础漂移（模拟流体运动）</span>
        p.<span class="hljs-property inline">vx</span> += <span class="hljs-number inline">0.01</span> * p.<span class="hljs-property inline">depth</span>;
        p.<span class="hljs-property inline">vy</span> += <span class="hljs-number inline">0.005</span> * p.<span class="hljs-property inline">depth</span>;

        <span class="hljs-comment inline">// 交互力场计算</span>
        <span class="hljs-keyword inline">if</span> (mouse.<span class="hljs-property inline">down</span>) {
            <span class="hljs-keyword inline">const</span> dx = p.<span class="hljs-property inline">x</span> - mouse.<span class="hljs-property inline">x</span>;
            <span class="hljs-keyword inline">const</span> dy = p.<span class="hljs-property inline">y</span> - mouse.<span class="hljs-property inline">y</span>;
            <span class="hljs-keyword inline">const</span> dist = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">sqrt</span>(dx * dx + dy * dy);

            <span class="hljs-keyword inline">if</span> (dist &lt; <span class="hljs-number inline">100</span>) {
                <span class="hljs-keyword inline">const</span> baseForce = <span class="hljs-number inline">100</span> / (dist + <span class="hljs-number inline">10</span>);
                <span class="hljs-keyword inline">const</span> force = baseForce * p.<span class="hljs-property inline">depth</span>;

                p.<span class="hljs-property inline">vx</span> += force * (dx / dist);
                p.<span class="hljs-property inline">vy</span> += force * (dy / dist);
            }
        }

        <span class="hljs-comment inline">// 应用摩擦力</span>
        p.<span class="hljs-property inline">vx</span> *= <span class="hljs-number inline">0.95</span>;
        p.<span class="hljs-property inline">vy</span> *= <span class="hljs-number inline">0.95</span>;

        <span class="hljs-comment inline">// 更新位置</span>
        p.<span class="hljs-property inline">x</span> += p.<span class="hljs-property inline">vx</span>;
        p.<span class="hljs-property inline">y</span> += p.<span class="hljs-property inline">vy</span>;

        <span class="hljs-comment inline">// 边界环绕</span>
        <span class="hljs-keyword inline">if</span> (p.<span class="hljs-property inline">x</span> &lt; -<span class="hljs-number inline">10</span>) p.<span class="hljs-property inline">x</span> = width + <span class="hljs-number inline">10</span>;
        <span class="hljs-keyword inline">if</span> (p.<span class="hljs-property inline">x</span> &gt; width + <span class="hljs-number inline">10</span>) p.<span class="hljs-property inline">x</span> = -<span class="hljs-number inline">10</span>;
        <span class="hljs-keyword inline">if</span> (p.<span class="hljs-property inline">y</span> &lt; -<span class="hljs-number inline">10</span>) p.<span class="hljs-property inline">y</span> = height + <span class="hljs-number inline">10</span>;
        <span class="hljs-keyword inline">if</span> (p.<span class="hljs-property inline">y</span> &gt; height + <span class="hljs-number inline">10</span>) p.<span class="hljs-property inline">y</span> = -<span class="hljs-number inline">10</span>;

        <span class="hljs-comment inline">// 视觉效果更新</span>
        <span class="hljs-keyword inline">const</span> scale = <span class="hljs-number inline">0.6</span> + <span class="hljs-number inline">0.4</span> * p.<span class="hljs-property inline">depth</span>;
        <span class="hljs-keyword inline">const</span> opacity = <span class="hljs-number inline">0.4</span> + <span class="hljs-number inline">0.6</span> * p.<span class="hljs-property inline">depth</span>;

        p.<span class="hljs-property inline">el</span>.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">transform</span> = <span class="hljs-string inline">`translate(<span class="hljs-subst inline">${p.x}</span>px, <span class="hljs-subst inline">${p.y}</span>px) scale(<span class="hljs-subst inline">${scale}</span>)`</span>;
        p.<span class="hljs-property inline">el</span>.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">opacity</span> = opacity.<span class="hljs-title function_ inline">toString</span>();
    }

    animationRef.<span class="hljs-property inline">current</span> = <span class="hljs-title function_ inline">requestAnimationFrame</span>(animate);
}, []);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">数值解析：</p>
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">0.01 * p.depth</strong>: 基础漂移力，让粒子有轻微的自然运动</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">0.005 * p.depth</strong>: Y方向的漂移更小，模拟重力的微弱影响</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">100 / (dist + 10)</strong>: 反平方力场，距离越近力越大，+10避免除零错误</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">0.95</strong>: 摩擦系数，让粒子运动逐渐减缓，模拟空气阻力</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">-10, +10</strong>: 边界缓冲，让粒子从屏幕外进入，避免突然出现</li>
</ol>
<h2 id="交互系统的物理世界" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#交互系统的物理世界" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 交互系统的物理世界">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            交互系统的物理世界
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">你也不想背景UI只是一副动态贴图吧？——沃兹基索德</p>
<h3 id="鼠标事件的全生命周期管理" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#鼠标事件的全生命周期管理" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 鼠标事件的全生命周期管理">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            鼠标事件的全生命周期管理
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20mouseRef%20%3D%20useRefMouseState%3E(%7B%20x%3A%200%2C%20y%3A%200%2C%20down%3A%20false%20%7D)%3B%0Aconst%20updateMousePos%20%3D%20useCallback((e%3A%20MouseEvent%20%7C%20Touch)%20%3D%3E%20%7B%0AmouseRef.current.x%20%3D%20e.clientX%3B%0AmouseRef.current.y%20%3D%20e.clientY%3B%0A%7D%2C%20%5B%5D)%3B%0Aconst%20handleMouseDown%20%3D%20useCallback((e%3A%20MouseEvent)%20%3D%3E%20%7B%0AmouseRef.current.down%20%3D%20true%3B%0AupdateMousePos(e)%3B%0A%7D%2C%20%5BupdateMousePos%5D)%3B%0Aconst%20handleMouseUp%20%3D%20useCallback(()%20%3D%3E%20%7B%0AmouseRef.current.down%20%3D%20false%3B%0A%7D%2C%20%5B%5D)%3B%0Aconst%20handleMouseMove%20%3D%20useCallback((e%3A%20MouseEvent)%20%3D%3E%20%7B%0Aif%20(mouseRef.current.down)%20updateMousePos(e)%3B%0A%7D%2C%20%5BupdateMousePos%5D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> mouseRef = useRef&lt;<span class="hljs-title class_ inline">MouseState</span>&gt;({ <span class="hljs-attr inline">x</span>: <span class="hljs-number inline">0</span>, <span class="hljs-attr inline">y</span>: <span class="hljs-number inline">0</span>, <span class="hljs-attr inline">down</span>: <span class="hljs-literal inline">false</span> });

<span class="hljs-keyword inline">const</span> updateMousePos = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">e</span>: <span class="hljs-title class_ inline">MouseEvent</span> | <span class="hljs-title class_ inline">Touch</span></span>) =&gt;</span> {
    mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">x</span> = e.<span class="hljs-property inline">clientX</span>;
    mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">y</span> = e.<span class="hljs-property inline">clientY</span>;
}, []);

<span class="hljs-keyword inline">const</span> handleMouseDown = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">e</span>: <span class="hljs-title class_ inline">MouseEvent</span></span>) =&gt;</span> {
    mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span> = <span class="hljs-literal inline">true</span>;
    <span class="hljs-title function_ inline">updateMousePos</span>(e);
}, [updateMousePos]);

<span class="hljs-keyword inline">const</span> handleMouseUp = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">() =&gt;</span> {
    mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span> = <span class="hljs-literal inline">false</span>;
}, []);

<span class="hljs-keyword inline">const</span> handleMouseMove = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">e</span>: <span class="hljs-title class_ inline">MouseEvent</span></span>) =&gt;</span> {
    <span class="hljs-keyword inline">if</span> (mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span>) <span class="hljs-title function_ inline">updateMousePos</span>(e);
}, [updateMousePos]);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">为什么要用ref而不是state</strong>？因为在60fps的动画循环中，我们需要在每一帧都读取鼠标位置，使用state会导致不必要的重渲染。ref提供了一个&quot;逃脱React渲染循环&quot;的后门。</p>
<h3 id="力场计算的数学原理" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#力场计算的数学原理" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 力场计算的数学原理">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            力场计算的数学原理
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">这是物理模拟的核心部分：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20%E8%AE%A1%E7%AE%97%E7%B2%92%E5%AD%90%E5%88%B0%E9%BC%A0%E6%A0%87%E7%9A%84%E5%90%91%E9%87%8F%0Aconst%20dx%20%3D%20p.x%20-%20mouse.x%3B%0Aconst%20dy%20%3D%20p.y%20-%20mouse.y%3B%0A%2F%2F%20%E8%AE%A1%E7%AE%97%E8%B7%9D%E7%A6%BB%EF%BC%88%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E8%B7%9D%E7%A6%BB%EF%BC%89%0Aconst%20dist%20%3D%20Math.sqrt(dx%20*%20dx%20%2B%20dy%20*%20dy)%3B%0A%2F%2F%20%E5%8F%8D%E5%B9%B3%E6%96%B9%E5%8A%9B%E5%9C%BA%EF%BC%88%E7%B1%BB%E4%BC%BC%E4%B8%87%E6%9C%89%E5%BC%95%E5%8A%9B%EF%BC%89%0Aconst%20baseForce%20%3D%20100%20%2F%20(dist%20%2B%2010)%3B%0A%2F%2F%20%E6%B7%B1%E5%BA%A6%E5%BD%B1%E5%93%8D%E5%8A%9B%E7%9A%84%E5%A4%A7%E5%B0%8F%0Aconst%20force%20%3D%20baseForce%20*%20p.depth%3B%0A%2F%2F%20%E8%AE%A1%E7%AE%97%E5%8D%95%E4%BD%8D%E5%90%91%E9%87%8F%E5%B9%B6%E5%BA%94%E7%94%A8%E5%8A%9B%0Ap.vx%20%2B%3D%20force%20*%20(dx%20%2F%20dist)%3B%0Ap.vy%20%2B%3D%20force%20*%20(dy%20%2F%20dist)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// 计算粒子到鼠标的向量</span>
<span class="hljs-keyword inline">const</span> dx = p.<span class="hljs-property inline">x</span> - mouse.<span class="hljs-property inline">x</span>;
<span class="hljs-keyword inline">const</span> dy = p.<span class="hljs-property inline">y</span> - mouse.<span class="hljs-property inline">y</span>;

<span class="hljs-comment inline">// 计算距离（欧几里得距离）</span>
<span class="hljs-keyword inline">const</span> dist = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">sqrt</span>(dx * dx + dy * dy);

<span class="hljs-comment inline">// 反平方力场（类似万有引力）</span>
<span class="hljs-keyword inline">const</span> baseForce = <span class="hljs-number inline">100</span> / (dist + <span class="hljs-number inline">10</span>);

<span class="hljs-comment inline">// 深度影响力的大小</span>
<span class="hljs-keyword inline">const</span> force = baseForce * p.<span class="hljs-property inline">depth</span>;

<span class="hljs-comment inline">// 计算单位向量并应用力</span>
p.<span class="hljs-property inline">vx</span> += force * (dx / dist);
p.<span class="hljs-property inline">vy</span> += force * (dy / dist);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">这个公式模拟了一个&quot;排斥力场&quot;：</p>
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">距离计算</strong>: 使用勾股定理计算实际距离</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">力的大小</strong>: 使用反平方定律，距离越近力越大</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">力的方向</strong>: <code>(dx/dist, dy/dist)</code>是从鼠标指向粒子的单位向量</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">深度加权</strong>: 靠近屏幕的粒子受力更明显，增加立体感</li>
</ol>
<h3 id="多点触控的支持" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#多点触控的支持" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 多点触控的支持">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            多点触控的支持
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20handleTouchStart%20%3D%20useCallback((e%3A%20TouchEvent)%20%3D%3E%20%7B%0AmouseRef.current.down%20%3D%20true%3B%0AupdateMousePos(e.touches%5B0%5D)%3B%0A%7D%2C%20%5BupdateMousePos%5D)%3B%0Aconst%20handleTouchMove%20%3D%20useCallback((e%3A%20TouchEvent)%20%3D%3E%20%7B%0Aif%20(mouseRef.current.down)%20updateMousePos(e.touches%5B0%5D)%3B%0A%7D%2C%20%5BupdateMousePos%5D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> handleTouchStart = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">e</span>: <span class="hljs-title class_ inline">TouchEvent</span></span>) =&gt;</span> {
    mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span> = <span class="hljs-literal inline">true</span>;
    <span class="hljs-title function_ inline">updateMousePos</span>(e.<span class="hljs-property inline">touches</span>[<span class="hljs-number inline">0</span>]);
}, [updateMousePos]);

<span class="hljs-keyword inline">const</span> handleTouchMove = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">e</span>: <span class="hljs-title class_ inline">TouchEvent</span></span>) =&gt;</span> {
    <span class="hljs-keyword inline">if</span> (mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span>) <span class="hljs-title function_ inline">updateMousePos</span>(e.<span class="hljs-property inline">touches</span>[<span class="hljs-number inline">0</span>]);
}, [updateMousePos]);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">移动设备支持只是取第一个触摸点，因为多点触控的物理模拟会变得非常复杂，而且大多数用户也只会用一个手指。<del class="line-through opacity-60">（偷懒的合理化）</del></p>
<h3 id="摩擦力模拟" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#摩擦力模拟" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 摩擦力模拟">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            摩擦力模拟
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="p.vx%20*%3D%200.95%3B%0Ap.vy%20*%3D%200.95%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript">p.<span class="hljs-property inline">vx</span> *= <span class="hljs-number inline">0.95</span>;
p.<span class="hljs-property inline">vy</span> *= <span class="hljs-number inline">0.95</span>;
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><del class="line-through opacity-60">从网上随便找来的摩擦力系数。</del></p>
<h2 id="主题系统的色彩混合" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#主题系统的色彩混合" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 主题系统的色彩混合">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            主题系统的色彩混合
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">泡沫背景需要与网站的主题系统无缝集成，这里涉及到了较为复杂的颜色混合运算。</p>
<h3 id="hsl颜色空间" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#hsl颜色空间" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to HSL颜色空间">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            HSL颜色空间
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">相比RGB，HSL更加适合生成相近的色彩：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20hexToHsl%20%3D%20useCallback((hex%3A%20string)%20%3D%3E%20%7B%0A%2F%2F%20%E5%B0%8616%E8%BF%9B%E5%88%B6%E8%BD%AC%E6%8D%A2%E4%B8%BARGB%0Aconst%20r%20%3D%20parseInt(hex.slice(1%2C%203)%2C%2016)%20%2F%20255%3B%0Aconst%20g%20%3D%20parseInt(hex.slice(3%2C%205)%2C%2016)%20%2F%20255%3B%0Aconst%20b%20%3D%20parseInt(hex.slice(5%2C%207)%2C%2016)%20%2F%20255%3B%0A%2F%2F%20%E6%89%BE%E5%88%B0%E6%9C%80%E5%A4%A7%E5%80%BC%E5%92%8C%E6%9C%80%E5%B0%8F%E5%80%BC%0Aconst%20max%20%3D%20Math.max(r%2C%20g%2C%20b)%3B%0Aconst%20min%20%3D%20Math.min(r%2C%20g%2C%20b)%3B%0Alet%20h%20%3D%200%2C%20s%20%3D%200%2C%20l%20%3D%20(max%20%2B%20min)%20%2F%202%3B%0Aif%20(max%20!%3D%3D%20min)%20%7B%0Aconst%20d%20%3D%20max%20-%20min%3B%0As%20%3D%20l%20%3E%200.5%20%3F%20d%20%2F%20(2%20-%20max%20-%20min)%20%3A%20d%20%2F%20(max%20%2B%20min)%3B%0Aswitch%20(max)%20%7B%0Acase%20r%3A%20h%20%3D%20(g%20-%20b)%20%2F%20d%20%2B%20(g%206%20%3A%200)%3B%20break%3B%0Acase%20g%3A%20h%20%3D%20(b%20-%20r)%20%2F%20d%20%2B%202%3B%20break%3B%0Acase%20b%3A%20h%20%3D%20(r%20-%20g)%20%2F%20d%20%2B%204%3B%20break%3B%0A%7D%0Ah%20%2F%3D%206%3B%0A%7D%0Areturn%20%5BMath.round(h%20*%20360)%2C%20Math.round(s%20*%20100)%2C%20Math.round(l%20*%20100)%5D%3B%0A%7D%2C%20%5B%5D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> hexToHsl = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">hex</span>: <span class="hljs-built_in inline">string</span></span>) =&gt;</span> {
    <span class="hljs-comment inline">// 将16进制转换为RGB</span>
    <span class="hljs-keyword inline">const</span> r = <span class="hljs-built_in inline">parseInt</span>(hex.<span class="hljs-title function_ inline">slice</span>(<span class="hljs-number inline">1</span>, <span class="hljs-number inline">3</span>), <span class="hljs-number inline">16</span>) / <span class="hljs-number inline">255</span>;
    <span class="hljs-keyword inline">const</span> g = <span class="hljs-built_in inline">parseInt</span>(hex.<span class="hljs-title function_ inline">slice</span>(<span class="hljs-number inline">3</span>, <span class="hljs-number inline">5</span>), <span class="hljs-number inline">16</span>) / <span class="hljs-number inline">255</span>;
    <span class="hljs-keyword inline">const</span> b = <span class="hljs-built_in inline">parseInt</span>(hex.<span class="hljs-title function_ inline">slice</span>(<span class="hljs-number inline">5</span>, <span class="hljs-number inline">7</span>), <span class="hljs-number inline">16</span>) / <span class="hljs-number inline">255</span>;

    <span class="hljs-comment inline">// 找到最大值和最小值</span>
    <span class="hljs-keyword inline">const</span> max = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">max</span>(r, g, b);
    <span class="hljs-keyword inline">const</span> min = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">min</span>(r, g, b);
    <span class="hljs-keyword inline">let</span> h = <span class="hljs-number inline">0</span>, s = <span class="hljs-number inline">0</span>, l = (max + min) / <span class="hljs-number inline">2</span>;

    <span class="hljs-keyword inline">if</span> (max !== min) {
        <span class="hljs-keyword inline">const</span> d = max - min;
        s = l &gt; <span class="hljs-number inline">0.5</span> ? d / (<span class="hljs-number inline">2</span> - max - min) : d / (max + min);
        
        <span class="hljs-keyword inline">switch</span> (max) {
            <span class="hljs-keyword inline">case</span> <span class="hljs-attr inline">r</span>: h = (g - b) / d + (g &lt; b ? <span class="hljs-number inline">6</span> : <span class="hljs-number inline">0</span>); <span class="hljs-keyword inline">break</span>;
            <span class="hljs-keyword inline">case</span> <span class="hljs-attr inline">g</span>: h = (b - r) / d + <span class="hljs-number inline">2</span>; <span class="hljs-keyword inline">break</span>;
            <span class="hljs-keyword inline">case</span> <span class="hljs-attr inline">b</span>: h = (r - g) / d + <span class="hljs-number inline">4</span>; <span class="hljs-keyword inline">break</span>;
        }
        h /= <span class="hljs-number inline">6</span>;
    }

    <span class="hljs-keyword inline">return</span> [<span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">round</span>(h * <span class="hljs-number inline">360</span>), <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">round</span>(s * <span class="hljs-number inline">100</span>), <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">round</span>(l * <span class="hljs-number inline">100</span>)];
}, []);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">这个转换算法看起来复杂，但原理很直观：</p>
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">将RGB标准化到0-1范围</strong></li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">计算明度(L)</strong>: 最大值和最小值的平均</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">计算饱和度(S)</strong>: 基于明度和色彩范围</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">计算色相(H)</strong>: 基于主导颜色的位置</li>
</ol>
<h3 id="主题响应的动态生成策略" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#主题响应的动态生成策略" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 主题响应的动态生成策略">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            主题响应的动态生成策略
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20getThemeColors%20%3D%20useCallback(()%20%3D%3E%20%7B%0Aconst%20%5BprimaryH%2C%20primaryS%5D%20%3D%20hexToHsl(currentTheme.colors.primary)%3B%0Aconst%20%5BaccentH%2C%20accentS%5D%20%3D%20hexToHsl(currentTheme.colors.accent)%3B%0Aconst%20isDark%20%3D%20currentTheme.id%20%3D%3D%3D%20'dark'%3B%0Aif%20(isDark)%20%7B%0A%2F%2F%20%E6%B7%B1%E8%89%B2%E4%B8%BB%E9%A2%98%EF%BC%9A%E6%9B%B4%E6%B7%B1%E3%80%81%E6%9B%B4%E9%A5%B1%E5%92%8C%E7%9A%84%E9%A2%9C%E8%89%B2%0Areturn%20%7B%0Abackground%3A%20%60linear-gradient(135deg%2C%20hsl(%24%7BprimaryH%7D%2C%20%24%7BMath.max(primaryS%20%2B%2010%2C%2040)%7D%25%2C%2025%25)%2C%20hsl(%24%7BaccentH%7D%2C%20%24%7BMath.max(accentS%20%2B%205%2C%2035)%7D%25%2C%2020%25))%60%2C%0Aparticle%3A%20%60hsl(%24%7BprimaryH%7D%2C%20%24%7BMath.max(primaryS%20%2B%2015%2C%2050)%7D%25%2C%2045%25)%60%0A%7D%3B%0A%7D%20else%20%7B%0A%2F%2F%20%E6%B5%85%E8%89%B2%E4%B8%BB%E9%A2%98%EF%BC%9A%E6%9B%B4%E4%BA%AE%E7%9A%84%E9%A2%9C%E8%89%B2%0Areturn%20%7B%0Abackground%3A%20%60linear-gradient(135deg%2C%20hsl(%24%7BprimaryH%7D%2C%20%24%7BMath.max(primaryS%20-%2020%2C%2020)%7D%25%2C%2060%25)%2C%20hsl(%24%7BaccentH%7D%2C%20%24%7BMath.max(accentS%20-%2010%2C%2030)%7D%25%2C%2050%25))%60%2C%0Aparticle%3A%20%60hsl(%24%7BprimaryH%7D%2C%20%24%7BMath.max(primaryS%20-%2010%2C%2035)%7D%25%2C%2075%25)%60%0A%7D%3B%0A%7D%0A%7D%2C%20%5BcurrentTheme%2C%20hexToHsl%5D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> getThemeColors = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-keyword inline">const</span> [primaryH, primaryS] = <span class="hljs-title function_ inline">hexToHsl</span>(currentTheme.<span class="hljs-property inline">colors</span>.<span class="hljs-property inline">primary</span>);
    <span class="hljs-keyword inline">const</span> [accentH, accentS] = <span class="hljs-title function_ inline">hexToHsl</span>(currentTheme.<span class="hljs-property inline">colors</span>.<span class="hljs-property inline">accent</span>);
    
    <span class="hljs-keyword inline">const</span> isDark = currentTheme.<span class="hljs-property inline">id</span> === <span class="hljs-string inline">&#x27;dark&#x27;</span>;
    
    <span class="hljs-keyword inline">if</span> (isDark) {
        <span class="hljs-comment inline">// 深色主题：更深、更饱和的颜色</span>
        <span class="hljs-keyword inline">return</span> {
            <span class="hljs-attr inline">background</span>: <span class="hljs-string inline">`linear-gradient(135deg, hsl(<span class="hljs-subst inline">${primaryH}</span>, <span class="hljs-subst inline">${<span class="hljs-built_in inline">Math</span>.max(primaryS + <span class="hljs-number inline">10</span>, <span class="hljs-number inline">40</span>)}</span>%, 25%), hsl(<span class="hljs-subst inline">${accentH}</span>, <span class="hljs-subst inline">${<span class="hljs-built_in inline">Math</span>.max(accentS + <span class="hljs-number inline">5</span>, <span class="hljs-number inline">35</span>)}</span>%, 20%))`</span>,
            <span class="hljs-attr inline">particle</span>: <span class="hljs-string inline">`hsl(<span class="hljs-subst inline">${primaryH}</span>, <span class="hljs-subst inline">${<span class="hljs-built_in inline">Math</span>.max(primaryS + <span class="hljs-number inline">15</span>, <span class="hljs-number inline">50</span>)}</span>%, 45%)`</span>
        };
    } <span class="hljs-keyword inline">else</span> {
        <span class="hljs-comment inline">// 浅色主题：更亮的颜色</span>
        <span class="hljs-keyword inline">return</span> {
            <span class="hljs-attr inline">background</span>: <span class="hljs-string inline">`linear-gradient(135deg, hsl(<span class="hljs-subst inline">${primaryH}</span>, <span class="hljs-subst inline">${<span class="hljs-built_in inline">Math</span>.max(primaryS - <span class="hljs-number inline">20</span>, <span class="hljs-number inline">20</span>)}</span>%, 60%), hsl(<span class="hljs-subst inline">${accentH}</span>, <span class="hljs-subst inline">${<span class="hljs-built_in inline">Math</span>.max(accentS - <span class="hljs-number inline">10</span>, <span class="hljs-number inline">30</span>)}</span>%, 50%))`</span>,
            <span class="hljs-attr inline">particle</span>: <span class="hljs-string inline">`hsl(<span class="hljs-subst inline">${primaryH}</span>, <span class="hljs-subst inline">${<span class="hljs-built_in inline">Math</span>.max(primaryS - <span class="hljs-number inline">10</span>, <span class="hljs-number inline">35</span>)}</span>%, 75%)`</span>
        };
    }
}, [currentTheme, hexToHsl]);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">这个函数的设计考虑了多个因素：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">饱和度调整</strong>: 深色模式增加饱和度，浅色模式降低饱和度，确保对比度适中</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">明度控制</strong>: 深色模式使用较低的明度值(20-45%)，浅色模式使用较高的明度值(50-75%)</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">渐变设计</strong>: 135度斜角渐变，从主色到强调色，创造空间深度感</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">安全边界</strong>: 使用<code>Math.max()</code>确保饱和度和明度不会过低</li>
</ul>
<h3 id="动态色彩的实时更新" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#动态色彩的实时更新" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 动态色彩的实时更新">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            动态色彩的实时更新
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="useEffect(()%20%3D%3E%20%7B%0Aif%20(particlesRef.current.length%20%3E%200)%20%7B%0Aconst%20colors%20%3D%20getThemeColors()%3B%0A%2F%2F%20%E6%9B%B4%E6%96%B0%E6%89%80%E6%9C%89%E7%B2%92%E5%AD%90%E7%9A%84%E9%A2%9C%E8%89%B2%0AparticlesRef.current.forEach(p%20%3D%3E%20%7B%0Ap.el.style.backgroundColor%20%3D%20colors.particle%3B%0A%7D)%3B%0A%2F%2F%20%E6%9B%B4%E6%96%B0%E5%AE%B9%E5%99%A8%E8%83%8C%E6%99%AF%0Aif%20(containerRef.current)%20%7B%0AcontainerRef.current.style.background%20%3D%20colors.background%3B%0A%7D%0A%7D%0A%7D%2C%20%5BcurrentTheme%2C%20getThemeColors%5D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-title function_ inline">useEffect</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-keyword inline">if</span> (particlesRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">length</span> &gt; <span class="hljs-number inline">0</span>) {
        <span class="hljs-keyword inline">const</span> colors = <span class="hljs-title function_ inline">getThemeColors</span>();
        
        <span class="hljs-comment inline">// 更新所有粒子的颜色</span>
        particlesRef.<span class="hljs-property inline">current</span>.<span class="hljs-title function_ inline">forEach</span>(<span class="hljs-function inline"><span class="hljs-params inline">p</span> =&gt;</span> {
            p.<span class="hljs-property inline">el</span>.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">backgroundColor</span> = colors.<span class="hljs-property inline">particle</span>;
        });
        
        <span class="hljs-comment inline">// 更新容器背景</span>
        <span class="hljs-keyword inline">if</span> (containerRef.<span class="hljs-property inline">current</span>) {
            containerRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">background</span> = colors.<span class="hljs-property inline">background</span>;
        }
    }
}, [currentTheme, getThemeColors]);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">当主题切换时，所有粒子会同步更新颜色，无需重新创建DOM元素，保证了切换的流畅性。</p>
<h3 id="深度数学模型" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#深度数学模型" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 深度数学模型">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            深度数学模型
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20depth%20%3D%20Math.random()%3B%20%2F%2F%200-1%E4%B9%8B%E9%97%B4%E7%9A%84%E9%9A%8F%E6%9C%BA%E6%B7%B1%E5%BA%A6%E5%80%BC%0A%2F%2F%20%E5%9F%BA%E4%BA%8E%E6%B7%B1%E5%BA%A6%E7%9A%84%E7%BC%A9%E6%94%BE%0Aconst%20scale%20%3D%200.6%20%2B%200.4%20*%20depth%3B%0A%2F%2F%20%E5%9F%BA%E4%BA%8E%E6%B7%B1%E5%BA%A6%E7%9A%84%E9%80%8F%E6%98%8E%E5%BA%A6%0Aconst%20opacity%20%3D%200.4%20%2B%200.6%20*%20depth%3B%0A%2F%2F%20%E5%9F%BA%E4%BA%8E%E6%B7%B1%E5%BA%A6%E7%9A%84%E8%BF%90%E5%8A%A8%E9%80%9F%E5%BA%A6%0Ap.vx%20%2B%3D%200.01%20*%20p.depth%3B%0Ap.vy%20%2B%3D%200.005%20*%20p.depth%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> depth = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">random</span>(); <span class="hljs-comment inline">// 0-1之间的随机深度值</span>

<span class="hljs-comment inline">// 基于深度的缩放</span>
<span class="hljs-keyword inline">const</span> scale = <span class="hljs-number inline">0.6</span> + <span class="hljs-number inline">0.4</span> * depth;

<span class="hljs-comment inline">// 基于深度的透明度</span>
<span class="hljs-keyword inline">const</span> opacity = <span class="hljs-number inline">0.4</span> + <span class="hljs-number inline">0.6</span> * depth;

<span class="hljs-comment inline">// 基于深度的运动速度</span>
p.<span class="hljs-property inline">vx</span> += <span class="hljs-number inline">0.01</span> * p.<span class="hljs-property inline">depth</span>;
p.<span class="hljs-property inline">vy</span> += <span class="hljs-number inline">0.005</span> * p.<span class="hljs-property inline">depth</span>;
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">层次感渲染：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">scale: 0.6-1.0</strong>: 远处的粒子小，近处的粒子大</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">opacity: 0.4-1.0</strong>: 远处的粒子透明，近处的粒子不透明</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">speed: depth倍数</strong>: 近处的粒子移动更快，远处的粒子移动更慢</li>
</ul>
<h3 id="视差运动的模拟" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#视差运动的模拟" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 视差运动的模拟">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            视差运动的模拟
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20%E5%9C%A8%E4%BA%A4%E4%BA%92%E5%8A%9B%E8%AE%A1%E7%AE%97%E4%B8%AD%0Aconst%20force%20%3D%20baseForce%20*%20p.depth%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// 在交互力计算中</span>
<span class="hljs-keyword inline">const</span> force = baseForce * p.<span class="hljs-property inline">depth</span>;
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">深度值作为力的倍数，意味着：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed">近处的粒子对交互更敏感</li>
<li class="text-foreground leading-relaxed">远处的粒子反应更迟钝</li>
<li class="text-foreground leading-relaxed">整体呈现出视差滚动的效果</li>
</ul>
<p class="text-base leading-7 mb-4 text-foreground">这种设计让用户感觉自己在与一个真正的3D空间互动，而不是平面上的点。（也许？）</p>
<h2 id="响应式布局的粒子重分配" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#响应式布局的粒子重分配" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 响应式布局的粒子重分配">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            响应式布局的粒子重分配
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">当窗口大小改变时，粒子系统需要灵活地适应新的尺寸。</p>
<h3 id="窗口尺寸变化的监听策略" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#窗口尺寸变化的监听策略" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 窗口尺寸变化的监听策略">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            窗口尺寸变化的监听策略
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20handleResize%20%3D%20useCallback(()%20%3D%3E%20%7B%0A%2F%2F%20%E9%87%8D%E6%96%B0%E5%88%9D%E5%A7%8B%E5%8C%96%E7%B2%92%E5%AD%90%E5%88%86%E5%B8%83%0AinitializeParticles()%3B%0A%7D%2C%20%5BinitializeParticles%5D)%3B%0AuseEffect(()%20%3D%3E%20%7B%0Awindow.addEventListener('resize'%2C%20handleResize)%3B%0Areturn%20()%20%3D%3E%20window.removeEventListener('resize'%2C%20handleResize)%3B%0A%7D%2C%20%5BhandleResize%5D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> handleResize = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-comment inline">// 重新初始化粒子分布</span>
    <span class="hljs-title function_ inline">initializeParticles</span>();
}, [initializeParticles]);

<span class="hljs-title function_ inline">useEffect</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-variable language_ inline">window</span>.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;resize&#x27;</span>, handleResize);
    
    <span class="hljs-keyword inline">return</span> <span class="hljs-function inline">() =&gt;</span> <span class="hljs-variable language_ inline">window</span>.<span class="hljs-title function_ inline">removeEventListener</span>(<span class="hljs-string inline">&#x27;resize&#x27;</span>, handleResize);
}, [handleResize]);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">为什么选择重新初始化而不是重新定位</strong>？因为重新定位现有粒子会导致视觉上的&quot;跳跃&quot;，而重新初始化虽然会有短暂的重建，但视觉效果更自然。</p>
<h3 id="粒子清理的内存安全" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#粒子清理的内存安全" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 粒子清理的内存安全">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            粒子清理的内存安全
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20%E6%B8%85%E7%90%86%E7%8E%B0%E6%9C%89%E7%B2%92%E5%AD%90%0AparticlesRef.current.forEach(p%20%3D%3E%20p.el.remove())%3B%0AparticlesRef.current%20%3D%20%5B%5D%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// 清理现有粒子</span>
particlesRef.<span class="hljs-property inline">current</span>.<span class="hljs-title function_ inline">forEach</span>(<span class="hljs-function inline"><span class="hljs-params inline">p</span> =&gt;</span> p.<span class="hljs-property inline">el</span>.<span class="hljs-title function_ inline">remove</span>());
particlesRef.<span class="hljs-property inline">current</span> = [];
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">为什么要手动remove</strong>？因为我们使用的是原生DOM操作，React不会自动清理这些元素。如果不手动移除，会导致DOM中堆积大量隐形元素，造成内存泄漏。</p>
<h3 id="防抖处理的必要性" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#防抖处理的必要性" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 防抖处理的必要性">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            防抖处理的必要性
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">用户调整窗口大小时，resize事件会疯狂触发。没有防抖的话，每一次微小的窗口变化都会重新创建300个粒子——反复拖几十个来回后，你也许就可以听到GPU风扇转动的美妙声音。</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">防抖实现</strong>：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20%E9%98%B2%E6%8A%96%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%0Aconst%20debounce%20%3D%20useCallback((func%3A%20Function%2C%20wait%3A%20number)%20%3D%3E%20%7B%0Alet%20timeout%3A%20NodeJS.Timeout%3B%0Areturn%20function%20executedFunction(...args%3A%20any%5B%5D)%20%7B%0Aconst%20later%20%3D%20()%20%3D%3E%20%7B%0AclearTimeout(timeout)%3B%0Afunc(...args)%3B%0A%7D%3B%0AclearTimeout(timeout)%3B%0Atimeout%20%3D%20setTimeout(later%2C%20wait)%3B%0A%7D%3B%0A%7D%2C%20%5B%5D)%3B%0A%2F%2F%20%E5%88%9B%E5%BB%BA%E9%98%B2%E6%8A%96%E7%89%88%E6%9C%AC%E7%9A%84resize%E5%A4%84%E7%90%86%E5%99%A8%0Aconst%20debouncedHandleResize%20%3D%20useCallback(%0Adebounce(handleResize%2C%201000)%2C%20%2F%2F%201%E7%A7%92%E7%9A%84%E9%98%B2%E6%8A%96%E5%BB%B6%E8%BF%9F%0A%5Bdebounce%2C%20handleResize%5D%0A)%3B%0A%2F%2F%20%E5%9C%A8%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E4%B8%AD%E4%BD%BF%E7%94%A8%E9%98%B2%E6%8A%96%E7%89%88%E6%9C%AC%0AuseEffect(()%20%3D%3E%20%7B%0Awindow.addEventListener('resize'%2C%20debouncedHandleResize)%3B%0Areturn%20()%20%3D%3E%20%7B%0Awindow.removeEventListener('resize'%2C%20debouncedHandleResize)%3B%0A%7D%3B%0A%7D%2C%20%5BdebouncedHandleResize%5D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// 防抖工具函数</span>
<span class="hljs-keyword inline">const</span> debounce = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">func</span>: <span class="hljs-title class_ inline">Function</span>, <span class="hljs-attr inline">wait</span>: <span class="hljs-built_in inline">number</span></span>) =&gt;</span> {
    <span class="hljs-keyword inline">let</span> <span class="hljs-attr inline">timeout</span>: <span class="hljs-title class_ inline">NodeJS</span>.<span class="hljs-property inline">Timeout</span>;
    <span class="hljs-keyword inline">return</span> <span class="hljs-keyword inline">function</span> <span class="hljs-title function_ inline">executedFunction</span>(<span class="hljs-params inline">...<span class="hljs-attr inline">args</span>: <span class="hljs-built_in inline">any</span>[]</span>) {
        <span class="hljs-keyword inline">const</span> <span class="hljs-title function_ inline">later</span> = (<span class="hljs-params inline"></span>) =&gt; {
            <span class="hljs-built_in inline">clearTimeout</span>(timeout);
            <span class="hljs-title function_ inline">func</span>(...args);
        };
        <span class="hljs-built_in inline">clearTimeout</span>(timeout);
        timeout = <span class="hljs-built_in inline">setTimeout</span>(later, wait);
    };
}, []);

<span class="hljs-comment inline">// 创建防抖版本的resize处理器</span>
<span class="hljs-keyword inline">const</span> debouncedHandleResize = <span class="hljs-title function_ inline">useCallback</span>(
    <span class="hljs-title function_ inline">debounce</span>(handleResize, <span class="hljs-number inline">1000</span>), <span class="hljs-comment inline">// 1秒的防抖延迟</span>
    [debounce, handleResize]
);

<span class="hljs-comment inline">// 在事件监听中使用防抖版本</span>
<span class="hljs-title function_ inline">useEffect</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-variable language_ inline">window</span>.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;resize&#x27;</span>, debouncedHandleResize);
    
    <span class="hljs-keyword inline">return</span> <span class="hljs-function inline">() =&gt;</span> {
        <span class="hljs-variable language_ inline">window</span>.<span class="hljs-title function_ inline">removeEventListener</span>(<span class="hljs-string inline">&#x27;resize&#x27;</span>, debouncedHandleResize);
    };
}, [debouncedHandleResize]);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">防抖的工作原理</strong>：</p>
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed">用户开始拖拽窗口 → 第一个resize事件到达</li>
<li class="text-foreground leading-relaxed">防抖函数设置1000ms定时器，准备执行重建</li>
<li class="text-foreground leading-relaxed">用户继续拖拽 → 更多resize事件到达</li>
<li class="text-foreground leading-relaxed">每次新事件都会取消之前的定时器，重新计时</li>
<li class="text-foreground leading-relaxed">用户停止拖拽1000ms后 → 定时器触发，执行粒子重建</li>
</ol>
<p class="text-base leading-7 mb-4 text-foreground">这样就把原本可能触发几十次的重建操作，优化成了只在用户真正&quot;完成调整&quot;后的一次重建。</p>
<h2 id="性能优化的关键策略" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#性能优化的关键策略" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 性能优化的关键策略">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            性能优化的关键策略
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">300个DOM元素的同时动画是对浏览器的严峻考验，每一个优化细节都至关重要。</p>
<h3 id="willchange属性的正确使用" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#willchange属性的正确使用" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to willChange属性的正确使用">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            willChange属性的正确使用
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="el.style.willChange%20%3D%20'transform%2C%20opacity'%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript">el.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">willChange</span> = <span class="hljs-string inline">&#x27;transform, opacity&#x27;</span>;
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">这行代码告诉浏览器：&quot;这个元素的transform和opacity会频繁变化，请为它准备GPU图层&quot;。</p>
<p class="text-base leading-7 mb-4 text-foreground">但是！willChange是一把双刃剑：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">好处</strong>: 开启GPU加速，动画更流畅</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">坏处</strong>: 消耗额外的GPU内存，过多使用会适得其反</li>
</ul>
<p class="text-base leading-7 mb-4 text-foreground">所以我们只在真正需要动画的属性上使用它。</p>
<h3 id="requestanimationframe的生命周期管理" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#requestanimationframe的生命周期管理" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to requestAnimationFrame的生命周期管理">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            requestAnimationFrame的生命周期管理
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="useEffect(()%20%3D%3E%20%7B%0Aanimate()%3B%0Areturn%20()%20%3D%3E%20%7B%0Aif%20(animationIdRef.current%20!%3D%3D%20null)%20%7B%0AcancelAnimationFrame(animationIdRef.current)%3B%0A%7D%0A%2F%2F%20%E6%B8%85%E7%90%86%E6%89%80%E6%9C%89%E7%B2%92%E5%AD%90%0AparticlesRef.current.forEach(p%20%3D%3E%20p.el.remove())%3B%0A%7D%3B%0A%7D%2C%20%5Banimate%5D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-title function_ inline">useEffect</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-title function_ inline">animate</span>();
    
    <span class="hljs-keyword inline">return</span> <span class="hljs-function inline">() =&gt;</span> {
        <span class="hljs-keyword inline">if</span> (animationIdRef.<span class="hljs-property inline">current</span> !== <span class="hljs-literal inline">null</span>) {
            <span class="hljs-title function_ inline">cancelAnimationFrame</span>(animationIdRef.<span class="hljs-property inline">current</span>);
        }
        
        <span class="hljs-comment inline">// 清理所有粒子</span>
        particlesRef.<span class="hljs-property inline">current</span>.<span class="hljs-title function_ inline">forEach</span>(<span class="hljs-function inline"><span class="hljs-params inline">p</span> =&gt;</span> p.<span class="hljs-property inline">el</span>.<span class="hljs-title function_ inline">remove</span>());
    };
}, [animate]);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">这个cleanup函数做了两件重要的事：</p>
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">取消动画帧</strong>: 避免组件卸载后动画继续运行</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">清理DOM元素</strong>: 防止内存泄漏</li>
</ol>
<h3 id="层级管理的z-index策略" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#层级管理的z-index策略" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 层级管理的z-index策略">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            层级管理的z-index策略
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="className%3D%22fixed%20inset-0%20w-full%20h-full%20overflow-hidden%20pointer-events-none%20z-0%22">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript">className=<span class="hljs-string inline">&quot;fixed inset-0 w-full h-full overflow-hidden pointer-events-none z-0&quot;</span>
</code></pre>
            </div>
        
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">z-0</strong>: 确保背景永远在最底层，不会遮挡其他内容</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">pointer-events-none</strong>: 让整个容器不响应鼠标事件，避免干扰页面交互</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">overflow-hidden</strong>: 防止粒子跑到容器外面显示</li>
</ul>
<h2 id="事件处理的边界情况" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#事件处理的边界情况" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 事件处理的边界情况">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            事件处理的边界情况
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">真实世界的用户交互远比理想情况复杂，我们需要处理各种边界情况。</p>
<h3 id="触摸设备的特殊处理" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#触摸设备的特殊处理" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 触摸设备的特殊处理">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            触摸设备的特殊处理
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20handleTouchStart%20%3D%20useCallback((e%3A%20TouchEvent)%20%3D%3E%20%7B%0AmouseRef.current.down%20%3D%20true%3B%0AupdateMousePos(e.touches%5B0%5D)%3B%0A%7D%2C%20%5BupdateMousePos%5D)%3B%0Aconst%20handleTouchMove%20%3D%20useCallback((e%3A%20TouchEvent)%20%3D%3E%20%7B%0Aif%20(mouseRef.current.down)%20updateMousePos(e.touches%5B0%5D)%3B%0A%7D%2C%20%5BupdateMousePos%5D)%3B%0Aconst%20handleTouchEnd%20%3D%20useCallback(()%20%3D%3E%20%7B%0AmouseRef.current.down%20%3D%20false%3B%0A%7D%2C%20%5B%5D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> handleTouchStart = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">e</span>: <span class="hljs-title class_ inline">TouchEvent</span></span>) =&gt;</span> {
    mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span> = <span class="hljs-literal inline">true</span>;
    <span class="hljs-title function_ inline">updateMousePos</span>(e.<span class="hljs-property inline">touches</span>[<span class="hljs-number inline">0</span>]);
}, [updateMousePos]);

<span class="hljs-keyword inline">const</span> handleTouchMove = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">e</span>: <span class="hljs-title class_ inline">TouchEvent</span></span>) =&gt;</span> {
    <span class="hljs-keyword inline">if</span> (mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span>) <span class="hljs-title function_ inline">updateMousePos</span>(e.<span class="hljs-property inline">touches</span>[<span class="hljs-number inline">0</span>]);
}, [updateMousePos]);

<span class="hljs-keyword inline">const</span> handleTouchEnd = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">() =&gt;</span> {
    mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span> = <span class="hljs-literal inline">false</span>;
}, []);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">为什么只取第一个触摸点</strong>？因为多点触控会让力场计算变得极其复杂，而且大多数用户也只会用一个手指&quot;戳泡泡&quot;。</p>
<h3 id="事件监听器的作用域控制" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#事件监听器的作用域控制" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 事件监听器的作用域控制">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            事件监听器的作用域控制
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20%E5%85%A8%E5%B1%80%E4%BA%8B%E4%BB%B6%0Adocument.addEventListener('mousedown'%2C%20handleMouseDown)%3B%0Adocument.addEventListener('mouseup'%2C%20handleMouseUp)%3B%0Adocument.addEventListener('mousemove'%2C%20handleMouseMove)%3B%0A%2F%2F%20%E5%AE%B9%E5%99%A8%E5%B1%80%E9%83%A8%E4%BA%8B%E4%BB%B6%0Acontainer.addEventListener('touchstart'%2C%20handleTouchStart)%3B%0Acontainer.addEventListener('touchend'%2C%20handleTouchEnd)%3B%0Acontainer.addEventListener('touchmove'%2C%20handleTouchMove)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// 全局事件</span>
<span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;mousedown&#x27;</span>, handleMouseDown);
<span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;mouseup&#x27;</span>, handleMouseUp);
<span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;mousemove&#x27;</span>, handleMouseMove);

<span class="hljs-comment inline">// 容器局部事件</span>
container.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;touchstart&#x27;</span>, handleTouchStart);
container.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;touchend&#x27;</span>, handleTouchEnd);
container.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;touchmove&#x27;</span>, handleTouchMove);
</code></pre>
            </div>
        
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">鼠标事件绑定到document</strong>: 确保用户拖拽时即使鼠标移出容器，交互也能继续</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">触摸事件绑定到容器</strong>: 触摸事件的传播机制不同，绑定到容器更安全</li>
</ul>
<h2 id="可复用设计模式总结" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#可复用设计模式总结" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 可复用设计模式总结">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            可复用设计模式总结
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">通过这次深入的实现分析，我们可以提取出几个通用的设计模式。</p>
<h3 id="粒子系统的通用架构" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#粒子系统的通用架构" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 粒子系统的通用架构">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            粒子系统的通用架构
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%201.%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%0Ainterface%20Particle%20%7B%0Ael%3A%20HTMLElement%3B%20%20%20%20%20%20%2F%2F%20DOM%E5%BC%95%E7%94%A8%0Ax%3A%20number%3B%20y%3A%20number%3B%20%2F%2F%20%E4%BD%8D%E7%BD%AE%0Avx%3A%20number%3B%20vy%3A%20number%3B%20%2F%2F%20%E9%80%9F%E5%BA%A6%0A%5Bkey%3A%20string%5D%3A%20any%3B%20%20%20%2F%2F%20%E5%85%B6%E4%BB%96%E5%B1%9E%E6%80%A7%0A%7D%0A%2F%2F%202.%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%AE%A1%E7%90%86%0Aconst%20createParticle%20%3D%20()%20%3D%3E%20%7B%20%2F*%20%E5%88%9B%E5%BB%BA%E9%80%BB%E8%BE%91%20*%2F%20%7D%3B%0Aconst%20updateParticle%20%3D%20(particle%3A%20Particle)%20%3D%3E%20%7B%20%2F*%20%E6%9B%B4%E6%96%B0%E9%80%BB%E8%BE%91%20*%2F%20%7D%3B%0Aconst%20destroyParticle%20%3D%20(particle%3A%20Particle)%20%3D%3E%20%7B%20%2F*%20%E9%94%80%E6%AF%81%E9%80%BB%E8%BE%91%20*%2F%20%7D%3B%0A%2F%2F%203.%20%E5%8A%A8%E7%94%BB%E5%BE%AA%E7%8E%AF%0Aconst%20animate%20%3D%20()%20%3D%3E%20%7B%0Aparticles.forEach(updateParticle)%3B%0ArequestAnimationFrame(animate)%3B%0A%7D%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// 1. 数据结构设计</span>
<span class="hljs-keyword inline">interface</span> <span class="hljs-title class_ inline">Particle</span> {
    <span class="hljs-attr inline">el</span>: <span class="hljs-title class_ inline">HTMLElement</span>;      <span class="hljs-comment inline">// DOM引用</span>
    <span class="hljs-attr inline">x</span>: <span class="hljs-built_in inline">number</span>; <span class="hljs-attr inline">y</span>: <span class="hljs-built_in inline">number</span>; <span class="hljs-comment inline">// 位置</span>
    <span class="hljs-attr inline">vx</span>: <span class="hljs-built_in inline">number</span>; <span class="hljs-attr inline">vy</span>: <span class="hljs-built_in inline">number</span>; <span class="hljs-comment inline">// 速度</span>
    [<span class="hljs-attr inline">key</span>: <span class="hljs-built_in inline">string</span>]: <span class="hljs-built_in inline">any</span>;   <span class="hljs-comment inline">// 其他属性</span>
}

<span class="hljs-comment inline">// 2. 生命周期管理</span>
<span class="hljs-keyword inline">const</span> <span class="hljs-title function_ inline">createParticle</span> = (<span class="hljs-params inline"></span>) =&gt; { <span class="hljs-comment inline">/* 创建逻辑 */</span> };
<span class="hljs-keyword inline">const</span> <span class="hljs-title function_ inline">updateParticle</span> = (<span class="hljs-params inline"><span class="hljs-attr inline">particle</span>: <span class="hljs-title class_ inline">Particle</span></span>) =&gt; { <span class="hljs-comment inline">/* 更新逻辑 */</span> };
<span class="hljs-keyword inline">const</span> <span class="hljs-title function_ inline">destroyParticle</span> = (<span class="hljs-params inline"><span class="hljs-attr inline">particle</span>: <span class="hljs-title class_ inline">Particle</span></span>) =&gt; { <span class="hljs-comment inline">/* 销毁逻辑 */</span> };

<span class="hljs-comment inline">// 3. 动画循环</span>
<span class="hljs-keyword inline">const</span> <span class="hljs-title function_ inline">animate</span> = (<span class="hljs-params inline"></span>) =&gt; {
    particles.<span class="hljs-title function_ inline">forEach</span>(updateParticle);
    <span class="hljs-title function_ inline">requestAnimationFrame</span>(animate);
};
</code></pre>
            </div>
        
<h3 id="物理模拟的基本模式" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#物理模拟的基本模式" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 物理模拟的基本模式">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            物理模拟的基本模式
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20%E5%8A%9B%E5%9C%BA%E8%AE%A1%E7%AE%97%E6%A8%A1%E5%BC%8F%0Aconst%20calculateForce%20%3D%20(particle%3A%20Particle%2C%20target%3A%20Position)%20%3D%3E%20%7B%0Aconst%20dx%20%3D%20particle.x%20-%20target.x%3B%0Aconst%20dy%20%3D%20particle.y%20-%20target.y%3B%0Aconst%20distance%20%3D%20Math.sqrt(dx%20*%20dx%20%2B%20dy%20*%20dy)%3B%0Aconst%20force%20%3D%20strength%20%2F%20(distance%20%2B%20epsilon)%3B%0Areturn%20%7B%0Afx%3A%20force%20*%20(dx%20%2F%20distance)%2C%0Afy%3A%20force%20*%20(dy%20%2F%20distance)%0A%7D%3B%0A%7D%3B%0A%2F%2F%20%E8%BE%B9%E7%95%8C%E5%A4%84%E7%90%86%E6%A8%A1%E5%BC%8F%0Aconst%20handleBoundaries%20%3D%20(particle%3A%20Particle%2C%20bounds%3A%20Bounds)%20%3D%3E%20%7B%0Aif%20(particle.x%20left)%20particle.x%20%3D%20bounds.right%3B%0Aif%20(particle.x%20%3E%20bounds.right)%20particle.x%20%3D%20bounds.left%3B%0Aif%20(particle.y%20top)%20particle.y%20%3D%20bounds.bottom%3B%0Aif%20(particle.y%20%3E%20bounds.bottom)%20particle.y%20%3D%20bounds.top%3B%0A%7D%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// 力场计算模式</span>
<span class="hljs-keyword inline">const</span> <span class="hljs-title function_ inline">calculateForce</span> = (<span class="hljs-params inline"><span class="hljs-attr inline">particle</span>: <span class="hljs-title class_ inline">Particle</span>, <span class="hljs-attr inline">target</span>: <span class="hljs-title class_ inline">Position</span></span>) =&gt; {
    <span class="hljs-keyword inline">const</span> dx = particle.<span class="hljs-property inline">x</span> - target.<span class="hljs-property inline">x</span>;
    <span class="hljs-keyword inline">const</span> dy = particle.<span class="hljs-property inline">y</span> - target.<span class="hljs-property inline">y</span>;
    <span class="hljs-keyword inline">const</span> distance = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">sqrt</span>(dx * dx + dy * dy);
    <span class="hljs-keyword inline">const</span> force = strength / (distance + epsilon);
    
    <span class="hljs-keyword inline">return</span> {
        <span class="hljs-attr inline">fx</span>: force * (dx / distance),
        <span class="hljs-attr inline">fy</span>: force * (dy / distance)
    };
};

<span class="hljs-comment inline">// 边界处理模式</span>
<span class="hljs-keyword inline">const</span> <span class="hljs-title function_ inline">handleBoundaries</span> = (<span class="hljs-params inline"><span class="hljs-attr inline">particle</span>: <span class="hljs-title class_ inline">Particle</span>, <span class="hljs-attr inline">bounds</span>: <span class="hljs-title class_ inline">Bounds</span></span>) =&gt; {
    <span class="hljs-keyword inline">if</span> (particle.<span class="hljs-property inline">x</span> &lt; bounds.<span class="hljs-property inline">left</span>) particle.<span class="hljs-property inline">x</span> = bounds.<span class="hljs-property inline">right</span>;
    <span class="hljs-keyword inline">if</span> (particle.<span class="hljs-property inline">x</span> &gt; bounds.<span class="hljs-property inline">right</span>) particle.<span class="hljs-property inline">x</span> = bounds.<span class="hljs-property inline">left</span>;
    <span class="hljs-keyword inline">if</span> (particle.<span class="hljs-property inline">y</span> &lt; bounds.<span class="hljs-property inline">top</span>) particle.<span class="hljs-property inline">y</span> = bounds.<span class="hljs-property inline">bottom</span>;
    <span class="hljs-keyword inline">if</span> (particle.<span class="hljs-property inline">y</span> &gt; bounds.<span class="hljs-property inline">bottom</span>) particle.<span class="hljs-property inline">y</span> = bounds.<span class="hljs-property inline">top</span>;
};
</code></pre>
            </div>
        
<h3 id="主题响应的设计模式" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#主题响应的设计模式" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 主题响应的设计模式">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            主题响应的设计模式
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20%E9%A2%9C%E8%89%B2%E7%B3%BB%E7%BB%9F%E6%A8%A1%E5%BC%8F%0Aconst%20createThemeColors%20%3D%20(baseTheme%3A%20Theme)%20%3D%3E%20%7B%0Aconst%20%5Bh%2C%20s%2C%20l%5D%20%3D%20hexToHsl(baseTheme.primary)%3B%0Areturn%20%7B%0Abackground%3A%20%60hsl(%24%7Bh%7D%2C%20%24%7Bs%7D%25%2C%20%24%7Bl%7D%25)%60%2C%0Aparticle%3A%20%60hsl(%24%7Bh%7D%2C%20%24%7BMath.max(s%20-%2020%2C%2020)%7D%25%2C%20%24%7Bl%20%2B%2020%7D%25)%60%2C%0A%2F%2F%20...%20%E5%85%B6%E4%BB%96%E9%A2%9C%E8%89%B2%0A%7D%3B%0A%7D%3B%0A%2F%2F%20%E4%B8%BB%E9%A2%98%E5%88%87%E6%8D%A2%E5%93%8D%E5%BA%94%E6%A8%A1%E5%BC%8F%0AuseEffect(()%20%3D%3E%20%7B%0Aconst%20colors%20%3D%20createThemeColors(currentTheme)%3B%0AupdateParticleColors(colors)%3B%0A%7D%2C%20%5BcurrentTheme%5D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// 颜色系统模式</span>
<span class="hljs-keyword inline">const</span> <span class="hljs-title function_ inline">createThemeColors</span> = (<span class="hljs-params inline"><span class="hljs-attr inline">baseTheme</span>: <span class="hljs-title class_ inline">Theme</span></span>) =&gt; {
    <span class="hljs-keyword inline">const</span> [h, s, l] = <span class="hljs-title function_ inline">hexToHsl</span>(baseTheme.<span class="hljs-property inline">primary</span>);
    
    <span class="hljs-keyword inline">return</span> {
        <span class="hljs-attr inline">background</span>: <span class="hljs-string inline">`hsl(<span class="hljs-subst inline">${h}</span>, <span class="hljs-subst inline">${s}</span>%, <span class="hljs-subst inline">${l}</span>%)`</span>,
        <span class="hljs-attr inline">particle</span>: <span class="hljs-string inline">`hsl(<span class="hljs-subst inline">${h}</span>, <span class="hljs-subst inline">${<span class="hljs-built_in inline">Math</span>.max(s - <span class="hljs-number inline">20</span>, <span class="hljs-number inline">20</span>)}</span>%, <span class="hljs-subst inline">${l + <span class="hljs-number inline">20</span>}</span>%)`</span>,
        <span class="hljs-comment inline">// ... 其他颜色</span>
    };
};

<span class="hljs-comment inline">// 主题切换响应模式</span>
<span class="hljs-title function_ inline">useEffect</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-keyword inline">const</span> colors = <span class="hljs-title function_ inline">createThemeColors</span>(currentTheme);
    <span class="hljs-title function_ inline">updateParticleColors</span>(colors);
}, [currentTheme]);
</code></pre>
            </div>
        
<h3 id="响应式粒子布局模式" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#响应式粒子布局模式" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 响应式粒子布局模式">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            响应式粒子布局模式
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20%E5%93%8D%E5%BA%94%E5%BC%8F%E9%87%8D%E5%B8%83%E5%B1%80%E6%A8%A1%E5%BC%8F%0Aconst%20handleResize%20%3D%20useCallback(()%20%3D%3E%20%7B%0A%2F%2F%20%E6%B8%85%E7%90%86%E7%8E%B0%E6%9C%89%E7%B2%92%E5%AD%90%0Aparticles.forEach(particle%20%3D%3E%20particle.el.remove())%3B%0A%2F%2F%20%E9%87%8D%E6%96%B0%E5%88%9D%E5%A7%8B%E5%8C%96%0AinitializeParticles()%3B%0A%7D%2C%20%5B%5D)%3B%0AuseEffect(()%20%3D%3E%20%7B%0Awindow.addEventListener('resize'%2C%20handleResize)%3B%0Areturn%20()%20%3D%3E%20window.removeEventListener('resize'%2C%20handleResize)%3B%0A%7D%2C%20%5B%5D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// 响应式重布局模式</span>
<span class="hljs-keyword inline">const</span> handleResize = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-comment inline">// 清理现有粒子</span>
    particles.<span class="hljs-title function_ inline">forEach</span>(<span class="hljs-function inline"><span class="hljs-params inline">particle</span> =&gt;</span> particle.<span class="hljs-property inline">el</span>.<span class="hljs-title function_ inline">remove</span>());
    
    <span class="hljs-comment inline">// 重新初始化</span>
    <span class="hljs-title function_ inline">initializeParticles</span>();
}, []);

<span class="hljs-title function_ inline">useEffect</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-variable language_ inline">window</span>.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;resize&#x27;</span>, handleResize);
    <span class="hljs-keyword inline">return</span> <span class="hljs-function inline">() =&gt;</span> <span class="hljs-variable language_ inline">window</span>.<span class="hljs-title function_ inline">removeEventListener</span>(<span class="hljs-string inline">&#x27;resize&#x27;</span>, handleResize);
}, []);
</code></pre>
            </div>
        
<h3 id="性能优化的最佳实践" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#性能优化的最佳实践" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 性能优化的最佳实践">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            性能优化的最佳实践
        </h3>
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">使用requestAnimationFrame而不是定时器</strong></li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">用transform代替直接修改位置属性</strong></li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">合理使用willChange提示</strong></li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">及时清理DOM元素和事件监听器</strong></li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">避免频繁的DOM查询，使用引用缓存</strong></li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">在适当的时候使用防抖和节流</strong></li>
</ol>
<h2 id="完整源码全解析" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#完整源码全解析" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 完整源码全解析">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            完整源码全解析
        </h2>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="'use%20client'%3B%0Aimport%20React%2C%20%7B%20useEffect%2C%20useRef%2C%20useCallback%20%7D%20from%20'react'%3B%0Aimport%20%7B%20useThemeStore%20%7D%20from%20'%40%2Flib%2Fstores%2FthemeStore'%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F**%0A*%20%E7%B2%92%E5%AD%90%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%0A*%20%E6%AF%8F%E4%B8%AA%E7%B2%92%E5%AD%90%E9%83%BD%E6%98%AF%E4%B8%80%E4%B8%AA%E7%8B%AC%E7%AB%8B%E7%9A%84%E7%89%A9%E7%90%86%E5%AE%9E%E4%BD%93%0A*%2F%0Ainterface%20Particle%20%7B%0Ael%3A%20HTMLDivElement%3B%20%20%2F%2F%20DOM%E5%85%83%E7%B4%A0%E5%BC%95%E7%94%A8%EF%BC%8C%E9%81%BF%E5%85%8D%E9%A2%91%E7%B9%81%E6%9F%A5%E8%AF%A2%0Ax%3A%20number%3B%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%BD%93%E5%89%8DX%E5%9D%90%E6%A0%87%EF%BC%88%E7%B2%BE%E7%A1%AE%E5%88%B0%E5%B0%8F%E6%95%B0%EF%BC%89%0Ay%3A%20number%3B%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%BD%93%E5%89%8DY%E5%9D%90%E6%A0%87%EF%BC%88%E7%B2%BE%E7%A1%AE%E5%88%B0%E5%B0%8F%E6%95%B0%EF%BC%89%0Avx%3A%20number%3B%20%20%20%20%20%20%20%20%20%20%2F%2F%20X%E6%96%B9%E5%90%91%E9%80%9F%E5%BA%A6%0Avy%3A%20number%3B%20%20%20%20%20%20%20%20%20%20%2F%2F%20Y%E6%96%B9%E5%90%91%E9%80%9F%E5%BA%A6%0Asize%3A%20number%3B%20%20%20%20%20%20%20%20%2F%2F%20%E7%B2%92%E5%AD%90%E5%9F%BA%E7%A1%80%E5%A4%A7%E5%B0%8F%0Adepth%3A%20number%3B%20%20%20%20%20%20%20%2F%2F%20%E6%B7%B1%E5%BA%A6%E5%B1%82%E6%AC%A1(0-1)%EF%BC%8C%E5%BD%B1%E5%93%8D%E5%A4%A7%E5%B0%8F%E3%80%81%E9%80%8F%E6%98%8E%E5%BA%A6%E3%80%81%E9%80%9F%E5%BA%A6%0A%7D%0A%2F**%0A*%20%E9%BC%A0%E6%A0%87%2F%E8%A7%A6%E6%91%B8%E7%8A%B6%E6%80%81%0A*%20%E7%94%A8%E4%BA%8E%E4%BA%A4%E4%BA%92%E5%8A%9B%E5%9C%BA%E8%AE%A1%E7%AE%97%0A*%2F%0Ainterface%20MouseState%20%7B%0Ax%3A%20number%3B%20%20%20%20%20%20%2F%2F%20%E9%BC%A0%E6%A0%87X%E5%9D%90%E6%A0%87%0Ay%3A%20number%3B%20%20%20%20%20%20%2F%2F%20%E9%BC%A0%E6%A0%87Y%E5%9D%90%E6%A0%87%0Adown%3A%20boolean%3B%20%20%2F%2F%20%E6%98%AF%E5%90%A6%E6%8C%89%E4%B8%8B%E7%8A%B6%E6%80%81%0A%7D%0Aconst%20FoamBackground%3A%20React.FC%20%3D%20()%20%3D%3E%20%7B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E5%BC%95%E7%94%A8%E5%AE%9A%E4%B9%89%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Aconst%20containerRef%20%3D%20useRefHTMLDivElement%3E(null)%3B%20%20%20%20%20%20%20%20%2F%2F%20%E5%AE%B9%E5%99%A8DOM%E5%BC%95%E7%94%A8%0Aconst%20particlesRef%20%3D%20useRefParticle%5B%5D%3E(%5B%5D)%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E7%B2%92%E5%AD%90%E6%95%B0%E7%BB%84%E5%BC%95%E7%94%A8%0Aconst%20mouseRef%20%3D%20useRefMouseState%3E(%7B%20x%3A%200%2C%20y%3A%200%2C%20down%3A%20false%20%7D)%3B%20%2F%2F%20%E9%BC%A0%E6%A0%87%E7%8A%B6%E6%80%81%E5%BC%95%E7%94%A8%0Aconst%20animationIdRef%20%3D%20useRefnumber%20%7C%20null%3E(null)%3B%20%20%20%20%20%20%20%2F%2F%20%E5%8A%A8%E7%94%BBID%E5%BC%95%E7%94%A8%EF%BC%8C%E7%94%A8%E4%BA%8E%E5%8F%96%E6%B6%88%E5%8A%A8%E7%94%BB%0Aconst%20%7B%20currentTheme%20%7D%20%3D%20useThemeStore()%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%B8%BB%E9%A2%98%E7%8A%B6%E6%80%81%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E9%85%8D%E7%BD%AE%E5%B8%B8%E9%87%8F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Aconst%20NUM_PARTICLES%20%3D%20300%3B%20%20%2F%2F%20%E7%B2%92%E5%AD%90%E6%80%BB%E6%95%B0%EF%BC%8C%E5%B9%B3%E8%A1%A1%E8%A7%86%E8%A7%89%E6%95%88%E6%9E%9C%E4%B8%8E%E6%80%A7%E8%83%BD%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F**%0A*%20%E9%98%B2%E6%8A%96%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%0A*%20%E7%94%A8%E4%BA%8E%E4%BC%98%E5%8C%96resize%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%EF%BC%8C%E9%81%BF%E5%85%8D%E9%A2%91%E7%B9%81%E9%87%8D%E5%BB%BA%E7%B2%92%E5%AD%90%0A*%20%40param%20func%20%E8%A6%81%E9%98%B2%E6%8A%96%E7%9A%84%E5%87%BD%E6%95%B0%0A*%20%40param%20wait%20%E9%98%B2%E6%8A%96%E5%BB%B6%E8%BF%9F%E6%97%B6%E9%97%B4%EF%BC%88%E6%AF%AB%E7%A7%92%EF%BC%89%0A*%2F%0Aconst%20debounce%20%3D%20useCallback((func%3A%20Function%2C%20wait%3A%20number)%20%3D%3E%20%7B%0Alet%20timeout%3A%20NodeJS.Timeout%3B%0Areturn%20function%20executedFunction(...args%3A%20any%5B%5D)%20%7B%0Aconst%20later%20%3D%20()%20%3D%3E%20%7B%0AclearTimeout(timeout)%3B%0Afunc(...args)%3B%0A%7D%3B%0AclearTimeout(timeout)%3B%0Atimeout%20%3D%20setTimeout(later%2C%20wait)%3B%0A%7D%3B%0A%7D%2C%20%5B%5D)%3B%0A%2F**%0A*%20%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E9%A2%9C%E8%89%B2%E8%BD%ACHSL%E9%A2%9C%E8%89%B2%E7%A9%BA%E9%97%B4%0A*%20HSL%E6%9B%B4%E9%80%82%E5%90%88%E7%94%9F%E6%88%90%E7%9B%B8%E8%BF%91%E7%9A%84%E8%89%B2%E5%BD%A9%E5%8F%98%E5%8C%96%0A*%20%40param%20hex%20%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E9%A2%9C%E8%89%B2%E5%80%BC%EF%BC%88%E5%A6%82%20%22%23ff6600%22%EF%BC%89%0A*%20%40returns%20%5B%E8%89%B2%E7%9B%B8%2C%20%E9%A5%B1%E5%92%8C%E5%BA%A6%2C%20%E6%98%8E%E5%BA%A6%5D%20%E6%95%B0%E7%BB%84%0A*%2F%0Aconst%20hexToHsl%20%3D%20useCallback((hex%3A%20string)%20%3D%3E%20%7B%0A%2F%2F%20%E5%B0%8616%E8%BF%9B%E5%88%B6%E8%BD%AC%E6%8D%A2%E4%B8%BARGB%EF%BC%880-1%E8%8C%83%E5%9B%B4%EF%BC%89%0Aconst%20r%20%3D%20parseInt(hex.slice(1%2C%203)%2C%2016)%20%2F%20255%3B%0Aconst%20g%20%3D%20parseInt(hex.slice(3%2C%205)%2C%2016)%20%2F%20255%3B%0Aconst%20b%20%3D%20parseInt(hex.slice(5%2C%207)%2C%2016)%20%2F%20255%3B%0A%2F%2F%20%E8%AE%A1%E7%AE%97%E6%9C%80%E5%A4%A7%E5%80%BC%E5%92%8C%E6%9C%80%E5%B0%8F%E5%80%BC%0Aconst%20max%20%3D%20Math.max(r%2C%20g%2C%20b)%3B%0Aconst%20min%20%3D%20Math.min(r%2C%20g%2C%20b)%3B%0Alet%20h%20%3D%200%2C%20s%20%3D%200%2C%20l%20%3D%20(max%20%2B%20min)%20%2F%202%3B%20%20%2F%2F%20%E6%98%8E%E5%BA%A6%E6%98%AF%E6%9C%80%E5%A4%A7%E5%80%BC%E5%92%8C%E6%9C%80%E5%B0%8F%E5%80%BC%E7%9A%84%E5%B9%B3%E5%9D%87%0Aif%20(max%20!%3D%3D%20min)%20%7B%0Aconst%20d%20%3D%20max%20-%20min%3B%0A%2F%2F%20%E6%A0%B9%E6%8D%AE%E6%98%8E%E5%BA%A6%E8%AE%A1%E7%AE%97%E9%A5%B1%E5%92%8C%E5%BA%A6%0As%20%3D%20l%20%3E%200.5%20%3F%20d%20%2F%20(2%20-%20max%20-%20min)%20%3A%20d%20%2F%20(max%20%2B%20min)%3B%0A%2F%2F%20%E6%A0%B9%E6%8D%AE%E4%B8%BB%E5%AF%BC%E9%A2%9C%E8%89%B2%E8%AE%A1%E7%AE%97%E8%89%B2%E7%9B%B8%0Aswitch%20(max)%20%7B%0Acase%20r%3A%20h%20%3D%20(g%20-%20b)%20%2F%20d%20%2B%20(g%206%20%3A%200)%3B%20break%3B%20%20%2F%2F%20%E7%BA%A2%E8%89%B2%E4%B8%BB%E5%AF%BC%0Acase%20g%3A%20h%20%3D%20(b%20-%20r)%20%2F%20d%20%2B%202%3B%20break%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E7%BB%BF%E8%89%B2%E4%B8%BB%E5%AF%BC%0Acase%20b%3A%20h%20%3D%20(r%20-%20g)%20%2F%20d%20%2B%204%3B%20break%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E8%93%9D%E8%89%B2%E4%B8%BB%E5%AF%BC%0A%7D%0Ah%20%2F%3D%206%3B%20%20%2F%2F%20%E8%BD%AC%E6%8D%A2%E4%B8%BA0-1%E8%8C%83%E5%9B%B4%0A%7D%0A%2F%2F%20%E8%BF%94%E5%9B%9E%E6%A0%87%E5%87%86HSL%E6%A0%BC%E5%BC%8F%0Areturn%20%5BMath.round(h%20*%20360)%2C%20Math.round(s%20*%20100)%2C%20Math.round(l%20*%20100)%5D%3B%0A%7D%2C%20%5B%5D)%3B%0A%2F**%0A*%20%E6%A0%B9%E6%8D%AE%E5%BD%93%E5%89%8D%E4%B8%BB%E9%A2%98%E7%94%9F%E6%88%90%E5%8A%A8%E6%80%81%E9%A2%9C%E8%89%B2%0A*%20%E6%B7%B1%E8%89%B2%E4%B8%BB%E9%A2%98%E4%BD%BF%E7%94%A8%E6%9B%B4%E6%B7%B1%E3%80%81%E6%9B%B4%E9%A5%B1%E5%92%8C%E7%9A%84%E9%A2%9C%E8%89%B2%0A*%20%E6%B5%85%E8%89%B2%E4%B8%BB%E9%A2%98%E4%BD%BF%E7%94%A8%E6%9B%B4%E4%BA%AE%E3%80%81%E6%9B%B4%E6%9F%94%E5%92%8C%E7%9A%84%E9%A2%9C%E8%89%B2%0A*%2F%0Aconst%20getThemeColors%20%3D%20useCallback(()%20%3D%3E%20%7B%0Aconst%20%5BprimaryH%2C%20primaryS%5D%20%3D%20hexToHsl(currentTheme.colors.primary)%3B%0Aconst%20%5BaccentH%2C%20accentS%5D%20%3D%20hexToHsl(currentTheme.colors.accent)%3B%0Aconst%20isDark%20%3D%20currentTheme.id%20%3D%3D%3D%20'dark'%3B%0Aif%20(isDark)%20%7B%0A%2F%2F%20%E6%B7%B1%E8%89%B2%E4%B8%BB%E9%A2%98%EF%BC%9A%E5%A2%9E%E5%8A%A0%E9%A5%B1%E5%92%8C%E5%BA%A6%EF%BC%8C%E9%99%8D%E4%BD%8E%E6%98%8E%E5%BA%A6%0Areturn%20%7B%0Abackground%3A%20%60linear-gradient(135deg%2C%20hsl(%24%7BprimaryH%7D%2C%20%24%7BMath.max(primaryS%20%2B%2010%2C%2040)%7D%25%2C%2025%25)%2C%20hsl(%24%7BaccentH%7D%2C%20%24%7BMath.max(accentS%20%2B%205%2C%2035)%7D%25%2C%2020%25))%60%2C%0Aparticle%3A%20%60hsl(%24%7BprimaryH%7D%2C%20%24%7BMath.max(primaryS%20%2B%2015%2C%2050)%7D%25%2C%2045%25)%60%0A%7D%3B%0A%7D%20else%20%7B%0A%2F%2F%20%E6%B5%85%E8%89%B2%E4%B8%BB%E9%A2%98%EF%BC%9A%E9%99%8D%E4%BD%8E%E9%A5%B1%E5%92%8C%E5%BA%A6%EF%BC%8C%E6%8F%90%E9%AB%98%E6%98%8E%E5%BA%A6%0Areturn%20%7B%0Abackground%3A%20%60linear-gradient(135deg%2C%20hsl(%24%7BprimaryH%7D%2C%20%24%7BMath.max(primaryS%20-%2020%2C%2020)%7D%25%2C%2060%25)%2C%20hsl(%24%7BaccentH%7D%2C%20%24%7BMath.max(accentS%20-%2010%2C%2030)%7D%25%2C%2050%25))%60%2C%0Aparticle%3A%20%60hsl(%24%7BprimaryH%7D%2C%20%24%7BMath.max(primaryS%20-%2010%2C%2035)%7D%25%2C%2075%25)%60%0A%7D%3B%0A%7D%0A%7D%2C%20%5BcurrentTheme%2C%20hexToHsl%5D)%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E9%BC%A0%E6%A0%87%E5%92%8C%E8%A7%A6%E6%91%B8%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F**%0A*%20%E6%9B%B4%E6%96%B0%E9%BC%A0%E6%A0%87%E4%BD%8D%E7%BD%AE%0A*%20%E5%85%BC%E5%AE%B9%E9%BC%A0%E6%A0%87%E4%BA%8B%E4%BB%B6%E5%92%8C%E8%A7%A6%E6%91%B8%E4%BA%8B%E4%BB%B6%0A*%2F%0Aconst%20updateMousePos%20%3D%20useCallback((e%3A%20MouseEvent%20%7C%20Touch)%20%3D%3E%20%7B%0AmouseRef.current.x%20%3D%20e.clientX%3B%0AmouseRef.current.y%20%3D%20e.clientY%3B%0A%7D%2C%20%5B%5D)%3B%0A%2F**%0A*%20%E9%BC%A0%E6%A0%87%E6%8C%89%E4%B8%8B%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%0A*%20%E6%BF%80%E6%B4%BB%E4%BA%A4%E4%BA%92%E5%8A%9B%E5%9C%BA%0A*%2F%0Aconst%20handleMouseDown%20%3D%20useCallback((e%3A%20MouseEvent)%20%3D%3E%20%7B%0AmouseRef.current.down%20%3D%20true%3B%0AupdateMousePos(e)%3B%0A%7D%2C%20%5BupdateMousePos%5D)%3B%0A%2F**%0A*%20%E9%BC%A0%E6%A0%87%E9%87%8A%E6%94%BE%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%0A*%20%E5%85%B3%E9%97%AD%E4%BA%A4%E4%BA%92%E5%8A%9B%E5%9C%BA%0A*%2F%0Aconst%20handleMouseUp%20%3D%20useCallback(()%20%3D%3E%20%7B%0AmouseRef.current.down%20%3D%20false%3B%0A%7D%2C%20%5B%5D)%3B%0A%2F**%0A*%20%E9%BC%A0%E6%A0%87%E7%A7%BB%E5%8A%A8%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%0A*%20%E5%8F%AA%E6%9C%89%E5%9C%A8%E6%8C%89%E4%B8%8B%E7%8A%B6%E6%80%81%E6%89%8D%E6%9B%B4%E6%96%B0%E4%BD%8D%E7%BD%AE%EF%BC%8C%E5%87%8F%E5%B0%91%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84%E8%AE%A1%E7%AE%97%0A*%2F%0Aconst%20handleMouseMove%20%3D%20useCallback((e%3A%20MouseEvent)%20%3D%3E%20%7B%0Aif%20(mouseRef.current.down)%20updateMousePos(e)%3B%0A%7D%2C%20%5BupdateMousePos%5D)%3B%0A%2F**%0A*%20%E8%A7%A6%E6%91%B8%E5%BC%80%E5%A7%8B%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%0A*%20%E7%A7%BB%E5%8A%A8%E8%AE%BE%E5%A4%87%E7%9A%84%E4%BA%A4%E4%BA%92%E6%94%AF%E6%8C%81%0A*%2F%0Aconst%20handleTouchStart%20%3D%20useCallback((e%3A%20TouchEvent)%20%3D%3E%20%7B%0AmouseRef.current.down%20%3D%20true%3B%0AupdateMousePos(e.touches%5B0%5D)%3B%20%20%2F%2F%20%E5%8F%AA%E5%8F%96%E7%AC%AC%E4%B8%80%E4%B8%AA%E8%A7%A6%E6%91%B8%E7%82%B9%0A%7D%2C%20%5BupdateMousePos%5D)%3B%0A%2F**%0A*%20%E8%A7%A6%E6%91%B8%E7%BB%93%E6%9D%9F%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%0A*%2F%0Aconst%20handleTouchEnd%20%3D%20useCallback(()%20%3D%3E%20%7B%0AmouseRef.current.down%20%3D%20false%3B%0A%7D%2C%20%5B%5D)%3B%0A%2F**%0A*%20%E8%A7%A6%E6%91%B8%E7%A7%BB%E5%8A%A8%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%0A*%2F%0Aconst%20handleTouchMove%20%3D%20useCallback((e%3A%20TouchEvent)%20%3D%3E%20%7B%0Aif%20(mouseRef.current.down)%20updateMousePos(e.touches%5B0%5D)%3B%0A%7D%2C%20%5BupdateMousePos%5D)%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E7%B2%92%E5%AD%90%E7%B3%BB%E7%BB%9F%E6%A0%B8%E5%BF%83%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F**%0A*%20%E5%88%9D%E5%A7%8B%E5%8C%96%E7%B2%92%E5%AD%90%E7%B3%BB%E7%BB%9F%0A*%20%E5%88%9B%E5%BB%BA%E6%8C%87%E5%AE%9A%E6%95%B0%E9%87%8F%E7%9A%84%E7%B2%92%E5%AD%90%E5%B9%B6%E5%88%86%E5%B8%83%E5%9C%A8%E5%B1%8F%E5%B9%95%E4%B8%8A%0A*%2F%0Aconst%20initializeParticles%20%3D%20useCallback(()%20%3D%3E%20%7B%0Aconst%20container%20%3D%20containerRef.current%3B%0Aif%20(!container)%20return%3B%0A%2F%2F%20%E6%B8%85%E7%90%86%E7%8E%B0%E6%9C%89%E7%B2%92%E5%AD%90%EF%BC%8C%E9%98%B2%E6%AD%A2%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%0AparticlesRef.current.forEach(p%20%3D%3E%20p.el.remove())%3B%0AparticlesRef.current%20%3D%20%5B%5D%3B%0Aconst%20width%20%3D%20window.innerWidth%3B%0Aconst%20height%20%3D%20window.innerHeight%3B%0Aconst%20colors%20%3D%20getThemeColors()%3B%0A%2F%2F%20%E5%88%9B%E5%BB%BA%E6%8C%87%E5%AE%9A%E6%95%B0%E9%87%8F%E7%9A%84%E7%B2%92%E5%AD%90%0Afor%20(let%20i%20%3D%200%3B%20i%20NUM_PARTICLES%3B%20i%2B%2B)%20%7B%0A%2F%2F%20%E5%88%9B%E5%BB%BADOM%E5%85%83%E7%B4%A0%0Aconst%20el%20%3D%20document.createElement('div')%3B%0Ael.style.position%20%3D%20'absolute'%3B%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E7%BB%9D%E5%AF%B9%E5%AE%9A%E4%BD%8D%EF%BC%8C%E8%84%B1%E7%A6%BB%E6%96%87%E6%A1%A3%E6%B5%81%0Ael.style.borderRadius%20%3D%20'50%25'%3B%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%9C%86%E5%BD%A2%E7%B2%92%E5%AD%90%0Ael.style.backgroundColor%20%3D%20colors.particle%3B%20%2F%2F%20%E4%B8%BB%E9%A2%98%E8%89%B2%0Ael.style.pointerEvents%20%3D%20'none'%3B%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%B8%8D%E5%93%8D%E5%BA%94%E9%BC%A0%E6%A0%87%E4%BA%8B%E4%BB%B6%0Ael.style.willChange%20%3D%20'transform%2C%20opacity'%3B%20%2F%2F%20%E6%8F%90%E7%A4%BA%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BC%98%E5%8C%96%0Acontainer.appendChild(el)%3B%0A%2F%2F%20%E9%9A%8F%E6%9C%BA%E5%A4%A7%E5%B0%8F%EF%BC%882-6px%EF%BC%89%0Aconst%20size%20%3D%202%20%2B%20Math.random()%20*%204%3B%0Ael.style.width%20%3D%20%60%24%7Bsize%7Dpx%60%3B%0Ael.style.height%20%3D%20%60%24%7Bsize%7Dpx%60%3B%0A%2F%2F%20%E9%9A%8F%E6%9C%BA%E6%B7%B1%E5%BA%A6%E5%92%8C%E4%BD%8D%E7%BD%AE%0Aconst%20depth%20%3D%20Math.random()%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%200-1%E7%9A%84%E6%B7%B1%E5%BA%A6%E5%80%BC%0Aconst%20x%20%3D%20Math.random()%20*%20width%3B%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E9%9A%8F%E6%9C%BAX%E4%BD%8D%E7%BD%AE%0Aconst%20y%20%3D%20Math.random()%20*%20height%3B%20%20%20%20%20%20%20%20%20%2F%2F%20%E9%9A%8F%E6%9C%BAY%E4%BD%8D%E7%BD%AE%0A%2F%2F%20%E5%88%9B%E5%BB%BA%E7%B2%92%E5%AD%90%E5%AF%B9%E8%B1%A1%0AparticlesRef.current.push(%7B%0Ael%2C%0Ax%2C%20y%2C%0Avx%3A%200%2C%20vy%3A%200%2C%20%20%20%20%2F%2F%20%E5%88%9D%E5%A7%8B%E9%80%9F%E5%BA%A6%E4%B8%BA0%0Asize%2C%20depth%0A%7D)%3B%0A%7D%0A%7D%2C%20%5BgetThemeColors%5D)%3B%0A%2F**%0A*%20%E5%8A%A8%E7%94%BB%E5%BE%AA%E7%8E%AF%E5%87%BD%E6%95%B0%0A*%20%E8%BF%99%E6%98%AF%E6%95%B4%E4%B8%AA%E7%B2%92%E5%AD%90%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%BF%83%E8%84%8F%EF%BC%8C%E6%AF%8F%E5%B8%A7%E9%83%BD%E4%BC%9A%E8%B0%83%E7%94%A8%0A*%2F%0Aconst%20animate%20%3D%20useCallback(()%20%3D%3E%20%7B%0Aconst%20mouse%20%3D%20mouseRef.current%3B%0Aconst%20width%20%3D%20window.innerWidth%3B%0Aconst%20height%20%3D%20window.innerHeight%3B%0A%2F%2F%20%E9%81%8D%E5%8E%86%E6%89%80%E6%9C%89%E7%B2%92%E5%AD%90%E8%BF%9B%E8%A1%8C%E7%89%A9%E7%90%86%E6%9B%B4%E6%96%B0%0Afor%20(let%20p%20of%20particlesRef.current)%20%7B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E5%9F%BA%E7%A1%80%E6%BC%82%E7%A7%BB%E5%8A%9B%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F%2F%20%E6%A8%A1%E6%8B%9F%E8%87%AA%E7%84%B6%E7%9A%84%E6%B5%81%E4%BD%93%E8%BF%90%E5%8A%A8%0Ap.vx%20%2B%3D%200.01%20*%20p.depth%3B%20%20%20%2F%2F%20X%E6%96%B9%E5%90%91%E5%9F%BA%E7%A1%80%E6%BC%82%E7%A7%BB%0Ap.vy%20%2B%3D%200.005%20*%20p.depth%3B%20%20%2F%2F%20Y%E6%96%B9%E5%90%91%E5%9F%BA%E7%A1%80%E6%BC%82%E7%A7%BB%EF%BC%88%E7%95%A5%E5%B0%8F%EF%BC%8C%E6%A8%A1%E6%8B%9F%E9%87%8D%E5%8A%9B%E5%BD%B1%E5%93%8D%EF%BC%89%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E4%BA%A4%E4%BA%92%E5%8A%9B%E5%9C%BA%E8%AE%A1%E7%AE%97%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Aif%20(mouse.down)%20%7B%0A%2F%2F%20%E8%AE%A1%E7%AE%97%E7%B2%92%E5%AD%90%E5%88%B0%E9%BC%A0%E6%A0%87%E7%9A%84%E5%90%91%E9%87%8F%0Aconst%20dx%20%3D%20p.x%20-%20mouse.x%3B%0Aconst%20dy%20%3D%20p.y%20-%20mouse.y%3B%0A%2F%2F%20%E8%AE%A1%E7%AE%97%E8%B7%9D%E7%A6%BB%EF%BC%88%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E8%B7%9D%E7%A6%BB%EF%BC%89%0Aconst%20dist%20%3D%20Math.sqrt(dx%20*%20dx%20%2B%20dy%20*%20dy)%3B%0A%2F%2F%20%E5%9C%A8%E5%BD%B1%E5%93%8D%E8%8C%83%E5%9B%B4%E5%86%85%E6%96%BD%E5%8A%A0%E6%8E%92%E6%96%A5%E5%8A%9B%0Aif%20(dist%20100)%20%7B%0A%2F%2F%20%E5%8F%8D%E5%B9%B3%E6%96%B9%E5%8A%9B%E5%9C%BA%EF%BC%9A%E8%B7%9D%E7%A6%BB%E8%B6%8A%E8%BF%91%EF%BC%8C%E5%8A%9B%E8%B6%8A%E5%A4%A7%0Aconst%20baseForce%20%3D%20100%20%2F%20(dist%20%2B%2010)%3B%20%20%2F%2F%20%2B10%E9%81%BF%E5%85%8D%E9%99%A4%E9%9B%B6%E9%94%99%E8%AF%AF%0Aconst%20force%20%3D%20baseForce%20*%20p.depth%3B%20%20%20%20%20%2F%2F%20%E6%B7%B1%E5%BA%A6%E5%BD%B1%E5%93%8D%E5%8A%9B%E7%9A%84%E5%A4%A7%E5%B0%8F%0A%2F%2F%20%E8%AE%A1%E7%AE%97%E5%8A%9B%E7%9A%84%E6%96%B9%E5%90%91%EF%BC%88%E5%8D%95%E4%BD%8D%E5%90%91%E9%87%8F%EF%BC%89%E5%B9%B6%E5%BA%94%E7%94%A8%0Ap.vx%20%2B%3D%20force%20*%20(dx%20%2F%20dist)%3B%20%20%2F%2F%20X%E6%96%B9%E5%90%91%E5%88%86%E5%8A%9B%0Ap.vy%20%2B%3D%20force%20*%20(dy%20%2F%20dist)%3B%20%20%2F%2F%20Y%E6%96%B9%E5%90%91%E5%88%86%E5%8A%9B%0A%7D%0A%7D%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E7%89%A9%E7%90%86%E7%B3%BB%E7%BB%9F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F%2F%20%E5%BA%94%E7%94%A8%E6%91%A9%E6%93%A6%E5%8A%9B%EF%BC%88%E7%A9%BA%E6%B0%94%E9%98%BB%E5%8A%9B%EF%BC%89%0Ap.vx%20*%3D%200.95%3B%20%20%2F%2F%20X%E6%96%B9%E5%90%91%E6%91%A9%E6%93%A6%0Ap.vy%20*%3D%200.95%3B%20%20%2F%2F%20Y%E6%96%B9%E5%90%91%E6%91%A9%E6%93%A6%0A%2F%2F%20%E6%9B%B4%E6%96%B0%E4%BD%8D%E7%BD%AE%0Ap.x%20%2B%3D%20p.vx%3B%0Ap.y%20%2B%3D%20p.vy%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E8%BE%B9%E7%95%8C%E5%A4%84%E7%90%86%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F%2F%20%E7%8E%AF%E7%BB%95%E8%BE%B9%E7%95%8C%EF%BC%9A%E7%B2%92%E5%AD%90%E4%BB%8E%E4%B8%80%E8%BE%B9%E5%87%BA%E5%8E%BB%EF%BC%8C%E4%BB%8E%E5%8F%A6%E4%B8%80%E8%BE%B9%E8%BF%9B%E6%9D%A5%0Aif%20(p.x%2010)%20p.x%20%3D%20width%20%2B%2010%3B%20%20%20%20%2F%2F%20%E5%B7%A6%E8%BE%B9%E7%95%8C%20%E2%86%92%20%E5%8F%B3%E8%BE%B9%E7%95%8C%0Aif%20(p.x%20%3E%20width%20%2B%2010)%20p.x%20%3D%20-10%3B%20%20%20%20%2F%2F%20%E5%8F%B3%E8%BE%B9%E7%95%8C%20%E2%86%92%20%E5%B7%A6%E8%BE%B9%E7%95%8C%0Aif%20(p.y%2010)%20p.y%20%3D%20height%20%2B%2010%3B%20%20%20%2F%2F%20%E4%B8%8A%E8%BE%B9%E7%95%8C%20%E2%86%92%20%E4%B8%8B%E8%BE%B9%E7%95%8C%0Aif%20(p.y%20%3E%20height%20%2B%2010)%20p.y%20%3D%20-10%3B%20%20%20%2F%2F%20%E4%B8%8B%E8%BE%B9%E7%95%8C%20%E2%86%92%20%E4%B8%8A%E8%BE%B9%E7%95%8C%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E8%A7%86%E8%A7%89%E6%95%88%E6%9E%9C%E6%9B%B4%E6%96%B0%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F%2F%20%E5%9F%BA%E4%BA%8E%E6%B7%B1%E5%BA%A6%E7%9A%84%E8%A7%86%E8%A7%89%E5%B1%82%E6%AC%A1%0Aconst%20scale%20%3D%200.6%20%2B%200.4%20*%20p.depth%3B%20%20%20%20%2F%2F%20%E7%BC%A9%E6%94%BE%EF%BC%9A0.6-1.0%0Aconst%20opacity%20%3D%200.4%20%2B%200.6%20*%20p.depth%3B%20%20%2F%2F%20%E9%80%8F%E6%98%8E%E5%BA%A6%EF%BC%9A0.4-1.0%0A%2F%2F%20%E5%BA%94%E7%94%A8%E5%8F%98%E6%8D%A2%EF%BC%88%E4%BD%BF%E7%94%A8transform%E4%BC%98%E5%8C%96%E6%80%A7%E8%83%BD%EF%BC%89%0Ap.el.style.transform%20%3D%20%60translate(%24%7Bp.x%7Dpx%2C%20%24%7Bp.y%7Dpx)%20scale(%24%7Bscale%7D)%60%3B%0Ap.el.style.opacity%20%3D%20opacity.toString()%3B%0A%7D%0A%2F%2F%20%E8%AF%B7%E6%B1%82%E4%B8%8B%E4%B8%80%E5%B8%A7%E5%8A%A8%E7%94%BB%0AanimationIdRef.current%20%3D%20requestAnimationFrame(animate)%3B%0A%7D%2C%20%5B%5D)%3B%0A%2F**%0A*%20%E7%AA%97%E5%8F%A3%E5%A4%A7%E5%B0%8F%E6%94%B9%E5%8F%98%E5%A4%84%E7%90%86%0A*%20%E9%87%8D%E6%96%B0%E5%88%9D%E5%A7%8B%E5%8C%96%E7%B2%92%E5%AD%90%E5%88%86%E5%B8%83%0A*%2F%0Aconst%20handleResize%20%3D%20useCallback(()%20%3D%3E%20%7B%0A%2F%2F%20%E9%87%8D%E6%96%B0%E5%88%9D%E5%A7%8B%E5%8C%96%E7%B2%92%E5%AD%90%E5%88%86%E5%B8%83%E4%BB%A5%E9%80%82%E5%BA%94%E6%96%B0%E7%9A%84%E7%AA%97%E5%8F%A3%E5%B0%BA%E5%AF%B8%0AinitializeParticles()%3B%0A%7D%2C%20%5BinitializeParticles%5D)%3B%0A%2F**%0A*%20%E9%98%B2%E6%8A%96%E7%89%88%E6%9C%AC%E7%9A%84resize%E5%A4%84%E7%90%86%E5%99%A8%0A*%20%E9%81%BF%E5%85%8D%E7%AA%97%E5%8F%A3%E6%8B%96%E6%8B%BD%E6%97%B6%E9%A2%91%E7%B9%81%E9%87%8D%E5%BB%BA%E7%B2%92%E5%AD%90%0A*%2F%0Aconst%20debouncedHandleResize%20%3D%20useCallback(%0Adebounce(handleResize%2C%201000)%2C%20%20%2F%2F%201%E7%A7%92%E9%98%B2%E6%8A%96%E5%BB%B6%E8%BF%9F%0A%5Bdebounce%2C%20handleResize%5D%0A)%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%AE%A1%E7%90%86%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F**%0A*%20%E7%BB%84%E4%BB%B6%E6%8C%82%E8%BD%BD%E5%92%8C%E6%B8%85%E7%90%86%E6%95%88%E6%9E%9C%0A*%20%E7%AE%A1%E7%90%86%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E5%99%A8%E5%92%8C%E5%8A%A8%E7%94%BB%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%0A*%2F%0AuseEffect(()%20%3D%3E%20%7B%0A%2F%2F%20%E5%88%9D%E5%A7%8B%E5%8C%96%E7%B2%92%E5%AD%90%0AinitializeParticles()%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E5%99%A8%E6%B3%A8%E5%86%8C%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F%2F%20%E5%85%A8%E5%B1%80%E9%BC%A0%E6%A0%87%E4%BA%8B%E4%BB%B6%EF%BC%88%E7%A1%AE%E4%BF%9D%E6%8B%96%E6%8B%BD%E6%97%B6%E5%8D%B3%E4%BD%BF%E7%A6%BB%E5%BC%80%E5%AE%B9%E5%99%A8%E4%B9%9F%E8%83%BD%E7%BB%A7%E7%BB%AD%EF%BC%89%0Adocument.addEventListener('mousedown'%2C%20handleMouseDown)%3B%0Adocument.addEventListener('mouseup'%2C%20handleMouseUp)%3B%0Adocument.addEventListener('mousemove'%2C%20handleMouseMove)%3B%0A%2F%2F%20%E5%AE%B9%E5%99%A8%E8%A7%A6%E6%91%B8%E4%BA%8B%E4%BB%B6%EF%BC%88%E7%A7%BB%E5%8A%A8%E8%AE%BE%E5%A4%87%E6%94%AF%E6%8C%81%EF%BC%89%0Aconst%20container%20%3D%20containerRef.current%3B%0Aif%20(container)%20%7B%0Acontainer.addEventListener('touchstart'%2C%20handleTouchStart)%3B%0Acontainer.addEventListener('touchend'%2C%20handleTouchEnd)%3B%0Acontainer.addEventListener('touchmove'%2C%20handleTouchMove)%3B%0A%7D%0A%2F%2F%20%E7%AA%97%E5%8F%A3resize%E4%BA%8B%E4%BB%B6%0Awindow.addEventListener('resize'%2C%20debouncedHandleResize)%3B%0A%2F%2F%20%E5%90%AF%E5%8A%A8%E5%8A%A8%E7%94%BB%E5%BE%AA%E7%8E%AF%0Aanimate()%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E6%B8%85%E7%90%86%E5%87%BD%E6%95%B0%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Areturn%20()%20%3D%3E%20%7B%0A%2F%2F%20%E7%A7%BB%E9%99%A4%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E5%99%A8%0Adocument.removeEventListener('mousedown'%2C%20handleMouseDown)%3B%0Adocument.removeEventListener('mouseup'%2C%20handleMouseUp)%3B%0Adocument.removeEventListener('mousemove'%2C%20handleMouseMove)%3B%0Aif%20(container)%20%7B%0Acontainer.removeEventListener('touchstart'%2C%20handleTouchStart)%3B%0Acontainer.removeEventListener('touchend'%2C%20handleTouchEnd)%3B%0Acontainer.removeEventListener('touchmove'%2C%20handleTouchMove)%3B%0A%7D%0Awindow.removeEventListener('resize'%2C%20debouncedHandleResize)%3B%0A%2F%2F%20%E5%8F%96%E6%B6%88%E5%8A%A8%E7%94%BB%E5%BE%AA%E7%8E%AF%0Aif%20(animationIdRef.current%20!%3D%3D%20null)%20%7B%0AcancelAnimationFrame(animationIdRef.current)%3B%0A%7D%0A%2F%2F%20%E6%B8%85%E7%90%86%E6%89%80%E6%9C%89%E7%B2%92%E5%AD%90DOM%E5%85%83%E7%B4%A0%0AparticlesRef.current.forEach(p%20%3D%3E%20p.el.remove())%3B%0A%7D%3B%0A%7D%2C%20%5Banimate%2C%20handleMouseDown%2C%20handleMouseUp%2C%20handleMouseMove%2C%20handleTouchStart%2C%20handleTouchEnd%2C%20handleTouchMove%2C%20debouncedHandleResize%2C%20initializeParticles%5D)%3B%0A%2F**%0A*%20%E4%B8%BB%E9%A2%98%E5%8F%98%E5%8C%96%E5%93%8D%E5%BA%94%0A*%20%E5%BD%93%E4%B8%BB%E9%A2%98%E5%88%87%E6%8D%A2%E6%97%B6%EF%BC%8C%E5%8A%A8%E6%80%81%E6%9B%B4%E6%96%B0%E6%89%80%E6%9C%89%E7%B2%92%E5%AD%90%E7%9A%84%E9%A2%9C%E8%89%B2%0A*%2F%0AuseEffect(()%20%3D%3E%20%7B%0Aif%20(particlesRef.current.length%20%3E%200)%20%7B%0Aconst%20colors%20%3D%20getThemeColors()%3B%0A%2F%2F%20%E6%9B%B4%E6%96%B0%E6%89%80%E6%9C%89%E7%B2%92%E5%AD%90%E7%9A%84%E9%A2%9C%E8%89%B2%0AparticlesRef.current.forEach(p%20%3D%3E%20%7B%0Ap.el.style.backgroundColor%20%3D%20colors.particle%3B%0A%7D)%3B%0A%2F%2F%20%E6%9B%B4%E6%96%B0%E5%AE%B9%E5%99%A8%E8%83%8C%E6%99%AF%E6%B8%90%E5%8F%98%0Aif%20(containerRef.current)%20%7B%0AcontainerRef.current.style.background%20%3D%20colors.background%3B%0A%7D%0A%7D%0A%7D%2C%20%5BcurrentTheme%2C%20getThemeColors%5D)%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E6%B8%B2%E6%9F%93%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Aconst%20colors%20%3D%20getThemeColors()%3B%0Areturn%20(%0Adiv%0Aref%3D%7BcontainerRef%7D%0AclassName%3D%22fixed%20inset-0%20w-full%20h-full%20overflow-hidden%20pointer-events-none%20z-0%22%0Astyle%3D%7B%7B%0Abackground%3A%20colors.background%2C%0A%7D%7D%0A%2F%3E%0A)%3B%0A%7D%3B%0Aexport%20default%20FoamBackground%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-string inline">&#x27;use client&#x27;</span>;

<span class="hljs-keyword inline">import</span> <span class="hljs-title class_ inline">React</span>, { useEffect, useRef, useCallback } <span class="hljs-keyword inline">from</span> <span class="hljs-string inline">&#x27;react&#x27;</span>;
<span class="hljs-keyword inline">import</span> { useThemeStore } <span class="hljs-keyword inline">from</span> <span class="hljs-string inline">&#x27;@/lib/stores/themeStore&#x27;</span>;

<span class="hljs-comment inline">// ==================== 类型定义 ====================</span>
<span class="hljs-comment inline">/**
 * 粒子数据结构
 * 每个粒子都是一个独立的物理实体
 */</span>
<span class="hljs-keyword inline">interface</span> <span class="hljs-title class_ inline">Particle</span> {
  <span class="hljs-attr inline">el</span>: <span class="hljs-title class_ inline">HTMLDivElement</span>;  <span class="hljs-comment inline">// DOM元素引用，避免频繁查询</span>
  <span class="hljs-attr inline">x</span>: <span class="hljs-built_in inline">number</span>;           <span class="hljs-comment inline">// 当前X坐标（精确到小数）</span>
  <span class="hljs-attr inline">y</span>: <span class="hljs-built_in inline">number</span>;           <span class="hljs-comment inline">// 当前Y坐标（精确到小数）</span>
  <span class="hljs-attr inline">vx</span>: <span class="hljs-built_in inline">number</span>;          <span class="hljs-comment inline">// X方向速度</span>
  <span class="hljs-attr inline">vy</span>: <span class="hljs-built_in inline">number</span>;          <span class="hljs-comment inline">// Y方向速度</span>
  <span class="hljs-attr inline">size</span>: <span class="hljs-built_in inline">number</span>;        <span class="hljs-comment inline">// 粒子基础大小</span>
  <span class="hljs-attr inline">depth</span>: <span class="hljs-built_in inline">number</span>;       <span class="hljs-comment inline">// 深度层次(0-1)，影响大小、透明度、速度</span>
}

<span class="hljs-comment inline">/**
 * 鼠标/触摸状态
 * 用于交互力场计算
 */</span>
<span class="hljs-keyword inline">interface</span> <span class="hljs-title class_ inline">MouseState</span> {
  <span class="hljs-attr inline">x</span>: <span class="hljs-built_in inline">number</span>;      <span class="hljs-comment inline">// 鼠标X坐标</span>
  <span class="hljs-attr inline">y</span>: <span class="hljs-built_in inline">number</span>;      <span class="hljs-comment inline">// 鼠标Y坐标</span>
  <span class="hljs-attr inline">down</span>: <span class="hljs-built_in inline">boolean</span>;  <span class="hljs-comment inline">// 是否按下状态</span>
}

<span class="hljs-keyword inline">const</span> <span class="hljs-title class_ inline">FoamBackground</span>: <span class="hljs-title class_ inline">React</span>.<span class="hljs-property inline">FC</span> = <span class="hljs-function inline">() =&gt;</span> {
  <span class="hljs-comment inline">// ==================== 引用定义 ====================</span>
  <span class="hljs-keyword inline">const</span> containerRef = useRef&lt;<span class="hljs-title class_ inline">HTMLDivElement</span>&gt;(<span class="hljs-literal inline">null</span>);        <span class="hljs-comment inline">// 容器DOM引用</span>
  <span class="hljs-keyword inline">const</span> particlesRef = useRef&lt;<span class="hljs-title class_ inline">Particle</span>[]&gt;([]);              <span class="hljs-comment inline">// 粒子数组引用</span>
  <span class="hljs-keyword inline">const</span> mouseRef = useRef&lt;<span class="hljs-title class_ inline">MouseState</span>&gt;({ <span class="hljs-attr inline">x</span>: <span class="hljs-number inline">0</span>, <span class="hljs-attr inline">y</span>: <span class="hljs-number inline">0</span>, <span class="hljs-attr inline">down</span>: <span class="hljs-literal inline">false</span> }); <span class="hljs-comment inline">// 鼠标状态引用</span>
  <span class="hljs-keyword inline">const</span> animationIdRef = useRef&lt;<span class="hljs-built_in inline">number</span> | <span class="hljs-literal inline">null</span>&gt;(<span class="hljs-literal inline">null</span>);       <span class="hljs-comment inline">// 动画ID引用，用于取消动画</span>
  <span class="hljs-keyword inline">const</span> { currentTheme } = <span class="hljs-title function_ inline">useThemeStore</span>();                 <span class="hljs-comment inline">// 主题状态</span>

  <span class="hljs-comment inline">// ==================== 配置常量 ====================</span>
  <span class="hljs-keyword inline">const</span> <span class="hljs-variable constant_ inline">NUM_PARTICLES</span> = <span class="hljs-number inline">300</span>;  <span class="hljs-comment inline">// 粒子总数，平衡视觉效果与性能</span>

  <span class="hljs-comment inline">// ==================== 工具函数 ====================</span>
  <span class="hljs-comment inline">/**
   * 防抖工具函数
   * 用于优化resize事件处理，避免频繁重建粒子
   * <span class="hljs-doctag inline">@param</span> func 要防抖的函数
   * <span class="hljs-doctag inline">@param</span> wait 防抖延迟时间（毫秒）
   */</span>
  <span class="hljs-keyword inline">const</span> debounce = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">func</span>: <span class="hljs-title class_ inline">Function</span>, <span class="hljs-attr inline">wait</span>: <span class="hljs-built_in inline">number</span></span>) =&gt;</span> {
    <span class="hljs-keyword inline">let</span> <span class="hljs-attr inline">timeout</span>: <span class="hljs-title class_ inline">NodeJS</span>.<span class="hljs-property inline">Timeout</span>;
    <span class="hljs-keyword inline">return</span> <span class="hljs-keyword inline">function</span> <span class="hljs-title function_ inline">executedFunction</span>(<span class="hljs-params inline">...<span class="hljs-attr inline">args</span>: <span class="hljs-built_in inline">any</span>[]</span>) {
      <span class="hljs-keyword inline">const</span> <span class="hljs-title function_ inline">later</span> = (<span class="hljs-params inline"></span>) =&gt; {
        <span class="hljs-built_in inline">clearTimeout</span>(timeout);
        <span class="hljs-title function_ inline">func</span>(...args);
      };
      <span class="hljs-built_in inline">clearTimeout</span>(timeout);
      timeout = <span class="hljs-built_in inline">setTimeout</span>(later, wait);
    };
  }, []);

  <span class="hljs-comment inline">/**
   * 十六进制颜色转HSL颜色空间
   * HSL更适合生成相近的色彩变化
   * <span class="hljs-doctag inline">@param</span> hex 十六进制颜色值（如 &quot;#ff6600&quot;）
   * <span class="hljs-doctag inline">@returns</span> [色相, 饱和度, 明度] 数组
   */</span>
  <span class="hljs-keyword inline">const</span> hexToHsl = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">hex</span>: <span class="hljs-built_in inline">string</span></span>) =&gt;</span> {
    <span class="hljs-comment inline">// 将16进制转换为RGB（0-1范围）</span>
    <span class="hljs-keyword inline">const</span> r = <span class="hljs-built_in inline">parseInt</span>(hex.<span class="hljs-title function_ inline">slice</span>(<span class="hljs-number inline">1</span>, <span class="hljs-number inline">3</span>), <span class="hljs-number inline">16</span>) / <span class="hljs-number inline">255</span>;
    <span class="hljs-keyword inline">const</span> g = <span class="hljs-built_in inline">parseInt</span>(hex.<span class="hljs-title function_ inline">slice</span>(<span class="hljs-number inline">3</span>, <span class="hljs-number inline">5</span>), <span class="hljs-number inline">16</span>) / <span class="hljs-number inline">255</span>;
    <span class="hljs-keyword inline">const</span> b = <span class="hljs-built_in inline">parseInt</span>(hex.<span class="hljs-title function_ inline">slice</span>(<span class="hljs-number inline">5</span>, <span class="hljs-number inline">7</span>), <span class="hljs-number inline">16</span>) / <span class="hljs-number inline">255</span>;

    <span class="hljs-comment inline">// 计算最大值和最小值</span>
    <span class="hljs-keyword inline">const</span> max = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">max</span>(r, g, b);
    <span class="hljs-keyword inline">const</span> min = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">min</span>(r, g, b);
    <span class="hljs-keyword inline">let</span> h = <span class="hljs-number inline">0</span>, s = <span class="hljs-number inline">0</span>, l = (max + min) / <span class="hljs-number inline">2</span>;  <span class="hljs-comment inline">// 明度是最大值和最小值的平均</span>

    <span class="hljs-keyword inline">if</span> (max !== min) {
      <span class="hljs-keyword inline">const</span> d = max - min;
      <span class="hljs-comment inline">// 根据明度计算饱和度</span>
      s = l &gt; <span class="hljs-number inline">0.5</span> ? d / (<span class="hljs-number inline">2</span> - max - min) : d / (max + min);
      
      <span class="hljs-comment inline">// 根据主导颜色计算色相</span>
      <span class="hljs-keyword inline">switch</span> (max) {
        <span class="hljs-keyword inline">case</span> <span class="hljs-attr inline">r</span>: h = (g - b) / d + (g &lt; b ? <span class="hljs-number inline">6</span> : <span class="hljs-number inline">0</span>); <span class="hljs-keyword inline">break</span>;  <span class="hljs-comment inline">// 红色主导</span>
        <span class="hljs-keyword inline">case</span> <span class="hljs-attr inline">g</span>: h = (b - r) / d + <span class="hljs-number inline">2</span>; <span class="hljs-keyword inline">break</span>;                <span class="hljs-comment inline">// 绿色主导</span>
        <span class="hljs-keyword inline">case</span> <span class="hljs-attr inline">b</span>: h = (r - g) / d + <span class="hljs-number inline">4</span>; <span class="hljs-keyword inline">break</span>;                <span class="hljs-comment inline">// 蓝色主导</span>
      }
      h /= <span class="hljs-number inline">6</span>;  <span class="hljs-comment inline">// 转换为0-1范围</span>
    }

    <span class="hljs-comment inline">// 返回标准HSL格式</span>
    <span class="hljs-keyword inline">return</span> [<span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">round</span>(h * <span class="hljs-number inline">360</span>), <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">round</span>(s * <span class="hljs-number inline">100</span>), <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">round</span>(l * <span class="hljs-number inline">100</span>)];
  }, []);

  <span class="hljs-comment inline">/**
   * 根据当前主题生成动态颜色
   * 深色主题使用更深、更饱和的颜色
   * 浅色主题使用更亮、更柔和的颜色
   */</span>
  <span class="hljs-keyword inline">const</span> getThemeColors = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-keyword inline">const</span> [primaryH, primaryS] = <span class="hljs-title function_ inline">hexToHsl</span>(currentTheme.<span class="hljs-property inline">colors</span>.<span class="hljs-property inline">primary</span>);
    <span class="hljs-keyword inline">const</span> [accentH, accentS] = <span class="hljs-title function_ inline">hexToHsl</span>(currentTheme.<span class="hljs-property inline">colors</span>.<span class="hljs-property inline">accent</span>);
    
    <span class="hljs-keyword inline">const</span> isDark = currentTheme.<span class="hljs-property inline">id</span> === <span class="hljs-string inline">&#x27;dark&#x27;</span>;
    
    <span class="hljs-keyword inline">if</span> (isDark) {
      <span class="hljs-comment inline">// 深色主题：增加饱和度，降低明度</span>
      <span class="hljs-keyword inline">return</span> {
        <span class="hljs-attr inline">background</span>: <span class="hljs-string inline">`linear-gradient(135deg, hsl(<span class="hljs-subst inline">${primaryH}</span>, <span class="hljs-subst inline">${<span class="hljs-built_in inline">Math</span>.max(primaryS + <span class="hljs-number inline">10</span>, <span class="hljs-number inline">40</span>)}</span>%, 25%), hsl(<span class="hljs-subst inline">${accentH}</span>, <span class="hljs-subst inline">${<span class="hljs-built_in inline">Math</span>.max(accentS + <span class="hljs-number inline">5</span>, <span class="hljs-number inline">35</span>)}</span>%, 20%))`</span>,
        <span class="hljs-attr inline">particle</span>: <span class="hljs-string inline">`hsl(<span class="hljs-subst inline">${primaryH}</span>, <span class="hljs-subst inline">${<span class="hljs-built_in inline">Math</span>.max(primaryS + <span class="hljs-number inline">15</span>, <span class="hljs-number inline">50</span>)}</span>%, 45%)`</span>
      };
    } <span class="hljs-keyword inline">else</span> {
      <span class="hljs-comment inline">// 浅色主题：降低饱和度，提高明度</span>
      <span class="hljs-keyword inline">return</span> {
        <span class="hljs-attr inline">background</span>: <span class="hljs-string inline">`linear-gradient(135deg, hsl(<span class="hljs-subst inline">${primaryH}</span>, <span class="hljs-subst inline">${<span class="hljs-built_in inline">Math</span>.max(primaryS - <span class="hljs-number inline">20</span>, <span class="hljs-number inline">20</span>)}</span>%, 60%), hsl(<span class="hljs-subst inline">${accentH}</span>, <span class="hljs-subst inline">${<span class="hljs-built_in inline">Math</span>.max(accentS - <span class="hljs-number inline">10</span>, <span class="hljs-number inline">30</span>)}</span>%, 50%))`</span>,
        <span class="hljs-attr inline">particle</span>: <span class="hljs-string inline">`hsl(<span class="hljs-subst inline">${primaryH}</span>, <span class="hljs-subst inline">${<span class="hljs-built_in inline">Math</span>.max(primaryS - <span class="hljs-number inline">10</span>, <span class="hljs-number inline">35</span>)}</span>%, 75%)`</span>
      };
    }
  }, [currentTheme, hexToHsl]);

  <span class="hljs-comment inline">// ==================== 鼠标和触摸事件处理 ====================</span>
  <span class="hljs-comment inline">/**
   * 更新鼠标位置
   * 兼容鼠标事件和触摸事件
   */</span>
  <span class="hljs-keyword inline">const</span> updateMousePos = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">e</span>: <span class="hljs-title class_ inline">MouseEvent</span> | <span class="hljs-title class_ inline">Touch</span></span>) =&gt;</span> {
    mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">x</span> = e.<span class="hljs-property inline">clientX</span>;
    mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">y</span> = e.<span class="hljs-property inline">clientY</span>;
  }, []);

  <span class="hljs-comment inline">/**
   * 鼠标按下事件处理
   * 激活交互力场
   */</span>
  <span class="hljs-keyword inline">const</span> handleMouseDown = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">e</span>: <span class="hljs-title class_ inline">MouseEvent</span></span>) =&gt;</span> {
    mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span> = <span class="hljs-literal inline">true</span>;
    <span class="hljs-title function_ inline">updateMousePos</span>(e);
  }, [updateMousePos]);

  <span class="hljs-comment inline">/**
   * 鼠标释放事件处理
   * 关闭交互力场
   */</span>
  <span class="hljs-keyword inline">const</span> handleMouseUp = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">() =&gt;</span> {
    mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span> = <span class="hljs-literal inline">false</span>;
  }, []);

  <span class="hljs-comment inline">/**
   * 鼠标移动事件处理
   * 只有在按下状态才更新位置，减少不必要的计算
   */</span>
  <span class="hljs-keyword inline">const</span> handleMouseMove = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">e</span>: <span class="hljs-title class_ inline">MouseEvent</span></span>) =&gt;</span> {
    <span class="hljs-keyword inline">if</span> (mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span>) <span class="hljs-title function_ inline">updateMousePos</span>(e);
  }, [updateMousePos]);

  <span class="hljs-comment inline">/**
   * 触摸开始事件处理
   * 移动设备的交互支持
   */</span>
  <span class="hljs-keyword inline">const</span> handleTouchStart = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">e</span>: <span class="hljs-title class_ inline">TouchEvent</span></span>) =&gt;</span> {
    mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span> = <span class="hljs-literal inline">true</span>;
    <span class="hljs-title function_ inline">updateMousePos</span>(e.<span class="hljs-property inline">touches</span>[<span class="hljs-number inline">0</span>]);  <span class="hljs-comment inline">// 只取第一个触摸点</span>
  }, [updateMousePos]);

  <span class="hljs-comment inline">/**
   * 触摸结束事件处理
   */</span>
  <span class="hljs-keyword inline">const</span> handleTouchEnd = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">() =&gt;</span> {
    mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span> = <span class="hljs-literal inline">false</span>;
  }, []);

  <span class="hljs-comment inline">/**
   * 触摸移动事件处理
   */</span>
  <span class="hljs-keyword inline">const</span> handleTouchMove = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">e</span>: <span class="hljs-title class_ inline">TouchEvent</span></span>) =&gt;</span> {
    <span class="hljs-keyword inline">if</span> (mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span>) <span class="hljs-title function_ inline">updateMousePos</span>(e.<span class="hljs-property inline">touches</span>[<span class="hljs-number inline">0</span>]);
  }, [updateMousePos]);

  <span class="hljs-comment inline">// ==================== 粒子系统核心 ====================</span>
  <span class="hljs-comment inline">/**
   * 初始化粒子系统
   * 创建指定数量的粒子并分布在屏幕上
   */</span>
  <span class="hljs-keyword inline">const</span> initializeParticles = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-keyword inline">const</span> container = containerRef.<span class="hljs-property inline">current</span>;
    <span class="hljs-keyword inline">if</span> (!container) <span class="hljs-keyword inline">return</span>;

    <span class="hljs-comment inline">// 清理现有粒子，防止内存泄漏</span>
    particlesRef.<span class="hljs-property inline">current</span>.<span class="hljs-title function_ inline">forEach</span>(<span class="hljs-function inline"><span class="hljs-params inline">p</span> =&gt;</span> p.<span class="hljs-property inline">el</span>.<span class="hljs-title function_ inline">remove</span>());
    particlesRef.<span class="hljs-property inline">current</span> = [];

    <span class="hljs-keyword inline">const</span> width = <span class="hljs-variable language_ inline">window</span>.<span class="hljs-property inline">innerWidth</span>;
    <span class="hljs-keyword inline">const</span> height = <span class="hljs-variable language_ inline">window</span>.<span class="hljs-property inline">innerHeight</span>;
    <span class="hljs-keyword inline">const</span> colors = <span class="hljs-title function_ inline">getThemeColors</span>();

    <span class="hljs-comment inline">// 创建指定数量的粒子</span>
    <span class="hljs-keyword inline">for</span> (<span class="hljs-keyword inline">let</span> i = <span class="hljs-number inline">0</span>; i &lt; <span class="hljs-variable constant_ inline">NUM_PARTICLES</span>; i++) {
      <span class="hljs-comment inline">// 创建DOM元素</span>
      <span class="hljs-keyword inline">const</span> el = <span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">createElement</span>(<span class="hljs-string inline">&#x27;div&#x27;</span>);
      el.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">position</span> = <span class="hljs-string inline">&#x27;absolute&#x27;</span>;           <span class="hljs-comment inline">// 绝对定位，脱离文档流</span>
      el.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">borderRadius</span> = <span class="hljs-string inline">&#x27;50%&#x27;</span>;            <span class="hljs-comment inline">// 圆形粒子</span>
      el.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">backgroundColor</span> = colors.<span class="hljs-property inline">particle</span>; <span class="hljs-comment inline">// 主题色</span>
      el.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">pointerEvents</span> = <span class="hljs-string inline">&#x27;none&#x27;</span>;          <span class="hljs-comment inline">// 不响应鼠标事件</span>
      el.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">willChange</span> = <span class="hljs-string inline">&#x27;transform, opacity&#x27;</span>; <span class="hljs-comment inline">// 提示浏览器优化</span>
      
      container.<span class="hljs-title function_ inline">appendChild</span>(el);

      <span class="hljs-comment inline">// 随机大小（2-6px）</span>
      <span class="hljs-keyword inline">const</span> size = <span class="hljs-number inline">2</span> + <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">random</span>() * <span class="hljs-number inline">4</span>;
      el.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">width</span> = <span class="hljs-string inline">`<span class="hljs-subst inline">${size}</span>px`</span>;
      el.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">height</span> = <span class="hljs-string inline">`<span class="hljs-subst inline">${size}</span>px`</span>;

      <span class="hljs-comment inline">// 随机深度和位置</span>
      <span class="hljs-keyword inline">const</span> depth = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">random</span>();              <span class="hljs-comment inline">// 0-1的深度值</span>
      <span class="hljs-keyword inline">const</span> x = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">random</span>() * width;          <span class="hljs-comment inline">// 随机X位置</span>
      <span class="hljs-keyword inline">const</span> y = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">random</span>() * height;         <span class="hljs-comment inline">// 随机Y位置</span>

      <span class="hljs-comment inline">// 创建粒子对象</span>
      particlesRef.<span class="hljs-property inline">current</span>.<span class="hljs-title function_ inline">push</span>({
        el,
        x, y,
        <span class="hljs-attr inline">vx</span>: <span class="hljs-number inline">0</span>, <span class="hljs-attr inline">vy</span>: <span class="hljs-number inline">0</span>,    <span class="hljs-comment inline">// 初始速度为0</span>
        size, depth
      });
    }
  }, [getThemeColors]);

  <span class="hljs-comment inline">/**
   * 动画循环函数
   * 这是整个粒子系统的心脏，每帧都会调用
   */</span>
  <span class="hljs-keyword inline">const</span> animate = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-keyword inline">const</span> mouse = mouseRef.<span class="hljs-property inline">current</span>;
    <span class="hljs-keyword inline">const</span> width = <span class="hljs-variable language_ inline">window</span>.<span class="hljs-property inline">innerWidth</span>;
    <span class="hljs-keyword inline">const</span> height = <span class="hljs-variable language_ inline">window</span>.<span class="hljs-property inline">innerHeight</span>;

    <span class="hljs-comment inline">// 遍历所有粒子进行物理更新</span>
    <span class="hljs-keyword inline">for</span> (<span class="hljs-keyword inline">let</span> p <span class="hljs-keyword inline">of</span> particlesRef.<span class="hljs-property inline">current</span>) {
      <span class="hljs-comment inline">// ==================== 基础漂移力 ====================</span>
      <span class="hljs-comment inline">// 模拟自然的流体运动</span>
      p.<span class="hljs-property inline">vx</span> += <span class="hljs-number inline">0.01</span> * p.<span class="hljs-property inline">depth</span>;   <span class="hljs-comment inline">// X方向基础漂移</span>
      p.<span class="hljs-property inline">vy</span> += <span class="hljs-number inline">0.005</span> * p.<span class="hljs-property inline">depth</span>;  <span class="hljs-comment inline">// Y方向基础漂移（略小，模拟重力影响）</span>

      <span class="hljs-comment inline">// ==================== 交互力场计算 ====================</span>
      <span class="hljs-keyword inline">if</span> (mouse.<span class="hljs-property inline">down</span>) {
        <span class="hljs-comment inline">// 计算粒子到鼠标的向量</span>
        <span class="hljs-keyword inline">const</span> dx = p.<span class="hljs-property inline">x</span> - mouse.<span class="hljs-property inline">x</span>;
        <span class="hljs-keyword inline">const</span> dy = p.<span class="hljs-property inline">y</span> - mouse.<span class="hljs-property inline">y</span>;
        <span class="hljs-comment inline">// 计算距离（欧几里得距离）</span>
        <span class="hljs-keyword inline">const</span> dist = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">sqrt</span>(dx * dx + dy * dy);

        <span class="hljs-comment inline">// 在影响范围内施加排斥力</span>
        <span class="hljs-keyword inline">if</span> (dist &lt; <span class="hljs-number inline">100</span>) {
          <span class="hljs-comment inline">// 反平方力场：距离越近，力越大</span>
          <span class="hljs-keyword inline">const</span> baseForce = <span class="hljs-number inline">100</span> / (dist + <span class="hljs-number inline">10</span>);  <span class="hljs-comment inline">// +10避免除零错误</span>
          <span class="hljs-keyword inline">const</span> force = baseForce * p.<span class="hljs-property inline">depth</span>;     <span class="hljs-comment inline">// 深度影响力的大小</span>

          <span class="hljs-comment inline">// 计算力的方向（单位向量）并应用</span>
          p.<span class="hljs-property inline">vx</span> += force * (dx / dist);  <span class="hljs-comment inline">// X方向分力</span>
          p.<span class="hljs-property inline">vy</span> += force * (dy / dist);  <span class="hljs-comment inline">// Y方向分力</span>
        }
      }

      <span class="hljs-comment inline">// ==================== 物理系统 ====================</span>
      <span class="hljs-comment inline">// 应用摩擦力（空气阻力）</span>
      p.<span class="hljs-property inline">vx</span> *= <span class="hljs-number inline">0.95</span>;  <span class="hljs-comment inline">// X方向摩擦</span>
      p.<span class="hljs-property inline">vy</span> *= <span class="hljs-number inline">0.95</span>;  <span class="hljs-comment inline">// Y方向摩擦</span>

      <span class="hljs-comment inline">// 更新位置</span>
      p.<span class="hljs-property inline">x</span> += p.<span class="hljs-property inline">vx</span>;
      p.<span class="hljs-property inline">y</span> += p.<span class="hljs-property inline">vy</span>;

      <span class="hljs-comment inline">// ==================== 边界处理 ====================</span>
      <span class="hljs-comment inline">// 环绕边界：粒子从一边出去，从另一边进来</span>
      <span class="hljs-keyword inline">if</span> (p.<span class="hljs-property inline">x</span> &lt; -<span class="hljs-number inline">10</span>) p.<span class="hljs-property inline">x</span> = width + <span class="hljs-number inline">10</span>;    <span class="hljs-comment inline">// 左边界 → 右边界</span>
      <span class="hljs-keyword inline">if</span> (p.<span class="hljs-property inline">x</span> &gt; width + <span class="hljs-number inline">10</span>) p.<span class="hljs-property inline">x</span> = -<span class="hljs-number inline">10</span>;    <span class="hljs-comment inline">// 右边界 → 左边界</span>
      <span class="hljs-keyword inline">if</span> (p.<span class="hljs-property inline">y</span> &lt; -<span class="hljs-number inline">10</span>) p.<span class="hljs-property inline">y</span> = height + <span class="hljs-number inline">10</span>;   <span class="hljs-comment inline">// 上边界 → 下边界</span>
      <span class="hljs-keyword inline">if</span> (p.<span class="hljs-property inline">y</span> &gt; height + <span class="hljs-number inline">10</span>) p.<span class="hljs-property inline">y</span> = -<span class="hljs-number inline">10</span>;   <span class="hljs-comment inline">// 下边界 → 上边界</span>

      <span class="hljs-comment inline">// ==================== 视觉效果更新 ====================</span>
      <span class="hljs-comment inline">// 基于深度的视觉层次</span>
      <span class="hljs-keyword inline">const</span> scale = <span class="hljs-number inline">0.6</span> + <span class="hljs-number inline">0.4</span> * p.<span class="hljs-property inline">depth</span>;    <span class="hljs-comment inline">// 缩放：0.6-1.0</span>
      <span class="hljs-keyword inline">const</span> opacity = <span class="hljs-number inline">0.4</span> + <span class="hljs-number inline">0.6</span> * p.<span class="hljs-property inline">depth</span>;  <span class="hljs-comment inline">// 透明度：0.4-1.0</span>

      <span class="hljs-comment inline">// 应用变换（使用transform优化性能）</span>
      p.<span class="hljs-property inline">el</span>.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">transform</span> = <span class="hljs-string inline">`translate(<span class="hljs-subst inline">${p.x}</span>px, <span class="hljs-subst inline">${p.y}</span>px) scale(<span class="hljs-subst inline">${scale}</span>)`</span>;
      p.<span class="hljs-property inline">el</span>.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">opacity</span> = opacity.<span class="hljs-title function_ inline">toString</span>();
    }

    <span class="hljs-comment inline">// 请求下一帧动画</span>
    animationIdRef.<span class="hljs-property inline">current</span> = <span class="hljs-title function_ inline">requestAnimationFrame</span>(animate);
  }, []);

  <span class="hljs-comment inline">/**
   * 窗口大小改变处理
   * 重新初始化粒子分布
   */</span>
  <span class="hljs-keyword inline">const</span> handleResize = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-comment inline">// 重新初始化粒子分布以适应新的窗口尺寸</span>
    <span class="hljs-title function_ inline">initializeParticles</span>();
  }, [initializeParticles]);

  <span class="hljs-comment inline">/**
   * 防抖版本的resize处理器
   * 避免窗口拖拽时频繁重建粒子
   */</span>
  <span class="hljs-keyword inline">const</span> debouncedHandleResize = <span class="hljs-title function_ inline">useCallback</span>(
    <span class="hljs-title function_ inline">debounce</span>(handleResize, <span class="hljs-number inline">1000</span>),  <span class="hljs-comment inline">// 1秒防抖延迟</span>
    [debounce, handleResize]
  );

  <span class="hljs-comment inline">// ==================== 生命周期管理 ====================</span>
  <span class="hljs-comment inline">/**
   * 组件挂载和清理效果
   * 管理事件监听器和动画生命周期
   */</span>
  <span class="hljs-title function_ inline">useEffect</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-comment inline">// 初始化粒子</span>
    <span class="hljs-title function_ inline">initializeParticles</span>();

    <span class="hljs-comment inline">// ==================== 事件监听器注册 ====================</span>
    <span class="hljs-comment inline">// 全局鼠标事件（确保拖拽时即使离开容器也能继续）</span>
    <span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;mousedown&#x27;</span>, handleMouseDown);
    <span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;mouseup&#x27;</span>, handleMouseUp);
    <span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;mousemove&#x27;</span>, handleMouseMove);
    
    <span class="hljs-comment inline">// 容器触摸事件（移动设备支持）</span>
    <span class="hljs-keyword inline">const</span> container = containerRef.<span class="hljs-property inline">current</span>;
    <span class="hljs-keyword inline">if</span> (container) {
      container.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;touchstart&#x27;</span>, handleTouchStart);
      container.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;touchend&#x27;</span>, handleTouchEnd);
      container.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;touchmove&#x27;</span>, handleTouchMove);
    }

    <span class="hljs-comment inline">// 窗口resize事件</span>
    <span class="hljs-variable language_ inline">window</span>.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;resize&#x27;</span>, debouncedHandleResize);

    <span class="hljs-comment inline">// 启动动画循环</span>
    <span class="hljs-title function_ inline">animate</span>();

    <span class="hljs-comment inline">// ==================== 清理函数 ====================</span>
    <span class="hljs-keyword inline">return</span> <span class="hljs-function inline">() =&gt;</span> {
      <span class="hljs-comment inline">// 移除事件监听器</span>
      <span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">removeEventListener</span>(<span class="hljs-string inline">&#x27;mousedown&#x27;</span>, handleMouseDown);
      <span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">removeEventListener</span>(<span class="hljs-string inline">&#x27;mouseup&#x27;</span>, handleMouseUp);
      <span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">removeEventListener</span>(<span class="hljs-string inline">&#x27;mousemove&#x27;</span>, handleMouseMove);
      
      <span class="hljs-keyword inline">if</span> (container) {
        container.<span class="hljs-title function_ inline">removeEventListener</span>(<span class="hljs-string inline">&#x27;touchstart&#x27;</span>, handleTouchStart);
        container.<span class="hljs-title function_ inline">removeEventListener</span>(<span class="hljs-string inline">&#x27;touchend&#x27;</span>, handleTouchEnd);
        container.<span class="hljs-title function_ inline">removeEventListener</span>(<span class="hljs-string inline">&#x27;touchmove&#x27;</span>, handleTouchMove);
      }

      <span class="hljs-variable language_ inline">window</span>.<span class="hljs-title function_ inline">removeEventListener</span>(<span class="hljs-string inline">&#x27;resize&#x27;</span>, debouncedHandleResize);

      <span class="hljs-comment inline">// 取消动画循环</span>
      <span class="hljs-keyword inline">if</span> (animationIdRef.<span class="hljs-property inline">current</span> !== <span class="hljs-literal inline">null</span>) {
        <span class="hljs-title function_ inline">cancelAnimationFrame</span>(animationIdRef.<span class="hljs-property inline">current</span>);
      }

      <span class="hljs-comment inline">// 清理所有粒子DOM元素</span>
      particlesRef.<span class="hljs-property inline">current</span>.<span class="hljs-title function_ inline">forEach</span>(<span class="hljs-function inline"><span class="hljs-params inline">p</span> =&gt;</span> p.<span class="hljs-property inline">el</span>.<span class="hljs-title function_ inline">remove</span>());
    };
  }, [animate, handleMouseDown, handleMouseUp, handleMouseMove, handleTouchStart, handleTouchEnd, handleTouchMove, debouncedHandleResize, initializeParticles]);

  <span class="hljs-comment inline">/**
   * 主题变化响应
   * 当主题切换时，动态更新所有粒子的颜色
   */</span>
  <span class="hljs-title function_ inline">useEffect</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-keyword inline">if</span> (particlesRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">length</span> &gt; <span class="hljs-number inline">0</span>) {
      <span class="hljs-keyword inline">const</span> colors = <span class="hljs-title function_ inline">getThemeColors</span>();
      
      <span class="hljs-comment inline">// 更新所有粒子的颜色</span>
      particlesRef.<span class="hljs-property inline">current</span>.<span class="hljs-title function_ inline">forEach</span>(<span class="hljs-function inline"><span class="hljs-params inline">p</span> =&gt;</span> {
        p.<span class="hljs-property inline">el</span>.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">backgroundColor</span> = colors.<span class="hljs-property inline">particle</span>;
      });
      
      <span class="hljs-comment inline">// 更新容器背景渐变</span>
      <span class="hljs-keyword inline">if</span> (containerRef.<span class="hljs-property inline">current</span>) {
        containerRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">background</span> = colors.<span class="hljs-property inline">background</span>;
      }
    }
  }, [currentTheme, getThemeColors]);

  <span class="hljs-comment inline">// ==================== 渲染 ====================</span>
  <span class="hljs-keyword inline">const</span> colors = <span class="hljs-title function_ inline">getThemeColors</span>();

  <span class="hljs-keyword inline">return</span> (
    <span class="language-xml inline"><span class="hljs-tag inline">&lt;<span class="hljs-name inline">div</span>
      <span class="hljs-attr inline">ref</span>=<span class="hljs-string inline">{containerRef}</span>
      <span class="hljs-attr inline">className</span>=<span class="hljs-string inline">&quot;fixed inset-0 w-full h-full overflow-hidden pointer-events-none z-0&quot;</span>
      <span class="hljs-attr inline">style</span>=<span class="hljs-string inline">{{</span>
        <span class="hljs-attr inline">background:</span> <span class="hljs-attr inline">colors.background</span>,
      }}
    /&gt;</span></span>
  );
};

<span class="hljs-keyword inline">export</span> <span class="hljs-keyword inline">default</span> <span class="hljs-title class_ inline">FoamBackground</span>;
</code></pre>
            </div>
        
<h3 id="核心算法流程图" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#核心算法流程图" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 核心算法流程图">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            核心算法流程图
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="" data-code="%E7%B2%92%E5%AD%90%E5%88%9D%E5%A7%8B%E5%8C%96%20%E2%86%92%20%E5%8A%A8%E7%94%BB%E5%BE%AA%E7%8E%AF%E5%90%AF%E5%8A%A8%20%E2%86%92%20%E6%AF%8F%E5%B8%A7%E7%89%A9%E7%90%86%E6%9B%B4%E6%96%B0%20%E2%86%92%20%E8%A7%86%E8%A7%89%E6%95%88%E6%9E%9C%E5%BA%94%E7%94%A8%20%E2%86%92%20%E4%B8%8B%E4%B8%80%E5%B8%A7%0A%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%20%20%20%20%20%20%20%20%20%20%E2%86%93%0A%E5%88%9B%E5%BB%BA300%E4%B8%AA%20%20%20%20%20%20%20requestAF%20%20%20%20%20%E5%9F%BA%E7%A1%80%E6%BC%82%E7%A7%BB%E5%8A%9B%20%20%20%20%20%20%E7%BC%A9%E6%94%BE%2F%E9%80%8F%E6%98%8E%E5%BA%A6%20%20%20%E5%BE%AA%E7%8E%AF%E7%BB%A7%E7%BB%AD%0A%E9%9A%8F%E6%9C%BA%E5%88%86%E5%B8%83%E7%B2%92%E5%AD%90%20%20%20%20%20%E8%B0%83%E7%94%A8animate%20%20%20%E4%BA%A4%E4%BA%92%E5%8A%9B%E5%9C%BA%E8%AE%A1%E7%AE%97%20%20%20%20depth%E5%8A%A0%E6%9D%83%20%20%20%20%2060fps%0A%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%20%20%20%20%20%20%20%20%20%20%E2%86%93%0ADOM%E5%85%83%E7%B4%A0%E5%88%9B%E5%BB%BA%20%20%20%20%20%20%E9%BC%A0%E6%A0%87%E7%8A%B6%E6%80%81%E6%A3%80%E6%B5%8B%20%20%20%E6%91%A9%E6%93%A6%E5%8A%9B%E5%BA%94%E7%94%A8%20%20%20%20%20%20transform%20%20%20%20%20%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%0A%E6%A0%B7%E5%BC%8F%E8%AE%BE%E7%BD%AE%20%20%20%20%20%20%20%20%E8%B7%9D%E7%A6%BB%E8%AE%A1%E7%AE%97%20%20%20%20%20%20%20%E4%BD%8D%E7%BD%AE%E6%9B%B4%E6%96%B0%20%20%20%20%20%20%20%20%E6%9B%B4%E6%96%B0DOM%20%20%20%20%20%20%E4%BA%8B%E4%BB%B6%E6%B8%85%E7%90%86">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">code</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code>粒子初始化 → 动画循环启动 → 每帧物理更新 → 视觉效果应用 → 下一帧
     ↓             ↓             ↓             ↓          ↓
  创建<span class="hljs-number inline">300</span>个       requestAF     基础漂移力      缩放/透明度   循环继续
  随机分布粒子     调用animate   交互力场计算    <span class="hljs-variable language_ inline">depth</span>加权     <span class="hljs-number inline">60</span><span class="hljs-variable language_ inline">fps</span>
     ↓             ↓             ↓             ↓          ↓
  DOM元素创建      鼠标状态检测   摩擦力应用      transform     性能优化
  样式设置        距离计算       位置更新        更新DOM      事件清理
</code></pre>
            </div>
        
<h3 id="关键算法解析" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#关键算法解析" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 关键算法解析">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            关键算法解析
        </h3>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">1. 力场物理计算</strong></p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20%E5%85%B3%E9%94%AE%EF%BC%9A%E5%8F%8D%E5%B9%B3%E6%96%B9%E5%8A%9B%E5%9C%BA%20%2B%20%E6%B7%B1%E5%BA%A6%E5%8A%A0%E6%9D%83%0Aconst%20dx%20%3D%20p.x%20-%20mouse.x%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E8%AE%A1%E7%AE%97X%E6%96%B9%E5%90%91%E8%B7%9D%E7%A6%BB%0Aconst%20dy%20%3D%20p.y%20-%20mouse.y%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E8%AE%A1%E7%AE%97Y%E6%96%B9%E5%90%91%E8%B7%9D%E7%A6%BB%0Aconst%20dist%20%3D%20Math.sqrt(dx%20*%20dx%20%2B%20dy%20*%20dy)%3B%20%20%20%2F%2F%20%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E8%B7%9D%E7%A6%BB%0Aconst%20baseForce%20%3D%20100%20%2F%20(dist%20%2B%2010)%3B%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%8F%8D%E5%B9%B3%E6%96%B9%E8%A1%B0%E5%87%8F%0Aconst%20force%20%3D%20baseForce%20*%20p.depth%3B%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E6%B7%B1%E5%BA%A6%E5%BD%B1%E5%93%8D%E5%8A%9B%E5%A4%A7%E5%B0%8F%0Ap.vx%20%2B%3D%20force%20*%20(dx%20%2F%20dist)%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%BA%94%E7%94%A8%E5%8D%95%E4%BD%8D%E5%90%91%E9%87%8F%E5%8A%9B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// 关键：反平方力场 + 深度加权</span>
<span class="hljs-keyword inline">const</span> dx = p.<span class="hljs-property inline">x</span> - mouse.<span class="hljs-property inline">x</span>;                    <span class="hljs-comment inline">// 计算X方向距离</span>
<span class="hljs-keyword inline">const</span> dy = p.<span class="hljs-property inline">y</span> - mouse.<span class="hljs-property inline">y</span>;                    <span class="hljs-comment inline">// 计算Y方向距离</span>
<span class="hljs-keyword inline">const</span> dist = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">sqrt</span>(dx * dx + dy * dy);   <span class="hljs-comment inline">// 欧几里得距离</span>
<span class="hljs-keyword inline">const</span> baseForce = <span class="hljs-number inline">100</span> / (dist + <span class="hljs-number inline">10</span>);         <span class="hljs-comment inline">// 反平方衰减</span>
<span class="hljs-keyword inline">const</span> force = baseForce * p.<span class="hljs-property inline">depth</span>;           <span class="hljs-comment inline">// 深度影响力大小</span>
p.<span class="hljs-property inline">vx</span> += force * (dx / dist);                 <span class="hljs-comment inline">// 应用单位向量力</span>
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">2. HSL颜色空间转换</strong></p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20%E5%85%B3%E9%94%AE%EF%BC%9ARGB%E5%88%B0HSL%E7%9A%84%E6%95%B0%E5%AD%A6%E5%8F%98%E6%8D%A2%0Aconst%20max%20%3D%20Math.max(r%2C%20g%2C%20b)%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E6%89%BE%E5%88%B0%E6%9C%80%E5%A4%A7%E5%80%BC%0Aconst%20min%20%3D%20Math.min(r%2C%20g%2C%20b)%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E6%89%BE%E5%88%B0%E6%9C%80%E5%B0%8F%E5%80%BC%0Alet%20l%20%3D%20(max%20%2B%20min)%20%2F%202%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E6%98%8E%E5%BA%A6%EF%BC%9A%E6%9C%80%E5%A4%A7%E6%9C%80%E5%B0%8F%E5%80%BC%E5%B9%B3%E5%9D%87%0Alet%20s%20%3D%20l%20%3E%200.5%20%3F%20d%20%2F%20(2%20-%20max%20-%20min)%20%3A%20d%20%2F%20(max%20%2B%20min)%3B%20%2F%2F%20%E9%A5%B1%E5%92%8C%E5%BA%A6%E8%AE%A1%E7%AE%97%0A%2F%2F%20%E8%89%B2%E7%9B%B8%E6%A0%B9%E6%8D%AE%E4%B8%BB%E5%AF%BC%E9%A2%9C%E8%89%B2%E8%AE%A1%E7%AE%97">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// 关键：RGB到HSL的数学变换</span>
<span class="hljs-keyword inline">const</span> max = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">max</span>(r, g, b);              <span class="hljs-comment inline">// 找到最大值</span>
<span class="hljs-keyword inline">const</span> min = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">min</span>(r, g, b);              <span class="hljs-comment inline">// 找到最小值</span>
<span class="hljs-keyword inline">let</span> l = (max + min) / <span class="hljs-number inline">2</span>;                    <span class="hljs-comment inline">// 明度：最大最小值平均</span>
<span class="hljs-keyword inline">let</span> s = l &gt; <span class="hljs-number inline">0.5</span> ? d / (<span class="hljs-number inline">2</span> - max - min) : d / (max + min); <span class="hljs-comment inline">// 饱和度计算</span>
<span class="hljs-comment inline">// 色相根据主导颜色计算</span>
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">3. 深度视觉效果</strong></p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20%E5%85%B3%E9%94%AE%EF%BC%9A%E7%BA%BF%E6%80%A7%E6%8F%92%E5%80%BC%E5%88%9B%E5%BB%BA%E5%B1%82%E6%AC%A1%E6%84%9F%0Aconst%20scale%20%3D%200.6%20%2B%200.4%20*%20p.depth%3B%20%20%20%20%20%20%20%20%20%2F%2F%20%E7%BC%A9%E6%94%BE%EF%BC%9A0.6-1.0%0Aconst%20opacity%20%3D%200.4%20%2B%200.6%20*%20p.depth%3B%20%20%20%20%20%20%20%2F%2F%20%E9%80%8F%E6%98%8E%E5%BA%A6%EF%BC%9A0.4-1.0%0Ap.vx%20%2B%3D%200.01%20*%20p.depth%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E9%80%9F%E5%BA%A6%EF%BC%9A%E6%B7%B1%E5%BA%A6%E8%B6%8A%E5%A4%A7%E8%B6%8A%E5%BF%AB%0Aconst%20force%20%3D%20baseForce%20*%20p.depth%3B%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%BA%A4%E4%BA%92%EF%BC%9A%E6%B7%B1%E5%BA%A6%E8%B6%8A%E5%A4%A7%E5%8F%8D%E5%BA%94%E8%B6%8A%E5%BC%BA">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// 关键：线性插值创建层次感</span>
<span class="hljs-keyword inline">const</span> scale = <span class="hljs-number inline">0.6</span> + <span class="hljs-number inline">0.4</span> * p.<span class="hljs-property inline">depth</span>;         <span class="hljs-comment inline">// 缩放：0.6-1.0</span>
<span class="hljs-keyword inline">const</span> opacity = <span class="hljs-number inline">0.4</span> + <span class="hljs-number inline">0.6</span> * p.<span class="hljs-property inline">depth</span>;       <span class="hljs-comment inline">// 透明度：0.4-1.0</span>
p.<span class="hljs-property inline">vx</span> += <span class="hljs-number inline">0.01</span> * p.<span class="hljs-property inline">depth</span>;                     <span class="hljs-comment inline">// 速度：深度越大越快</span>
<span class="hljs-keyword inline">const</span> force = baseForce * p.<span class="hljs-property inline">depth</span>;          <span class="hljs-comment inline">// 交互：深度越大反应越强</span>
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">4. 边界环绕算法</strong></p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20%E5%85%B3%E9%94%AE%EF%BC%9A%E5%B9%B3%E6%BB%91%E7%9A%84%E8%BE%B9%E7%95%8C%E8%BF%87%E6%B8%A1%0Aif%20(p.x%2010)%20p.x%20%3D%20width%20%2B%2010%3B%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%B7%A6%E5%87%BA%E5%8F%B3%E8%BF%9B%EF%BC%8C10px%E7%BC%93%E5%86%B2%0Aif%20(p.x%20%3E%20width%20%2B%2010)%20p.x%20%3D%20-10%3B%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%8F%B3%E5%87%BA%E5%B7%A6%E8%BF%9B%0Aif%20(p.y%2010)%20p.y%20%3D%20height%20%2B%2010%3B%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%B8%8A%E5%87%BA%E4%B8%8B%E8%BF%9B%0Aif%20(p.y%20%3E%20height%20%2B%2010)%20p.y%20%3D%20-10%3B%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%B8%8B%E5%87%BA%E4%B8%8A%E8%BF%9B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// 关键：平滑的边界过渡</span>
<span class="hljs-keyword inline">if</span> (p.<span class="hljs-property inline">x</span> &lt; -<span class="hljs-number inline">10</span>) p.<span class="hljs-property inline">x</span> = width + <span class="hljs-number inline">10</span>;           <span class="hljs-comment inline">// 左出右进，10px缓冲</span>
<span class="hljs-keyword inline">if</span> (p.<span class="hljs-property inline">x</span> &gt; width + <span class="hljs-number inline">10</span>) p.<span class="hljs-property inline">x</span> = -<span class="hljs-number inline">10</span>;           <span class="hljs-comment inline">// 右出左进</span>
<span class="hljs-keyword inline">if</span> (p.<span class="hljs-property inline">y</span> &lt; -<span class="hljs-number inline">10</span>) p.<span class="hljs-property inline">y</span> = height + <span class="hljs-number inline">10</span>;          <span class="hljs-comment inline">// 上出下进</span>
<span class="hljs-keyword inline">if</span> (p.<span class="hljs-property inline">y</span> &gt; height + <span class="hljs-number inline">10</span>) p.<span class="hljs-property inline">y</span> = -<span class="hljs-number inline">10</span>;          <span class="hljs-comment inline">// 下出上进</span>
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">5. 防抖优化机制</strong></p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20%E5%85%B3%E9%94%AE%EF%BC%9A%E5%BB%B6%E8%BF%9F%E6%89%A7%E8%A1%8C%20%2B%20%E9%87%8D%E5%A4%8D%E5%8F%96%E6%B6%88%0Aconst%20debounce%20%3D%20(func%3A%20Function%2C%20wait%3A%20number)%20%3D%3E%20%7B%0Alet%20timeout%3A%20NodeJS.Timeout%3B%0Areturn%20(...args%3A%20any%5B%5D)%20%3D%3E%20%7B%0AclearTimeout(timeout)%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%8F%96%E6%B6%88%E4%B9%8B%E5%89%8D%E7%9A%84%E5%AE%9A%E6%97%B6%E5%99%A8%0Atimeout%20%3D%20setTimeout(()%20%3D%3E%20func(...args)%2C%20wait)%3B%20%2F%2F%20%E9%87%8D%E6%96%B0%E8%AE%A1%E6%97%B6%0A%7D%3B%0A%7D%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// 关键：延迟执行 + 重复取消</span>
<span class="hljs-keyword inline">const</span> <span class="hljs-title function_ inline">debounce</span> = (<span class="hljs-params inline"><span class="hljs-attr inline">func</span>: <span class="hljs-title class_ inline">Function</span>, <span class="hljs-attr inline">wait</span>: <span class="hljs-built_in inline">number</span></span>) =&gt; {
    <span class="hljs-keyword inline">let</span> <span class="hljs-attr inline">timeout</span>: <span class="hljs-title class_ inline">NodeJS</span>.<span class="hljs-property inline">Timeout</span>;
    <span class="hljs-keyword inline">return</span> <span class="hljs-function inline">(<span class="hljs-params inline">...<span class="hljs-attr inline">args</span>: <span class="hljs-built_in inline">any</span>[]</span>) =&gt;</span> {
        <span class="hljs-built_in inline">clearTimeout</span>(timeout);               <span class="hljs-comment inline">// 取消之前的定时器</span>
        timeout = <span class="hljs-built_in inline">setTimeout</span>(<span class="hljs-function inline">() =&gt;</span> <span class="hljs-title function_ inline">func</span>(...args), wait); <span class="hljs-comment inline">// 重新计时</span>
    };
};
</code></pre>
            </div>
        
<h2 id="实现回顾" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#实现回顾" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 实现回顾">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            实现回顾
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">通过这次深入的技术剖析，我们看到了一个看似简单的&quot;泡沫背景&quot;背后隐藏的复杂世界。从Canvas思维到DOM实现的转换，从物理模拟到视觉效果，从性能优化到边界处理，每一个环节都需要精心设计和仔细调试。</p>
<p class="text-base leading-7 mb-4 text-foreground">选择DOM而不是Canvas可能看起来像是&quot;用大炮打蚊子&quot;，但这种选择带来了更好的可访问性、更容易的主题集成，以及更直观的事件处理。有时候，看起来&quot;笨&quot;的方法反而能开辟新的可能性。</p>
<p class="text-base leading-7 mb-4 text-foreground"><em class="italic text-foreground">愿你的粒子如星尘般闪耀，如泡沫般轻盈，在用户的指尖下翩翩起舞。</em> ✨</p>
</div></article><footer class="mt-16 pt-8 border-t border-foreground/20"><div class="flex items-center justify-between"><a class="inline-flex items-center px-4 py-2 bg-primary text-foreground rounded-lg hover:bg-primary/90 transition-colors" href="/MilkWind-Website/documents/">documents.backToDocuments</a><div class="text-sm text-foreground/60"><span>documents.byAuthor<!-- --> <!-- -->MilkWind</span></div></div></footer></div></div><!--$--><!--/$--><!--$--><!--/$--><!--/$--><!--/$--><script src="/MilkWind-Website/_next/static/chunks/webpack-3067cca20e80713b.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[38735,[\"46\",\"static/chunks/46-268e24d727b280ef.js\",\"7177\",\"static/chunks/app/layout-af4a6e723c0ff668.js\"],\"default\"]\n3:I[19945,[\"46\",\"static/chunks/46-268e24d727b280ef.js\",\"7177\",\"static/chunks/app/layout-af4a6e723c0ff668.js\"],\"default\"]\n4:I[65337,[\"46\",\"static/chunks/46-268e24d727b280ef.js\",\"7177\",\"static/chunks/app/layout-af4a6e723c0ff668.js\"],\"default\"]\n5:I[96190,[\"46\",\"static/chunks/46-268e24d727b280ef.js\",\"7177\",\"static/chunks/app/layout-af4a6e723c0ff668.js\"],\"ClientProviders\"]\n6:I[87555,[],\"\"]\n7:I[51901,[\"8039\",\"static/chunks/app/error-dda32be1d095a86c.js\"],\"default\"]\n8:I[31295,[],\"\"]\n9:I[6874,[\"6874\",\"static/chunks/6874-fbe9a08eb79b991c.js\",\"4345\",\"static/chunks/app/not-found-9ff98b2ccf24cac7.js\"],\"\"]\na:I[94970,[],\"ClientSegmentRoot\"]\nb:I[44065,[\"206\",\"static/chunks/206-4f4cbf4d7156f437.js\",\"3092\",\"static/chunks/app/documents/layout-28408791defde09e.js\"],\"default\"]\ne:I[59665,[],\"MetadataBoundary\"]\n10:I[59665,[],\"OutletBoundary\"]\n13:I[74911,[],\"AsyncMetadataOutlet\"]\n15:I[39460,[\"2415\",\"static/chunks/2415-689c103fb3d2c28d.js\",\"8610\",\"static/chunks/8610-7bd3f91f3cf2a4d6.js\",\"5650\",\"static/chunks/app/documents/loading-1fa3f98b6e5a8e78.js\"],\"default\"]\n16:I[88610,[\"2415\",\"static/chunks/2415-689c103fb3d2c28d.js\",\"8610\",\"static/chunks/8610-7bd3f91f3cf2a4d6.js\",\"4209\",\"static/chunks/app/loading-68f227fb49b3ac8c.js\"],\"default\"]\n17:I[59665,[],\"ViewportBoundary\"]\n19:I[26614,[],\"\"]\n:HL[\"/MilkWind-Website/_next/static/css/f034c804622acb16.css\",\"style\"]\n:HL[\"/MilkWind-Website/_next/static/css/276b387d8ca46690.css\",\"style\"]\n:HL[\"/MilkWind-Website/_next/static/css/5eacd01f773eed7f.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"ZB-xVo91GcWurycYUaga2\",\"p\":\"/MilkWind-Website\",\"c\":[\"\",\"documents\",\"zh\",\"dark\",\"personal-website\",\"foam-background\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"documents\",{\"children\":[[\"slug\",\"zh/dark/personal-website/foam-background\",\"c\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/MilkWind-Website/_next/static/css/f034c804622acb16.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/MilkWind-Website/_next/static/css/276b387d8ca46690.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"__variable_9b7fb1 __variable_ca2a15 __variable_591dcc font-sans antialiased min-h-screen bg-background text-foreground\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"$L2\",null,{}],[\"$\",\"$L3\",null,{}],[\"$\",\"$L4\",null,{}],[\"$\",\"$L5\",null,{\"children\":[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$7\",\"errorStyles\":[],\"errorScripts\":[],\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"div\",null,{\"className\":\"z-10 relative min-h-screen flex items-center justify-center bg-background p-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"text-center max-w-md\",\"children\":[[\"$\",\"div\",null,{\"className\":\"text-8xl font-bold text-primary mb-4\",\"children\":\"404\"}],[\"$\",\"h2\",null,{\"className\":\"text-2xl font-bold text-foreground mb-4\",\"children\":\"Page Not Found\"}],[\"$\",\"p\",null,{\"className\":\"text-foreground/70 mb-8\",\"children\":\"The page you're looking for doesn't exist or has been moved to a different location.\"}],[\"$\",\"div\",null,{\"className\":\"flex flex-col sm:flex-row gap-4 justify-center\",\"children\":[[\"$\",\"$L9\",null,{\"href\":\"/\",\"className\":\"px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary/80 transition-colors\",\"children\":\"Go Home\"}],[\"$\",\"$L9\",null,{\"href\":\"/works\",\"className\":\"px-6 py-2 border border-primary text-primary rounded-lg hover:bg-primary/10 transition-colors\",\"children\":\"View Works\"}]]}],[\"$\",\"div\",null,{\"className\":\"absolute inset-0 overflow-hidden pointer-events-none -z-10\",\"children\":[[\"$\",\"div\",null,{\"className\":\"absolute top-1/4 left-1/4 w-2 h-2 bg-primary/20 rounded-full animate-float\"}],[\"$\",\"div\",null,{\"className\":\"absolute top-3/4 right-1/4 w-3 h-3 bg-accent/20 rounded-full animate-float\",\"style\":{\"animationDelay\":\"1s\"}}],[\"$\",\"div\",null,{\"className\":\"absolute bottom-1/4 left-1/3 w-1 h-1 bg-secondary/20 rounded-full animate-float\",\"style\":{\"animationDelay\":\"2s\"}}]]}]]}]}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}]}]]}],{\"children\":[\"documents\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$La\",null,{\"Component\":\"$b\",\"slots\":{\"children\":[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]},\"params\":{},\"promise\":\"$@c\"}]]}],{\"children\":[[\"slug\",\"zh/dark/personal-website/foam-background\",\"c\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$Ld\",[\"$\",\"$Le\",null,{\"children\":\"$Lf\"}],[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/MilkWind-Website/_next/static/css/5eacd01f773eed7f.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L10\",null,{\"children\":[\"$L11\",\"$L12\",[\"$\",\"$L13\",null,{\"promise\":\"$@14\"}]]}]]}],{},null,false]},null,false]},[[\"$\",\"$L15\",\"l\",{}],[],[]],false]},[[\"$\",\"$L16\",\"l\",{}],[],[]],false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"UaPo3uaNt8Sz8yDWYVyRC\",{\"children\":[[\"$\",\"$L17\",null,{\"children\":\"$L18\"}],null]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$19\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"1a:\"$Sreact.suspense\"\n1b:I[74911,[],\"AsyncMetadata\"]\nc:{}\nf:[\"$\",\"$1a\",null,{\"fallback\":null,\"children\":[\"$\",\"$L1b\",null,{\"promise\":\"$@1c\"}]}]\n"])</script><script>self.__next_f.push([1,"1d:I[57340,[\"5584\",\"static/chunks/b498d07c-095637f0f10883c6.js\",\"2415\",\"static/chunks/2415-689c103fb3d2c28d.js\",\"6874\",\"static/chunks/6874-fbe9a08eb79b991c.js\",\"9554\",\"static/chunks/9554-b714f9de28e85d30.js\",\"1873\",\"static/chunks/app/documents/%5B...slug%5D/page-8f3efa7e6c6c5377.js\"],\"DocumentPageClient\"]\n1e:T3f41e,"])</script><script>self.__next_f.push([1,"\u003ch1 id=\"泡沫背景：从canvas思维到dom实现的粒子世界\" class=\"group relative text-4xl font-bold mt-8 mb-4 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#泡沫背景：从canvas思维到dom实现的粒子世界\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 泡沫背景：从Canvas思维到DOM实现的粒子世界\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            泡沫背景：从Canvas思维到DOM实现的粒子世界\n        \u003c/h1\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e序言——这是美观性计划的一部分。\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e在这篇文章中，我将从Canvas的思维模式开始，逐步展示如何用DOM + CSS的组合来创造出流畅的粒子动画效果，涵盖物理模拟、主题响应、性能优化等各个方面的实现细节。\u003c/p\u003e\n\u003ch2 id=\"canvas思维在dom世界的转译\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#canvas思维在dom世界的转译\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to Canvas思维在DOM世界的转译\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            Canvas思维在DOM世界的转译\n        \u003c/h2\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e开始之前，我们先聊聊为什么要\u0026quot;背叛\u0026quot;Canvas，投靠DOM的怀抱。\u003c/p\u003e\n\u003ch3 id=\"canvas-vs-dom：一场哲学选择\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#canvas-vs-dom：一场哲学选择\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to Canvas vs DOM：一场哲学选择\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            Canvas vs DOM：一场哲学选择\n        \u003c/h3\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e在Canvas的世界里，粒子系统的实现思路很直接：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"%2F%2F%20Canvas%E7%9A%84%E7%BB%8F%E5%85%B8%E5%A5%97%E8%B7%AF%0Afunction%20drawParticle(ctx%2C%20particle)%20%7B%0Actx.beginPath()%3B%0Actx.arc(particle.x%2C%20particle.y%2C%20particle.size%2C%200%2C%20Math.PI%20*%202)%3B%0Actx.fillStyle%20%3D%20particle.color%3B%0Actx.fill()%3B%0A%7D%0Afunction%20animateFrame()%20%7B%0Actx.clearRect(0%2C%200%2C%20canvas.width%2C%20canvas.height)%3B%0Aparticles.forEach(particle%20%3D%3E%20%7B%0AupdateParticle(particle)%3B%0AdrawParticle(ctx%2C%20particle)%3B%0A%7D)%3B%0ArequestAnimationFrame(animateFrame)%3B%0A%7D\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// Canvas的经典套路\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003edrawParticle\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003ectx, particle\u003c/span\u003e) {\n    ctx.\u003cspan class=\"hljs-title function_ inline\"\u003ebeginPath\u003c/span\u003e();\n    ctx.\u003cspan class=\"hljs-title function_ inline\"\u003earc\u003c/span\u003e(particle.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e, particle.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e, particle.\u003cspan class=\"hljs-property inline\"\u003esize\u003c/span\u003e, \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-title class_ inline\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003ePI\u003c/span\u003e * \u003cspan class=\"hljs-number inline\"\u003e2\u003c/span\u003e);\n    ctx.\u003cspan class=\"hljs-property inline\"\u003efillStyle\u003c/span\u003e = particle.\u003cspan class=\"hljs-property inline\"\u003ecolor\u003c/span\u003e;\n    ctx.\u003cspan class=\"hljs-title function_ inline\"\u003efill\u003c/span\u003e();\n}\n\n\u003cspan class=\"hljs-keyword inline\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003eanimateFrame\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003c/span\u003e) {\n    ctx.\u003cspan class=\"hljs-title function_ inline\"\u003eclearRect\u003c/span\u003e(\u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e, canvas.\u003cspan class=\"hljs-property inline\"\u003ewidth\u003c/span\u003e, canvas.\u003cspan class=\"hljs-property inline\"\u003eheight\u003c/span\u003e);\n    particles.\u003cspan class=\"hljs-title function_ inline\"\u003eforEach\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e\u003cspan class=\"hljs-params inline\"\u003eparticle\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n        \u003cspan class=\"hljs-title function_ inline\"\u003eupdateParticle\u003c/span\u003e(particle);\n        \u003cspan class=\"hljs-title function_ inline\"\u003edrawParticle\u003c/span\u003e(ctx, particle);\n    });\n    \u003cspan class=\"hljs-title function_ inline\"\u003erequestAnimationFrame\u003c/span\u003e(animateFrame);\n}\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e简洁明了，性能也不错。但我选择DOM的原因是：\u003c/p\u003e\n\u003col class=\"list-decimal list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e这是第一点\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e这是第二点\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e这是第三点\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e这是第四点\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e这是…\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e好吧不开玩笑了。实际上是：\u003c/p\u003e\n\u003col class=\"list-decimal list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e更好的可访问性\u003c/strong\u003e: DOM元素天生支持屏幕阅读器和其他辅助技术\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e更容易的主题集成\u003c/strong\u003e: CSS变量和主题系统无缝对接\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e更简单的事件处理\u003c/strong\u003e: 每个粒子都是真实的DOM元素，事件处理更直观\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003eGPU加速的transform\u003c/strong\u003e: CSS的transform属性会自动触发GPU加速\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e当然，代价就是复杂度的增加和一些性能上的权衡。\u003cdel class=\"line-through opacity-60\"\u003e（主要是AI一开始给我的就是DOM方案导致我在这条路上越走越深）\u003c/del\u003e\u003c/p\u003e\n\u003ch3 id=\"dom粒子的创建艺术\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#dom粒子的创建艺术\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to DOM粒子的创建艺术\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            DOM粒子的创建艺术\n        \u003c/h3\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e在DOM世界里，每个粒子都是一个真实的div元素：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"const%20el%20%3D%20document.createElement('div')%3B%0Ael.style.position%20%3D%20'absolute'%3B%0Ael.style.borderRadius%20%3D%20'50%25'%3B%0Ael.style.backgroundColor%20%3D%20colors.particle%3B%0Ael.style.pointerEvents%20%3D%20'none'%3B%0Ael.style.willChange%20%3D%20'transform%2C%20opacity'%3B%0Acontainer.appendChild(el)%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e el = \u003cspan class=\"hljs-variable language_ inline\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003ecreateElement\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;div\u0026#x27;\u003c/span\u003e);\nel.\u003cspan class=\"hljs-property inline\"\u003estyle\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eposition\u003c/span\u003e = \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;absolute\u0026#x27;\u003c/span\u003e;\nel.\u003cspan class=\"hljs-property inline\"\u003estyle\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eborderRadius\u003c/span\u003e = \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;50%\u0026#x27;\u003c/span\u003e;\nel.\u003cspan class=\"hljs-property inline\"\u003estyle\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003ebackgroundColor\u003c/span\u003e = colors.\u003cspan class=\"hljs-property inline\"\u003eparticle\u003c/span\u003e;\nel.\u003cspan class=\"hljs-property inline\"\u003estyle\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epointerEvents\u003c/span\u003e = \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;none\u0026#x27;\u003c/span\u003e;\nel.\u003cspan class=\"hljs-property inline\"\u003estyle\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003ewillChange\u003c/span\u003e = \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;transform, opacity\u0026#x27;\u003c/span\u003e;\n\ncontainer.\u003cspan class=\"hljs-title function_ inline\"\u003eappendChild\u003c/span\u003e(el);\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e属性解释：\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003eposition: absolute\u003c/strong\u003e: 让粒子脱离文档流，可以自由定位\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003eborderRadius: 50%\u003c/strong\u003e: 把方形div变成圆形，模拟泡沫的形状\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003epointerEvents: none\u003c/strong\u003e: 确保粒子不会干扰用户与页面的交互\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003ewillChange\u003c/strong\u003e: 提示浏览器这个元素会频繁变化，开启优化\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"坐标系统的映射关系\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#坐标系统的映射关系\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 坐标系统的映射关系\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            坐标系统的映射关系\n        \u003c/h3\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003eCanvas使用的是标准的笛卡尔坐标系，而DOM使用的是CSS坐标系。好在两者的映射关系很直接：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"%2F%2F%20Canvas%3A%20drawCircle(x%2C%20y%2C%20radius)%0A%2F%2F%20DOM%3A%20element.style.left%20%3D%20x%20%2B%20'px'%3B%20element.style.top%20%3D%20y%20%2B%20'px'%3B%0A%2F%2F%20%E6%88%91%E4%BB%AC%E7%9A%84%E5%AE%9E%E7%8E%B0%0Ap.el.style.transform%20%3D%20%60translate(%24%7Bp.x%7Dpx%2C%20%24%7Bp.y%7Dpx)%20scale(%24%7Bscale%7D)%60%3B%0Ap.el.style.opacity%20%3D%20opacity.toString()%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// Canvas: drawCircle(x, y, radius)\u003c/span\u003e\n\u003cspan class=\"hljs-comment inline\"\u003e// DOM: element.style.left = x + \u0026#x27;px\u0026#x27;; element.style.top = y + \u0026#x27;px\u0026#x27;;\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment inline\"\u003e// 我们的实现\u003c/span\u003e\np.\u003cspan class=\"hljs-property inline\"\u003eel\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003estyle\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003etransform\u003c/span\u003e = \u003cspan class=\"hljs-string inline\"\u003e`translate(\u003cspan class=\"hljs-subst inline\"\u003e${p.x}\u003c/span\u003epx, \u003cspan class=\"hljs-subst inline\"\u003e${p.y}\u003c/span\u003epx) scale(\u003cspan class=\"hljs-subst inline\"\u003e${scale}\u003c/span\u003e)`\u003c/span\u003e;\np.\u003cspan class=\"hljs-property inline\"\u003eel\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003estyle\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eopacity\u003c/span\u003e = opacity.\u003cspan class=\"hljs-title function_ inline\"\u003etoString\u003c/span\u003e();\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e使用\u003ccode\u003etransform\u003c/code\u003e而不是直接修改\u003ccode\u003eleft/top\u003c/code\u003e有个重要原因：\u003cstrong class=\"font-bold text-foreground\"\u003etransform不会触发重排\u003c/strong\u003e，只会触发重绘和合成，性能更好。\u003c/p\u003e\n\u003ch2 id=\"粒子的生命周期与数据架构\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#粒子的生命周期与数据架构\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 粒子的生命周期与数据架构\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            粒子的生命周期与数据架构\n        \u003c/h2\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e现在让我们深入粒子系统的核心——数据结构设计。\u003c/p\u003e\n\u003ch3 id=\"粒子接口设计\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#粒子接口设计\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 粒子接口设计\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            粒子接口设计\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"interface%20Particle%20%7B%0Ael%3A%20HTMLDivElement%3B%20%20%20%20%2F%2F%20DOM%E5%85%83%E7%B4%A0%E5%BC%95%E7%94%A8%0Ax%3A%20number%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20X%E5%9D%90%E6%A0%87%0Ay%3A%20number%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Y%E5%9D%90%E6%A0%87%0Avx%3A%20number%3B%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20X%E6%96%B9%E5%90%91%E9%80%9F%E5%BA%A6%0Avy%3A%20number%3B%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Y%E6%96%B9%E5%90%91%E9%80%9F%E5%BA%A6%0Asize%3A%20number%3B%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E7%B2%92%E5%AD%90%E5%A4%A7%E5%B0%8F%0Adepth%3A%20number%3B%20%20%20%20%20%20%20%20%20%2F%2F%20%E6%B7%B1%E5%BA%A6%E5%B1%82%E6%AC%A1(0-1)%0A%7D\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-keyword inline\"\u003einterface\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eParticle\u003c/span\u003e {\n  \u003cspan class=\"hljs-attr inline\"\u003eel\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eHTMLDivElement\u003c/span\u003e;    \u003cspan class=\"hljs-comment inline\"\u003e// DOM元素引用\u003c/span\u003e\n  \u003cspan class=\"hljs-attr inline\"\u003ex\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003enumber\u003c/span\u003e;             \u003cspan class=\"hljs-comment inline\"\u003e// X坐标\u003c/span\u003e\n  \u003cspan class=\"hljs-attr inline\"\u003ey\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003enumber\u003c/span\u003e;             \u003cspan class=\"hljs-comment inline\"\u003e// Y坐标  \u003c/span\u003e\n  \u003cspan class=\"hljs-attr inline\"\u003evx\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003enumber\u003c/span\u003e;            \u003cspan class=\"hljs-comment inline\"\u003e// X方向速度\u003c/span\u003e\n  \u003cspan class=\"hljs-attr inline\"\u003evy\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003enumber\u003c/span\u003e;            \u003cspan class=\"hljs-comment inline\"\u003e// Y方向速度\u003c/span\u003e\n  \u003cspan class=\"hljs-attr inline\"\u003esize\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003enumber\u003c/span\u003e;          \u003cspan class=\"hljs-comment inline\"\u003e// 粒子大小\u003c/span\u003e\n  \u003cspan class=\"hljs-attr inline\"\u003edepth\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003enumber\u003c/span\u003e;         \u003cspan class=\"hljs-comment inline\"\u003e// 深度层次(0-1)\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e字段解释：\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003eel\u003c/strong\u003e: 直接存储DOM元素引用，避免频繁的DOM查询\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003ex, y\u003c/strong\u003e: 当前的精确位置（可以是小数）\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003evx, vy\u003c/strong\u003e: 速度向量，用于模拟物理运动\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003esize\u003c/strong\u003e: 粒子的基础大小，会结合depth计算最终显示大小\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003edepth\u003c/strong\u003e: 这是视觉深度的关键，控制着粒子的大小、透明度和运动速度\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"粒子初始化的随机化策略\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#粒子初始化的随机化策略\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 粒子初始化的随机化策略\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            粒子初始化的随机化策略\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"const%20initializeParticles%20%3D%20useCallback(()%20%3D%3E%20%7B%0Aconst%20width%20%3D%20window.innerWidth%3B%0Aconst%20height%20%3D%20window.innerHeight%3B%0Aconst%20colors%20%3D%20getThemeColors()%3B%0Afor%20(let%20i%20%3D%200%3B%20i%20NUM_PARTICLES%3B%20i%2B%2B)%20%7B%0Aconst%20size%20%3D%202%20%2B%20Math.random()%20*%204%3B%20%20%20%20%20%20%2F%2F%202-6px%E7%9A%84%E9%9A%8F%E6%9C%BA%E5%A4%A7%E5%B0%8F%0Aconst%20depth%20%3D%20Math.random()%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%200-1%E7%9A%84%E9%9A%8F%E6%9C%BA%E6%B7%B1%E5%BA%A6%0Aconst%20x%20%3D%20Math.random()%20*%20width%3B%20%20%20%20%20%20%20%20%20%2F%2F%20%E9%9A%8F%E6%9C%BAX%E4%BD%8D%E7%BD%AE%0Aconst%20y%20%3D%20Math.random()%20*%20height%3B%20%20%20%20%20%20%20%20%2F%2F%20%E9%9A%8F%E6%9C%BAY%E4%BD%8D%E7%BD%AE%0Aconst%20particle%20%3D%20%7B%0Ael%2C%20x%2C%20y%2C%0Avx%3A%200%2C%20vy%3A%200%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%88%9D%E5%A7%8B%E9%80%9F%E5%BA%A6%E4%B8%BA0%0Asize%2C%20depth%0A%7D%3B%0AparticlesRef.current.push(particle)%3B%0A%7D%0A%7D%2C%20%5BgetThemeColors%5D)%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e initializeParticles = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e width = \u003cspan class=\"hljs-variable language_ inline\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003einnerWidth\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e height = \u003cspan class=\"hljs-variable language_ inline\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003einnerHeight\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e colors = \u003cspan class=\"hljs-title function_ inline\"\u003egetThemeColors\u003c/span\u003e();\n\n    \u003cspan class=\"hljs-keyword inline\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword inline\"\u003elet\u003c/span\u003e i = \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e; i \u0026lt; \u003cspan class=\"hljs-variable constant_ inline\"\u003eNUM_PARTICLES\u003c/span\u003e; i++) {\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e size = \u003cspan class=\"hljs-number inline\"\u003e2\u003c/span\u003e + \u003cspan class=\"hljs-title class_ inline\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003erandom\u003c/span\u003e() * \u003cspan class=\"hljs-number inline\"\u003e4\u003c/span\u003e;      \u003cspan class=\"hljs-comment inline\"\u003e// 2-6px的随机大小\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e depth = \u003cspan class=\"hljs-title class_ inline\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003erandom\u003c/span\u003e();             \u003cspan class=\"hljs-comment inline\"\u003e// 0-1的随机深度\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e x = \u003cspan class=\"hljs-title class_ inline\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003erandom\u003c/span\u003e() * width;         \u003cspan class=\"hljs-comment inline\"\u003e// 随机X位置\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e y = \u003cspan class=\"hljs-title class_ inline\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003erandom\u003c/span\u003e() * height;        \u003cspan class=\"hljs-comment inline\"\u003e// 随机Y位置\u003c/span\u003e\n\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e particle = {\n            el, x, y,\n            \u003cspan class=\"hljs-attr inline\"\u003evx\u003c/span\u003e: \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-attr inline\"\u003evy\u003c/span\u003e: \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e,                        \u003cspan class=\"hljs-comment inline\"\u003e// 初始速度为0\u003c/span\u003e\n            size, depth\n        };\n        \n        particlesRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003epush\u003c/span\u003e(particle);\n    }\n}, [getThemeColors]);\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e为什么初始速度为0\u003c/strong\u003e？让粒子从静止开始，只在受到外力（动画效果）时才运动，更符合物理直觉。\u003c/p\u003e\n\u003ch3 id=\"动画循环的时间精度控制\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#动画循环的时间精度控制\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 动画循环的时间精度控制\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            动画循环的时间精度控制\n        \u003c/h3\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e这是整个系统的心脏——动画循环：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"const%20animate%20%3D%20useCallback(()%20%3D%3E%20%7B%0Aconst%20mouse%20%3D%20mouseRef.current%3B%0Aconst%20width%20%3D%20window.innerWidth%3B%0Aconst%20height%20%3D%20window.innerHeight%3B%0Afor%20(let%20p%20of%20particlesRef.current)%20%7B%0A%2F%2F%20%E5%9F%BA%E7%A1%80%E6%BC%82%E7%A7%BB%EF%BC%88%E6%A8%A1%E6%8B%9F%E6%B5%81%E4%BD%93%E8%BF%90%E5%8A%A8%EF%BC%89%0Ap.vx%20%2B%3D%200.01%20*%20p.depth%3B%0Ap.vy%20%2B%3D%200.005%20*%20p.depth%3B%0A%2F%2F%20%E4%BA%A4%E4%BA%92%E5%8A%9B%E5%9C%BA%E8%AE%A1%E7%AE%97%0Aif%20(mouse.down)%20%7B%0Aconst%20dx%20%3D%20p.x%20-%20mouse.x%3B%0Aconst%20dy%20%3D%20p.y%20-%20mouse.y%3B%0Aconst%20dist%20%3D%20Math.sqrt(dx%20*%20dx%20%2B%20dy%20*%20dy)%3B%0Aif%20(dist%20100)%20%7B%0Aconst%20baseForce%20%3D%20100%20%2F%20(dist%20%2B%2010)%3B%0Aconst%20force%20%3D%20baseForce%20*%20p.depth%3B%0Ap.vx%20%2B%3D%20force%20*%20(dx%20%2F%20dist)%3B%0Ap.vy%20%2B%3D%20force%20*%20(dy%20%2F%20dist)%3B%0A%7D%0A%7D%0A%2F%2F%20%E5%BA%94%E7%94%A8%E6%91%A9%E6%93%A6%E5%8A%9B%0Ap.vx%20*%3D%200.95%3B%0Ap.vy%20*%3D%200.95%3B%0A%2F%2F%20%E6%9B%B4%E6%96%B0%E4%BD%8D%E7%BD%AE%0Ap.x%20%2B%3D%20p.vx%3B%0Ap.y%20%2B%3D%20p.vy%3B%0A%2F%2F%20%E8%BE%B9%E7%95%8C%E7%8E%AF%E7%BB%95%0Aif%20(p.x%2010)%20p.x%20%3D%20width%20%2B%2010%3B%0Aif%20(p.x%20%3E%20width%20%2B%2010)%20p.x%20%3D%20-10%3B%0Aif%20(p.y%2010)%20p.y%20%3D%20height%20%2B%2010%3B%0Aif%20(p.y%20%3E%20height%20%2B%2010)%20p.y%20%3D%20-10%3B%0A%2F%2F%20%E8%A7%86%E8%A7%89%E6%95%88%E6%9E%9C%E6%9B%B4%E6%96%B0%0Aconst%20scale%20%3D%200.6%20%2B%200.4%20*%20p.depth%3B%0Aconst%20opacity%20%3D%200.4%20%2B%200.6%20*%20p.depth%3B%0Ap.el.style.transform%20%3D%20%60translate(%24%7Bp.x%7Dpx%2C%20%24%7Bp.y%7Dpx)%20scale(%24%7Bscale%7D)%60%3B%0Ap.el.style.opacity%20%3D%20opacity.toString()%3B%0A%7D%0AanimationRef.current%20%3D%20requestAnimationFrame(animate)%3B%0A%7D%2C%20%5B%5D)%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e animate = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e mouse = mouseRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e width = \u003cspan class=\"hljs-variable language_ inline\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003einnerWidth\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e height = \u003cspan class=\"hljs-variable language_ inline\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003einnerHeight\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-keyword inline\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword inline\"\u003elet\u003c/span\u003e p \u003cspan class=\"hljs-keyword inline\"\u003eof\u003c/span\u003e particlesRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e) {\n        \u003cspan class=\"hljs-comment inline\"\u003e// 基础漂移（模拟流体运动）\u003c/span\u003e\n        p.\u003cspan class=\"hljs-property inline\"\u003evx\u003c/span\u003e += \u003cspan class=\"hljs-number inline\"\u003e0.01\u003c/span\u003e * p.\u003cspan class=\"hljs-property inline\"\u003edepth\u003c/span\u003e;\n        p.\u003cspan class=\"hljs-property inline\"\u003evy\u003c/span\u003e += \u003cspan class=\"hljs-number inline\"\u003e0.005\u003c/span\u003e * p.\u003cspan class=\"hljs-property inline\"\u003edepth\u003c/span\u003e;\n\n        \u003cspan class=\"hljs-comment inline\"\u003e// 交互力场计算\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (mouse.\u003cspan class=\"hljs-property inline\"\u003edown\u003c/span\u003e) {\n            \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e dx = p.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e - mouse.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e;\n            \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e dy = p.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e - mouse.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e;\n            \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e dist = \u003cspan class=\"hljs-title class_ inline\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003esqrt\u003c/span\u003e(dx * dx + dy * dy);\n\n            \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (dist \u0026lt; \u003cspan class=\"hljs-number inline\"\u003e100\u003c/span\u003e) {\n                \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e baseForce = \u003cspan class=\"hljs-number inline\"\u003e100\u003c/span\u003e / (dist + \u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e);\n                \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e force = baseForce * p.\u003cspan class=\"hljs-property inline\"\u003edepth\u003c/span\u003e;\n\n                p.\u003cspan class=\"hljs-property inline\"\u003evx\u003c/span\u003e += force * (dx / dist);\n                p.\u003cspan class=\"hljs-property inline\"\u003evy\u003c/span\u003e += force * (dy / dist);\n            }\n        }\n\n        \u003cspan class=\"hljs-comment inline\"\u003e// 应用摩擦力\u003c/span\u003e\n        p.\u003cspan class=\"hljs-property inline\"\u003evx\u003c/span\u003e *= \u003cspan class=\"hljs-number inline\"\u003e0.95\u003c/span\u003e;\n        p.\u003cspan class=\"hljs-property inline\"\u003evy\u003c/span\u003e *= \u003cspan class=\"hljs-number inline\"\u003e0.95\u003c/span\u003e;\n\n        \u003cspan class=\"hljs-comment inline\"\u003e// 更新位置\u003c/span\u003e\n        p.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e += p.\u003cspan class=\"hljs-property inline\"\u003evx\u003c/span\u003e;\n        p.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e += p.\u003cspan class=\"hljs-property inline\"\u003evy\u003c/span\u003e;\n\n        \u003cspan class=\"hljs-comment inline\"\u003e// 边界环绕\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (p.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e \u0026lt; -\u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e) p.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e = width + \u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e;\n        \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (p.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e \u0026gt; width + \u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e) p.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e = -\u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e;\n        \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (p.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e \u0026lt; -\u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e) p.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e = height + \u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e;\n        \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (p.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e \u0026gt; height + \u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e) p.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e = -\u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e;\n\n        \u003cspan class=\"hljs-comment inline\"\u003e// 视觉效果更新\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e scale = \u003cspan class=\"hljs-number inline\"\u003e0.6\u003c/span\u003e + \u003cspan class=\"hljs-number inline\"\u003e0.4\u003c/span\u003e * p.\u003cspan class=\"hljs-property inline\"\u003edepth\u003c/span\u003e;\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e opacity = \u003cspan class=\"hljs-number inline\"\u003e0.4\u003c/span\u003e + \u003cspan class=\"hljs-number inline\"\u003e0.6\u003c/span\u003e * p.\u003cspan class=\"hljs-property inline\"\u003edepth\u003c/span\u003e;\n\n        p.\u003cspan class=\"hljs-property inline\"\u003eel\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003estyle\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003etransform\u003c/span\u003e = \u003cspan class=\"hljs-string inline\"\u003e`translate(\u003cspan class=\"hljs-subst inline\"\u003e${p.x}\u003c/span\u003epx, \u003cspan class=\"hljs-subst inline\"\u003e${p.y}\u003c/span\u003epx) scale(\u003cspan class=\"hljs-subst inline\"\u003e${scale}\u003c/span\u003e)`\u003c/span\u003e;\n        p.\u003cspan class=\"hljs-property inline\"\u003eel\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003estyle\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eopacity\u003c/span\u003e = opacity.\u003cspan class=\"hljs-title function_ inline\"\u003etoString\u003c/span\u003e();\n    }\n\n    animationRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e = \u003cspan class=\"hljs-title function_ inline\"\u003erequestAnimationFrame\u003c/span\u003e(animate);\n}, []);\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e数值解析：\u003c/p\u003e\n\u003col class=\"list-decimal list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e0.01 * p.depth\u003c/strong\u003e: 基础漂移力，让粒子有轻微的自然运动\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e0.005 * p.depth\u003c/strong\u003e: Y方向的漂移更小，模拟重力的微弱影响\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e100 / (dist + 10)\u003c/strong\u003e: 反平方力场，距离越近力越大，+10避免除零错误\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e0.95\u003c/strong\u003e: 摩擦系数，让粒子运动逐渐减缓，模拟空气阻力\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e-10, +10\u003c/strong\u003e: 边界缓冲，让粒子从屏幕外进入，避免突然出现\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"交互系统的物理世界\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#交互系统的物理世界\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 交互系统的物理世界\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            交互系统的物理世界\n        \u003c/h2\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e你也不想背景UI只是一副动态贴图吧？——沃兹基索德\u003c/p\u003e\n\u003ch3 id=\"鼠标事件的全生命周期管理\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#鼠标事件的全生命周期管理\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 鼠标事件的全生命周期管理\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            鼠标事件的全生命周期管理\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"const%20mouseRef%20%3D%20useRefMouseState%3E(%7B%20x%3A%200%2C%20y%3A%200%2C%20down%3A%20false%20%7D)%3B%0Aconst%20updateMousePos%20%3D%20useCallback((e%3A%20MouseEvent%20%7C%20Touch)%20%3D%3E%20%7B%0AmouseRef.current.x%20%3D%20e.clientX%3B%0AmouseRef.current.y%20%3D%20e.clientY%3B%0A%7D%2C%20%5B%5D)%3B%0Aconst%20handleMouseDown%20%3D%20useCallback((e%3A%20MouseEvent)%20%3D%3E%20%7B%0AmouseRef.current.down%20%3D%20true%3B%0AupdateMousePos(e)%3B%0A%7D%2C%20%5BupdateMousePos%5D)%3B%0Aconst%20handleMouseUp%20%3D%20useCallback(()%20%3D%3E%20%7B%0AmouseRef.current.down%20%3D%20false%3B%0A%7D%2C%20%5B%5D)%3B%0Aconst%20handleMouseMove%20%3D%20useCallback((e%3A%20MouseEvent)%20%3D%3E%20%7B%0Aif%20(mouseRef.current.down)%20updateMousePos(e)%3B%0A%7D%2C%20%5BupdateMousePos%5D)%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e mouseRef = useRef\u0026lt;\u003cspan class=\"hljs-title class_ inline\"\u003eMouseState\u003c/span\u003e\u0026gt;({ \u003cspan class=\"hljs-attr inline\"\u003ex\u003c/span\u003e: \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-attr inline\"\u003ey\u003c/span\u003e: \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-attr inline\"\u003edown\u003c/span\u003e: \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e });\n\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e updateMousePos = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003cspan class=\"hljs-attr inline\"\u003ee\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eMouseEvent\u003c/span\u003e | \u003cspan class=\"hljs-title class_ inline\"\u003eTouch\u003c/span\u003e\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    mouseRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e = e.\u003cspan class=\"hljs-property inline\"\u003eclientX\u003c/span\u003e;\n    mouseRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e = e.\u003cspan class=\"hljs-property inline\"\u003eclientY\u003c/span\u003e;\n}, []);\n\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e handleMouseDown = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003cspan class=\"hljs-attr inline\"\u003ee\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eMouseEvent\u003c/span\u003e\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    mouseRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003edown\u003c/span\u003e = \u003cspan class=\"hljs-literal inline\"\u003etrue\u003c/span\u003e;\n    \u003cspan class=\"hljs-title function_ inline\"\u003eupdateMousePos\u003c/span\u003e(e);\n}, [updateMousePos]);\n\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e handleMouseUp = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e {\n    mouseRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003edown\u003c/span\u003e = \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e;\n}, []);\n\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e handleMouseMove = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003cspan class=\"hljs-attr inline\"\u003ee\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eMouseEvent\u003c/span\u003e\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (mouseRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003edown\u003c/span\u003e) \u003cspan class=\"hljs-title function_ inline\"\u003eupdateMousePos\u003c/span\u003e(e);\n}, [updateMousePos]);\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e为什么要用ref而不是state\u003c/strong\u003e？因为在60fps的动画循环中，我们需要在每一帧都读取鼠标位置，使用state会导致不必要的重渲染。ref提供了一个\u0026quot;逃脱React渲染循环\u0026quot;的后门。\u003c/p\u003e\n\u003ch3 id=\"力场计算的数学原理\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#力场计算的数学原理\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 力场计算的数学原理\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            力场计算的数学原理\n        \u003c/h3\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e这是物理模拟的核心部分：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"%2F%2F%20%E8%AE%A1%E7%AE%97%E7%B2%92%E5%AD%90%E5%88%B0%E9%BC%A0%E6%A0%87%E7%9A%84%E5%90%91%E9%87%8F%0Aconst%20dx%20%3D%20p.x%20-%20mouse.x%3B%0Aconst%20dy%20%3D%20p.y%20-%20mouse.y%3B%0A%2F%2F%20%E8%AE%A1%E7%AE%97%E8%B7%9D%E7%A6%BB%EF%BC%88%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E8%B7%9D%E7%A6%BB%EF%BC%89%0Aconst%20dist%20%3D%20Math.sqrt(dx%20*%20dx%20%2B%20dy%20*%20dy)%3B%0A%2F%2F%20%E5%8F%8D%E5%B9%B3%E6%96%B9%E5%8A%9B%E5%9C%BA%EF%BC%88%E7%B1%BB%E4%BC%BC%E4%B8%87%E6%9C%89%E5%BC%95%E5%8A%9B%EF%BC%89%0Aconst%20baseForce%20%3D%20100%20%2F%20(dist%20%2B%2010)%3B%0A%2F%2F%20%E6%B7%B1%E5%BA%A6%E5%BD%B1%E5%93%8D%E5%8A%9B%E7%9A%84%E5%A4%A7%E5%B0%8F%0Aconst%20force%20%3D%20baseForce%20*%20p.depth%3B%0A%2F%2F%20%E8%AE%A1%E7%AE%97%E5%8D%95%E4%BD%8D%E5%90%91%E9%87%8F%E5%B9%B6%E5%BA%94%E7%94%A8%E5%8A%9B%0Ap.vx%20%2B%3D%20force%20*%20(dx%20%2F%20dist)%3B%0Ap.vy%20%2B%3D%20force%20*%20(dy%20%2F%20dist)%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 计算粒子到鼠标的向量\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e dx = p.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e - mouse.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e dy = p.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e - mouse.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment inline\"\u003e// 计算距离（欧几里得距离）\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e dist = \u003cspan class=\"hljs-title class_ inline\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003esqrt\u003c/span\u003e(dx * dx + dy * dy);\n\n\u003cspan class=\"hljs-comment inline\"\u003e// 反平方力场（类似万有引力）\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e baseForce = \u003cspan class=\"hljs-number inline\"\u003e100\u003c/span\u003e / (dist + \u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment inline\"\u003e// 深度影响力的大小\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e force = baseForce * p.\u003cspan class=\"hljs-property inline\"\u003edepth\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment inline\"\u003e// 计算单位向量并应用力\u003c/span\u003e\np.\u003cspan class=\"hljs-property inline\"\u003evx\u003c/span\u003e += force * (dx / dist);\np.\u003cspan class=\"hljs-property inline\"\u003evy\u003c/span\u003e += force * (dy / dist);\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e这个公式模拟了一个\u0026quot;排斥力场\u0026quot;：\u003c/p\u003e\n\u003col class=\"list-decimal list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e距离计算\u003c/strong\u003e: 使用勾股定理计算实际距离\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e力的大小\u003c/strong\u003e: 使用反平方定律，距离越近力越大\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e力的方向\u003c/strong\u003e: \u003ccode\u003e(dx/dist, dy/dist)\u003c/code\u003e是从鼠标指向粒子的单位向量\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e深度加权\u003c/strong\u003e: 靠近屏幕的粒子受力更明显，增加立体感\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"多点触控的支持\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#多点触控的支持\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 多点触控的支持\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            多点触控的支持\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"const%20handleTouchStart%20%3D%20useCallback((e%3A%20TouchEvent)%20%3D%3E%20%7B%0AmouseRef.current.down%20%3D%20true%3B%0AupdateMousePos(e.touches%5B0%5D)%3B%0A%7D%2C%20%5BupdateMousePos%5D)%3B%0Aconst%20handleTouchMove%20%3D%20useCallback((e%3A%20TouchEvent)%20%3D%3E%20%7B%0Aif%20(mouseRef.current.down)%20updateMousePos(e.touches%5B0%5D)%3B%0A%7D%2C%20%5BupdateMousePos%5D)%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e handleTouchStart = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003cspan class=\"hljs-attr inline\"\u003ee\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eTouchEvent\u003c/span\u003e\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    mouseRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003edown\u003c/span\u003e = \u003cspan class=\"hljs-literal inline\"\u003etrue\u003c/span\u003e;\n    \u003cspan class=\"hljs-title function_ inline\"\u003eupdateMousePos\u003c/span\u003e(e.\u003cspan class=\"hljs-property inline\"\u003etouches\u003c/span\u003e[\u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e]);\n}, [updateMousePos]);\n\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e handleTouchMove = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003cspan class=\"hljs-attr inline\"\u003ee\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eTouchEvent\u003c/span\u003e\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (mouseRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003edown\u003c/span\u003e) \u003cspan class=\"hljs-title function_ inline\"\u003eupdateMousePos\u003c/span\u003e(e.\u003cspan class=\"hljs-property inline\"\u003etouches\u003c/span\u003e[\u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e]);\n}, [updateMousePos]);\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e移动设备支持只是取第一个触摸点，因为多点触控的物理模拟会变得非常复杂，而且大多数用户也只会用一个手指。\u003cdel class=\"line-through opacity-60\"\u003e（偷懒的合理化）\u003c/del\u003e\u003c/p\u003e\n\u003ch3 id=\"摩擦力模拟\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#摩擦力模拟\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 摩擦力模拟\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            摩擦力模拟\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"p.vx%20*%3D%200.95%3B%0Ap.vy%20*%3D%200.95%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003ep.\u003cspan class=\"hljs-property inline\"\u003evx\u003c/span\u003e *= \u003cspan class=\"hljs-number inline\"\u003e0.95\u003c/span\u003e;\np.\u003cspan class=\"hljs-property inline\"\u003evy\u003c/span\u003e *= \u003cspan class=\"hljs-number inline\"\u003e0.95\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cdel class=\"line-through opacity-60\"\u003e从网上随便找来的摩擦力系数。\u003c/del\u003e\u003c/p\u003e\n\u003ch2 id=\"主题系统的色彩混合\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#主题系统的色彩混合\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 主题系统的色彩混合\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            主题系统的色彩混合\n        \u003c/h2\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e泡沫背景需要与网站的主题系统无缝集成，这里涉及到了较为复杂的颜色混合运算。\u003c/p\u003e\n\u003ch3 id=\"hsl颜色空间\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#hsl颜色空间\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to HSL颜色空间\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            HSL颜色空间\n        \u003c/h3\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e相比RGB，HSL更加适合生成相近的色彩：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"const%20hexToHsl%20%3D%20useCallback((hex%3A%20string)%20%3D%3E%20%7B%0A%2F%2F%20%E5%B0%8616%E8%BF%9B%E5%88%B6%E8%BD%AC%E6%8D%A2%E4%B8%BARGB%0Aconst%20r%20%3D%20parseInt(hex.slice(1%2C%203)%2C%2016)%20%2F%20255%3B%0Aconst%20g%20%3D%20parseInt(hex.slice(3%2C%205)%2C%2016)%20%2F%20255%3B%0Aconst%20b%20%3D%20parseInt(hex.slice(5%2C%207)%2C%2016)%20%2F%20255%3B%0A%2F%2F%20%E6%89%BE%E5%88%B0%E6%9C%80%E5%A4%A7%E5%80%BC%E5%92%8C%E6%9C%80%E5%B0%8F%E5%80%BC%0Aconst%20max%20%3D%20Math.max(r%2C%20g%2C%20b)%3B%0Aconst%20min%20%3D%20Math.min(r%2C%20g%2C%20b)%3B%0Alet%20h%20%3D%200%2C%20s%20%3D%200%2C%20l%20%3D%20(max%20%2B%20min)%20%2F%202%3B%0Aif%20(max%20!%3D%3D%20min)%20%7B%0Aconst%20d%20%3D%20max%20-%20min%3B%0As%20%3D%20l%20%3E%200.5%20%3F%20d%20%2F%20(2%20-%20max%20-%20min)%20%3A%20d%20%2F%20(max%20%2B%20min)%3B%0Aswitch%20(max)%20%7B%0Acase%20r%3A%20h%20%3D%20(g%20-%20b)%20%2F%20d%20%2B%20(g%206%20%3A%200)%3B%20break%3B%0Acase%20g%3A%20h%20%3D%20(b%20-%20r)%20%2F%20d%20%2B%202%3B%20break%3B%0Acase%20b%3A%20h%20%3D%20(r%20-%20g)%20%2F%20d%20%2B%204%3B%20break%3B%0A%7D%0Ah%20%2F%3D%206%3B%0A%7D%0Areturn%20%5BMath.round(h%20*%20360)%2C%20Math.round(s%20*%20100)%2C%20Math.round(l%20*%20100)%5D%3B%0A%7D%2C%20%5B%5D)%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e hexToHsl = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003cspan class=\"hljs-attr inline\"\u003ehex\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment inline\"\u003e// 将16进制转换为RGB\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e r = \u003cspan class=\"hljs-built_in inline\"\u003eparseInt\u003c/span\u003e(hex.\u003cspan class=\"hljs-title function_ inline\"\u003eslice\u003c/span\u003e(\u003cspan class=\"hljs-number inline\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number inline\"\u003e3\u003c/span\u003e), \u003cspan class=\"hljs-number inline\"\u003e16\u003c/span\u003e) / \u003cspan class=\"hljs-number inline\"\u003e255\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e g = \u003cspan class=\"hljs-built_in inline\"\u003eparseInt\u003c/span\u003e(hex.\u003cspan class=\"hljs-title function_ inline\"\u003eslice\u003c/span\u003e(\u003cspan class=\"hljs-number inline\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-number inline\"\u003e5\u003c/span\u003e), \u003cspan class=\"hljs-number inline\"\u003e16\u003c/span\u003e) / \u003cspan class=\"hljs-number inline\"\u003e255\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e b = \u003cspan class=\"hljs-built_in inline\"\u003eparseInt\u003c/span\u003e(hex.\u003cspan class=\"hljs-title function_ inline\"\u003eslice\u003c/span\u003e(\u003cspan class=\"hljs-number inline\"\u003e5\u003c/span\u003e, \u003cspan class=\"hljs-number inline\"\u003e7\u003c/span\u003e), \u003cspan class=\"hljs-number inline\"\u003e16\u003c/span\u003e) / \u003cspan class=\"hljs-number inline\"\u003e255\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 找到最大值和最小值\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e max = \u003cspan class=\"hljs-title class_ inline\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003emax\u003c/span\u003e(r, g, b);\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e min = \u003cspan class=\"hljs-title class_ inline\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003emin\u003c/span\u003e(r, g, b);\n    \u003cspan class=\"hljs-keyword inline\"\u003elet\u003c/span\u003e h = \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e, s = \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e, l = (max + min) / \u003cspan class=\"hljs-number inline\"\u003e2\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (max !== min) {\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e d = max - min;\n        s = l \u0026gt; \u003cspan class=\"hljs-number inline\"\u003e0.5\u003c/span\u003e ? d / (\u003cspan class=\"hljs-number inline\"\u003e2\u003c/span\u003e - max - min) : d / (max + min);\n        \n        \u003cspan class=\"hljs-keyword inline\"\u003eswitch\u003c/span\u003e (max) {\n            \u003cspan class=\"hljs-keyword inline\"\u003ecase\u003c/span\u003e \u003cspan class=\"hljs-attr inline\"\u003er\u003c/span\u003e: h = (g - b) / d + (g \u0026lt; b ? \u003cspan class=\"hljs-number inline\"\u003e6\u003c/span\u003e : \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e); \u003cspan class=\"hljs-keyword inline\"\u003ebreak\u003c/span\u003e;\n            \u003cspan class=\"hljs-keyword inline\"\u003ecase\u003c/span\u003e \u003cspan class=\"hljs-attr inline\"\u003eg\u003c/span\u003e: h = (b - r) / d + \u003cspan class=\"hljs-number inline\"\u003e2\u003c/span\u003e; \u003cspan class=\"hljs-keyword inline\"\u003ebreak\u003c/span\u003e;\n            \u003cspan class=\"hljs-keyword inline\"\u003ecase\u003c/span\u003e \u003cspan class=\"hljs-attr inline\"\u003eb\u003c/span\u003e: h = (r - g) / d + \u003cspan class=\"hljs-number inline\"\u003e4\u003c/span\u003e; \u003cspan class=\"hljs-keyword inline\"\u003ebreak\u003c/span\u003e;\n        }\n        h /= \u003cspan class=\"hljs-number inline\"\u003e6\u003c/span\u003e;\n    }\n\n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e [\u003cspan class=\"hljs-title class_ inline\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eround\u003c/span\u003e(h * \u003cspan class=\"hljs-number inline\"\u003e360\u003c/span\u003e), \u003cspan class=\"hljs-title class_ inline\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eround\u003c/span\u003e(s * \u003cspan class=\"hljs-number inline\"\u003e100\u003c/span\u003e), \u003cspan class=\"hljs-title class_ inline\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eround\u003c/span\u003e(l * \u003cspan class=\"hljs-number inline\"\u003e100\u003c/span\u003e)];\n}, []);\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e这个转换算法看起来复杂，但原理很直观：\u003c/p\u003e\n\u003col class=\"list-decimal list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e将RGB标准化到0-1范围\u003c/strong\u003e\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e计算明度(L)\u003c/strong\u003e: 最大值和最小值的平均\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e计算饱和度(S)\u003c/strong\u003e: 基于明度和色彩范围\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e计算色相(H)\u003c/strong\u003e: 基于主导颜色的位置\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"主题响应的动态生成策略\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#主题响应的动态生成策略\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 主题响应的动态生成策略\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            主题响应的动态生成策略\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"const%20getThemeColors%20%3D%20useCallback(()%20%3D%3E%20%7B%0Aconst%20%5BprimaryH%2C%20primaryS%5D%20%3D%20hexToHsl(currentTheme.colors.primary)%3B%0Aconst%20%5BaccentH%2C%20accentS%5D%20%3D%20hexToHsl(currentTheme.colors.accent)%3B%0Aconst%20isDark%20%3D%20currentTheme.id%20%3D%3D%3D%20'dark'%3B%0Aif%20(isDark)%20%7B%0A%2F%2F%20%E6%B7%B1%E8%89%B2%E4%B8%BB%E9%A2%98%EF%BC%9A%E6%9B%B4%E6%B7%B1%E3%80%81%E6%9B%B4%E9%A5%B1%E5%92%8C%E7%9A%84%E9%A2%9C%E8%89%B2%0Areturn%20%7B%0Abackground%3A%20%60linear-gradient(135deg%2C%20hsl(%24%7BprimaryH%7D%2C%20%24%7BMath.max(primaryS%20%2B%2010%2C%2040)%7D%25%2C%2025%25)%2C%20hsl(%24%7BaccentH%7D%2C%20%24%7BMath.max(accentS%20%2B%205%2C%2035)%7D%25%2C%2020%25))%60%2C%0Aparticle%3A%20%60hsl(%24%7BprimaryH%7D%2C%20%24%7BMath.max(primaryS%20%2B%2015%2C%2050)%7D%25%2C%2045%25)%60%0A%7D%3B%0A%7D%20else%20%7B%0A%2F%2F%20%E6%B5%85%E8%89%B2%E4%B8%BB%E9%A2%98%EF%BC%9A%E6%9B%B4%E4%BA%AE%E7%9A%84%E9%A2%9C%E8%89%B2%0Areturn%20%7B%0Abackground%3A%20%60linear-gradient(135deg%2C%20hsl(%24%7BprimaryH%7D%2C%20%24%7BMath.max(primaryS%20-%2020%2C%2020)%7D%25%2C%2060%25)%2C%20hsl(%24%7BaccentH%7D%2C%20%24%7BMath.max(accentS%20-%2010%2C%2030)%7D%25%2C%2050%25))%60%2C%0Aparticle%3A%20%60hsl(%24%7BprimaryH%7D%2C%20%24%7BMath.max(primaryS%20-%2010%2C%2035)%7D%25%2C%2075%25)%60%0A%7D%3B%0A%7D%0A%7D%2C%20%5BcurrentTheme%2C%20hexToHsl%5D)%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e getThemeColors = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e [primaryH, primaryS] = \u003cspan class=\"hljs-title function_ inline\"\u003ehexToHsl\u003c/span\u003e(currentTheme.\u003cspan class=\"hljs-property inline\"\u003ecolors\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eprimary\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e [accentH, accentS] = \u003cspan class=\"hljs-title function_ inline\"\u003ehexToHsl\u003c/span\u003e(currentTheme.\u003cspan class=\"hljs-property inline\"\u003ecolors\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eaccent\u003c/span\u003e);\n    \n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e isDark = currentTheme.\u003cspan class=\"hljs-property inline\"\u003eid\u003c/span\u003e === \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;dark\u0026#x27;\u003c/span\u003e;\n    \n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (isDark) {\n        \u003cspan class=\"hljs-comment inline\"\u003e// 深色主题：更深、更饱和的颜色\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e {\n            \u003cspan class=\"hljs-attr inline\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e`linear-gradient(135deg, hsl(\u003cspan class=\"hljs-subst inline\"\u003e${primaryH}\u003c/span\u003e, \u003cspan class=\"hljs-subst inline\"\u003e${\u003cspan class=\"hljs-built_in inline\"\u003eMath\u003c/span\u003e.max(primaryS + \u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e, \u003cspan class=\"hljs-number inline\"\u003e40\u003c/span\u003e)}\u003c/span\u003e%, 25%), hsl(\u003cspan class=\"hljs-subst inline\"\u003e${accentH}\u003c/span\u003e, \u003cspan class=\"hljs-subst inline\"\u003e${\u003cspan class=\"hljs-built_in inline\"\u003eMath\u003c/span\u003e.max(accentS + \u003cspan class=\"hljs-number inline\"\u003e5\u003c/span\u003e, \u003cspan class=\"hljs-number inline\"\u003e35\u003c/span\u003e)}\u003c/span\u003e%, 20%))`\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr inline\"\u003eparticle\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e`hsl(\u003cspan class=\"hljs-subst inline\"\u003e${primaryH}\u003c/span\u003e, \u003cspan class=\"hljs-subst inline\"\u003e${\u003cspan class=\"hljs-built_in inline\"\u003eMath\u003c/span\u003e.max(primaryS + \u003cspan class=\"hljs-number inline\"\u003e15\u003c/span\u003e, \u003cspan class=\"hljs-number inline\"\u003e50\u003c/span\u003e)}\u003c/span\u003e%, 45%)`\u003c/span\u003e\n        };\n    } \u003cspan class=\"hljs-keyword inline\"\u003eelse\u003c/span\u003e {\n        \u003cspan class=\"hljs-comment inline\"\u003e// 浅色主题：更亮的颜色\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e {\n            \u003cspan class=\"hljs-attr inline\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e`linear-gradient(135deg, hsl(\u003cspan class=\"hljs-subst inline\"\u003e${primaryH}\u003c/span\u003e, \u003cspan class=\"hljs-subst inline\"\u003e${\u003cspan class=\"hljs-built_in inline\"\u003eMath\u003c/span\u003e.max(primaryS - \u003cspan class=\"hljs-number inline\"\u003e20\u003c/span\u003e, \u003cspan class=\"hljs-number inline\"\u003e20\u003c/span\u003e)}\u003c/span\u003e%, 60%), hsl(\u003cspan class=\"hljs-subst inline\"\u003e${accentH}\u003c/span\u003e, \u003cspan class=\"hljs-subst inline\"\u003e${\u003cspan class=\"hljs-built_in inline\"\u003eMath\u003c/span\u003e.max(accentS - \u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e, \u003cspan class=\"hljs-number inline\"\u003e30\u003c/span\u003e)}\u003c/span\u003e%, 50%))`\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr inline\"\u003eparticle\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e`hsl(\u003cspan class=\"hljs-subst inline\"\u003e${primaryH}\u003c/span\u003e, \u003cspan class=\"hljs-subst inline\"\u003e${\u003cspan class=\"hljs-built_in inline\"\u003eMath\u003c/span\u003e.max(primaryS - \u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e, \u003cspan class=\"hljs-number inline\"\u003e35\u003c/span\u003e)}\u003c/span\u003e%, 75%)`\u003c/span\u003e\n        };\n    }\n}, [currentTheme, hexToHsl]);\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e这个函数的设计考虑了多个因素：\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e饱和度调整\u003c/strong\u003e: 深色模式增加饱和度，浅色模式降低饱和度，确保对比度适中\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e明度控制\u003c/strong\u003e: 深色模式使用较低的明度值(20-45%)，浅色模式使用较高的明度值(50-75%)\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e渐变设计\u003c/strong\u003e: 135度斜角渐变，从主色到强调色，创造空间深度感\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e安全边界\u003c/strong\u003e: 使用\u003ccode\u003eMath.max()\u003c/code\u003e确保饱和度和明度不会过低\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"动态色彩的实时更新\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#动态色彩的实时更新\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 动态色彩的实时更新\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            动态色彩的实时更新\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"useEffect(()%20%3D%3E%20%7B%0Aif%20(particlesRef.current.length%20%3E%200)%20%7B%0Aconst%20colors%20%3D%20getThemeColors()%3B%0A%2F%2F%20%E6%9B%B4%E6%96%B0%E6%89%80%E6%9C%89%E7%B2%92%E5%AD%90%E7%9A%84%E9%A2%9C%E8%89%B2%0AparticlesRef.current.forEach(p%20%3D%3E%20%7B%0Ap.el.style.backgroundColor%20%3D%20colors.particle%3B%0A%7D)%3B%0A%2F%2F%20%E6%9B%B4%E6%96%B0%E5%AE%B9%E5%99%A8%E8%83%8C%E6%99%AF%0Aif%20(containerRef.current)%20%7B%0AcontainerRef.current.style.background%20%3D%20colors.background%3B%0A%7D%0A%7D%0A%7D%2C%20%5BcurrentTheme%2C%20getThemeColors%5D)%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-title function_ inline\"\u003euseEffect\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (particlesRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003elength\u003c/span\u003e \u0026gt; \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e colors = \u003cspan class=\"hljs-title function_ inline\"\u003egetThemeColors\u003c/span\u003e();\n        \n        \u003cspan class=\"hljs-comment inline\"\u003e// 更新所有粒子的颜色\u003c/span\u003e\n        particlesRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eforEach\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e\u003cspan class=\"hljs-params inline\"\u003ep\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n            p.\u003cspan class=\"hljs-property inline\"\u003eel\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003estyle\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003ebackgroundColor\u003c/span\u003e = colors.\u003cspan class=\"hljs-property inline\"\u003eparticle\u003c/span\u003e;\n        });\n        \n        \u003cspan class=\"hljs-comment inline\"\u003e// 更新容器背景\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (containerRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e) {\n            containerRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003estyle\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003ebackground\u003c/span\u003e = colors.\u003cspan class=\"hljs-property inline\"\u003ebackground\u003c/span\u003e;\n        }\n    }\n}, [currentTheme, getThemeColors]);\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e当主题切换时，所有粒子会同步更新颜色，无需重新创建DOM元素，保证了切换的流畅性。\u003c/p\u003e\n\u003ch3 id=\"深度数学模型\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#深度数学模型\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 深度数学模型\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            深度数学模型\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"const%20depth%20%3D%20Math.random()%3B%20%2F%2F%200-1%E4%B9%8B%E9%97%B4%E7%9A%84%E9%9A%8F%E6%9C%BA%E6%B7%B1%E5%BA%A6%E5%80%BC%0A%2F%2F%20%E5%9F%BA%E4%BA%8E%E6%B7%B1%E5%BA%A6%E7%9A%84%E7%BC%A9%E6%94%BE%0Aconst%20scale%20%3D%200.6%20%2B%200.4%20*%20depth%3B%0A%2F%2F%20%E5%9F%BA%E4%BA%8E%E6%B7%B1%E5%BA%A6%E7%9A%84%E9%80%8F%E6%98%8E%E5%BA%A6%0Aconst%20opacity%20%3D%200.4%20%2B%200.6%20*%20depth%3B%0A%2F%2F%20%E5%9F%BA%E4%BA%8E%E6%B7%B1%E5%BA%A6%E7%9A%84%E8%BF%90%E5%8A%A8%E9%80%9F%E5%BA%A6%0Ap.vx%20%2B%3D%200.01%20*%20p.depth%3B%0Ap.vy%20%2B%3D%200.005%20*%20p.depth%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e depth = \u003cspan class=\"hljs-title class_ inline\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003erandom\u003c/span\u003e(); \u003cspan class=\"hljs-comment inline\"\u003e// 0-1之间的随机深度值\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment inline\"\u003e// 基于深度的缩放\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e scale = \u003cspan class=\"hljs-number inline\"\u003e0.6\u003c/span\u003e + \u003cspan class=\"hljs-number inline\"\u003e0.4\u003c/span\u003e * depth;\n\n\u003cspan class=\"hljs-comment inline\"\u003e// 基于深度的透明度\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e opacity = \u003cspan class=\"hljs-number inline\"\u003e0.4\u003c/span\u003e + \u003cspan class=\"hljs-number inline\"\u003e0.6\u003c/span\u003e * depth;\n\n\u003cspan class=\"hljs-comment inline\"\u003e// 基于深度的运动速度\u003c/span\u003e\np.\u003cspan class=\"hljs-property inline\"\u003evx\u003c/span\u003e += \u003cspan class=\"hljs-number inline\"\u003e0.01\u003c/span\u003e * p.\u003cspan class=\"hljs-property inline\"\u003edepth\u003c/span\u003e;\np.\u003cspan class=\"hljs-property inline\"\u003evy\u003c/span\u003e += \u003cspan class=\"hljs-number inline\"\u003e0.005\u003c/span\u003e * p.\u003cspan class=\"hljs-property inline\"\u003edepth\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e层次感渲染：\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003escale: 0.6-1.0\u003c/strong\u003e: 远处的粒子小，近处的粒子大\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003eopacity: 0.4-1.0\u003c/strong\u003e: 远处的粒子透明，近处的粒子不透明\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003espeed: depth倍数\u003c/strong\u003e: 近处的粒子移动更快，远处的粒子移动更慢\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"视差运动的模拟\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#视差运动的模拟\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 视差运动的模拟\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            视差运动的模拟\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"%2F%2F%20%E5%9C%A8%E4%BA%A4%E4%BA%92%E5%8A%9B%E8%AE%A1%E7%AE%97%E4%B8%AD%0Aconst%20force%20%3D%20baseForce%20*%20p.depth%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 在交互力计算中\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e force = baseForce * p.\u003cspan class=\"hljs-property inline\"\u003edepth\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e深度值作为力的倍数，意味着：\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e近处的粒子对交互更敏感\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e远处的粒子反应更迟钝\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e整体呈现出视差滚动的效果\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e这种设计让用户感觉自己在与一个真正的3D空间互动，而不是平面上的点。（也许？）\u003c/p\u003e\n\u003ch2 id=\"响应式布局的粒子重分配\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#响应式布局的粒子重分配\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 响应式布局的粒子重分配\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            响应式布局的粒子重分配\n        \u003c/h2\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e当窗口大小改变时，粒子系统需要灵活地适应新的尺寸。\u003c/p\u003e\n\u003ch3 id=\"窗口尺寸变化的监听策略\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#窗口尺寸变化的监听策略\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 窗口尺寸变化的监听策略\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            窗口尺寸变化的监听策略\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"const%20handleResize%20%3D%20useCallback(()%20%3D%3E%20%7B%0A%2F%2F%20%E9%87%8D%E6%96%B0%E5%88%9D%E5%A7%8B%E5%8C%96%E7%B2%92%E5%AD%90%E5%88%86%E5%B8%83%0AinitializeParticles()%3B%0A%7D%2C%20%5BinitializeParticles%5D)%3B%0AuseEffect(()%20%3D%3E%20%7B%0Awindow.addEventListener('resize'%2C%20handleResize)%3B%0Areturn%20()%20%3D%3E%20window.removeEventListener('resize'%2C%20handleResize)%3B%0A%7D%2C%20%5BhandleResize%5D)%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e handleResize = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment inline\"\u003e// 重新初始化粒子分布\u003c/span\u003e\n    \u003cspan class=\"hljs-title function_ inline\"\u003einitializeParticles\u003c/span\u003e();\n}, [initializeParticles]);\n\n\u003cspan class=\"hljs-title function_ inline\"\u003euseEffect\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-variable language_ inline\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;resize\u0026#x27;\u003c/span\u003e, handleResize);\n    \n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-variable language_ inline\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eremoveEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;resize\u0026#x27;\u003c/span\u003e, handleResize);\n}, [handleResize]);\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e为什么选择重新初始化而不是重新定位\u003c/strong\u003e？因为重新定位现有粒子会导致视觉上的\u0026quot;跳跃\u0026quot;，而重新初始化虽然会有短暂的重建，但视觉效果更自然。\u003c/p\u003e\n\u003ch3 id=\"粒子清理的内存安全\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#粒子清理的内存安全\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 粒子清理的内存安全\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            粒子清理的内存安全\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"%2F%2F%20%E6%B8%85%E7%90%86%E7%8E%B0%E6%9C%89%E7%B2%92%E5%AD%90%0AparticlesRef.current.forEach(p%20%3D%3E%20p.el.remove())%3B%0AparticlesRef.current%20%3D%20%5B%5D%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 清理现有粒子\u003c/span\u003e\nparticlesRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eforEach\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e\u003cspan class=\"hljs-params inline\"\u003ep\u003c/span\u003e =\u0026gt;\u003c/span\u003e p.\u003cspan class=\"hljs-property inline\"\u003eel\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eremove\u003c/span\u003e());\nparticlesRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e = [];\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e为什么要手动remove\u003c/strong\u003e？因为我们使用的是原生DOM操作，React不会自动清理这些元素。如果不手动移除，会导致DOM中堆积大量隐形元素，造成内存泄漏。\u003c/p\u003e\n\u003ch3 id=\"防抖处理的必要性\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#防抖处理的必要性\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 防抖处理的必要性\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            防抖处理的必要性\n        \u003c/h3\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e用户调整窗口大小时，resize事件会疯狂触发。没有防抖的话，每一次微小的窗口变化都会重新创建300个粒子——反复拖几十个来回后，你也许就可以听到GPU风扇转动的美妙声音。\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e防抖实现\u003c/strong\u003e：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"%2F%2F%20%E9%98%B2%E6%8A%96%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%0Aconst%20debounce%20%3D%20useCallback((func%3A%20Function%2C%20wait%3A%20number)%20%3D%3E%20%7B%0Alet%20timeout%3A%20NodeJS.Timeout%3B%0Areturn%20function%20executedFunction(...args%3A%20any%5B%5D)%20%7B%0Aconst%20later%20%3D%20()%20%3D%3E%20%7B%0AclearTimeout(timeout)%3B%0Afunc(...args)%3B%0A%7D%3B%0AclearTimeout(timeout)%3B%0Atimeout%20%3D%20setTimeout(later%2C%20wait)%3B%0A%7D%3B%0A%7D%2C%20%5B%5D)%3B%0A%2F%2F%20%E5%88%9B%E5%BB%BA%E9%98%B2%E6%8A%96%E7%89%88%E6%9C%AC%E7%9A%84resize%E5%A4%84%E7%90%86%E5%99%A8%0Aconst%20debouncedHandleResize%20%3D%20useCallback(%0Adebounce(handleResize%2C%201000)%2C%20%2F%2F%201%E7%A7%92%E7%9A%84%E9%98%B2%E6%8A%96%E5%BB%B6%E8%BF%9F%0A%5Bdebounce%2C%20handleResize%5D%0A)%3B%0A%2F%2F%20%E5%9C%A8%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E4%B8%AD%E4%BD%BF%E7%94%A8%E9%98%B2%E6%8A%96%E7%89%88%E6%9C%AC%0AuseEffect(()%20%3D%3E%20%7B%0Awindow.addEventListener('resize'%2C%20debouncedHandleResize)%3B%0Areturn%20()%20%3D%3E%20%7B%0Awindow.removeEventListener('resize'%2C%20debouncedHandleResize)%3B%0A%7D%3B%0A%7D%2C%20%5BdebouncedHandleResize%5D)%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 防抖工具函数\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e debounce = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003cspan class=\"hljs-attr inline\"\u003efunc\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eFunction\u003c/span\u003e, \u003cspan class=\"hljs-attr inline\"\u003ewait\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003enumber\u003c/span\u003e\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword inline\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-attr inline\"\u003etimeout\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eNodeJS\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eTimeout\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003eexecutedFunction\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003e...\u003cspan class=\"hljs-attr inline\"\u003eargs\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003eany\u003c/span\u003e[]\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003elater\u003c/span\u003e = (\u003cspan class=\"hljs-params inline\"\u003e\u003c/span\u003e) =\u0026gt; {\n            \u003cspan class=\"hljs-built_in inline\"\u003eclearTimeout\u003c/span\u003e(timeout);\n            \u003cspan class=\"hljs-title function_ inline\"\u003efunc\u003c/span\u003e(...args);\n        };\n        \u003cspan class=\"hljs-built_in inline\"\u003eclearTimeout\u003c/span\u003e(timeout);\n        timeout = \u003cspan class=\"hljs-built_in inline\"\u003esetTimeout\u003c/span\u003e(later, wait);\n    };\n}, []);\n\n\u003cspan class=\"hljs-comment inline\"\u003e// 创建防抖版本的resize处理器\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e debouncedHandleResize = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\n    \u003cspan class=\"hljs-title function_ inline\"\u003edebounce\u003c/span\u003e(handleResize, \u003cspan class=\"hljs-number inline\"\u003e1000\u003c/span\u003e), \u003cspan class=\"hljs-comment inline\"\u003e// 1秒的防抖延迟\u003c/span\u003e\n    [debounce, handleResize]\n);\n\n\u003cspan class=\"hljs-comment inline\"\u003e// 在事件监听中使用防抖版本\u003c/span\u003e\n\u003cspan class=\"hljs-title function_ inline\"\u003euseEffect\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-variable language_ inline\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;resize\u0026#x27;\u003c/span\u003e, debouncedHandleResize);\n    \n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e {\n        \u003cspan class=\"hljs-variable language_ inline\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eremoveEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;resize\u0026#x27;\u003c/span\u003e, debouncedHandleResize);\n    };\n}, [debouncedHandleResize]);\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e防抖的工作原理\u003c/strong\u003e：\u003c/p\u003e\n\u003col class=\"list-decimal list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e用户开始拖拽窗口 → 第一个resize事件到达\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e防抖函数设置1000ms定时器，准备执行重建\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e用户继续拖拽 → 更多resize事件到达\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e每次新事件都会取消之前的定时器，重新计时\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e用户停止拖拽1000ms后 → 定时器触发，执行粒子重建\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e这样就把原本可能触发几十次的重建操作，优化成了只在用户真正\u0026quot;完成调整\u0026quot;后的一次重建。\u003c/p\u003e\n\u003ch2 id=\"性能优化的关键策略\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#性能优化的关键策略\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 性能优化的关键策略\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            性能优化的关键策略\n        \u003c/h2\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e300个DOM元素的同时动画是对浏览器的严峻考验，每一个优化细节都至关重要。\u003c/p\u003e\n\u003ch3 id=\"willchange属性的正确使用\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#willchange属性的正确使用\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to willChange属性的正确使用\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            willChange属性的正确使用\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"el.style.willChange%20%3D%20'transform%2C%20opacity'%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003eel.\u003cspan class=\"hljs-property inline\"\u003estyle\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003ewillChange\u003c/span\u003e = \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;transform, opacity\u0026#x27;\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e这行代码告诉浏览器：\u0026quot;这个元素的transform和opacity会频繁变化，请为它准备GPU图层\u0026quot;。\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e但是！willChange是一把双刃剑：\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e好处\u003c/strong\u003e: 开启GPU加速，动画更流畅\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e坏处\u003c/strong\u003e: 消耗额外的GPU内存，过多使用会适得其反\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e所以我们只在真正需要动画的属性上使用它。\u003c/p\u003e\n\u003ch3 id=\"requestanimationframe的生命周期管理\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#requestanimationframe的生命周期管理\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to requestAnimationFrame的生命周期管理\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            requestAnimationFrame的生命周期管理\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"useEffect(()%20%3D%3E%20%7B%0Aanimate()%3B%0Areturn%20()%20%3D%3E%20%7B%0Aif%20(animationIdRef.current%20!%3D%3D%20null)%20%7B%0AcancelAnimationFrame(animationIdRef.current)%3B%0A%7D%0A%2F%2F%20%E6%B8%85%E7%90%86%E6%89%80%E6%9C%89%E7%B2%92%E5%AD%90%0AparticlesRef.current.forEach(p%20%3D%3E%20p.el.remove())%3B%0A%7D%3B%0A%7D%2C%20%5Banimate%5D)%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-title function_ inline\"\u003euseEffect\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-title function_ inline\"\u003eanimate\u003c/span\u003e();\n    \n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (animationIdRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e !== \u003cspan class=\"hljs-literal inline\"\u003enull\u003c/span\u003e) {\n            \u003cspan class=\"hljs-title function_ inline\"\u003ecancelAnimationFrame\u003c/span\u003e(animationIdRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e);\n        }\n        \n        \u003cspan class=\"hljs-comment inline\"\u003e// 清理所有粒子\u003c/span\u003e\n        particlesRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eforEach\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e\u003cspan class=\"hljs-params inline\"\u003ep\u003c/span\u003e =\u0026gt;\u003c/span\u003e p.\u003cspan class=\"hljs-property inline\"\u003eel\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eremove\u003c/span\u003e());\n    };\n}, [animate]);\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e这个cleanup函数做了两件重要的事：\u003c/p\u003e\n\u003col class=\"list-decimal list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e取消动画帧\u003c/strong\u003e: 避免组件卸载后动画继续运行\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e清理DOM元素\u003c/strong\u003e: 防止内存泄漏\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"层级管理的z-index策略\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#层级管理的z-index策略\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 层级管理的z-index策略\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            层级管理的z-index策略\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"className%3D%22fixed%20inset-0%20w-full%20h-full%20overflow-hidden%20pointer-events-none%20z-0%22\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003eclassName=\u003cspan class=\"hljs-string inline\"\u003e\u0026quot;fixed inset-0 w-full h-full overflow-hidden pointer-events-none z-0\u0026quot;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003ez-0\u003c/strong\u003e: 确保背景永远在最底层，不会遮挡其他内容\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003epointer-events-none\u003c/strong\u003e: 让整个容器不响应鼠标事件，避免干扰页面交互\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003eoverflow-hidden\u003c/strong\u003e: 防止粒子跑到容器外面显示\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"事件处理的边界情况\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#事件处理的边界情况\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 事件处理的边界情况\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            事件处理的边界情况\n        \u003c/h2\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e真实世界的用户交互远比理想情况复杂，我们需要处理各种边界情况。\u003c/p\u003e\n\u003ch3 id=\"触摸设备的特殊处理\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#触摸设备的特殊处理\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 触摸设备的特殊处理\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            触摸设备的特殊处理\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"const%20handleTouchStart%20%3D%20useCallback((e%3A%20TouchEvent)%20%3D%3E%20%7B%0AmouseRef.current.down%20%3D%20true%3B%0AupdateMousePos(e.touches%5B0%5D)%3B%0A%7D%2C%20%5BupdateMousePos%5D)%3B%0Aconst%20handleTouchMove%20%3D%20useCallback((e%3A%20TouchEvent)%20%3D%3E%20%7B%0Aif%20(mouseRef.current.down)%20updateMousePos(e.touches%5B0%5D)%3B%0A%7D%2C%20%5BupdateMousePos%5D)%3B%0Aconst%20handleTouchEnd%20%3D%20useCallback(()%20%3D%3E%20%7B%0AmouseRef.current.down%20%3D%20false%3B%0A%7D%2C%20%5B%5D)%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e handleTouchStart = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003cspan class=\"hljs-attr inline\"\u003ee\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eTouchEvent\u003c/span\u003e\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    mouseRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003edown\u003c/span\u003e = \u003cspan class=\"hljs-literal inline\"\u003etrue\u003c/span\u003e;\n    \u003cspan class=\"hljs-title function_ inline\"\u003eupdateMousePos\u003c/span\u003e(e.\u003cspan class=\"hljs-property inline\"\u003etouches\u003c/span\u003e[\u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e]);\n}, [updateMousePos]);\n\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e handleTouchMove = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003cspan class=\"hljs-attr inline\"\u003ee\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eTouchEvent\u003c/span\u003e\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (mouseRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003edown\u003c/span\u003e) \u003cspan class=\"hljs-title function_ inline\"\u003eupdateMousePos\u003c/span\u003e(e.\u003cspan class=\"hljs-property inline\"\u003etouches\u003c/span\u003e[\u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e]);\n}, [updateMousePos]);\n\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e handleTouchEnd = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e {\n    mouseRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003edown\u003c/span\u003e = \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e;\n}, []);\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e为什么只取第一个触摸点\u003c/strong\u003e？因为多点触控会让力场计算变得极其复杂，而且大多数用户也只会用一个手指\u0026quot;戳泡泡\u0026quot;。\u003c/p\u003e\n\u003ch3 id=\"事件监听器的作用域控制\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#事件监听器的作用域控制\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 事件监听器的作用域控制\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            事件监听器的作用域控制\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"%2F%2F%20%E5%85%A8%E5%B1%80%E4%BA%8B%E4%BB%B6%0Adocument.addEventListener('mousedown'%2C%20handleMouseDown)%3B%0Adocument.addEventListener('mouseup'%2C%20handleMouseUp)%3B%0Adocument.addEventListener('mousemove'%2C%20handleMouseMove)%3B%0A%2F%2F%20%E5%AE%B9%E5%99%A8%E5%B1%80%E9%83%A8%E4%BA%8B%E4%BB%B6%0Acontainer.addEventListener('touchstart'%2C%20handleTouchStart)%3B%0Acontainer.addEventListener('touchend'%2C%20handleTouchEnd)%3B%0Acontainer.addEventListener('touchmove'%2C%20handleTouchMove)%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 全局事件\u003c/span\u003e\n\u003cspan class=\"hljs-variable language_ inline\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;mousedown\u0026#x27;\u003c/span\u003e, handleMouseDown);\n\u003cspan class=\"hljs-variable language_ inline\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;mouseup\u0026#x27;\u003c/span\u003e, handleMouseUp);\n\u003cspan class=\"hljs-variable language_ inline\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;mousemove\u0026#x27;\u003c/span\u003e, handleMouseMove);\n\n\u003cspan class=\"hljs-comment inline\"\u003e// 容器局部事件\u003c/span\u003e\ncontainer.\u003cspan class=\"hljs-title function_ inline\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;touchstart\u0026#x27;\u003c/span\u003e, handleTouchStart);\ncontainer.\u003cspan class=\"hljs-title function_ inline\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;touchend\u0026#x27;\u003c/span\u003e, handleTouchEnd);\ncontainer.\u003cspan class=\"hljs-title function_ inline\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;touchmove\u0026#x27;\u003c/span\u003e, handleTouchMove);\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e鼠标事件绑定到document\u003c/strong\u003e: 确保用户拖拽时即使鼠标移出容器，交互也能继续\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e触摸事件绑定到容器\u003c/strong\u003e: 触摸事件的传播机制不同，绑定到容器更安全\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"可复用设计模式总结\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#可复用设计模式总结\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 可复用设计模式总结\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            可复用设计模式总结\n        \u003c/h2\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e通过这次深入的实现分析，我们可以提取出几个通用的设计模式。\u003c/p\u003e\n\u003ch3 id=\"粒子系统的通用架构\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#粒子系统的通用架构\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 粒子系统的通用架构\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            粒子系统的通用架构\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"%2F%2F%201.%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1%0Ainterface%20Particle%20%7B%0Ael%3A%20HTMLElement%3B%20%20%20%20%20%20%2F%2F%20DOM%E5%BC%95%E7%94%A8%0Ax%3A%20number%3B%20y%3A%20number%3B%20%2F%2F%20%E4%BD%8D%E7%BD%AE%0Avx%3A%20number%3B%20vy%3A%20number%3B%20%2F%2F%20%E9%80%9F%E5%BA%A6%0A%5Bkey%3A%20string%5D%3A%20any%3B%20%20%20%2F%2F%20%E5%85%B6%E4%BB%96%E5%B1%9E%E6%80%A7%0A%7D%0A%2F%2F%202.%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%AE%A1%E7%90%86%0Aconst%20createParticle%20%3D%20()%20%3D%3E%20%7B%20%2F*%20%E5%88%9B%E5%BB%BA%E9%80%BB%E8%BE%91%20*%2F%20%7D%3B%0Aconst%20updateParticle%20%3D%20(particle%3A%20Particle)%20%3D%3E%20%7B%20%2F*%20%E6%9B%B4%E6%96%B0%E9%80%BB%E8%BE%91%20*%2F%20%7D%3B%0Aconst%20destroyParticle%20%3D%20(particle%3A%20Particle)%20%3D%3E%20%7B%20%2F*%20%E9%94%80%E6%AF%81%E9%80%BB%E8%BE%91%20*%2F%20%7D%3B%0A%2F%2F%203.%20%E5%8A%A8%E7%94%BB%E5%BE%AA%E7%8E%AF%0Aconst%20animate%20%3D%20()%20%3D%3E%20%7B%0Aparticles.forEach(updateParticle)%3B%0ArequestAnimationFrame(animate)%3B%0A%7D%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 1. 数据结构设计\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003einterface\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eParticle\u003c/span\u003e {\n    \u003cspan class=\"hljs-attr inline\"\u003eel\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eHTMLElement\u003c/span\u003e;      \u003cspan class=\"hljs-comment inline\"\u003e// DOM引用\u003c/span\u003e\n    \u003cspan class=\"hljs-attr inline\"\u003ex\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003enumber\u003c/span\u003e; \u003cspan class=\"hljs-attr inline\"\u003ey\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003enumber\u003c/span\u003e; \u003cspan class=\"hljs-comment inline\"\u003e// 位置\u003c/span\u003e\n    \u003cspan class=\"hljs-attr inline\"\u003evx\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003enumber\u003c/span\u003e; \u003cspan class=\"hljs-attr inline\"\u003evy\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003enumber\u003c/span\u003e; \u003cspan class=\"hljs-comment inline\"\u003e// 速度\u003c/span\u003e\n    [\u003cspan class=\"hljs-attr inline\"\u003ekey\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e]: \u003cspan class=\"hljs-built_in inline\"\u003eany\u003c/span\u003e;   \u003cspan class=\"hljs-comment inline\"\u003e// 其他属性\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-comment inline\"\u003e// 2. 生命周期管理\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003ecreateParticle\u003c/span\u003e = (\u003cspan class=\"hljs-params inline\"\u003e\u003c/span\u003e) =\u0026gt; { \u003cspan class=\"hljs-comment inline\"\u003e/* 创建逻辑 */\u003c/span\u003e };\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003eupdateParticle\u003c/span\u003e = (\u003cspan class=\"hljs-params inline\"\u003e\u003cspan class=\"hljs-attr inline\"\u003eparticle\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eParticle\u003c/span\u003e\u003c/span\u003e) =\u0026gt; { \u003cspan class=\"hljs-comment inline\"\u003e/* 更新逻辑 */\u003c/span\u003e };\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003edestroyParticle\u003c/span\u003e = (\u003cspan class=\"hljs-params inline\"\u003e\u003cspan class=\"hljs-attr inline\"\u003eparticle\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eParticle\u003c/span\u003e\u003c/span\u003e) =\u0026gt; { \u003cspan class=\"hljs-comment inline\"\u003e/* 销毁逻辑 */\u003c/span\u003e };\n\n\u003cspan class=\"hljs-comment inline\"\u003e// 3. 动画循环\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003eanimate\u003c/span\u003e = (\u003cspan class=\"hljs-params inline\"\u003e\u003c/span\u003e) =\u0026gt; {\n    particles.\u003cspan class=\"hljs-title function_ inline\"\u003eforEach\u003c/span\u003e(updateParticle);\n    \u003cspan class=\"hljs-title function_ inline\"\u003erequestAnimationFrame\u003c/span\u003e(animate);\n};\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch3 id=\"物理模拟的基本模式\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#物理模拟的基本模式\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 物理模拟的基本模式\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            物理模拟的基本模式\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"%2F%2F%20%E5%8A%9B%E5%9C%BA%E8%AE%A1%E7%AE%97%E6%A8%A1%E5%BC%8F%0Aconst%20calculateForce%20%3D%20(particle%3A%20Particle%2C%20target%3A%20Position)%20%3D%3E%20%7B%0Aconst%20dx%20%3D%20particle.x%20-%20target.x%3B%0Aconst%20dy%20%3D%20particle.y%20-%20target.y%3B%0Aconst%20distance%20%3D%20Math.sqrt(dx%20*%20dx%20%2B%20dy%20*%20dy)%3B%0Aconst%20force%20%3D%20strength%20%2F%20(distance%20%2B%20epsilon)%3B%0Areturn%20%7B%0Afx%3A%20force%20*%20(dx%20%2F%20distance)%2C%0Afy%3A%20force%20*%20(dy%20%2F%20distance)%0A%7D%3B%0A%7D%3B%0A%2F%2F%20%E8%BE%B9%E7%95%8C%E5%A4%84%E7%90%86%E6%A8%A1%E5%BC%8F%0Aconst%20handleBoundaries%20%3D%20(particle%3A%20Particle%2C%20bounds%3A%20Bounds)%20%3D%3E%20%7B%0Aif%20(particle.x%20left)%20particle.x%20%3D%20bounds.right%3B%0Aif%20(particle.x%20%3E%20bounds.right)%20particle.x%20%3D%20bounds.left%3B%0Aif%20(particle.y%20top)%20particle.y%20%3D%20bounds.bottom%3B%0Aif%20(particle.y%20%3E%20bounds.bottom)%20particle.y%20%3D%20bounds.top%3B%0A%7D%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 力场计算模式\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003ecalculateForce\u003c/span\u003e = (\u003cspan class=\"hljs-params inline\"\u003e\u003cspan class=\"hljs-attr inline\"\u003eparticle\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eParticle\u003c/span\u003e, \u003cspan class=\"hljs-attr inline\"\u003etarget\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003ePosition\u003c/span\u003e\u003c/span\u003e) =\u0026gt; {\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e dx = particle.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e - target.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e dy = particle.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e - target.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e distance = \u003cspan class=\"hljs-title class_ inline\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003esqrt\u003c/span\u003e(dx * dx + dy * dy);\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e force = strength / (distance + epsilon);\n    \n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e {\n        \u003cspan class=\"hljs-attr inline\"\u003efx\u003c/span\u003e: force * (dx / distance),\n        \u003cspan class=\"hljs-attr inline\"\u003efy\u003c/span\u003e: force * (dy / distance)\n    };\n};\n\n\u003cspan class=\"hljs-comment inline\"\u003e// 边界处理模式\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003ehandleBoundaries\u003c/span\u003e = (\u003cspan class=\"hljs-params inline\"\u003e\u003cspan class=\"hljs-attr inline\"\u003eparticle\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eParticle\u003c/span\u003e, \u003cspan class=\"hljs-attr inline\"\u003ebounds\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eBounds\u003c/span\u003e\u003c/span\u003e) =\u0026gt; {\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (particle.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e \u0026lt; bounds.\u003cspan class=\"hljs-property inline\"\u003eleft\u003c/span\u003e) particle.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e = bounds.\u003cspan class=\"hljs-property inline\"\u003eright\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (particle.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e \u0026gt; bounds.\u003cspan class=\"hljs-property inline\"\u003eright\u003c/span\u003e) particle.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e = bounds.\u003cspan class=\"hljs-property inline\"\u003eleft\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (particle.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e \u0026lt; bounds.\u003cspan class=\"hljs-property inline\"\u003etop\u003c/span\u003e) particle.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e = bounds.\u003cspan class=\"hljs-property inline\"\u003ebottom\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (particle.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e \u0026gt; bounds.\u003cspan class=\"hljs-property inline\"\u003ebottom\u003c/span\u003e) particle.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e = bounds.\u003cspan class=\"hljs-property inline\"\u003etop\u003c/span\u003e;\n};\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch3 id=\"主题响应的设计模式\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#主题响应的设计模式\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 主题响应的设计模式\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            主题响应的设计模式\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"%2F%2F%20%E9%A2%9C%E8%89%B2%E7%B3%BB%E7%BB%9F%E6%A8%A1%E5%BC%8F%0Aconst%20createThemeColors%20%3D%20(baseTheme%3A%20Theme)%20%3D%3E%20%7B%0Aconst%20%5Bh%2C%20s%2C%20l%5D%20%3D%20hexToHsl(baseTheme.primary)%3B%0Areturn%20%7B%0Abackground%3A%20%60hsl(%24%7Bh%7D%2C%20%24%7Bs%7D%25%2C%20%24%7Bl%7D%25)%60%2C%0Aparticle%3A%20%60hsl(%24%7Bh%7D%2C%20%24%7BMath.max(s%20-%2020%2C%2020)%7D%25%2C%20%24%7Bl%20%2B%2020%7D%25)%60%2C%0A%2F%2F%20...%20%E5%85%B6%E4%BB%96%E9%A2%9C%E8%89%B2%0A%7D%3B%0A%7D%3B%0A%2F%2F%20%E4%B8%BB%E9%A2%98%E5%88%87%E6%8D%A2%E5%93%8D%E5%BA%94%E6%A8%A1%E5%BC%8F%0AuseEffect(()%20%3D%3E%20%7B%0Aconst%20colors%20%3D%20createThemeColors(currentTheme)%3B%0AupdateParticleColors(colors)%3B%0A%7D%2C%20%5BcurrentTheme%5D)%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 颜色系统模式\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003ecreateThemeColors\u003c/span\u003e = (\u003cspan class=\"hljs-params inline\"\u003e\u003cspan class=\"hljs-attr inline\"\u003ebaseTheme\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eTheme\u003c/span\u003e\u003c/span\u003e) =\u0026gt; {\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e [h, s, l] = \u003cspan class=\"hljs-title function_ inline\"\u003ehexToHsl\u003c/span\u003e(baseTheme.\u003cspan class=\"hljs-property inline\"\u003eprimary\u003c/span\u003e);\n    \n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e {\n        \u003cspan class=\"hljs-attr inline\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e`hsl(\u003cspan class=\"hljs-subst inline\"\u003e${h}\u003c/span\u003e, \u003cspan class=\"hljs-subst inline\"\u003e${s}\u003c/span\u003e%, \u003cspan class=\"hljs-subst inline\"\u003e${l}\u003c/span\u003e%)`\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr inline\"\u003eparticle\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e`hsl(\u003cspan class=\"hljs-subst inline\"\u003e${h}\u003c/span\u003e, \u003cspan class=\"hljs-subst inline\"\u003e${\u003cspan class=\"hljs-built_in inline\"\u003eMath\u003c/span\u003e.max(s - \u003cspan class=\"hljs-number inline\"\u003e20\u003c/span\u003e, \u003cspan class=\"hljs-number inline\"\u003e20\u003c/span\u003e)}\u003c/span\u003e%, \u003cspan class=\"hljs-subst inline\"\u003e${l + \u003cspan class=\"hljs-number inline\"\u003e20\u003c/span\u003e}\u003c/span\u003e%)`\u003c/span\u003e,\n        \u003cspan class=\"hljs-comment inline\"\u003e// ... 其他颜色\u003c/span\u003e\n    };\n};\n\n\u003cspan class=\"hljs-comment inline\"\u003e// 主题切换响应模式\u003c/span\u003e\n\u003cspan class=\"hljs-title function_ inline\"\u003euseEffect\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e colors = \u003cspan class=\"hljs-title function_ inline\"\u003ecreateThemeColors\u003c/span\u003e(currentTheme);\n    \u003cspan class=\"hljs-title function_ inline\"\u003eupdateParticleColors\u003c/span\u003e(colors);\n}, [currentTheme]);\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch3 id=\"响应式粒子布局模式\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#响应式粒子布局模式\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 响应式粒子布局模式\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            响应式粒子布局模式\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"%2F%2F%20%E5%93%8D%E5%BA%94%E5%BC%8F%E9%87%8D%E5%B8%83%E5%B1%80%E6%A8%A1%E5%BC%8F%0Aconst%20handleResize%20%3D%20useCallback(()%20%3D%3E%20%7B%0A%2F%2F%20%E6%B8%85%E7%90%86%E7%8E%B0%E6%9C%89%E7%B2%92%E5%AD%90%0Aparticles.forEach(particle%20%3D%3E%20particle.el.remove())%3B%0A%2F%2F%20%E9%87%8D%E6%96%B0%E5%88%9D%E5%A7%8B%E5%8C%96%0AinitializeParticles()%3B%0A%7D%2C%20%5B%5D)%3B%0AuseEffect(()%20%3D%3E%20%7B%0Awindow.addEventListener('resize'%2C%20handleResize)%3B%0Areturn%20()%20%3D%3E%20window.removeEventListener('resize'%2C%20handleResize)%3B%0A%7D%2C%20%5B%5D)%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 响应式重布局模式\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e handleResize = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment inline\"\u003e// 清理现有粒子\u003c/span\u003e\n    particles.\u003cspan class=\"hljs-title function_ inline\"\u003eforEach\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e\u003cspan class=\"hljs-params inline\"\u003eparticle\u003c/span\u003e =\u0026gt;\u003c/span\u003e particle.\u003cspan class=\"hljs-property inline\"\u003eel\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eremove\u003c/span\u003e());\n    \n    \u003cspan class=\"hljs-comment inline\"\u003e// 重新初始化\u003c/span\u003e\n    \u003cspan class=\"hljs-title function_ inline\"\u003einitializeParticles\u003c/span\u003e();\n}, []);\n\n\u003cspan class=\"hljs-title function_ inline\"\u003euseEffect\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-variable language_ inline\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;resize\u0026#x27;\u003c/span\u003e, handleResize);\n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-variable language_ inline\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eremoveEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;resize\u0026#x27;\u003c/span\u003e, handleResize);\n}, []);\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch3 id=\"性能优化的最佳实践\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#性能优化的最佳实践\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 性能优化的最佳实践\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            性能优化的最佳实践\n        \u003c/h3\u003e\n\u003col class=\"list-decimal list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e使用requestAnimationFrame而不是定时器\u003c/strong\u003e\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e用transform代替直接修改位置属性\u003c/strong\u003e\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e合理使用willChange提示\u003c/strong\u003e\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e及时清理DOM元素和事件监听器\u003c/strong\u003e\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e避免频繁的DOM查询，使用引用缓存\u003c/strong\u003e\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e在适当的时候使用防抖和节流\u003c/strong\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"完整源码全解析\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#完整源码全解析\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 完整源码全解析\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            完整源码全解析\n        \u003c/h2\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"'use%20client'%3B%0Aimport%20React%2C%20%7B%20useEffect%2C%20useRef%2C%20useCallback%20%7D%20from%20'react'%3B%0Aimport%20%7B%20useThemeStore%20%7D%20from%20'%40%2Flib%2Fstores%2FthemeStore'%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F**%0A*%20%E7%B2%92%E5%AD%90%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%0A*%20%E6%AF%8F%E4%B8%AA%E7%B2%92%E5%AD%90%E9%83%BD%E6%98%AF%E4%B8%80%E4%B8%AA%E7%8B%AC%E7%AB%8B%E7%9A%84%E7%89%A9%E7%90%86%E5%AE%9E%E4%BD%93%0A*%2F%0Ainterface%20Particle%20%7B%0Ael%3A%20HTMLDivElement%3B%20%20%2F%2F%20DOM%E5%85%83%E7%B4%A0%E5%BC%95%E7%94%A8%EF%BC%8C%E9%81%BF%E5%85%8D%E9%A2%91%E7%B9%81%E6%9F%A5%E8%AF%A2%0Ax%3A%20number%3B%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%BD%93%E5%89%8DX%E5%9D%90%E6%A0%87%EF%BC%88%E7%B2%BE%E7%A1%AE%E5%88%B0%E5%B0%8F%E6%95%B0%EF%BC%89%0Ay%3A%20number%3B%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%BD%93%E5%89%8DY%E5%9D%90%E6%A0%87%EF%BC%88%E7%B2%BE%E7%A1%AE%E5%88%B0%E5%B0%8F%E6%95%B0%EF%BC%89%0Avx%3A%20number%3B%20%20%20%20%20%20%20%20%20%20%2F%2F%20X%E6%96%B9%E5%90%91%E9%80%9F%E5%BA%A6%0Avy%3A%20number%3B%20%20%20%20%20%20%20%20%20%20%2F%2F%20Y%E6%96%B9%E5%90%91%E9%80%9F%E5%BA%A6%0Asize%3A%20number%3B%20%20%20%20%20%20%20%20%2F%2F%20%E7%B2%92%E5%AD%90%E5%9F%BA%E7%A1%80%E5%A4%A7%E5%B0%8F%0Adepth%3A%20number%3B%20%20%20%20%20%20%20%2F%2F%20%E6%B7%B1%E5%BA%A6%E5%B1%82%E6%AC%A1(0-1)%EF%BC%8C%E5%BD%B1%E5%93%8D%E5%A4%A7%E5%B0%8F%E3%80%81%E9%80%8F%E6%98%8E%E5%BA%A6%E3%80%81%E9%80%9F%E5%BA%A6%0A%7D%0A%2F**%0A*%20%E9%BC%A0%E6%A0%87%2F%E8%A7%A6%E6%91%B8%E7%8A%B6%E6%80%81%0A*%20%E7%94%A8%E4%BA%8E%E4%BA%A4%E4%BA%92%E5%8A%9B%E5%9C%BA%E8%AE%A1%E7%AE%97%0A*%2F%0Ainterface%20MouseState%20%7B%0Ax%3A%20number%3B%20%20%20%20%20%20%2F%2F%20%E9%BC%A0%E6%A0%87X%E5%9D%90%E6%A0%87%0Ay%3A%20number%3B%20%20%20%20%20%20%2F%2F%20%E9%BC%A0%E6%A0%87Y%E5%9D%90%E6%A0%87%0Adown%3A%20boolean%3B%20%20%2F%2F%20%E6%98%AF%E5%90%A6%E6%8C%89%E4%B8%8B%E7%8A%B6%E6%80%81%0A%7D%0Aconst%20FoamBackground%3A%20React.FC%20%3D%20()%20%3D%3E%20%7B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E5%BC%95%E7%94%A8%E5%AE%9A%E4%B9%89%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Aconst%20containerRef%20%3D%20useRefHTMLDivElement%3E(null)%3B%20%20%20%20%20%20%20%20%2F%2F%20%E5%AE%B9%E5%99%A8DOM%E5%BC%95%E7%94%A8%0Aconst%20particlesRef%20%3D%20useRefParticle%5B%5D%3E(%5B%5D)%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E7%B2%92%E5%AD%90%E6%95%B0%E7%BB%84%E5%BC%95%E7%94%A8%0Aconst%20mouseRef%20%3D%20useRefMouseState%3E(%7B%20x%3A%200%2C%20y%3A%200%2C%20down%3A%20false%20%7D)%3B%20%2F%2F%20%E9%BC%A0%E6%A0%87%E7%8A%B6%E6%80%81%E5%BC%95%E7%94%A8%0Aconst%20animationIdRef%20%3D%20useRefnumber%20%7C%20null%3E(null)%3B%20%20%20%20%20%20%20%2F%2F%20%E5%8A%A8%E7%94%BBID%E5%BC%95%E7%94%A8%EF%BC%8C%E7%94%A8%E4%BA%8E%E5%8F%96%E6%B6%88%E5%8A%A8%E7%94%BB%0Aconst%20%7B%20currentTheme%20%7D%20%3D%20useThemeStore()%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%B8%BB%E9%A2%98%E7%8A%B6%E6%80%81%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E9%85%8D%E7%BD%AE%E5%B8%B8%E9%87%8F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Aconst%20NUM_PARTICLES%20%3D%20300%3B%20%20%2F%2F%20%E7%B2%92%E5%AD%90%E6%80%BB%E6%95%B0%EF%BC%8C%E5%B9%B3%E8%A1%A1%E8%A7%86%E8%A7%89%E6%95%88%E6%9E%9C%E4%B8%8E%E6%80%A7%E8%83%BD%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F**%0A*%20%E9%98%B2%E6%8A%96%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%0A*%20%E7%94%A8%E4%BA%8E%E4%BC%98%E5%8C%96resize%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%EF%BC%8C%E9%81%BF%E5%85%8D%E9%A2%91%E7%B9%81%E9%87%8D%E5%BB%BA%E7%B2%92%E5%AD%90%0A*%20%40param%20func%20%E8%A6%81%E9%98%B2%E6%8A%96%E7%9A%84%E5%87%BD%E6%95%B0%0A*%20%40param%20wait%20%E9%98%B2%E6%8A%96%E5%BB%B6%E8%BF%9F%E6%97%B6%E9%97%B4%EF%BC%88%E6%AF%AB%E7%A7%92%EF%BC%89%0A*%2F%0Aconst%20debounce%20%3D%20useCallback((func%3A%20Function%2C%20wait%3A%20number)%20%3D%3E%20%7B%0Alet%20timeout%3A%20NodeJS.Timeout%3B%0Areturn%20function%20executedFunction(...args%3A%20any%5B%5D)%20%7B%0Aconst%20later%20%3D%20()%20%3D%3E%20%7B%0AclearTimeout(timeout)%3B%0Afunc(...args)%3B%0A%7D%3B%0AclearTimeout(timeout)%3B%0Atimeout%20%3D%20setTimeout(later%2C%20wait)%3B%0A%7D%3B%0A%7D%2C%20%5B%5D)%3B%0A%2F**%0A*%20%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E9%A2%9C%E8%89%B2%E8%BD%ACHSL%E9%A2%9C%E8%89%B2%E7%A9%BA%E9%97%B4%0A*%20HSL%E6%9B%B4%E9%80%82%E5%90%88%E7%94%9F%E6%88%90%E7%9B%B8%E8%BF%91%E7%9A%84%E8%89%B2%E5%BD%A9%E5%8F%98%E5%8C%96%0A*%20%40param%20hex%20%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E9%A2%9C%E8%89%B2%E5%80%BC%EF%BC%88%E5%A6%82%20%22%23ff6600%22%EF%BC%89%0A*%20%40returns%20%5B%E8%89%B2%E7%9B%B8%2C%20%E9%A5%B1%E5%92%8C%E5%BA%A6%2C%20%E6%98%8E%E5%BA%A6%5D%20%E6%95%B0%E7%BB%84%0A*%2F%0Aconst%20hexToHsl%20%3D%20useCallback((hex%3A%20string)%20%3D%3E%20%7B%0A%2F%2F%20%E5%B0%8616%E8%BF%9B%E5%88%B6%E8%BD%AC%E6%8D%A2%E4%B8%BARGB%EF%BC%880-1%E8%8C%83%E5%9B%B4%EF%BC%89%0Aconst%20r%20%3D%20parseInt(hex.slice(1%2C%203)%2C%2016)%20%2F%20255%3B%0Aconst%20g%20%3D%20parseInt(hex.slice(3%2C%205)%2C%2016)%20%2F%20255%3B%0Aconst%20b%20%3D%20parseInt(hex.slice(5%2C%207)%2C%2016)%20%2F%20255%3B%0A%2F%2F%20%E8%AE%A1%E7%AE%97%E6%9C%80%E5%A4%A7%E5%80%BC%E5%92%8C%E6%9C%80%E5%B0%8F%E5%80%BC%0Aconst%20max%20%3D%20Math.max(r%2C%20g%2C%20b)%3B%0Aconst%20min%20%3D%20Math.min(r%2C%20g%2C%20b)%3B%0Alet%20h%20%3D%200%2C%20s%20%3D%200%2C%20l%20%3D%20(max%20%2B%20min)%20%2F%202%3B%20%20%2F%2F%20%E6%98%8E%E5%BA%A6%E6%98%AF%E6%9C%80%E5%A4%A7%E5%80%BC%E5%92%8C%E6%9C%80%E5%B0%8F%E5%80%BC%E7%9A%84%E5%B9%B3%E5%9D%87%0Aif%20(max%20!%3D%3D%20min)%20%7B%0Aconst%20d%20%3D%20max%20-%20min%3B%0A%2F%2F%20%E6%A0%B9%E6%8D%AE%E6%98%8E%E5%BA%A6%E8%AE%A1%E7%AE%97%E9%A5%B1%E5%92%8C%E5%BA%A6%0As%20%3D%20l%20%3E%200.5%20%3F%20d%20%2F%20(2%20-%20max%20-%20min)%20%3A%20d%20%2F%20(max%20%2B%20min)%3B%0A%2F%2F%20%E6%A0%B9%E6%8D%AE%E4%B8%BB%E5%AF%BC%E9%A2%9C%E8%89%B2%E8%AE%A1%E7%AE%97%E8%89%B2%E7%9B%B8%0Aswitch%20(max)%20%7B%0Acase%20r%3A%20h%20%3D%20(g%20-%20b)%20%2F%20d%20%2B%20(g%206%20%3A%200)%3B%20break%3B%20%20%2F%2F%20%E7%BA%A2%E8%89%B2%E4%B8%BB%E5%AF%BC%0Acase%20g%3A%20h%20%3D%20(b%20-%20r)%20%2F%20d%20%2B%202%3B%20break%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E7%BB%BF%E8%89%B2%E4%B8%BB%E5%AF%BC%0Acase%20b%3A%20h%20%3D%20(r%20-%20g)%20%2F%20d%20%2B%204%3B%20break%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E8%93%9D%E8%89%B2%E4%B8%BB%E5%AF%BC%0A%7D%0Ah%20%2F%3D%206%3B%20%20%2F%2F%20%E8%BD%AC%E6%8D%A2%E4%B8%BA0-1%E8%8C%83%E5%9B%B4%0A%7D%0A%2F%2F%20%E8%BF%94%E5%9B%9E%E6%A0%87%E5%87%86HSL%E6%A0%BC%E5%BC%8F%0Areturn%20%5BMath.round(h%20*%20360)%2C%20Math.round(s%20*%20100)%2C%20Math.round(l%20*%20100)%5D%3B%0A%7D%2C%20%5B%5D)%3B%0A%2F**%0A*%20%E6%A0%B9%E6%8D%AE%E5%BD%93%E5%89%8D%E4%B8%BB%E9%A2%98%E7%94%9F%E6%88%90%E5%8A%A8%E6%80%81%E9%A2%9C%E8%89%B2%0A*%20%E6%B7%B1%E8%89%B2%E4%B8%BB%E9%A2%98%E4%BD%BF%E7%94%A8%E6%9B%B4%E6%B7%B1%E3%80%81%E6%9B%B4%E9%A5%B1%E5%92%8C%E7%9A%84%E9%A2%9C%E8%89%B2%0A*%20%E6%B5%85%E8%89%B2%E4%B8%BB%E9%A2%98%E4%BD%BF%E7%94%A8%E6%9B%B4%E4%BA%AE%E3%80%81%E6%9B%B4%E6%9F%94%E5%92%8C%E7%9A%84%E9%A2%9C%E8%89%B2%0A*%2F%0Aconst%20getThemeColors%20%3D%20useCallback(()%20%3D%3E%20%7B%0Aconst%20%5BprimaryH%2C%20primaryS%5D%20%3D%20hexToHsl(currentTheme.colors.primary)%3B%0Aconst%20%5BaccentH%2C%20accentS%5D%20%3D%20hexToHsl(currentTheme.colors.accent)%3B%0Aconst%20isDark%20%3D%20currentTheme.id%20%3D%3D%3D%20'dark'%3B%0Aif%20(isDark)%20%7B%0A%2F%2F%20%E6%B7%B1%E8%89%B2%E4%B8%BB%E9%A2%98%EF%BC%9A%E5%A2%9E%E5%8A%A0%E9%A5%B1%E5%92%8C%E5%BA%A6%EF%BC%8C%E9%99%8D%E4%BD%8E%E6%98%8E%E5%BA%A6%0Areturn%20%7B%0Abackground%3A%20%60linear-gradient(135deg%2C%20hsl(%24%7BprimaryH%7D%2C%20%24%7BMath.max(primaryS%20%2B%2010%2C%2040)%7D%25%2C%2025%25)%2C%20hsl(%24%7BaccentH%7D%2C%20%24%7BMath.max(accentS%20%2B%205%2C%2035)%7D%25%2C%2020%25))%60%2C%0Aparticle%3A%20%60hsl(%24%7BprimaryH%7D%2C%20%24%7BMath.max(primaryS%20%2B%2015%2C%2050)%7D%25%2C%2045%25)%60%0A%7D%3B%0A%7D%20else%20%7B%0A%2F%2F%20%E6%B5%85%E8%89%B2%E4%B8%BB%E9%A2%98%EF%BC%9A%E9%99%8D%E4%BD%8E%E9%A5%B1%E5%92%8C%E5%BA%A6%EF%BC%8C%E6%8F%90%E9%AB%98%E6%98%8E%E5%BA%A6%0Areturn%20%7B%0Abackground%3A%20%60linear-gradient(135deg%2C%20hsl(%24%7BprimaryH%7D%2C%20%24%7BMath.max(primaryS%20-%2020%2C%2020)%7D%25%2C%2060%25)%2C%20hsl(%24%7BaccentH%7D%2C%20%24%7BMath.max(accentS%20-%2010%2C%2030)%7D%25%2C%2050%25))%60%2C%0Aparticle%3A%20%60hsl(%24%7BprimaryH%7D%2C%20%24%7BMath.max(primaryS%20-%2010%2C%2035)%7D%25%2C%2075%25)%60%0A%7D%3B%0A%7D%0A%7D%2C%20%5BcurrentTheme%2C%20hexToHsl%5D)%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E9%BC%A0%E6%A0%87%E5%92%8C%E8%A7%A6%E6%91%B8%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F**%0A*%20%E6%9B%B4%E6%96%B0%E9%BC%A0%E6%A0%87%E4%BD%8D%E7%BD%AE%0A*%20%E5%85%BC%E5%AE%B9%E9%BC%A0%E6%A0%87%E4%BA%8B%E4%BB%B6%E5%92%8C%E8%A7%A6%E6%91%B8%E4%BA%8B%E4%BB%B6%0A*%2F%0Aconst%20updateMousePos%20%3D%20useCallback((e%3A%20MouseEvent%20%7C%20Touch)%20%3D%3E%20%7B%0AmouseRef.current.x%20%3D%20e.clientX%3B%0AmouseRef.current.y%20%3D%20e.clientY%3B%0A%7D%2C%20%5B%5D)%3B%0A%2F**%0A*%20%E9%BC%A0%E6%A0%87%E6%8C%89%E4%B8%8B%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%0A*%20%E6%BF%80%E6%B4%BB%E4%BA%A4%E4%BA%92%E5%8A%9B%E5%9C%BA%0A*%2F%0Aconst%20handleMouseDown%20%3D%20useCallback((e%3A%20MouseEvent)%20%3D%3E%20%7B%0AmouseRef.current.down%20%3D%20true%3B%0AupdateMousePos(e)%3B%0A%7D%2C%20%5BupdateMousePos%5D)%3B%0A%2F**%0A*%20%E9%BC%A0%E6%A0%87%E9%87%8A%E6%94%BE%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%0A*%20%E5%85%B3%E9%97%AD%E4%BA%A4%E4%BA%92%E5%8A%9B%E5%9C%BA%0A*%2F%0Aconst%20handleMouseUp%20%3D%20useCallback(()%20%3D%3E%20%7B%0AmouseRef.current.down%20%3D%20false%3B%0A%7D%2C%20%5B%5D)%3B%0A%2F**%0A*%20%E9%BC%A0%E6%A0%87%E7%A7%BB%E5%8A%A8%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%0A*%20%E5%8F%AA%E6%9C%89%E5%9C%A8%E6%8C%89%E4%B8%8B%E7%8A%B6%E6%80%81%E6%89%8D%E6%9B%B4%E6%96%B0%E4%BD%8D%E7%BD%AE%EF%BC%8C%E5%87%8F%E5%B0%91%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84%E8%AE%A1%E7%AE%97%0A*%2F%0Aconst%20handleMouseMove%20%3D%20useCallback((e%3A%20MouseEvent)%20%3D%3E%20%7B%0Aif%20(mouseRef.current.down)%20updateMousePos(e)%3B%0A%7D%2C%20%5BupdateMousePos%5D)%3B%0A%2F**%0A*%20%E8%A7%A6%E6%91%B8%E5%BC%80%E5%A7%8B%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%0A*%20%E7%A7%BB%E5%8A%A8%E8%AE%BE%E5%A4%87%E7%9A%84%E4%BA%A4%E4%BA%92%E6%94%AF%E6%8C%81%0A*%2F%0Aconst%20handleTouchStart%20%3D%20useCallback((e%3A%20TouchEvent)%20%3D%3E%20%7B%0AmouseRef.current.down%20%3D%20true%3B%0AupdateMousePos(e.touches%5B0%5D)%3B%20%20%2F%2F%20%E5%8F%AA%E5%8F%96%E7%AC%AC%E4%B8%80%E4%B8%AA%E8%A7%A6%E6%91%B8%E7%82%B9%0A%7D%2C%20%5BupdateMousePos%5D)%3B%0A%2F**%0A*%20%E8%A7%A6%E6%91%B8%E7%BB%93%E6%9D%9F%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%0A*%2F%0Aconst%20handleTouchEnd%20%3D%20useCallback(()%20%3D%3E%20%7B%0AmouseRef.current.down%20%3D%20false%3B%0A%7D%2C%20%5B%5D)%3B%0A%2F**%0A*%20%E8%A7%A6%E6%91%B8%E7%A7%BB%E5%8A%A8%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%0A*%2F%0Aconst%20handleTouchMove%20%3D%20useCallback((e%3A%20TouchEvent)%20%3D%3E%20%7B%0Aif%20(mouseRef.current.down)%20updateMousePos(e.touches%5B0%5D)%3B%0A%7D%2C%20%5BupdateMousePos%5D)%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E7%B2%92%E5%AD%90%E7%B3%BB%E7%BB%9F%E6%A0%B8%E5%BF%83%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F**%0A*%20%E5%88%9D%E5%A7%8B%E5%8C%96%E7%B2%92%E5%AD%90%E7%B3%BB%E7%BB%9F%0A*%20%E5%88%9B%E5%BB%BA%E6%8C%87%E5%AE%9A%E6%95%B0%E9%87%8F%E7%9A%84%E7%B2%92%E5%AD%90%E5%B9%B6%E5%88%86%E5%B8%83%E5%9C%A8%E5%B1%8F%E5%B9%95%E4%B8%8A%0A*%2F%0Aconst%20initializeParticles%20%3D%20useCallback(()%20%3D%3E%20%7B%0Aconst%20container%20%3D%20containerRef.current%3B%0Aif%20(!container)%20return%3B%0A%2F%2F%20%E6%B8%85%E7%90%86%E7%8E%B0%E6%9C%89%E7%B2%92%E5%AD%90%EF%BC%8C%E9%98%B2%E6%AD%A2%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%0AparticlesRef.current.forEach(p%20%3D%3E%20p.el.remove())%3B%0AparticlesRef.current%20%3D%20%5B%5D%3B%0Aconst%20width%20%3D%20window.innerWidth%3B%0Aconst%20height%20%3D%20window.innerHeight%3B%0Aconst%20colors%20%3D%20getThemeColors()%3B%0A%2F%2F%20%E5%88%9B%E5%BB%BA%E6%8C%87%E5%AE%9A%E6%95%B0%E9%87%8F%E7%9A%84%E7%B2%92%E5%AD%90%0Afor%20(let%20i%20%3D%200%3B%20i%20NUM_PARTICLES%3B%20i%2B%2B)%20%7B%0A%2F%2F%20%E5%88%9B%E5%BB%BADOM%E5%85%83%E7%B4%A0%0Aconst%20el%20%3D%20document.createElement('div')%3B%0Ael.style.position%20%3D%20'absolute'%3B%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E7%BB%9D%E5%AF%B9%E5%AE%9A%E4%BD%8D%EF%BC%8C%E8%84%B1%E7%A6%BB%E6%96%87%E6%A1%A3%E6%B5%81%0Ael.style.borderRadius%20%3D%20'50%25'%3B%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%9C%86%E5%BD%A2%E7%B2%92%E5%AD%90%0Ael.style.backgroundColor%20%3D%20colors.particle%3B%20%2F%2F%20%E4%B8%BB%E9%A2%98%E8%89%B2%0Ael.style.pointerEvents%20%3D%20'none'%3B%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%B8%8D%E5%93%8D%E5%BA%94%E9%BC%A0%E6%A0%87%E4%BA%8B%E4%BB%B6%0Ael.style.willChange%20%3D%20'transform%2C%20opacity'%3B%20%2F%2F%20%E6%8F%90%E7%A4%BA%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BC%98%E5%8C%96%0Acontainer.appendChild(el)%3B%0A%2F%2F%20%E9%9A%8F%E6%9C%BA%E5%A4%A7%E5%B0%8F%EF%BC%882-6px%EF%BC%89%0Aconst%20size%20%3D%202%20%2B%20Math.random()%20*%204%3B%0Ael.style.width%20%3D%20%60%24%7Bsize%7Dpx%60%3B%0Ael.style.height%20%3D%20%60%24%7Bsize%7Dpx%60%3B%0A%2F%2F%20%E9%9A%8F%E6%9C%BA%E6%B7%B1%E5%BA%A6%E5%92%8C%E4%BD%8D%E7%BD%AE%0Aconst%20depth%20%3D%20Math.random()%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%200-1%E7%9A%84%E6%B7%B1%E5%BA%A6%E5%80%BC%0Aconst%20x%20%3D%20Math.random()%20*%20width%3B%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E9%9A%8F%E6%9C%BAX%E4%BD%8D%E7%BD%AE%0Aconst%20y%20%3D%20Math.random()%20*%20height%3B%20%20%20%20%20%20%20%20%20%2F%2F%20%E9%9A%8F%E6%9C%BAY%E4%BD%8D%E7%BD%AE%0A%2F%2F%20%E5%88%9B%E5%BB%BA%E7%B2%92%E5%AD%90%E5%AF%B9%E8%B1%A1%0AparticlesRef.current.push(%7B%0Ael%2C%0Ax%2C%20y%2C%0Avx%3A%200%2C%20vy%3A%200%2C%20%20%20%20%2F%2F%20%E5%88%9D%E5%A7%8B%E9%80%9F%E5%BA%A6%E4%B8%BA0%0Asize%2C%20depth%0A%7D)%3B%0A%7D%0A%7D%2C%20%5BgetThemeColors%5D)%3B%0A%2F**%0A*%20%E5%8A%A8%E7%94%BB%E5%BE%AA%E7%8E%AF%E5%87%BD%E6%95%B0%0A*%20%E8%BF%99%E6%98%AF%E6%95%B4%E4%B8%AA%E7%B2%92%E5%AD%90%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%BF%83%E8%84%8F%EF%BC%8C%E6%AF%8F%E5%B8%A7%E9%83%BD%E4%BC%9A%E8%B0%83%E7%94%A8%0A*%2F%0Aconst%20animate%20%3D%20useCallback(()%20%3D%3E%20%7B%0Aconst%20mouse%20%3D%20mouseRef.current%3B%0Aconst%20width%20%3D%20window.innerWidth%3B%0Aconst%20height%20%3D%20window.innerHeight%3B%0A%2F%2F%20%E9%81%8D%E5%8E%86%E6%89%80%E6%9C%89%E7%B2%92%E5%AD%90%E8%BF%9B%E8%A1%8C%E7%89%A9%E7%90%86%E6%9B%B4%E6%96%B0%0Afor%20(let%20p%20of%20particlesRef.current)%20%7B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E5%9F%BA%E7%A1%80%E6%BC%82%E7%A7%BB%E5%8A%9B%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F%2F%20%E6%A8%A1%E6%8B%9F%E8%87%AA%E7%84%B6%E7%9A%84%E6%B5%81%E4%BD%93%E8%BF%90%E5%8A%A8%0Ap.vx%20%2B%3D%200.01%20*%20p.depth%3B%20%20%20%2F%2F%20X%E6%96%B9%E5%90%91%E5%9F%BA%E7%A1%80%E6%BC%82%E7%A7%BB%0Ap.vy%20%2B%3D%200.005%20*%20p.depth%3B%20%20%2F%2F%20Y%E6%96%B9%E5%90%91%E5%9F%BA%E7%A1%80%E6%BC%82%E7%A7%BB%EF%BC%88%E7%95%A5%E5%B0%8F%EF%BC%8C%E6%A8%A1%E6%8B%9F%E9%87%8D%E5%8A%9B%E5%BD%B1%E5%93%8D%EF%BC%89%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E4%BA%A4%E4%BA%92%E5%8A%9B%E5%9C%BA%E8%AE%A1%E7%AE%97%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Aif%20(mouse.down)%20%7B%0A%2F%2F%20%E8%AE%A1%E7%AE%97%E7%B2%92%E5%AD%90%E5%88%B0%E9%BC%A0%E6%A0%87%E7%9A%84%E5%90%91%E9%87%8F%0Aconst%20dx%20%3D%20p.x%20-%20mouse.x%3B%0Aconst%20dy%20%3D%20p.y%20-%20mouse.y%3B%0A%2F%2F%20%E8%AE%A1%E7%AE%97%E8%B7%9D%E7%A6%BB%EF%BC%88%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E8%B7%9D%E7%A6%BB%EF%BC%89%0Aconst%20dist%20%3D%20Math.sqrt(dx%20*%20dx%20%2B%20dy%20*%20dy)%3B%0A%2F%2F%20%E5%9C%A8%E5%BD%B1%E5%93%8D%E8%8C%83%E5%9B%B4%E5%86%85%E6%96%BD%E5%8A%A0%E6%8E%92%E6%96%A5%E5%8A%9B%0Aif%20(dist%20100)%20%7B%0A%2F%2F%20%E5%8F%8D%E5%B9%B3%E6%96%B9%E5%8A%9B%E5%9C%BA%EF%BC%9A%E8%B7%9D%E7%A6%BB%E8%B6%8A%E8%BF%91%EF%BC%8C%E5%8A%9B%E8%B6%8A%E5%A4%A7%0Aconst%20baseForce%20%3D%20100%20%2F%20(dist%20%2B%2010)%3B%20%20%2F%2F%20%2B10%E9%81%BF%E5%85%8D%E9%99%A4%E9%9B%B6%E9%94%99%E8%AF%AF%0Aconst%20force%20%3D%20baseForce%20*%20p.depth%3B%20%20%20%20%20%2F%2F%20%E6%B7%B1%E5%BA%A6%E5%BD%B1%E5%93%8D%E5%8A%9B%E7%9A%84%E5%A4%A7%E5%B0%8F%0A%2F%2F%20%E8%AE%A1%E7%AE%97%E5%8A%9B%E7%9A%84%E6%96%B9%E5%90%91%EF%BC%88%E5%8D%95%E4%BD%8D%E5%90%91%E9%87%8F%EF%BC%89%E5%B9%B6%E5%BA%94%E7%94%A8%0Ap.vx%20%2B%3D%20force%20*%20(dx%20%2F%20dist)%3B%20%20%2F%2F%20X%E6%96%B9%E5%90%91%E5%88%86%E5%8A%9B%0Ap.vy%20%2B%3D%20force%20*%20(dy%20%2F%20dist)%3B%20%20%2F%2F%20Y%E6%96%B9%E5%90%91%E5%88%86%E5%8A%9B%0A%7D%0A%7D%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E7%89%A9%E7%90%86%E7%B3%BB%E7%BB%9F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F%2F%20%E5%BA%94%E7%94%A8%E6%91%A9%E6%93%A6%E5%8A%9B%EF%BC%88%E7%A9%BA%E6%B0%94%E9%98%BB%E5%8A%9B%EF%BC%89%0Ap.vx%20*%3D%200.95%3B%20%20%2F%2F%20X%E6%96%B9%E5%90%91%E6%91%A9%E6%93%A6%0Ap.vy%20*%3D%200.95%3B%20%20%2F%2F%20Y%E6%96%B9%E5%90%91%E6%91%A9%E6%93%A6%0A%2F%2F%20%E6%9B%B4%E6%96%B0%E4%BD%8D%E7%BD%AE%0Ap.x%20%2B%3D%20p.vx%3B%0Ap.y%20%2B%3D%20p.vy%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E8%BE%B9%E7%95%8C%E5%A4%84%E7%90%86%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F%2F%20%E7%8E%AF%E7%BB%95%E8%BE%B9%E7%95%8C%EF%BC%9A%E7%B2%92%E5%AD%90%E4%BB%8E%E4%B8%80%E8%BE%B9%E5%87%BA%E5%8E%BB%EF%BC%8C%E4%BB%8E%E5%8F%A6%E4%B8%80%E8%BE%B9%E8%BF%9B%E6%9D%A5%0Aif%20(p.x%2010)%20p.x%20%3D%20width%20%2B%2010%3B%20%20%20%20%2F%2F%20%E5%B7%A6%E8%BE%B9%E7%95%8C%20%E2%86%92%20%E5%8F%B3%E8%BE%B9%E7%95%8C%0Aif%20(p.x%20%3E%20width%20%2B%2010)%20p.x%20%3D%20-10%3B%20%20%20%20%2F%2F%20%E5%8F%B3%E8%BE%B9%E7%95%8C%20%E2%86%92%20%E5%B7%A6%E8%BE%B9%E7%95%8C%0Aif%20(p.y%2010)%20p.y%20%3D%20height%20%2B%2010%3B%20%20%20%2F%2F%20%E4%B8%8A%E8%BE%B9%E7%95%8C%20%E2%86%92%20%E4%B8%8B%E8%BE%B9%E7%95%8C%0Aif%20(p.y%20%3E%20height%20%2B%2010)%20p.y%20%3D%20-10%3B%20%20%20%2F%2F%20%E4%B8%8B%E8%BE%B9%E7%95%8C%20%E2%86%92%20%E4%B8%8A%E8%BE%B9%E7%95%8C%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E8%A7%86%E8%A7%89%E6%95%88%E6%9E%9C%E6%9B%B4%E6%96%B0%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F%2F%20%E5%9F%BA%E4%BA%8E%E6%B7%B1%E5%BA%A6%E7%9A%84%E8%A7%86%E8%A7%89%E5%B1%82%E6%AC%A1%0Aconst%20scale%20%3D%200.6%20%2B%200.4%20*%20p.depth%3B%20%20%20%20%2F%2F%20%E7%BC%A9%E6%94%BE%EF%BC%9A0.6-1.0%0Aconst%20opacity%20%3D%200.4%20%2B%200.6%20*%20p.depth%3B%20%20%2F%2F%20%E9%80%8F%E6%98%8E%E5%BA%A6%EF%BC%9A0.4-1.0%0A%2F%2F%20%E5%BA%94%E7%94%A8%E5%8F%98%E6%8D%A2%EF%BC%88%E4%BD%BF%E7%94%A8transform%E4%BC%98%E5%8C%96%E6%80%A7%E8%83%BD%EF%BC%89%0Ap.el.style.transform%20%3D%20%60translate(%24%7Bp.x%7Dpx%2C%20%24%7Bp.y%7Dpx)%20scale(%24%7Bscale%7D)%60%3B%0Ap.el.style.opacity%20%3D%20opacity.toString()%3B%0A%7D%0A%2F%2F%20%E8%AF%B7%E6%B1%82%E4%B8%8B%E4%B8%80%E5%B8%A7%E5%8A%A8%E7%94%BB%0AanimationIdRef.current%20%3D%20requestAnimationFrame(animate)%3B%0A%7D%2C%20%5B%5D)%3B%0A%2F**%0A*%20%E7%AA%97%E5%8F%A3%E5%A4%A7%E5%B0%8F%E6%94%B9%E5%8F%98%E5%A4%84%E7%90%86%0A*%20%E9%87%8D%E6%96%B0%E5%88%9D%E5%A7%8B%E5%8C%96%E7%B2%92%E5%AD%90%E5%88%86%E5%B8%83%0A*%2F%0Aconst%20handleResize%20%3D%20useCallback(()%20%3D%3E%20%7B%0A%2F%2F%20%E9%87%8D%E6%96%B0%E5%88%9D%E5%A7%8B%E5%8C%96%E7%B2%92%E5%AD%90%E5%88%86%E5%B8%83%E4%BB%A5%E9%80%82%E5%BA%94%E6%96%B0%E7%9A%84%E7%AA%97%E5%8F%A3%E5%B0%BA%E5%AF%B8%0AinitializeParticles()%3B%0A%7D%2C%20%5BinitializeParticles%5D)%3B%0A%2F**%0A*%20%E9%98%B2%E6%8A%96%E7%89%88%E6%9C%AC%E7%9A%84resize%E5%A4%84%E7%90%86%E5%99%A8%0A*%20%E9%81%BF%E5%85%8D%E7%AA%97%E5%8F%A3%E6%8B%96%E6%8B%BD%E6%97%B6%E9%A2%91%E7%B9%81%E9%87%8D%E5%BB%BA%E7%B2%92%E5%AD%90%0A*%2F%0Aconst%20debouncedHandleResize%20%3D%20useCallback(%0Adebounce(handleResize%2C%201000)%2C%20%20%2F%2F%201%E7%A7%92%E9%98%B2%E6%8A%96%E5%BB%B6%E8%BF%9F%0A%5Bdebounce%2C%20handleResize%5D%0A)%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%AE%A1%E7%90%86%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F**%0A*%20%E7%BB%84%E4%BB%B6%E6%8C%82%E8%BD%BD%E5%92%8C%E6%B8%85%E7%90%86%E6%95%88%E6%9E%9C%0A*%20%E7%AE%A1%E7%90%86%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E5%99%A8%E5%92%8C%E5%8A%A8%E7%94%BB%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%0A*%2F%0AuseEffect(()%20%3D%3E%20%7B%0A%2F%2F%20%E5%88%9D%E5%A7%8B%E5%8C%96%E7%B2%92%E5%AD%90%0AinitializeParticles()%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E5%99%A8%E6%B3%A8%E5%86%8C%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F%2F%20%E5%85%A8%E5%B1%80%E9%BC%A0%E6%A0%87%E4%BA%8B%E4%BB%B6%EF%BC%88%E7%A1%AE%E4%BF%9D%E6%8B%96%E6%8B%BD%E6%97%B6%E5%8D%B3%E4%BD%BF%E7%A6%BB%E5%BC%80%E5%AE%B9%E5%99%A8%E4%B9%9F%E8%83%BD%E7%BB%A7%E7%BB%AD%EF%BC%89%0Adocument.addEventListener('mousedown'%2C%20handleMouseDown)%3B%0Adocument.addEventListener('mouseup'%2C%20handleMouseUp)%3B%0Adocument.addEventListener('mousemove'%2C%20handleMouseMove)%3B%0A%2F%2F%20%E5%AE%B9%E5%99%A8%E8%A7%A6%E6%91%B8%E4%BA%8B%E4%BB%B6%EF%BC%88%E7%A7%BB%E5%8A%A8%E8%AE%BE%E5%A4%87%E6%94%AF%E6%8C%81%EF%BC%89%0Aconst%20container%20%3D%20containerRef.current%3B%0Aif%20(container)%20%7B%0Acontainer.addEventListener('touchstart'%2C%20handleTouchStart)%3B%0Acontainer.addEventListener('touchend'%2C%20handleTouchEnd)%3B%0Acontainer.addEventListener('touchmove'%2C%20handleTouchMove)%3B%0A%7D%0A%2F%2F%20%E7%AA%97%E5%8F%A3resize%E4%BA%8B%E4%BB%B6%0Awindow.addEventListener('resize'%2C%20debouncedHandleResize)%3B%0A%2F%2F%20%E5%90%AF%E5%8A%A8%E5%8A%A8%E7%94%BB%E5%BE%AA%E7%8E%AF%0Aanimate()%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E6%B8%85%E7%90%86%E5%87%BD%E6%95%B0%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Areturn%20()%20%3D%3E%20%7B%0A%2F%2F%20%E7%A7%BB%E9%99%A4%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E5%99%A8%0Adocument.removeEventListener('mousedown'%2C%20handleMouseDown)%3B%0Adocument.removeEventListener('mouseup'%2C%20handleMouseUp)%3B%0Adocument.removeEventListener('mousemove'%2C%20handleMouseMove)%3B%0Aif%20(container)%20%7B%0Acontainer.removeEventListener('touchstart'%2C%20handleTouchStart)%3B%0Acontainer.removeEventListener('touchend'%2C%20handleTouchEnd)%3B%0Acontainer.removeEventListener('touchmove'%2C%20handleTouchMove)%3B%0A%7D%0Awindow.removeEventListener('resize'%2C%20debouncedHandleResize)%3B%0A%2F%2F%20%E5%8F%96%E6%B6%88%E5%8A%A8%E7%94%BB%E5%BE%AA%E7%8E%AF%0Aif%20(animationIdRef.current%20!%3D%3D%20null)%20%7B%0AcancelAnimationFrame(animationIdRef.current)%3B%0A%7D%0A%2F%2F%20%E6%B8%85%E7%90%86%E6%89%80%E6%9C%89%E7%B2%92%E5%AD%90DOM%E5%85%83%E7%B4%A0%0AparticlesRef.current.forEach(p%20%3D%3E%20p.el.remove())%3B%0A%7D%3B%0A%7D%2C%20%5Banimate%2C%20handleMouseDown%2C%20handleMouseUp%2C%20handleMouseMove%2C%20handleTouchStart%2C%20handleTouchEnd%2C%20handleTouchMove%2C%20debouncedHandleResize%2C%20initializeParticles%5D)%3B%0A%2F**%0A*%20%E4%B8%BB%E9%A2%98%E5%8F%98%E5%8C%96%E5%93%8D%E5%BA%94%0A*%20%E5%BD%93%E4%B8%BB%E9%A2%98%E5%88%87%E6%8D%A2%E6%97%B6%EF%BC%8C%E5%8A%A8%E6%80%81%E6%9B%B4%E6%96%B0%E6%89%80%E6%9C%89%E7%B2%92%E5%AD%90%E7%9A%84%E9%A2%9C%E8%89%B2%0A*%2F%0AuseEffect(()%20%3D%3E%20%7B%0Aif%20(particlesRef.current.length%20%3E%200)%20%7B%0Aconst%20colors%20%3D%20getThemeColors()%3B%0A%2F%2F%20%E6%9B%B4%E6%96%B0%E6%89%80%E6%9C%89%E7%B2%92%E5%AD%90%E7%9A%84%E9%A2%9C%E8%89%B2%0AparticlesRef.current.forEach(p%20%3D%3E%20%7B%0Ap.el.style.backgroundColor%20%3D%20colors.particle%3B%0A%7D)%3B%0A%2F%2F%20%E6%9B%B4%E6%96%B0%E5%AE%B9%E5%99%A8%E8%83%8C%E6%99%AF%E6%B8%90%E5%8F%98%0Aif%20(containerRef.current)%20%7B%0AcontainerRef.current.style.background%20%3D%20colors.background%3B%0A%7D%0A%7D%0A%7D%2C%20%5BcurrentTheme%2C%20getThemeColors%5D)%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E6%B8%B2%E6%9F%93%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Aconst%20colors%20%3D%20getThemeColors()%3B%0Areturn%20(%0Adiv%0Aref%3D%7BcontainerRef%7D%0AclassName%3D%22fixed%20inset-0%20w-full%20h-full%20overflow-hidden%20pointer-events-none%20z-0%22%0Astyle%3D%7B%7B%0Abackground%3A%20colors.background%2C%0A%7D%7D%0A%2F%3E%0A)%3B%0A%7D%3B%0Aexport%20default%20FoamBackground%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;use client\u0026#x27;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword inline\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eReact\u003c/span\u003e, { useEffect, useRef, useCallback } \u003cspan class=\"hljs-keyword inline\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;react\u0026#x27;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword inline\"\u003eimport\u003c/span\u003e { useThemeStore } \u003cspan class=\"hljs-keyword inline\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;@/lib/stores/themeStore\u0026#x27;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment inline\"\u003e// ==================== 类型定义 ====================\u003c/span\u003e\n\u003cspan class=\"hljs-comment inline\"\u003e/**\n * 粒子数据结构\n * 每个粒子都是一个独立的物理实体\n */\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003einterface\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eParticle\u003c/span\u003e {\n  \u003cspan class=\"hljs-attr inline\"\u003eel\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eHTMLDivElement\u003c/span\u003e;  \u003cspan class=\"hljs-comment inline\"\u003e// DOM元素引用，避免频繁查询\u003c/span\u003e\n  \u003cspan class=\"hljs-attr inline\"\u003ex\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003enumber\u003c/span\u003e;           \u003cspan class=\"hljs-comment inline\"\u003e// 当前X坐标（精确到小数）\u003c/span\u003e\n  \u003cspan class=\"hljs-attr inline\"\u003ey\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003enumber\u003c/span\u003e;           \u003cspan class=\"hljs-comment inline\"\u003e// 当前Y坐标（精确到小数）\u003c/span\u003e\n  \u003cspan class=\"hljs-attr inline\"\u003evx\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003enumber\u003c/span\u003e;          \u003cspan class=\"hljs-comment inline\"\u003e// X方向速度\u003c/span\u003e\n  \u003cspan class=\"hljs-attr inline\"\u003evy\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003enumber\u003c/span\u003e;          \u003cspan class=\"hljs-comment inline\"\u003e// Y方向速度\u003c/span\u003e\n  \u003cspan class=\"hljs-attr inline\"\u003esize\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003enumber\u003c/span\u003e;        \u003cspan class=\"hljs-comment inline\"\u003e// 粒子基础大小\u003c/span\u003e\n  \u003cspan class=\"hljs-attr inline\"\u003edepth\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003enumber\u003c/span\u003e;       \u003cspan class=\"hljs-comment inline\"\u003e// 深度层次(0-1)，影响大小、透明度、速度\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-comment inline\"\u003e/**\n * 鼠标/触摸状态\n * 用于交互力场计算\n */\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003einterface\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eMouseState\u003c/span\u003e {\n  \u003cspan class=\"hljs-attr inline\"\u003ex\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003enumber\u003c/span\u003e;      \u003cspan class=\"hljs-comment inline\"\u003e// 鼠标X坐标\u003c/span\u003e\n  \u003cspan class=\"hljs-attr inline\"\u003ey\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003enumber\u003c/span\u003e;      \u003cspan class=\"hljs-comment inline\"\u003e// 鼠标Y坐标\u003c/span\u003e\n  \u003cspan class=\"hljs-attr inline\"\u003edown\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003eboolean\u003c/span\u003e;  \u003cspan class=\"hljs-comment inline\"\u003e// 是否按下状态\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eFoamBackground\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eReact\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eFC\u003c/span\u003e = \u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-comment inline\"\u003e// ==================== 引用定义 ====================\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e containerRef = useRef\u0026lt;\u003cspan class=\"hljs-title class_ inline\"\u003eHTMLDivElement\u003c/span\u003e\u0026gt;(\u003cspan class=\"hljs-literal inline\"\u003enull\u003c/span\u003e);        \u003cspan class=\"hljs-comment inline\"\u003e// 容器DOM引用\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e particlesRef = useRef\u0026lt;\u003cspan class=\"hljs-title class_ inline\"\u003eParticle\u003c/span\u003e[]\u0026gt;([]);              \u003cspan class=\"hljs-comment inline\"\u003e// 粒子数组引用\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e mouseRef = useRef\u0026lt;\u003cspan class=\"hljs-title class_ inline\"\u003eMouseState\u003c/span\u003e\u0026gt;({ \u003cspan class=\"hljs-attr inline\"\u003ex\u003c/span\u003e: \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-attr inline\"\u003ey\u003c/span\u003e: \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-attr inline\"\u003edown\u003c/span\u003e: \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e }); \u003cspan class=\"hljs-comment inline\"\u003e// 鼠标状态引用\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e animationIdRef = useRef\u0026lt;\u003cspan class=\"hljs-built_in inline\"\u003enumber\u003c/span\u003e | \u003cspan class=\"hljs-literal inline\"\u003enull\u003c/span\u003e\u0026gt;(\u003cspan class=\"hljs-literal inline\"\u003enull\u003c/span\u003e);       \u003cspan class=\"hljs-comment inline\"\u003e// 动画ID引用，用于取消动画\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e { currentTheme } = \u003cspan class=\"hljs-title function_ inline\"\u003euseThemeStore\u003c/span\u003e();                 \u003cspan class=\"hljs-comment inline\"\u003e// 主题状态\u003c/span\u003e\n\n  \u003cspan class=\"hljs-comment inline\"\u003e// ==================== 配置常量 ====================\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-variable constant_ inline\"\u003eNUM_PARTICLES\u003c/span\u003e = \u003cspan class=\"hljs-number inline\"\u003e300\u003c/span\u003e;  \u003cspan class=\"hljs-comment inline\"\u003e// 粒子总数，平衡视觉效果与性能\u003c/span\u003e\n\n  \u003cspan class=\"hljs-comment inline\"\u003e// ==================== 工具函数 ====================\u003c/span\u003e\n  \u003cspan class=\"hljs-comment inline\"\u003e/**\n   * 防抖工具函数\n   * 用于优化resize事件处理，避免频繁重建粒子\n   * \u003cspan class=\"hljs-doctag inline\"\u003e@param\u003c/span\u003e func 要防抖的函数\n   * \u003cspan class=\"hljs-doctag inline\"\u003e@param\u003c/span\u003e wait 防抖延迟时间（毫秒）\n   */\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e debounce = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003cspan class=\"hljs-attr inline\"\u003efunc\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eFunction\u003c/span\u003e, \u003cspan class=\"hljs-attr inline\"\u003ewait\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003enumber\u003c/span\u003e\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword inline\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-attr inline\"\u003etimeout\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eNodeJS\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eTimeout\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003eexecutedFunction\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003e...\u003cspan class=\"hljs-attr inline\"\u003eargs\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003eany\u003c/span\u003e[]\u003c/span\u003e) {\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003elater\u003c/span\u003e = (\u003cspan class=\"hljs-params inline\"\u003e\u003c/span\u003e) =\u0026gt; {\n        \u003cspan class=\"hljs-built_in inline\"\u003eclearTimeout\u003c/span\u003e(timeout);\n        \u003cspan class=\"hljs-title function_ inline\"\u003efunc\u003c/span\u003e(...args);\n      };\n      \u003cspan class=\"hljs-built_in inline\"\u003eclearTimeout\u003c/span\u003e(timeout);\n      timeout = \u003cspan class=\"hljs-built_in inline\"\u003esetTimeout\u003c/span\u003e(later, wait);\n    };\n  }, []);\n\n  \u003cspan class=\"hljs-comment inline\"\u003e/**\n   * 十六进制颜色转HSL颜色空间\n   * HSL更适合生成相近的色彩变化\n   * \u003cspan class=\"hljs-doctag inline\"\u003e@param\u003c/span\u003e hex 十六进制颜色值（如 \u0026quot;#ff6600\u0026quot;）\n   * \u003cspan class=\"hljs-doctag inline\"\u003e@returns\u003c/span\u003e [色相, 饱和度, 明度] 数组\n   */\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e hexToHsl = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003cspan class=\"hljs-attr inline\"\u003ehex\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment inline\"\u003e// 将16进制转换为RGB（0-1范围）\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e r = \u003cspan class=\"hljs-built_in inline\"\u003eparseInt\u003c/span\u003e(hex.\u003cspan class=\"hljs-title function_ inline\"\u003eslice\u003c/span\u003e(\u003cspan class=\"hljs-number inline\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number inline\"\u003e3\u003c/span\u003e), \u003cspan class=\"hljs-number inline\"\u003e16\u003c/span\u003e) / \u003cspan class=\"hljs-number inline\"\u003e255\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e g = \u003cspan class=\"hljs-built_in inline\"\u003eparseInt\u003c/span\u003e(hex.\u003cspan class=\"hljs-title function_ inline\"\u003eslice\u003c/span\u003e(\u003cspan class=\"hljs-number inline\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-number inline\"\u003e5\u003c/span\u003e), \u003cspan class=\"hljs-number inline\"\u003e16\u003c/span\u003e) / \u003cspan class=\"hljs-number inline\"\u003e255\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e b = \u003cspan class=\"hljs-built_in inline\"\u003eparseInt\u003c/span\u003e(hex.\u003cspan class=\"hljs-title function_ inline\"\u003eslice\u003c/span\u003e(\u003cspan class=\"hljs-number inline\"\u003e5\u003c/span\u003e, \u003cspan class=\"hljs-number inline\"\u003e7\u003c/span\u003e), \u003cspan class=\"hljs-number inline\"\u003e16\u003c/span\u003e) / \u003cspan class=\"hljs-number inline\"\u003e255\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 计算最大值和最小值\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e max = \u003cspan class=\"hljs-title class_ inline\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003emax\u003c/span\u003e(r, g, b);\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e min = \u003cspan class=\"hljs-title class_ inline\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003emin\u003c/span\u003e(r, g, b);\n    \u003cspan class=\"hljs-keyword inline\"\u003elet\u003c/span\u003e h = \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e, s = \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e, l = (max + min) / \u003cspan class=\"hljs-number inline\"\u003e2\u003c/span\u003e;  \u003cspan class=\"hljs-comment inline\"\u003e// 明度是最大值和最小值的平均\u003c/span\u003e\n\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (max !== min) {\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e d = max - min;\n      \u003cspan class=\"hljs-comment inline\"\u003e// 根据明度计算饱和度\u003c/span\u003e\n      s = l \u0026gt; \u003cspan class=\"hljs-number inline\"\u003e0.5\u003c/span\u003e ? d / (\u003cspan class=\"hljs-number inline\"\u003e2\u003c/span\u003e - max - min) : d / (max + min);\n      \n      \u003cspan class=\"hljs-comment inline\"\u003e// 根据主导颜色计算色相\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003eswitch\u003c/span\u003e (max) {\n        \u003cspan class=\"hljs-keyword inline\"\u003ecase\u003c/span\u003e \u003cspan class=\"hljs-attr inline\"\u003er\u003c/span\u003e: h = (g - b) / d + (g \u0026lt; b ? \u003cspan class=\"hljs-number inline\"\u003e6\u003c/span\u003e : \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e); \u003cspan class=\"hljs-keyword inline\"\u003ebreak\u003c/span\u003e;  \u003cspan class=\"hljs-comment inline\"\u003e// 红色主导\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003ecase\u003c/span\u003e \u003cspan class=\"hljs-attr inline\"\u003eg\u003c/span\u003e: h = (b - r) / d + \u003cspan class=\"hljs-number inline\"\u003e2\u003c/span\u003e; \u003cspan class=\"hljs-keyword inline\"\u003ebreak\u003c/span\u003e;                \u003cspan class=\"hljs-comment inline\"\u003e// 绿色主导\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003ecase\u003c/span\u003e \u003cspan class=\"hljs-attr inline\"\u003eb\u003c/span\u003e: h = (r - g) / d + \u003cspan class=\"hljs-number inline\"\u003e4\u003c/span\u003e; \u003cspan class=\"hljs-keyword inline\"\u003ebreak\u003c/span\u003e;                \u003cspan class=\"hljs-comment inline\"\u003e// 蓝色主导\u003c/span\u003e\n      }\n      h /= \u003cspan class=\"hljs-number inline\"\u003e6\u003c/span\u003e;  \u003cspan class=\"hljs-comment inline\"\u003e// 转换为0-1范围\u003c/span\u003e\n    }\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 返回标准HSL格式\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e [\u003cspan class=\"hljs-title class_ inline\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eround\u003c/span\u003e(h * \u003cspan class=\"hljs-number inline\"\u003e360\u003c/span\u003e), \u003cspan class=\"hljs-title class_ inline\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eround\u003c/span\u003e(s * \u003cspan class=\"hljs-number inline\"\u003e100\u003c/span\u003e), \u003cspan class=\"hljs-title class_ inline\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eround\u003c/span\u003e(l * \u003cspan class=\"hljs-number inline\"\u003e100\u003c/span\u003e)];\n  }, []);\n\n  \u003cspan class=\"hljs-comment inline\"\u003e/**\n   * 根据当前主题生成动态颜色\n   * 深色主题使用更深、更饱和的颜色\n   * 浅色主题使用更亮、更柔和的颜色\n   */\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e getThemeColors = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e [primaryH, primaryS] = \u003cspan class=\"hljs-title function_ inline\"\u003ehexToHsl\u003c/span\u003e(currentTheme.\u003cspan class=\"hljs-property inline\"\u003ecolors\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eprimary\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e [accentH, accentS] = \u003cspan class=\"hljs-title function_ inline\"\u003ehexToHsl\u003c/span\u003e(currentTheme.\u003cspan class=\"hljs-property inline\"\u003ecolors\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eaccent\u003c/span\u003e);\n    \n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e isDark = currentTheme.\u003cspan class=\"hljs-property inline\"\u003eid\u003c/span\u003e === \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;dark\u0026#x27;\u003c/span\u003e;\n    \n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (isDark) {\n      \u003cspan class=\"hljs-comment inline\"\u003e// 深色主题：增加饱和度，降低明度\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e {\n        \u003cspan class=\"hljs-attr inline\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e`linear-gradient(135deg, hsl(\u003cspan class=\"hljs-subst inline\"\u003e${primaryH}\u003c/span\u003e, \u003cspan class=\"hljs-subst inline\"\u003e${\u003cspan class=\"hljs-built_in inline\"\u003eMath\u003c/span\u003e.max(primaryS + \u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e, \u003cspan class=\"hljs-number inline\"\u003e40\u003c/span\u003e)}\u003c/span\u003e%, 25%), hsl(\u003cspan class=\"hljs-subst inline\"\u003e${accentH}\u003c/span\u003e, \u003cspan class=\"hljs-subst inline\"\u003e${\u003cspan class=\"hljs-built_in inline\"\u003eMath\u003c/span\u003e.max(accentS + \u003cspan class=\"hljs-number inline\"\u003e5\u003c/span\u003e, \u003cspan class=\"hljs-number inline\"\u003e35\u003c/span\u003e)}\u003c/span\u003e%, 20%))`\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr inline\"\u003eparticle\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e`hsl(\u003cspan class=\"hljs-subst inline\"\u003e${primaryH}\u003c/span\u003e, \u003cspan class=\"hljs-subst inline\"\u003e${\u003cspan class=\"hljs-built_in inline\"\u003eMath\u003c/span\u003e.max(primaryS + \u003cspan class=\"hljs-number inline\"\u003e15\u003c/span\u003e, \u003cspan class=\"hljs-number inline\"\u003e50\u003c/span\u003e)}\u003c/span\u003e%, 45%)`\u003c/span\u003e\n      };\n    } \u003cspan class=\"hljs-keyword inline\"\u003eelse\u003c/span\u003e {\n      \u003cspan class=\"hljs-comment inline\"\u003e// 浅色主题：降低饱和度，提高明度\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e {\n        \u003cspan class=\"hljs-attr inline\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e`linear-gradient(135deg, hsl(\u003cspan class=\"hljs-subst inline\"\u003e${primaryH}\u003c/span\u003e, \u003cspan class=\"hljs-subst inline\"\u003e${\u003cspan class=\"hljs-built_in inline\"\u003eMath\u003c/span\u003e.max(primaryS - \u003cspan class=\"hljs-number inline\"\u003e20\u003c/span\u003e, \u003cspan class=\"hljs-number inline\"\u003e20\u003c/span\u003e)}\u003c/span\u003e%, 60%), hsl(\u003cspan class=\"hljs-subst inline\"\u003e${accentH}\u003c/span\u003e, \u003cspan class=\"hljs-subst inline\"\u003e${\u003cspan class=\"hljs-built_in inline\"\u003eMath\u003c/span\u003e.max(accentS - \u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e, \u003cspan class=\"hljs-number inline\"\u003e30\u003c/span\u003e)}\u003c/span\u003e%, 50%))`\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr inline\"\u003eparticle\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e`hsl(\u003cspan class=\"hljs-subst inline\"\u003e${primaryH}\u003c/span\u003e, \u003cspan class=\"hljs-subst inline\"\u003e${\u003cspan class=\"hljs-built_in inline\"\u003eMath\u003c/span\u003e.max(primaryS - \u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e, \u003cspan class=\"hljs-number inline\"\u003e35\u003c/span\u003e)}\u003c/span\u003e%, 75%)`\u003c/span\u003e\n      };\n    }\n  }, [currentTheme, hexToHsl]);\n\n  \u003cspan class=\"hljs-comment inline\"\u003e// ==================== 鼠标和触摸事件处理 ====================\u003c/span\u003e\n  \u003cspan class=\"hljs-comment inline\"\u003e/**\n   * 更新鼠标位置\n   * 兼容鼠标事件和触摸事件\n   */\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e updateMousePos = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003cspan class=\"hljs-attr inline\"\u003ee\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eMouseEvent\u003c/span\u003e | \u003cspan class=\"hljs-title class_ inline\"\u003eTouch\u003c/span\u003e\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    mouseRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e = e.\u003cspan class=\"hljs-property inline\"\u003eclientX\u003c/span\u003e;\n    mouseRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e = e.\u003cspan class=\"hljs-property inline\"\u003eclientY\u003c/span\u003e;\n  }, []);\n\n  \u003cspan class=\"hljs-comment inline\"\u003e/**\n   * 鼠标按下事件处理\n   * 激活交互力场\n   */\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e handleMouseDown = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003cspan class=\"hljs-attr inline\"\u003ee\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eMouseEvent\u003c/span\u003e\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    mouseRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003edown\u003c/span\u003e = \u003cspan class=\"hljs-literal inline\"\u003etrue\u003c/span\u003e;\n    \u003cspan class=\"hljs-title function_ inline\"\u003eupdateMousePos\u003c/span\u003e(e);\n  }, [updateMousePos]);\n\n  \u003cspan class=\"hljs-comment inline\"\u003e/**\n   * 鼠标释放事件处理\n   * 关闭交互力场\n   */\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e handleMouseUp = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e {\n    mouseRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003edown\u003c/span\u003e = \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e;\n  }, []);\n\n  \u003cspan class=\"hljs-comment inline\"\u003e/**\n   * 鼠标移动事件处理\n   * 只有在按下状态才更新位置，减少不必要的计算\n   */\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e handleMouseMove = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003cspan class=\"hljs-attr inline\"\u003ee\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eMouseEvent\u003c/span\u003e\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (mouseRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003edown\u003c/span\u003e) \u003cspan class=\"hljs-title function_ inline\"\u003eupdateMousePos\u003c/span\u003e(e);\n  }, [updateMousePos]);\n\n  \u003cspan class=\"hljs-comment inline\"\u003e/**\n   * 触摸开始事件处理\n   * 移动设备的交互支持\n   */\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e handleTouchStart = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003cspan class=\"hljs-attr inline\"\u003ee\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eTouchEvent\u003c/span\u003e\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    mouseRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003edown\u003c/span\u003e = \u003cspan class=\"hljs-literal inline\"\u003etrue\u003c/span\u003e;\n    \u003cspan class=\"hljs-title function_ inline\"\u003eupdateMousePos\u003c/span\u003e(e.\u003cspan class=\"hljs-property inline\"\u003etouches\u003c/span\u003e[\u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e]);  \u003cspan class=\"hljs-comment inline\"\u003e// 只取第一个触摸点\u003c/span\u003e\n  }, [updateMousePos]);\n\n  \u003cspan class=\"hljs-comment inline\"\u003e/**\n   * 触摸结束事件处理\n   */\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e handleTouchEnd = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e {\n    mouseRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003edown\u003c/span\u003e = \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e;\n  }, []);\n\n  \u003cspan class=\"hljs-comment inline\"\u003e/**\n   * 触摸移动事件处理\n   */\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e handleTouchMove = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003cspan class=\"hljs-attr inline\"\u003ee\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eTouchEvent\u003c/span\u003e\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (mouseRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003edown\u003c/span\u003e) \u003cspan class=\"hljs-title function_ inline\"\u003eupdateMousePos\u003c/span\u003e(e.\u003cspan class=\"hljs-property inline\"\u003etouches\u003c/span\u003e[\u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e]);\n  }, [updateMousePos]);\n\n  \u003cspan class=\"hljs-comment inline\"\u003e// ==================== 粒子系统核心 ====================\u003c/span\u003e\n  \u003cspan class=\"hljs-comment inline\"\u003e/**\n   * 初始化粒子系统\n   * 创建指定数量的粒子并分布在屏幕上\n   */\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e initializeParticles = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e container = containerRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!container) \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 清理现有粒子，防止内存泄漏\u003c/span\u003e\n    particlesRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eforEach\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e\u003cspan class=\"hljs-params inline\"\u003ep\u003c/span\u003e =\u0026gt;\u003c/span\u003e p.\u003cspan class=\"hljs-property inline\"\u003eel\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eremove\u003c/span\u003e());\n    particlesRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e = [];\n\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e width = \u003cspan class=\"hljs-variable language_ inline\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003einnerWidth\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e height = \u003cspan class=\"hljs-variable language_ inline\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003einnerHeight\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e colors = \u003cspan class=\"hljs-title function_ inline\"\u003egetThemeColors\u003c/span\u003e();\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 创建指定数量的粒子\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword inline\"\u003elet\u003c/span\u003e i = \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e; i \u0026lt; \u003cspan class=\"hljs-variable constant_ inline\"\u003eNUM_PARTICLES\u003c/span\u003e; i++) {\n      \u003cspan class=\"hljs-comment inline\"\u003e// 创建DOM元素\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e el = \u003cspan class=\"hljs-variable language_ inline\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003ecreateElement\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;div\u0026#x27;\u003c/span\u003e);\n      el.\u003cspan class=\"hljs-property inline\"\u003estyle\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eposition\u003c/span\u003e = \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;absolute\u0026#x27;\u003c/span\u003e;           \u003cspan class=\"hljs-comment inline\"\u003e// 绝对定位，脱离文档流\u003c/span\u003e\n      el.\u003cspan class=\"hljs-property inline\"\u003estyle\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eborderRadius\u003c/span\u003e = \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;50%\u0026#x27;\u003c/span\u003e;            \u003cspan class=\"hljs-comment inline\"\u003e// 圆形粒子\u003c/span\u003e\n      el.\u003cspan class=\"hljs-property inline\"\u003estyle\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003ebackgroundColor\u003c/span\u003e = colors.\u003cspan class=\"hljs-property inline\"\u003eparticle\u003c/span\u003e; \u003cspan class=\"hljs-comment inline\"\u003e// 主题色\u003c/span\u003e\n      el.\u003cspan class=\"hljs-property inline\"\u003estyle\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epointerEvents\u003c/span\u003e = \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;none\u0026#x27;\u003c/span\u003e;          \u003cspan class=\"hljs-comment inline\"\u003e// 不响应鼠标事件\u003c/span\u003e\n      el.\u003cspan class=\"hljs-property inline\"\u003estyle\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003ewillChange\u003c/span\u003e = \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;transform, opacity\u0026#x27;\u003c/span\u003e; \u003cspan class=\"hljs-comment inline\"\u003e// 提示浏览器优化\u003c/span\u003e\n      \n      container.\u003cspan class=\"hljs-title function_ inline\"\u003eappendChild\u003c/span\u003e(el);\n\n      \u003cspan class=\"hljs-comment inline\"\u003e// 随机大小（2-6px）\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e size = \u003cspan class=\"hljs-number inline\"\u003e2\u003c/span\u003e + \u003cspan class=\"hljs-title class_ inline\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003erandom\u003c/span\u003e() * \u003cspan class=\"hljs-number inline\"\u003e4\u003c/span\u003e;\n      el.\u003cspan class=\"hljs-property inline\"\u003estyle\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003ewidth\u003c/span\u003e = \u003cspan class=\"hljs-string inline\"\u003e`\u003cspan class=\"hljs-subst inline\"\u003e${size}\u003c/span\u003epx`\u003c/span\u003e;\n      el.\u003cspan class=\"hljs-property inline\"\u003estyle\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eheight\u003c/span\u003e = \u003cspan class=\"hljs-string inline\"\u003e`\u003cspan class=\"hljs-subst inline\"\u003e${size}\u003c/span\u003epx`\u003c/span\u003e;\n\n      \u003cspan class=\"hljs-comment inline\"\u003e// 随机深度和位置\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e depth = \u003cspan class=\"hljs-title class_ inline\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003erandom\u003c/span\u003e();              \u003cspan class=\"hljs-comment inline\"\u003e// 0-1的深度值\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e x = \u003cspan class=\"hljs-title class_ inline\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003erandom\u003c/span\u003e() * width;          \u003cspan class=\"hljs-comment inline\"\u003e// 随机X位置\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e y = \u003cspan class=\"hljs-title class_ inline\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003erandom\u003c/span\u003e() * height;         \u003cspan class=\"hljs-comment inline\"\u003e// 随机Y位置\u003c/span\u003e\n\n      \u003cspan class=\"hljs-comment inline\"\u003e// 创建粒子对象\u003c/span\u003e\n      particlesRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003epush\u003c/span\u003e({\n        el,\n        x, y,\n        \u003cspan class=\"hljs-attr inline\"\u003evx\u003c/span\u003e: \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-attr inline\"\u003evy\u003c/span\u003e: \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e,    \u003cspan class=\"hljs-comment inline\"\u003e// 初始速度为0\u003c/span\u003e\n        size, depth\n      });\n    }\n  }, [getThemeColors]);\n\n  \u003cspan class=\"hljs-comment inline\"\u003e/**\n   * 动画循环函数\n   * 这是整个粒子系统的心脏，每帧都会调用\n   */\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e animate = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e mouse = mouseRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e width = \u003cspan class=\"hljs-variable language_ inline\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003einnerWidth\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e height = \u003cspan class=\"hljs-variable language_ inline\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003einnerHeight\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 遍历所有粒子进行物理更新\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword inline\"\u003elet\u003c/span\u003e p \u003cspan class=\"hljs-keyword inline\"\u003eof\u003c/span\u003e particlesRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e) {\n      \u003cspan class=\"hljs-comment inline\"\u003e// ==================== 基础漂移力 ====================\u003c/span\u003e\n      \u003cspan class=\"hljs-comment inline\"\u003e// 模拟自然的流体运动\u003c/span\u003e\n      p.\u003cspan class=\"hljs-property inline\"\u003evx\u003c/span\u003e += \u003cspan class=\"hljs-number inline\"\u003e0.01\u003c/span\u003e * p.\u003cspan class=\"hljs-property inline\"\u003edepth\u003c/span\u003e;   \u003cspan class=\"hljs-comment inline\"\u003e// X方向基础漂移\u003c/span\u003e\n      p.\u003cspan class=\"hljs-property inline\"\u003evy\u003c/span\u003e += \u003cspan class=\"hljs-number inline\"\u003e0.005\u003c/span\u003e * p.\u003cspan class=\"hljs-property inline\"\u003edepth\u003c/span\u003e;  \u003cspan class=\"hljs-comment inline\"\u003e// Y方向基础漂移（略小，模拟重力影响）\u003c/span\u003e\n\n      \u003cspan class=\"hljs-comment inline\"\u003e// ==================== 交互力场计算 ====================\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (mouse.\u003cspan class=\"hljs-property inline\"\u003edown\u003c/span\u003e) {\n        \u003cspan class=\"hljs-comment inline\"\u003e// 计算粒子到鼠标的向量\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e dx = p.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e - mouse.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e;\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e dy = p.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e - mouse.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e;\n        \u003cspan class=\"hljs-comment inline\"\u003e// 计算距离（欧几里得距离）\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e dist = \u003cspan class=\"hljs-title class_ inline\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003esqrt\u003c/span\u003e(dx * dx + dy * dy);\n\n        \u003cspan class=\"hljs-comment inline\"\u003e// 在影响范围内施加排斥力\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (dist \u0026lt; \u003cspan class=\"hljs-number inline\"\u003e100\u003c/span\u003e) {\n          \u003cspan class=\"hljs-comment inline\"\u003e// 反平方力场：距离越近，力越大\u003c/span\u003e\n          \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e baseForce = \u003cspan class=\"hljs-number inline\"\u003e100\u003c/span\u003e / (dist + \u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e);  \u003cspan class=\"hljs-comment inline\"\u003e// +10避免除零错误\u003c/span\u003e\n          \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e force = baseForce * p.\u003cspan class=\"hljs-property inline\"\u003edepth\u003c/span\u003e;     \u003cspan class=\"hljs-comment inline\"\u003e// 深度影响力的大小\u003c/span\u003e\n\n          \u003cspan class=\"hljs-comment inline\"\u003e// 计算力的方向（单位向量）并应用\u003c/span\u003e\n          p.\u003cspan class=\"hljs-property inline\"\u003evx\u003c/span\u003e += force * (dx / dist);  \u003cspan class=\"hljs-comment inline\"\u003e// X方向分力\u003c/span\u003e\n          p.\u003cspan class=\"hljs-property inline\"\u003evy\u003c/span\u003e += force * (dy / dist);  \u003cspan class=\"hljs-comment inline\"\u003e// Y方向分力\u003c/span\u003e\n        }\n      }\n\n      \u003cspan class=\"hljs-comment inline\"\u003e// ==================== 物理系统 ====================\u003c/span\u003e\n      \u003cspan class=\"hljs-comment inline\"\u003e// 应用摩擦力（空气阻力）\u003c/span\u003e\n      p.\u003cspan class=\"hljs-property inline\"\u003evx\u003c/span\u003e *= \u003cspan class=\"hljs-number inline\"\u003e0.95\u003c/span\u003e;  \u003cspan class=\"hljs-comment inline\"\u003e// X方向摩擦\u003c/span\u003e\n      p.\u003cspan class=\"hljs-property inline\"\u003evy\u003c/span\u003e *= \u003cspan class=\"hljs-number inline\"\u003e0.95\u003c/span\u003e;  \u003cspan class=\"hljs-comment inline\"\u003e// Y方向摩擦\u003c/span\u003e\n\n      \u003cspan class=\"hljs-comment inline\"\u003e// 更新位置\u003c/span\u003e\n      p.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e += p.\u003cspan class=\"hljs-property inline\"\u003evx\u003c/span\u003e;\n      p.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e += p.\u003cspan class=\"hljs-property inline\"\u003evy\u003c/span\u003e;\n\n      \u003cspan class=\"hljs-comment inline\"\u003e// ==================== 边界处理 ====================\u003c/span\u003e\n      \u003cspan class=\"hljs-comment inline\"\u003e// 环绕边界：粒子从一边出去，从另一边进来\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (p.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e \u0026lt; -\u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e) p.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e = width + \u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e;    \u003cspan class=\"hljs-comment inline\"\u003e// 左边界 → 右边界\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (p.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e \u0026gt; width + \u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e) p.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e = -\u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e;    \u003cspan class=\"hljs-comment inline\"\u003e// 右边界 → 左边界\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (p.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e \u0026lt; -\u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e) p.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e = height + \u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e;   \u003cspan class=\"hljs-comment inline\"\u003e// 上边界 → 下边界\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (p.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e \u0026gt; height + \u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e) p.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e = -\u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e;   \u003cspan class=\"hljs-comment inline\"\u003e// 下边界 → 上边界\u003c/span\u003e\n\n      \u003cspan class=\"hljs-comment inline\"\u003e// ==================== 视觉效果更新 ====================\u003c/span\u003e\n      \u003cspan class=\"hljs-comment inline\"\u003e// 基于深度的视觉层次\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e scale = \u003cspan class=\"hljs-number inline\"\u003e0.6\u003c/span\u003e + \u003cspan class=\"hljs-number inline\"\u003e0.4\u003c/span\u003e * p.\u003cspan class=\"hljs-property inline\"\u003edepth\u003c/span\u003e;    \u003cspan class=\"hljs-comment inline\"\u003e// 缩放：0.6-1.0\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e opacity = \u003cspan class=\"hljs-number inline\"\u003e0.4\u003c/span\u003e + \u003cspan class=\"hljs-number inline\"\u003e0.6\u003c/span\u003e * p.\u003cspan class=\"hljs-property inline\"\u003edepth\u003c/span\u003e;  \u003cspan class=\"hljs-comment inline\"\u003e// 透明度：0.4-1.0\u003c/span\u003e\n\n      \u003cspan class=\"hljs-comment inline\"\u003e// 应用变换（使用transform优化性能）\u003c/span\u003e\n      p.\u003cspan class=\"hljs-property inline\"\u003eel\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003estyle\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003etransform\u003c/span\u003e = \u003cspan class=\"hljs-string inline\"\u003e`translate(\u003cspan class=\"hljs-subst inline\"\u003e${p.x}\u003c/span\u003epx, \u003cspan class=\"hljs-subst inline\"\u003e${p.y}\u003c/span\u003epx) scale(\u003cspan class=\"hljs-subst inline\"\u003e${scale}\u003c/span\u003e)`\u003c/span\u003e;\n      p.\u003cspan class=\"hljs-property inline\"\u003eel\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003estyle\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eopacity\u003c/span\u003e = opacity.\u003cspan class=\"hljs-title function_ inline\"\u003etoString\u003c/span\u003e();\n    }\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 请求下一帧动画\u003c/span\u003e\n    animationIdRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e = \u003cspan class=\"hljs-title function_ inline\"\u003erequestAnimationFrame\u003c/span\u003e(animate);\n  }, []);\n\n  \u003cspan class=\"hljs-comment inline\"\u003e/**\n   * 窗口大小改变处理\n   * 重新初始化粒子分布\n   */\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e handleResize = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment inline\"\u003e// 重新初始化粒子分布以适应新的窗口尺寸\u003c/span\u003e\n    \u003cspan class=\"hljs-title function_ inline\"\u003einitializeParticles\u003c/span\u003e();\n  }, [initializeParticles]);\n\n  \u003cspan class=\"hljs-comment inline\"\u003e/**\n   * 防抖版本的resize处理器\n   * 避免窗口拖拽时频繁重建粒子\n   */\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e debouncedHandleResize = \u003cspan class=\"hljs-title function_ inline\"\u003euseCallback\u003c/span\u003e(\n    \u003cspan class=\"hljs-title function_ inline\"\u003edebounce\u003c/span\u003e(handleResize, \u003cspan class=\"hljs-number inline\"\u003e1000\u003c/span\u003e),  \u003cspan class=\"hljs-comment inline\"\u003e// 1秒防抖延迟\u003c/span\u003e\n    [debounce, handleResize]\n  );\n\n  \u003cspan class=\"hljs-comment inline\"\u003e// ==================== 生命周期管理 ====================\u003c/span\u003e\n  \u003cspan class=\"hljs-comment inline\"\u003e/**\n   * 组件挂载和清理效果\n   * 管理事件监听器和动画生命周期\n   */\u003c/span\u003e\n  \u003cspan class=\"hljs-title function_ inline\"\u003euseEffect\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment inline\"\u003e// 初始化粒子\u003c/span\u003e\n    \u003cspan class=\"hljs-title function_ inline\"\u003einitializeParticles\u003c/span\u003e();\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// ==================== 事件监听器注册 ====================\u003c/span\u003e\n    \u003cspan class=\"hljs-comment inline\"\u003e// 全局鼠标事件（确保拖拽时即使离开容器也能继续）\u003c/span\u003e\n    \u003cspan class=\"hljs-variable language_ inline\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;mousedown\u0026#x27;\u003c/span\u003e, handleMouseDown);\n    \u003cspan class=\"hljs-variable language_ inline\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;mouseup\u0026#x27;\u003c/span\u003e, handleMouseUp);\n    \u003cspan class=\"hljs-variable language_ inline\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;mousemove\u0026#x27;\u003c/span\u003e, handleMouseMove);\n    \n    \u003cspan class=\"hljs-comment inline\"\u003e// 容器触摸事件（移动设备支持）\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e container = containerRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (container) {\n      container.\u003cspan class=\"hljs-title function_ inline\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;touchstart\u0026#x27;\u003c/span\u003e, handleTouchStart);\n      container.\u003cspan class=\"hljs-title function_ inline\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;touchend\u0026#x27;\u003c/span\u003e, handleTouchEnd);\n      container.\u003cspan class=\"hljs-title function_ inline\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;touchmove\u0026#x27;\u003c/span\u003e, handleTouchMove);\n    }\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 窗口resize事件\u003c/span\u003e\n    \u003cspan class=\"hljs-variable language_ inline\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;resize\u0026#x27;\u003c/span\u003e, debouncedHandleResize);\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 启动动画循环\u003c/span\u003e\n    \u003cspan class=\"hljs-title function_ inline\"\u003eanimate\u003c/span\u003e();\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// ==================== 清理函数 ====================\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e {\n      \u003cspan class=\"hljs-comment inline\"\u003e// 移除事件监听器\u003c/span\u003e\n      \u003cspan class=\"hljs-variable language_ inline\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eremoveEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;mousedown\u0026#x27;\u003c/span\u003e, handleMouseDown);\n      \u003cspan class=\"hljs-variable language_ inline\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eremoveEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;mouseup\u0026#x27;\u003c/span\u003e, handleMouseUp);\n      \u003cspan class=\"hljs-variable language_ inline\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eremoveEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;mousemove\u0026#x27;\u003c/span\u003e, handleMouseMove);\n      \n      \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (container) {\n        container.\u003cspan class=\"hljs-title function_ inline\"\u003eremoveEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;touchstart\u0026#x27;\u003c/span\u003e, handleTouchStart);\n        container.\u003cspan class=\"hljs-title function_ inline\"\u003eremoveEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;touchend\u0026#x27;\u003c/span\u003e, handleTouchEnd);\n        container.\u003cspan class=\"hljs-title function_ inline\"\u003eremoveEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;touchmove\u0026#x27;\u003c/span\u003e, handleTouchMove);\n      }\n\n      \u003cspan class=\"hljs-variable language_ inline\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eremoveEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;resize\u0026#x27;\u003c/span\u003e, debouncedHandleResize);\n\n      \u003cspan class=\"hljs-comment inline\"\u003e// 取消动画循环\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (animationIdRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e !== \u003cspan class=\"hljs-literal inline\"\u003enull\u003c/span\u003e) {\n        \u003cspan class=\"hljs-title function_ inline\"\u003ecancelAnimationFrame\u003c/span\u003e(animationIdRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e);\n      }\n\n      \u003cspan class=\"hljs-comment inline\"\u003e// 清理所有粒子DOM元素\u003c/span\u003e\n      particlesRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eforEach\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e\u003cspan class=\"hljs-params inline\"\u003ep\u003c/span\u003e =\u0026gt;\u003c/span\u003e p.\u003cspan class=\"hljs-property inline\"\u003eel\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eremove\u003c/span\u003e());\n    };\n  }, [animate, handleMouseDown, handleMouseUp, handleMouseMove, handleTouchStart, handleTouchEnd, handleTouchMove, debouncedHandleResize, initializeParticles]);\n\n  \u003cspan class=\"hljs-comment inline\"\u003e/**\n   * 主题变化响应\n   * 当主题切换时，动态更新所有粒子的颜色\n   */\u003c/span\u003e\n  \u003cspan class=\"hljs-title function_ inline\"\u003euseEffect\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (particlesRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003elength\u003c/span\u003e \u0026gt; \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e) {\n      \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e colors = \u003cspan class=\"hljs-title function_ inline\"\u003egetThemeColors\u003c/span\u003e();\n      \n      \u003cspan class=\"hljs-comment inline\"\u003e// 更新所有粒子的颜色\u003c/span\u003e\n      particlesRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eforEach\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e\u003cspan class=\"hljs-params inline\"\u003ep\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n        p.\u003cspan class=\"hljs-property inline\"\u003eel\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003estyle\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003ebackgroundColor\u003c/span\u003e = colors.\u003cspan class=\"hljs-property inline\"\u003eparticle\u003c/span\u003e;\n      });\n      \n      \u003cspan class=\"hljs-comment inline\"\u003e// 更新容器背景渐变\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (containerRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e) {\n        containerRef.\u003cspan class=\"hljs-property inline\"\u003ecurrent\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003estyle\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003ebackground\u003c/span\u003e = colors.\u003cspan class=\"hljs-property inline\"\u003ebackground\u003c/span\u003e;\n      }\n    }\n  }, [currentTheme, getThemeColors]);\n\n  \u003cspan class=\"hljs-comment inline\"\u003e// ==================== 渲染 ====================\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e colors = \u003cspan class=\"hljs-title function_ inline\"\u003egetThemeColors\u003c/span\u003e();\n\n  \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e (\n    \u003cspan class=\"language-xml inline\"\u003e\u003cspan class=\"hljs-tag inline\"\u003e\u0026lt;\u003cspan class=\"hljs-name inline\"\u003ediv\u003c/span\u003e\n      \u003cspan class=\"hljs-attr inline\"\u003eref\u003c/span\u003e=\u003cspan class=\"hljs-string inline\"\u003e{containerRef}\u003c/span\u003e\n      \u003cspan class=\"hljs-attr inline\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string inline\"\u003e\u0026quot;fixed inset-0 w-full h-full overflow-hidden pointer-events-none z-0\u0026quot;\u003c/span\u003e\n      \u003cspan class=\"hljs-attr inline\"\u003estyle\u003c/span\u003e=\u003cspan class=\"hljs-string inline\"\u003e{{\u003c/span\u003e\n        \u003cspan class=\"hljs-attr inline\"\u003ebackground:\u003c/span\u003e \u003cspan class=\"hljs-attr inline\"\u003ecolors.background\u003c/span\u003e,\n      }}\n    /\u0026gt;\u003c/span\u003e\u003c/span\u003e\n  );\n};\n\n\u003cspan class=\"hljs-keyword inline\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eFoamBackground\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch3 id=\"核心算法流程图\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#核心算法流程图\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 核心算法流程图\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            核心算法流程图\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"\" data-code=\"%E7%B2%92%E5%AD%90%E5%88%9D%E5%A7%8B%E5%8C%96%20%E2%86%92%20%E5%8A%A8%E7%94%BB%E5%BE%AA%E7%8E%AF%E5%90%AF%E5%8A%A8%20%E2%86%92%20%E6%AF%8F%E5%B8%A7%E7%89%A9%E7%90%86%E6%9B%B4%E6%96%B0%20%E2%86%92%20%E8%A7%86%E8%A7%89%E6%95%88%E6%9E%9C%E5%BA%94%E7%94%A8%20%E2%86%92%20%E4%B8%8B%E4%B8%80%E5%B8%A7%0A%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%20%20%20%20%20%20%20%20%20%20%E2%86%93%0A%E5%88%9B%E5%BB%BA300%E4%B8%AA%20%20%20%20%20%20%20requestAF%20%20%20%20%20%E5%9F%BA%E7%A1%80%E6%BC%82%E7%A7%BB%E5%8A%9B%20%20%20%20%20%20%E7%BC%A9%E6%94%BE%2F%E9%80%8F%E6%98%8E%E5%BA%A6%20%20%20%E5%BE%AA%E7%8E%AF%E7%BB%A7%E7%BB%AD%0A%E9%9A%8F%E6%9C%BA%E5%88%86%E5%B8%83%E7%B2%92%E5%AD%90%20%20%20%20%20%E8%B0%83%E7%94%A8animate%20%20%20%E4%BA%A4%E4%BA%92%E5%8A%9B%E5%9C%BA%E8%AE%A1%E7%AE%97%20%20%20%20depth%E5%8A%A0%E6%9D%83%20%20%20%20%2060fps%0A%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%20%20%20%20%20%20%20%20%20%20%E2%86%93%0ADOM%E5%85%83%E7%B4%A0%E5%88%9B%E5%BB%BA%20%20%20%20%20%20%E9%BC%A0%E6%A0%87%E7%8A%B6%E6%80%81%E6%A3%80%E6%B5%8B%20%20%20%E6%91%A9%E6%93%A6%E5%8A%9B%E5%BA%94%E7%94%A8%20%20%20%20%20%20transform%20%20%20%20%20%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%0A%E6%A0%B7%E5%BC%8F%E8%AE%BE%E7%BD%AE%20%20%20%20%20%20%20%20%E8%B7%9D%E7%A6%BB%E8%AE%A1%E7%AE%97%20%20%20%20%20%20%20%E4%BD%8D%E7%BD%AE%E6%9B%B4%E6%96%B0%20%20%20%20%20%20%20%20%E6%9B%B4%E6%96%B0DOM%20%20%20%20%20%20%E4%BA%8B%E4%BB%B6%E6%B8%85%E7%90%86\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ecode\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode\u003e粒子初始化 → 动画循环启动 → 每帧物理更新 → 视觉效果应用 → 下一帧\n     ↓             ↓             ↓             ↓          ↓\n  创建\u003cspan class=\"hljs-number inline\"\u003e300\u003c/span\u003e个       requestAF     基础漂移力      缩放/透明度   循环继续\n  随机分布粒子     调用animate   交互力场计算    \u003cspan class=\"hljs-variable language_ inline\"\u003edepth\u003c/span\u003e加权     \u003cspan class=\"hljs-number inline\"\u003e60\u003c/span\u003e\u003cspan class=\"hljs-variable language_ inline\"\u003efps\u003c/span\u003e\n     ↓             ↓             ↓             ↓          ↓\n  DOM元素创建      鼠标状态检测   摩擦力应用      transform     性能优化\n  样式设置        距离计算       位置更新        更新DOM      事件清理\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch3 id=\"关键算法解析\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#关键算法解析\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 关键算法解析\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            关键算法解析\n        \u003c/h3\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e1. 力场物理计算\u003c/strong\u003e\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"%2F%2F%20%E5%85%B3%E9%94%AE%EF%BC%9A%E5%8F%8D%E5%B9%B3%E6%96%B9%E5%8A%9B%E5%9C%BA%20%2B%20%E6%B7%B1%E5%BA%A6%E5%8A%A0%E6%9D%83%0Aconst%20dx%20%3D%20p.x%20-%20mouse.x%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E8%AE%A1%E7%AE%97X%E6%96%B9%E5%90%91%E8%B7%9D%E7%A6%BB%0Aconst%20dy%20%3D%20p.y%20-%20mouse.y%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E8%AE%A1%E7%AE%97Y%E6%96%B9%E5%90%91%E8%B7%9D%E7%A6%BB%0Aconst%20dist%20%3D%20Math.sqrt(dx%20*%20dx%20%2B%20dy%20*%20dy)%3B%20%20%20%2F%2F%20%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E8%B7%9D%E7%A6%BB%0Aconst%20baseForce%20%3D%20100%20%2F%20(dist%20%2B%2010)%3B%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%8F%8D%E5%B9%B3%E6%96%B9%E8%A1%B0%E5%87%8F%0Aconst%20force%20%3D%20baseForce%20*%20p.depth%3B%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E6%B7%B1%E5%BA%A6%E5%BD%B1%E5%93%8D%E5%8A%9B%E5%A4%A7%E5%B0%8F%0Ap.vx%20%2B%3D%20force%20*%20(dx%20%2F%20dist)%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%BA%94%E7%94%A8%E5%8D%95%E4%BD%8D%E5%90%91%E9%87%8F%E5%8A%9B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 关键：反平方力场 + 深度加权\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e dx = p.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e - mouse.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e;                    \u003cspan class=\"hljs-comment inline\"\u003e// 计算X方向距离\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e dy = p.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e - mouse.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e;                    \u003cspan class=\"hljs-comment inline\"\u003e// 计算Y方向距离\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e dist = \u003cspan class=\"hljs-title class_ inline\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003esqrt\u003c/span\u003e(dx * dx + dy * dy);   \u003cspan class=\"hljs-comment inline\"\u003e// 欧几里得距离\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e baseForce = \u003cspan class=\"hljs-number inline\"\u003e100\u003c/span\u003e / (dist + \u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e);         \u003cspan class=\"hljs-comment inline\"\u003e// 反平方衰减\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e force = baseForce * p.\u003cspan class=\"hljs-property inline\"\u003edepth\u003c/span\u003e;           \u003cspan class=\"hljs-comment inline\"\u003e// 深度影响力大小\u003c/span\u003e\np.\u003cspan class=\"hljs-property inline\"\u003evx\u003c/span\u003e += force * (dx / dist);                 \u003cspan class=\"hljs-comment inline\"\u003e// 应用单位向量力\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e2. HSL颜色空间转换\u003c/strong\u003e\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"%2F%2F%20%E5%85%B3%E9%94%AE%EF%BC%9ARGB%E5%88%B0HSL%E7%9A%84%E6%95%B0%E5%AD%A6%E5%8F%98%E6%8D%A2%0Aconst%20max%20%3D%20Math.max(r%2C%20g%2C%20b)%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E6%89%BE%E5%88%B0%E6%9C%80%E5%A4%A7%E5%80%BC%0Aconst%20min%20%3D%20Math.min(r%2C%20g%2C%20b)%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E6%89%BE%E5%88%B0%E6%9C%80%E5%B0%8F%E5%80%BC%0Alet%20l%20%3D%20(max%20%2B%20min)%20%2F%202%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E6%98%8E%E5%BA%A6%EF%BC%9A%E6%9C%80%E5%A4%A7%E6%9C%80%E5%B0%8F%E5%80%BC%E5%B9%B3%E5%9D%87%0Alet%20s%20%3D%20l%20%3E%200.5%20%3F%20d%20%2F%20(2%20-%20max%20-%20min)%20%3A%20d%20%2F%20(max%20%2B%20min)%3B%20%2F%2F%20%E9%A5%B1%E5%92%8C%E5%BA%A6%E8%AE%A1%E7%AE%97%0A%2F%2F%20%E8%89%B2%E7%9B%B8%E6%A0%B9%E6%8D%AE%E4%B8%BB%E5%AF%BC%E9%A2%9C%E8%89%B2%E8%AE%A1%E7%AE%97\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 关键：RGB到HSL的数学变换\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e max = \u003cspan class=\"hljs-title class_ inline\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003emax\u003c/span\u003e(r, g, b);              \u003cspan class=\"hljs-comment inline\"\u003e// 找到最大值\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e min = \u003cspan class=\"hljs-title class_ inline\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003emin\u003c/span\u003e(r, g, b);              \u003cspan class=\"hljs-comment inline\"\u003e// 找到最小值\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003elet\u003c/span\u003e l = (max + min) / \u003cspan class=\"hljs-number inline\"\u003e2\u003c/span\u003e;                    \u003cspan class=\"hljs-comment inline\"\u003e// 明度：最大最小值平均\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003elet\u003c/span\u003e s = l \u0026gt; \u003cspan class=\"hljs-number inline\"\u003e0.5\u003c/span\u003e ? d / (\u003cspan class=\"hljs-number inline\"\u003e2\u003c/span\u003e - max - min) : d / (max + min); \u003cspan class=\"hljs-comment inline\"\u003e// 饱和度计算\u003c/span\u003e\n\u003cspan class=\"hljs-comment inline\"\u003e// 色相根据主导颜色计算\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e3. 深度视觉效果\u003c/strong\u003e\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"%2F%2F%20%E5%85%B3%E9%94%AE%EF%BC%9A%E7%BA%BF%E6%80%A7%E6%8F%92%E5%80%BC%E5%88%9B%E5%BB%BA%E5%B1%82%E6%AC%A1%E6%84%9F%0Aconst%20scale%20%3D%200.6%20%2B%200.4%20*%20p.depth%3B%20%20%20%20%20%20%20%20%20%2F%2F%20%E7%BC%A9%E6%94%BE%EF%BC%9A0.6-1.0%0Aconst%20opacity%20%3D%200.4%20%2B%200.6%20*%20p.depth%3B%20%20%20%20%20%20%20%2F%2F%20%E9%80%8F%E6%98%8E%E5%BA%A6%EF%BC%9A0.4-1.0%0Ap.vx%20%2B%3D%200.01%20*%20p.depth%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E9%80%9F%E5%BA%A6%EF%BC%9A%E6%B7%B1%E5%BA%A6%E8%B6%8A%E5%A4%A7%E8%B6%8A%E5%BF%AB%0Aconst%20force%20%3D%20baseForce%20*%20p.depth%3B%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%BA%A4%E4%BA%92%EF%BC%9A%E6%B7%B1%E5%BA%A6%E8%B6%8A%E5%A4%A7%E5%8F%8D%E5%BA%94%E8%B6%8A%E5%BC%BA\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 关键：线性插值创建层次感\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e scale = \u003cspan class=\"hljs-number inline\"\u003e0.6\u003c/span\u003e + \u003cspan class=\"hljs-number inline\"\u003e0.4\u003c/span\u003e * p.\u003cspan class=\"hljs-property inline\"\u003edepth\u003c/span\u003e;         \u003cspan class=\"hljs-comment inline\"\u003e// 缩放：0.6-1.0\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e opacity = \u003cspan class=\"hljs-number inline\"\u003e0.4\u003c/span\u003e + \u003cspan class=\"hljs-number inline\"\u003e0.6\u003c/span\u003e * p.\u003cspan class=\"hljs-property inline\"\u003edepth\u003c/span\u003e;       \u003cspan class=\"hljs-comment inline\"\u003e// 透明度：0.4-1.0\u003c/span\u003e\np.\u003cspan class=\"hljs-property inline\"\u003evx\u003c/span\u003e += \u003cspan class=\"hljs-number inline\"\u003e0.01\u003c/span\u003e * p.\u003cspan class=\"hljs-property inline\"\u003edepth\u003c/span\u003e;                     \u003cspan class=\"hljs-comment inline\"\u003e// 速度：深度越大越快\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e force = baseForce * p.\u003cspan class=\"hljs-property inline\"\u003edepth\u003c/span\u003e;          \u003cspan class=\"hljs-comment inline\"\u003e// 交互：深度越大反应越强\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e4. 边界环绕算法\u003c/strong\u003e\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"%2F%2F%20%E5%85%B3%E9%94%AE%EF%BC%9A%E5%B9%B3%E6%BB%91%E7%9A%84%E8%BE%B9%E7%95%8C%E8%BF%87%E6%B8%A1%0Aif%20(p.x%2010)%20p.x%20%3D%20width%20%2B%2010%3B%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%B7%A6%E5%87%BA%E5%8F%B3%E8%BF%9B%EF%BC%8C10px%E7%BC%93%E5%86%B2%0Aif%20(p.x%20%3E%20width%20%2B%2010)%20p.x%20%3D%20-10%3B%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%8F%B3%E5%87%BA%E5%B7%A6%E8%BF%9B%0Aif%20(p.y%2010)%20p.y%20%3D%20height%20%2B%2010%3B%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%B8%8A%E5%87%BA%E4%B8%8B%E8%BF%9B%0Aif%20(p.y%20%3E%20height%20%2B%2010)%20p.y%20%3D%20-10%3B%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%B8%8B%E5%87%BA%E4%B8%8A%E8%BF%9B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 关键：平滑的边界过渡\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (p.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e \u0026lt; -\u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e) p.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e = width + \u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e;           \u003cspan class=\"hljs-comment inline\"\u003e// 左出右进，10px缓冲\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (p.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e \u0026gt; width + \u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e) p.\u003cspan class=\"hljs-property inline\"\u003ex\u003c/span\u003e = -\u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e;           \u003cspan class=\"hljs-comment inline\"\u003e// 右出左进\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (p.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e \u0026lt; -\u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e) p.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e = height + \u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e;          \u003cspan class=\"hljs-comment inline\"\u003e// 上出下进\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (p.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e \u0026gt; height + \u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e) p.\u003cspan class=\"hljs-property inline\"\u003ey\u003c/span\u003e = -\u003cspan class=\"hljs-number inline\"\u003e10\u003c/span\u003e;          \u003cspan class=\"hljs-comment inline\"\u003e// 下出上进\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e5. 防抖优化机制\u003c/strong\u003e\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"%2F%2F%20%E5%85%B3%E9%94%AE%EF%BC%9A%E5%BB%B6%E8%BF%9F%E6%89%A7%E8%A1%8C%20%2B%20%E9%87%8D%E5%A4%8D%E5%8F%96%E6%B6%88%0Aconst%20debounce%20%3D%20(func%3A%20Function%2C%20wait%3A%20number)%20%3D%3E%20%7B%0Alet%20timeout%3A%20NodeJS.Timeout%3B%0Areturn%20(...args%3A%20any%5B%5D)%20%3D%3E%20%7B%0AclearTimeout(timeout)%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%8F%96%E6%B6%88%E4%B9%8B%E5%89%8D%E7%9A%84%E5%AE%9A%E6%97%B6%E5%99%A8%0Atimeout%20%3D%20setTimeout(()%20%3D%3E%20func(...args)%2C%20wait)%3B%20%2F%2F%20%E9%87%8D%E6%96%B0%E8%AE%A1%E6%97%B6%0A%7D%3B%0A%7D%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 关键：延迟执行 + 重复取消\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003edebounce\u003c/span\u003e = (\u003cspan class=\"hljs-params inline\"\u003e\u003cspan class=\"hljs-attr inline\"\u003efunc\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eFunction\u003c/span\u003e, \u003cspan class=\"hljs-attr inline\"\u003ewait\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003enumber\u003c/span\u003e\u003c/span\u003e) =\u0026gt; {\n    \u003cspan class=\"hljs-keyword inline\"\u003elet\u003c/span\u003e \u003cspan class=\"hljs-attr inline\"\u003etimeout\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eNodeJS\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eTimeout\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-function inline\"\u003e(\u003cspan class=\"hljs-params inline\"\u003e...\u003cspan class=\"hljs-attr inline\"\u003eargs\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003eany\u003c/span\u003e[]\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n        \u003cspan class=\"hljs-built_in inline\"\u003eclearTimeout\u003c/span\u003e(timeout);               \u003cspan class=\"hljs-comment inline\"\u003e// 取消之前的定时器\u003c/span\u003e\n        timeout = \u003cspan class=\"hljs-built_in inline\"\u003esetTimeout\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e() =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-title function_ inline\"\u003efunc\u003c/span\u003e(...args), wait); \u003cspan class=\"hljs-comment inline\"\u003e// 重新计时\u003c/span\u003e\n    };\n};\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch2 id=\"实现回顾\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#实现回顾\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 实现回顾\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            实现回顾\n        \u003c/h2\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e通过这次深入的技术剖析，我们看到了一个看似简单的\u0026quot;泡沫背景\u0026quot;背后隐藏的复杂世界。从Canvas思维到DOM实现的转换，从物理模拟到视觉效果，从性能优化到边界处理，每一个环节都需要精心设计和仔细调试。\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e选择DOM而不是Canvas可能看起来像是\u0026quot;用大炮打蚊子\u0026quot;，但这种选择带来了更好的可访问性、更容易的主题集成，以及更直观的事件处理。有时候，看起来\u0026quot;笨\u0026quot;的方法反而能开辟新的可能性。\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cem class=\"italic text-foreground\"\u003e愿你的粒子如星尘般闪耀，如泡沫般轻盈，在用户的指尖下翩翩起舞。\u003c/em\u003e ✨\u003c/p\u003e\n"])</script><script>self.__next_f.push([1,"d:[\"$\",\"$L1d\",null,{\"htmlContent\":\"$1e\",\"frontMatter\":{\"title\":\"泡沫背景：从Canvas思维到DOM实现的粒子世界\",\"description\":\"详细解析泡沫背景粒子系统的实现原理，从数学基础到交互优化\",\"date\":\"2025-06-22\",\"author\":\"MilkWind\",\"tags\":[\"Canvas\",\"交互设计\"],\"references\":{}},\"readingTime\":\"36 min read\",\"category\":\"personal-website\",\"tocItems\":[{\"id\":\"泡沫背景：从canvas思维到dom实现的粒子世界\",\"text\":\"泡沫背景：从Canvas思维到DOM实现的粒子世界\",\"level\":1},{\"id\":\"canvas思维在dom世界的转译\",\"text\":\"Canvas思维在DOM世界的转译\",\"level\":2},{\"id\":\"canvas-vs-dom：一场哲学选择\",\"text\":\"Canvas vs DOM：一场哲学选择\",\"level\":3},{\"id\":\"dom粒子的创建艺术\",\"text\":\"DOM粒子的创建艺术\",\"level\":3},{\"id\":\"坐标系统的映射关系\",\"text\":\"坐标系统的映射关系\",\"level\":3},{\"id\":\"粒子的生命周期与数据架构\",\"text\":\"粒子的生命周期与数据架构\",\"level\":2},{\"id\":\"粒子接口设计\",\"text\":\"粒子接口设计\",\"level\":3},{\"id\":\"粒子初始化的随机化策略\",\"text\":\"粒子初始化的随机化策略\",\"level\":3},{\"id\":\"动画循环的时间精度控制\",\"text\":\"动画循环的时间精度控制\",\"level\":3},{\"id\":\"交互系统的物理世界\",\"text\":\"交互系统的物理世界\",\"level\":2},{\"id\":\"鼠标事件的全生命周期管理\",\"text\":\"鼠标事件的全生命周期管理\",\"level\":3},{\"id\":\"力场计算的数学原理\",\"text\":\"力场计算的数学原理\",\"level\":3},{\"id\":\"多点触控的支持\",\"text\":\"多点触控的支持\",\"level\":3},{\"id\":\"摩擦力模拟\",\"text\":\"摩擦力模拟\",\"level\":3},{\"id\":\"主题系统的色彩混合\",\"text\":\"主题系统的色彩混合\",\"level\":2},{\"id\":\"hsl颜色空间\",\"text\":\"HSL颜色空间\",\"level\":3},{\"id\":\"主题响应的动态生成策略\",\"text\":\"主题响应的动态生成策略\",\"level\":3},{\"id\":\"动态色彩的实时更新\",\"text\":\"动态色彩的实时更新\",\"level\":3},{\"id\":\"深度数学模型\",\"text\":\"深度数学模型\",\"level\":3},{\"id\":\"视差运动的模拟\",\"text\":\"视差运动的模拟\",\"level\":3},{\"id\":\"响应式布局的粒子重分配\",\"text\":\"响应式布局的粒子重分配\",\"level\":2},{\"id\":\"窗口尺寸变化的监听策略\",\"text\":\"窗口尺寸变化的监听策略\",\"level\":3},{\"id\":\"粒子清理的内存安全\",\"text\":\"粒子清理的内存安全\",\"level\":3},{\"id\":\"防抖处理的必要性\",\"text\":\"防抖处理的必要性\",\"level\":3},{\"id\":\"性能优化的关键策略\",\"text\":\"性能优化的关键策略\",\"level\":2},{\"id\":\"willchange属性的正确使用\",\"text\":\"willChange属性的正确使用\",\"level\":3},{\"id\":\"requestanimationframe的生命周期管理\",\"text\":\"requestAnimationFrame的生命周期管理\",\"level\":3},{\"id\":\"层级管理的z-index策略\",\"text\":\"层级管理的z-index策略\",\"level\":3},{\"id\":\"事件处理的边界情况\",\"text\":\"事件处理的边界情况\",\"level\":2},{\"id\":\"触摸设备的特殊处理\",\"text\":\"触摸设备的特殊处理\",\"level\":3},{\"id\":\"事件监听器的作用域控制\",\"text\":\"事件监听器的作用域控制\",\"level\":3},{\"id\":\"可复用设计模式总结\",\"text\":\"可复用设计模式总结\",\"level\":2},{\"id\":\"粒子系统的通用架构\",\"text\":\"粒子系统的通用架构\",\"level\":3},{\"id\":\"物理模拟的基本模式\",\"text\":\"物理模拟的基本模式\",\"level\":3},{\"id\":\"主题响应的设计模式\",\"text\":\"主题响应的设计模式\",\"level\":3},{\"id\":\"响应式粒子布局模式\",\"text\":\"响应式粒子布局模式\",\"level\":3},{\"id\":\"性能优化的最佳实践\",\"text\":\"性能优化的最佳实践\",\"level\":3},{\"id\":\"完整源码全解析\",\"text\":\"完整源码全解析\",\"level\":2},{\"id\":\"核心算法流程图\",\"text\":\"核心算法流程图\",\"level\":3},{\"id\":\"关键算法解析\",\"text\":\"关键算法解析\",\"level\":3},{\"id\":\"实现回顾\",\"text\":\"实现回顾\",\"level\":2}],\"translations\":{\"common\":{\"welcome\":\"欢迎\",\"loading\":\"加载中...\",\"error\":\"出现了一些问题\",\"retry\":\"重试\",\"theme\":\"主题\",\"language\":\"语言\",\"light\":\"浅色\",\"dark\":\"深色\"},\"navigation\":{\"home\":\"首页\",\"personal\":\"个人\",\"works\":\"作品\",\"contributions\":\"贡献\",\"documents\":\"文档\",\"about\":\"关于\",\"contact\":\"联系\"},\"personal\":{\"technicalSkills\":\"技术技能\",\"email\":\"邮箱\",\"github\":\"代码仓库\",\"resume\":\"简历\",\"codeRepository\":\"代码仓库\",\"loadingPersonalInfo\":\"加载个人信息中...\",\"loadingResume\":\"加载简历中...\",\"closeResume\":\"关闭简历\",\"emailCopied\":\"邮箱已复制到剪贴板！\",\"galaxyDefaultDescription\":\"精通全栈开发技术，具备跨平台架构能力，擅长AI技术整合与高性能系统优化\",\"skillGalaxy\":\"技能星系\",\"stirGalaxy\":\"搅动星系\",\"stirring\":\"搅动中...\",\"fullStackEngineer\":\"MilkWind - 全栈工程师\",\"professionalProfile\":\"关于我\"},\"documents\":{\"technicalDocuments\":\"技术文档\",\"description\":\"基本原理、代码拆分以及一些碎碎念。\",\"articles\":\"文章\",\"categories\":\"分类\",\"allCategories\":\"所有分类\",\"noArticlesFound\":\"未找到文章\",\"noArticlesAvailable\":\"中文暂无文章。\",\"noArticlesInCategory\":\"该分类下未找到文章。\",\"readMore\":\"阅读更多\",\"loadingDocuments\":\"加载文档中...\",\"backToDocuments\":\"← 返回文档\",\"documentNotFound\":\"文档未找到\",\"documentNotFoundDescription\":\"请求的文档无法找到。\",\"technicalInsights\":\"技术拆解\",\"untitledDocument\":\"无标题文档\",\"byAuthor\":\"作者：\",\"search\":\"搜索文章...\",\"searchByTags\":\"按标签筛选\",\"searching\":\"搜索中...\",\"noSearchResults\":\"没有找到符合搜索条件的文章\",\"clearSearch\":\"清除搜索\",\"selectedTags\":\"已选标签\",\"allTags\":\"所有标签\",\"searchInTitle\":\"在标题、描述和内容中搜索\",\"enterImmersiveMode\":\"沉浸阅读\",\"exitImmersiveMode\":\"退出沉浸模式\",\"immersiveReading\":\"沉浸阅读模式\",\"exploreContent\":\"按分类探索内容\",\"browseBy\":\"浏览方式\",\"exploreAll\":\"所有内容汇总\",\"categoryDescription\":\"该分类下的文章\",\"totalArticles\":\"文章\",\"totalCategories\":\"分类\",\"foundArticles\":\"找到文章\",\"categoriesWithResults\":\"有结果的分类\"},\"works\":{\"workCases\":\"作品案例\",\"projects\":\"作品集\",\"loadingProjects\":\"加载项目中...\",\"grid\":\"网格\",\"stack\":\"堆叠\",\"of\":\"共\",\"workCasesPageTitle\":\"作品案例页面\",\"pageWorkingCorrectly\":\"此页面运行正常！路由配置正确。\",\"try3DVersion\":\"尝试3D版本\",\"dragToScroll\":\"拖拽滚动\",\"dragToChange\":\"拖拽切换\",\"swipeCards\":\"切换卡片\",\"keyboardNav\":\"键盘导航\"},\"contributions\":{\"contributionCases\":\"开源项目\",\"contributions\":\"贡献\",\"loadingContributions\":\"加载贡献中...\",\"grid\":\"网格\",\"stack\":\"堆叠\",\"of\":\"共\",\"contributionCasesPageTitle\":\"贡献案例页面\",\"pageWorkingCorrectly\":\"此页面运行正常！路由配置正确。\",\"try3DVersion\":\"尝试3D版本\",\"dragToScroll\":\"拖拽滚动\",\"dragToChange\":\"拖拽切换\",\"swipeCards\":\"切换卡片\",\"keyboardNav\":\"键盘导航\"},\"contribution\":{\"contributionPreview\":\"贡献预览\",\"accessible\":\"可访问\",\"code\":\"代码\",\"maintenance\":\"维护\",\"enhancement\":\"增强\",\"documentation\":\"文档\",\"community\":\"社区\",\"moreItems\":\"更多\",\"technicalDetails\":\"技术详情\",\"technologies\":\"技术栈：\",\"contributionDetail\":\"贡献详情\",\"description\":\"描述：\",\"seeDetails\":\"查看详情\",\"github\":\"代码仓库\",\"viewContribution\":\"查看贡献\",\"viewCode\":\"查看代码\"},\"project\":{\"projectPreview\":\"项目预览\",\"accessible\":\"可访问\",\"tool\":\"工具\",\"plugin\":\"插件\",\"toy\":\"小玩意\",\"moreItems\":\"更多\",\"technicalDetails\":\"技术详情\",\"technologies\":\"技术栈：\",\"description\":\"描述：\",\"seeDetails\":\"查看详情\",\"github\":\"GitHub\",\"gitee\":\"Gitee\",\"viewLiveDemo\":\"查看演示\",\"viewCode\":\"查看代码\",\"access\":\"访问\",\"videos\":\"视频\",\"watchVideo\":\"观看视频\",\"hasVideo\":\"有视频\"},\"codeblock\":{\"copy\":\"复制\",\"copySuccess\":\"代码已复制到剪贴板！\",\"copyError\":\"复制代码失败\",\"copyTooltip\":\"复制代码\"},\"toc\":{\"contents\":\"目录\",\"autoScroll\":\"自动滚动到章节\",\"collapse\":\"折叠\",\"expand\":\"展开\"},\"loading\":{\"loading\":\"加载中\",\"preparingExperience\":\"准备体验中\"}},\"lang\":\"zh\",\"theme\":\"dark\"}]\n"])</script><script>self.__next_f.push([1,"12:null\n"])</script><script>self.__next_f.push([1,"18:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n11:null\n"])</script><script>self.__next_f.push([1,"1c:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"泡沫背景：从Canvas思维到DOM实现的粒子世界 | Interactive Portfolio\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"详细解析泡沫背景粒子系统的实现原理，从数学基础到交互优化\"}],[\"$\",\"meta\",\"2\",{\"name\":\"author\",\"content\":\"Developer\"}],[\"$\",\"meta\",\"3\",{\"name\":\"keywords\",\"content\":\"portfolio,3D,interactive,web development,Three.js,Next.js\"}],[\"$\",\"meta\",\"4\",{\"property\":\"og:title\",\"content\":\"泡沫背景：从Canvas思维到DOM实现的粒子世界 | Interactive Portfolio\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:description\",\"content\":\"详细解析泡沫背景粒子系统的实现原理，从数学基础到交互优化\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"7\",{\"property\":\"article:published_time\",\"content\":\"2025-06-22\"}],[\"$\",\"meta\",\"8\",{\"property\":\"article:tag\",\"content\":\"Canvas\"}],[\"$\",\"meta\",\"9\",{\"property\":\"article:tag\",\"content\":\"交互设计\"}],[\"$\",\"meta\",\"10\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"11\",{\"name\":\"twitter:title\",\"content\":\"泡沫背景：从Canvas思维到DOM实现的粒子世界 | Interactive Portfolio\"}],[\"$\",\"meta\",\"12\",{\"name\":\"twitter:description\",\"content\":\"详细解析泡沫背景粒子系统的实现原理，从数学基础到交互优化\"}],[\"$\",\"link\",\"13\",{\"rel\":\"icon\",\"href\":\"/MilkWind-Website/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"32x32\"}]],\"error\":null,\"digest\":\"$undefined\"}\n14:{\"metadata\":\"$1c:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script></body></html>