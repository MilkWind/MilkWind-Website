<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/de70bee13400563f.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/38943437573ce53c.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/5eacd01f773eed7f.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-d118f969809e6d65.js"/><script src="/_next/static/chunks/4bd1b696-5119e10e90c1bd1b.js" async=""></script><script src="/_next/static/chunks/1684-be5e4efdb509cc75.js" async=""></script><script src="/_next/static/chunks/main-app-c135286a205d98a2.js" async=""></script><script src="/_next/static/chunks/1899-6f0bb42883f79753.js" async=""></script><script src="/_next/static/chunks/app/layout-5c95b441a38f3a56.js" async=""></script><script src="/_next/static/chunks/app/error-10ebab2e11865aaf.js" async=""></script><script src="/_next/static/chunks/6874-fbe9a08eb79b991c.js" async=""></script><script src="/_next/static/chunks/app/not-found-38b9d1a0bc95ac08.js" async=""></script><script src="/_next/static/chunks/206-4f4cbf4d7156f437.js" async=""></script><script src="/_next/static/chunks/app/documents/layout-5f4e66d848ce7829.js" async=""></script><script src="/_next/static/chunks/2415-689c103fb3d2c28d.js" async=""></script><script src="/_next/static/chunks/8610-7bd3f91f3cf2a4d6.js" async=""></script><script src="/_next/static/chunks/app/documents/loading-552c4cd17346a076.js" async=""></script><script src="/_next/static/chunks/app/loading-0c530d99d5132c05.js" async=""></script><script src="/_next/static/chunks/b498d07c-095637f0f10883c6.js" async=""></script><script src="/_next/static/chunks/9554-b714f9de28e85d30.js" async=""></script><script src="/_next/static/chunks/app/documents/%5B...slug%5D/page-9ee3d086bd3810e0.js" async=""></script><title>提示词炼金术：从模板到智能的语言解析之旅 | Interactive Portfolio</title><meta name="description" content="深度解析AI服务中提示词加载、结构化解析、缓存优化与容错机制的完整实现原理"/><meta name="author" content="Developer"/><meta name="keywords" content="portfolio,3D,interactive,web development,Three.js,Next.js"/><meta property="og:title" content="提示词炼金术：从模板到智能的语言解析之旅 | Interactive Portfolio"/><meta property="og:description" content="深度解析AI服务中提示词加载、结构化解析、缓存优化与容错机制的完整实现原理"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2025-06-22"/><meta property="article:tag" content="AI"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="提示词炼金术：从模板到智能的语言解析之旅 | Interactive Portfolio"/><meta name="twitter:description" content="深度解析AI服务中提示词加载、结构化解析、缓存优化与容错机制的完整实现原理"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="32x32"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__variable_188709 __variable_9a8899 font-sans antialiased min-h-screen bg-background text-foreground"><div class="fixed inset-0 w-full h-full overflow-hidden pointer-events-none z-0" style="background:linear-gradient(135deg, hsl(210, 80%, 60%), hsl(180, 40%, 50%))"></div><div class="fixed top-20 right-5 z-50"><div class="w-16 h-16 rounded-full backdrop-blur-md border animate-pulse bg-surface/60 border-surface/40"></div></div><!--$--><style>
:root {
  --bprogress-color: #0066cc;
  --bprogress-height: 4px;
  --bprogress-spinner-size: 18px;
  --bprogress-spinner-animation-duration: 400ms;
  --bprogress-spinner-border-size: 2px;
  --bprogress-box-shadow: 0 0 10px #0066cc, 0 0 5px #0066cc;
  --bprogress-z-index: 99999;
  --bprogress-spinner-top: 15px;
  --bprogress-spinner-bottom: auto;
  --bprogress-spinner-right: 15px;
  --bprogress-spinner-left: auto;
}

.bprogress {
  width: 0;
  height: 0;
  pointer-events: none;
  z-index: var(--bprogress-z-index);
}

.bprogress .bar {
  background: var(--bprogress-color);
  position: fixed;
  z-index: var(--bprogress-z-index);
  top: 0;
  left: 0;
  width: 100%;
  height: var(--bprogress-height);
}

/* Fancy blur effect */
.bprogress .peg {
  display: block;
  position: absolute;
  right: 0;
  width: 100px;
  height: 100%;
  box-shadow: var(--bprogress-box-shadow);
  opacity: 1.0;
  transform: rotate(3deg) translate(0px, -4px);
}

/* Remove these to get rid of the spinner */
.bprogress .spinner {
  display: block;
  position: fixed;
  z-index: var(--bprogress-z-index);
  top: var(--bprogress-spinner-top);
  bottom: var(--bprogress-spinner-bottom);
  right: var(--bprogress-spinner-right);
  left: var(--bprogress-spinner-left);
}

.bprogress .spinner-icon {
  width: var(--bprogress-spinner-size);
  height: var(--bprogress-spinner-size);
  box-sizing: border-box;
  border: solid var(--bprogress-spinner-border-size) transparent;
  border-top-color: var(--bprogress-color);
  border-left-color: var(--bprogress-color);
  border-radius: 50%;
  -webkit-animation: bprogress-spinner var(--bprogress-spinner-animation-duration) linear infinite;
  animation: bprogress-spinner var(--bprogress-spinner-animation-duration) linear infinite;
}

.bprogress-custom-parent {
  overflow: hidden;
  position: relative;
}

.bprogress-custom-parent .bprogress .spinner,
.bprogress-custom-parent .bprogress .bar {
  position: absolute;
}

.bprogress .indeterminate {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: var(--bprogress-height);
  overflow: hidden;
}

.bprogress .indeterminate .inc,
.bprogress .indeterminate .dec {
  position: absolute;
  top: 0;
  height: 100%;
  background-color: var(--bprogress-color);
}

.bprogress .indeterminate .inc {
  animation: bprogress-indeterminate-increase 2s infinite;
}

.bprogress .indeterminate .dec {
  animation: bprogress-indeterminate-decrease 2s 0.5s infinite;
}

@-webkit-keyframes bprogress-spinner {
  0%   { -webkit-transform: rotate(0deg); transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); transform: rotate(360deg); }
}

@keyframes bprogress-spinner {
  0%   { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

@keyframes bprogress-indeterminate-increase {
  from { left: -5%; width: 5%; }
  to { left: 130%; width: 100%; }
}

@keyframes bprogress-indeterminate-decrease {
  from { left: -80%; width: 80%; }
  to { left: 110%; width: 10%; }
}
</style><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--><!--$--><div class="relative z-30 min-h-screen bg-background "><div class="container mx-auto px-4 py-8 max-w-4xl"><div class="mb-8"><a class="inline-flex items-center text-primary hover:text-primary/80 transition-colors" href="/documents/">documents.backToDocuments</a></div><header class="mb-12"><div class="flex items-center gap-4 mb-4 text-sm text-foreground/60"><span class="px-3 py-1 bg-primary/20 text-primary rounded-full capitalize">questions party</span><span>24 min read</span></div><h1 class="font-bold mb-4 bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent text-4xl md:text-5xl">提示词炼金术：从模板到智能的语言解析之旅</h1><p class="text-xl text-foreground/80 max-w-3xl">深度解析AI服务中提示词加载、结构化解析、缓存优化与容错机制的完整实现原理</p><div class="flex flex-wrap gap-2 mt-6"><span class="px-3 py-1 text-sm bg-accent/20 text-accent rounded-full">AI</span></div></header><article class="prose prose-headings:mt-8 prose-headings:font-semibold prose-headings:text-foreground prose-h1:text-5xl prose-h2:text-4xl prose-h3:text-3xl prose-h4:text-2xl prose-h5:text-xl prose-h6:text-lg max-w-none "><div class="prose-pre:p-4 prose-pre:bg-surface w-full"><h1 id="提示词生成与响应解析：另一种机器语言的诞生" class="group relative text-4xl font-bold mt-8 mb-4 text-foreground leading-tight">
            <a href="#提示词生成与响应解析：另一种机器语言的诞生" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 提示词生成与响应解析：另一种机器语言的诞生">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            提示词生成与响应解析：另一种机器语言的诞生
        </h1>
<p class="text-base leading-7 mb-4 text-foreground">我时常会想，让计算机能够识别机器语言是编程领域的第一大里程碑，那如今能够让AI识别自然语言算不算第二大里程碑？</p>
<p class="text-base leading-7 mb-4 text-foreground">本文将全面解析Questions Party项目中的提示词管理系统，从PromptLoader的架构设计到响应解析的鲁棒性实现，带你阅览MCP的原始原理。</p>
<h2 id="promptloader核心架构" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#promptloader核心架构" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to PromptLoader核心架构">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            PromptLoader核心架构
        </h2>
<h3 id="单例模式设计" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#单例模式设计" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 单例模式设计">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            单例模式设计
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="const%20fs%20%3D%20require('fs')%3B%0Aconst%20path%20%3D%20require('path')%3B%0Aclass%20PromptLoader%20%7B%0Aconstructor()%20%7B%0Athis.promptCache%20%3D%20new%20Map()%3B%0Athis.promptsDir%20%3D%20path.join(__dirname%2C%20'..%2Fprompts')%3B%0A%7D%0A%7D%0A**%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F**%EF%BC%9A%0A%E5%9C%A8%E6%95%B4%E4%B8%AA%E5%BA%94%E7%94%A8%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E4%B8%AD%EF%BC%8CPromptLoader%E5%8F%AA%E9%9C%80%E8%A6%81%E4%B8%80%E4%B8%AA%E5%AE%9E%E4%BE%8B%E5%B0%B1%E5%A4%9F%E4%BA%86%E2%80%94%E2%80%94%E6%AF%95%E7%AB%9F%E6%8F%90%E7%A4%BA%E8%AF%8D%E6%A8%A1%E6%9D%BF%E4%B8%8D%E4%BC%9A%E8%B7%91%E8%B7%AF%EF%BC%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B9%9F%E4%B8%8D%E4%BC%9A%E7%AA%81%E7%84%B6%E5%8F%98%E8%84%B8%E3%80%82%0A%23%23%23%20%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E7%9A%84%E7%BA%A6%E5%AE%9A%0A%60%60%60typescript%0A%2F%2F%20%E5%AE%9E%E9%99%85%E7%9A%84%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%0Asrc%2Fprompts%2F%0A%E2%94%9C%E2%94%80%E2%94%80%20sentence-check-pure.txt%20%20%20%20%20%20%20%20%23%20%E7%BA%AF%E8%8B%B1%E6%96%87%E5%8F%A5%E5%AD%90%E6%A3%80%E6%9F%A5%E6%A8%A1%E6%9D%BF%0A%E2%94%9C%E2%94%80%E2%94%80%20sentence-check-combined.txt%20%20%20%20%23%20%E5%8F%8C%E8%AF%AD%E5%8F%A5%E5%AD%90%E6%A3%80%E6%9F%A5%E6%A8%A1%E6%9D%BF%0A%E2%94%9C%E2%94%80%E2%94%80%20sentence-generation-pure.txt%20%20%20%23%20%E7%BA%AF%E8%8B%B1%E6%96%87%E5%8F%A5%E5%AD%90%E7%94%9F%E6%88%90%E6%A8%A1%E6%9D%BF%0A%E2%94%9C%E2%94%80%E2%94%80%20sentence-generation-combined.txt%20%20%23%20%E5%8F%8C%E8%AF%AD%E5%8F%A5%E5%AD%90%E7%94%9F%E6%88%90%E6%A8%A1%E6%9D%BF%0A%E2%94%94%E2%94%80%E2%94%80%20README.md%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20%E6%96%87%E6%A1%A3%E8%AF%B4">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-keyword inline">const</span> fs = <span class="hljs-built_in inline">require</span>(<span class="hljs-string inline">&#x27;fs&#x27;</span>);
<span class="hljs-keyword inline">const</span> path = <span class="hljs-built_in inline">require</span>(<span class="hljs-string inline">&#x27;path&#x27;</span>);

<span class="hljs-keyword inline">class</span> <span class="hljs-title class_ inline">PromptLoader</span> {
    <span class="hljs-title function_ inline">constructor</span>(<span class="hljs-params inline"></span>) {
        <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">promptCache</span> = <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Map</span>();
        <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">promptsDir</span> = path.<span class="hljs-title function_ inline">join</span>(__dirname, <span class="hljs-string inline">&#x27;../prompts&#x27;</span>);
    }
}

**为什么选择单例模式**：

在整个应用生命周期中，<span class="hljs-title class_ inline">PromptLoader</span>只需要一个实例就够了——毕竟提示词模板不会跑路，文件系统也不会突然变脸。

### 目录结构的约定

<span class="hljs-string inline">``</span><span class="hljs-string inline">`typescript
// 实际的目录结构
src/prompts/
├── sentence-check-pure.txt        # 纯英文句子检查模板
├── sentence-check-combined.txt    # 双语句子检查模板
├── sentence-generation-pure.txt   # 纯英文句子生成模板
├── sentence-generation-combined.txt  # 双语句子生成模板
└── README.md                      # 文档说
</span></code></pre>
            </div>
        
<h3 id="map缓存" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#map缓存" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Map缓存">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Map缓存
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="this.promptCache%20%3D%20new%20Map()%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">promptCache</span> = <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Map</span>();
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">为什么选择Map而不是Object</strong>？</p>
<p class="text-base leading-7 mb-4 text-foreground">这是一个经典的数据结构选择问题：</p>
<table class="w-full border-collapse mb-4 shadow-sm rounded-lg overflow-hidden">
<thead class="bg-surface">
<tr class="border-b border-gray-200"><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">特性</th><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">Map</th><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">Object</th></tr>
</thead>
<tbody class="bg-background divide-y divide-gray-200">
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">键类型</td><td class="px-4 py-3 text-sm text-foreground">任意类型</td><td class="px-4 py-3 text-sm text-foreground">字符串/Symbol</td></tr>
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">大小获取</td><td class="px-4 py-3 text-sm text-foreground">O(1)</td><td class="px-4 py-3 text-sm text-foreground">O(n)</td></tr>
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">迭代性能</td><td class="px-4 py-3 text-sm text-foreground">优秀</td><td class="px-4 py-3 text-sm text-foreground">一般</td></tr>
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">原型污染</td><td class="px-4 py-3 text-sm text-foreground">无</td><td class="px-4 py-3 text-sm text-foreground">有风险</td></tr>
</tbody>
</table>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">缓存性能的数学分析</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">假设每个提示词文件平均2KB，系统有4个模板文件：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">无缓存</strong>：每次请求都需要读取文件，IO时间约1-5ms</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">有缓存</strong>：首次读取后，访问时间降至0.01ms以下</li>
</ul>
<p class="text-base leading-7 mb-4 text-foreground">缓存命中率达到90%时，性能提升约：<br class="block">
<span class="katex-display inline"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>性能提升</mtext><mo>=</mo><mfrac><mrow><mn>5</mn><mi>m</mi><mi>s</mi></mrow><mrow><mn>0.01</mn><mi>m</mi><mi>s</mi></mrow></mfrac><mo>×</mo><mn>0.9</mn><mo>=</mo><mn>450</mn><mtext>倍</mtext></mrow><annotation encoding="application/x-tex">性能提升 = \frac{5ms}{0.01ms} \times 0.9 = 450倍</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.6833em;"></span><span class="mord cjk_fallback inline">性能提升</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:2.0074em;vertical-align:-0.686em;"></span><span class="mord inline"><span class="mopen nulldelimiter inline"></span><span class="mfrac inline"><span class="vlist-t vlist-t2 inline"><span class="vlist-r inline"><span class="vlist inline" style="height:1.3214em;"><span style="top:-2.314em;" class="inline"><span class="pstrut inline" style="height:3em;"></span><span class="mord inline"><span class="mord inline">0.01</span><span class="mord mathnormal inline">m</span><span class="mord mathnormal inline">s</span></span></span><span style="top:-3.23em;" class="inline"><span class="pstrut inline" style="height:3em;"></span><span class="frac-line inline" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;" class="inline"><span class="pstrut inline" style="height:3em;"></span><span class="mord inline"><span class="mord inline">5</span><span class="mord mathnormal inline">m</span><span class="mord mathnormal inline">s</span></span></span></span><span class="vlist-s inline">​</span></span><span class="vlist-r inline"><span class="vlist inline" style="height:0.686em;"><span class="inline"></span></span></span></span></span><span class="mclose nulldelimiter inline"></span></span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">×</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6444em;"></span><span class="mord inline">0.9</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6833em;"></span><span class="mord inline">450</span><span class="mord cjk_fallback inline">倍</span></span></span></span></span></p>
<h2 id="loadprompt函数" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#loadprompt函数" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to loadPrompt函数">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            loadPrompt函数
        </h2>
<h3 id="缓存优先策略" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#缓存优先策略" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 缓存优先策略">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            缓存优先策略
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="loadPrompt(type%2C%20grammarLanguageOption%20%3D%20'combined')%20%7B%0Aconst%20cacheKey%20%3D%20%60%24%7Btype%7D-%24%7BgrammarLanguageOption%7D%60%3B%0A%2F%2F%20%E5%A6%82%E6%9E%9C%E7%BC%93%E5%AD%98%E4%B8%AD%E6%9C%89%EF%BC%8C%E8%BF%94%E5%9B%9E%E7%BC%93%E5%AD%98%E7%9A%84%E7%89%88%E6%9C%AC%0Aif%20(this.promptCache.has(cacheKey))%20%7B%0Areturn%20this.promptCache.get(cacheKey)%3B%0A%7D%0Atry%20%7B%0Aconst%20filename%20%3D%20%60%24%7Btype%7D-%24%7BgrammarLanguageOption%7D.txt%60%3B%0Aconst%20filepath%20%3D%20path.join(this.promptsDir%2C%20filename)%3B%0Aif%20(!fs.existsSync(filepath))%20%7B%0Athrow%20new%20Error(%60Prompt%20file%20not%20found%3A%20%24%7Bfilepath%7D%60)%3B%0A%7D%0Aconst%20promptTemplate%20%3D%20fs.readFileSync(filepath%2C%20'utf8')%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-title function_ inline">loadPrompt</span>(<span class="hljs-params inline">type, grammarLanguageOption = <span class="hljs-string inline">&#x27;combined&#x27;</span></span>) {
    <span class="hljs-keyword inline">const</span> cacheKey = <span class="hljs-string inline">`<span class="hljs-subst inline">${type}</span>-<span class="hljs-subst inline">${grammarLanguageOption}</span>`</span>;
    
    <span class="hljs-comment inline">// 如果缓存中有，返回缓存的版本</span>
    <span class="hljs-keyword inline">if</span> (<span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">promptCache</span>.<span class="hljs-title function_ inline">has</span>(cacheKey)) {
        <span class="hljs-keyword inline">return</span> <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">promptCache</span>.<span class="hljs-title function_ inline">get</span>(cacheKey);
    }

    <span class="hljs-keyword inline">try</span> {
        <span class="hljs-keyword inline">const</span> filename = <span class="hljs-string inline">`<span class="hljs-subst inline">${type}</span>-<span class="hljs-subst inline">${grammarLanguageOption}</span>.txt`</span>;
        <span class="hljs-keyword inline">const</span> filepath = path.<span class="hljs-title function_ inline">join</span>(<span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">promptsDir</span>, filename);
        
        <span class="hljs-keyword inline">if</span> (!fs.<span class="hljs-title function_ inline">existsSync</span>(filepath)) {
            <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">`Prompt file not found: <span class="hljs-subst inline">${filepath}</span>`</span>);
        }

        <span class="hljs-keyword inline">const</span> promptTemplate = fs.<span class="hljs-title function_ inline">readFileSync</span>(filepath, <span class="hljs-string inline">&#x27;utf8&#x27;</span>);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">缓存键设计</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground"><code>${type}-${grammarLanguageOption}</code>是一个复合键，分别对应&quot;功能-语言&quot;。</p>
<h3 id="文件系统的安全操作" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#文件系统的安全操作" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 文件系统的安全操作">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            文件系统的安全操作
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="if%20(!fs.existsSync(filepath))%20%7B%0Athrow%20new%20Error(%60Prompt%20file%20not%20found%3A%20%24%7Bfilepath%7D%60)%3B%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-keyword inline">if</span> (!fs.<span class="hljs-title function_ inline">existsSync</span>(filepath)) {
    <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">`Prompt file not found: <span class="hljs-subst inline">${filepath}</span>`</span>);
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">为什么先检查文件存在性</strong>？</p>
<p class="text-base leading-7 mb-4 text-foreground">这是防御性编程的经典案例：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20%E2%9D%8C%20%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E5%81%9A%E6%B3%95%0Aconst%20content%20%3D%20fs.readFileSync(filepath%2C%20'utf8')%3B%20%20%2F%2F%20%E5%8F%AF%E8%83%BD%E6%8A%9B%E5%87%BAENOENT%E9%94%99%E8%AF%AF%0A%2F%2F%20%E2%9C%85%20%E5%AE%89%E5%85%A8%E7%9A%84%E5%81%9A%E6%B3%95%0Aif%20(!fs.existsSync(filepath))%20%7B%0Athrow%20new%20Error(%60Prompt%20file%20not%20found%3A%20%24%7Bfilepath%7D%60)%3B%0A%7D%0Aconst%20content%20%3D%20fs.readFileSync(filepath%2C%20'utf8')%3B%20%20%2F%2F%20%E6%98%8E%E7%A1%AE%E7%9A%84%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// ❌ 不安全的做法</span>
<span class="hljs-keyword inline">const</span> content = fs.<span class="hljs-title function_ inline">readFileSync</span>(filepath, <span class="hljs-string inline">&#x27;utf8&#x27;</span>);  <span class="hljs-comment inline">// 可能抛出ENOENT错误</span>

<span class="hljs-comment inline">// ✅ 安全的做法</span>
<span class="hljs-keyword inline">if</span> (!fs.<span class="hljs-title function_ inline">existsSync</span>(filepath)) {
    <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">`Prompt file not found: <span class="hljs-subst inline">${filepath}</span>`</span>);
}
<span class="hljs-keyword inline">const</span> content = fs.<span class="hljs-title function_ inline">readFileSync</span>(filepath, <span class="hljs-string inline">&#x27;utf8&#x27;</span>);  <span class="hljs-comment inline">// 明确的错误信息</span>
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">路径拼接兼容</strong>：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20filepath%20%3D%20path.join(this.promptsDir%2C%20filename)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> filepath = path.<span class="hljs-title function_ inline">join</span>(<span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">promptsDir</span>, filename);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">使用<code>path.join</code>而不是字符串拼接，避免了路径分隔符的跨平台问题：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed">Windows: <code>\</code></li>
<li class="text-foreground leading-relaxed">Unix/Linux: <code>/</code></li>
<li class="text-foreground leading-relaxed">Node.js自动处理</li>
</ul>
<h3 id="提示词加载降级处理" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#提示词加载降级处理" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 提示词加载降级处理">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            提示词加载降级处理
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="%7D%20catch%20(error)%20%7B%0Aconsole.error(%60Error%20loading%20prompt%20%24%7Btype%7D-%24%7BgrammarLanguageOption%7D%3A%60%2C%20error.message)%3B%0A%2F%2F%20%E5%A6%82%E6%9E%9Cpure%E7%89%88%E6%9C%AC%E5%A4%B1%E8%B4%A5%EF%BC%8C%E9%99%8D%E7%BA%A7%E5%88%B0combined%E7%89%88%E6%9C%AC%0Aif%20(grammarLanguageOption%20%3D%3D%3D%20'pure')%20%7B%0Aconsole.warn(%60Falling%20back%20to%20combined%20prompt%20for%20%24%7Btype%7D%60)%3B%0Areturn%20this.loadPrompt(type%2C%20'combined')%3B%0A%7D%0A%2F%2F%20%E5%A6%82%E6%9E%9Ccombined%E7%89%88%E6%9C%AC%E4%B9%9F%E5%A4%B1%E8%B4%A5%EF%BC%8C%E6%8A%9B%E5%87%BA%E9%94%99%E8%AF%AF%0Athrow%20new%20Error(%60Failed%20to%20load%20prompt%20template%3A%20%24%7Btype%7D-%24%7BgrammarLanguageOption%7D%60)%3B%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript">} <span class="hljs-keyword inline">catch</span> (error) {
    <span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">error</span>(<span class="hljs-string inline">`Error loading prompt <span class="hljs-subst inline">${type}</span>-<span class="hljs-subst inline">${grammarLanguageOption}</span>:`</span>, error.<span class="hljs-property inline">message</span>);
    
    <span class="hljs-comment inline">// 如果pure版本失败，降级到combined版本</span>
    <span class="hljs-keyword inline">if</span> (grammarLanguageOption === <span class="hljs-string inline">&#x27;pure&#x27;</span>) {
        <span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">warn</span>(<span class="hljs-string inline">`Falling back to combined prompt for <span class="hljs-subst inline">${type}</span>`</span>);
        <span class="hljs-keyword inline">return</span> <span class="hljs-variable language_ inline">this</span>.<span class="hljs-title function_ inline">loadPrompt</span>(type, <span class="hljs-string inline">&#x27;combined&#x27;</span>);
    }
    
    <span class="hljs-comment inline">// 如果combined版本也失败，抛出错误</span>
    <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">`Failed to load prompt template: <span class="hljs-subst inline">${type}</span>-<span class="hljs-subst inline">${grammarLanguageOption}</span>`</span>);
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">递归降级顺序：<code>pure → combined → error</code></p>
<p class="text-base leading-7 mb-4 text-foreground">错误处理的决策树：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="" data-code="%E5%8A%A0%E8%BD%BDpure%E7%89%88%E6%9C%AC%0A%E2%86%93%0A%E5%A4%B1%E8%B4%A5%EF%BC%9F%E2%86%92%20%E6%98%AF%20%E2%86%92%20%E5%B0%9D%E8%AF%95combined%E7%89%88%E6%9C%AC%0A%E2%86%93%20%20%20%20%20%20%20%20%20%E2%86%93%0A%E5%90%A6%20%20%20%20%20%20%20%20%E5%A4%B1%E8%B4%A5%EF%BC%9F%E2%86%92%20%E6%98%AF%20%E2%86%92%20%E6%8A%9B%E5%87%BA%E9%94%99%E8%AF%AF%0A%E2%86%93%20%20%20%20%20%20%20%20%20%E2%86%93%0A%E8%BF%94%E5%9B%9E%E5%86%85%E5%AE%B9%20%20%20%20%20%20%20%E5%90%A6%0A%E2%86%93%0A%E8%BF%94%E5%9B%9E%E5%86%85%E5%AE%B9">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">code</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code>加载<span class="hljs-keyword inline">pure</span>版本
    ↓
失败？→ 是 → 尝试combined版本
    ↓         ↓
   否        失败？→ 是 → 抛出错误
    ↓         ↓
返回内容       否
              ↓
           返回内容
</code></pre>
            </div>
        
<h2 id="提示词结构化设计" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#提示词结构化设计" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 提示词结构化设计">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            提示词结构化设计
        </h2>
<h3 id="combined-vs-pure：双语教学" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#combined-vs-pure：双语教学" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Combined vs Pure：双语教学">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Combined vs Pure：双语教学
        </h3>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">Pure版本（纯英文）</strong>：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="" data-code="Analyze%20this%20sentence%3A%20%22%7Bsentence%7D%22%0AFollow%20this%20exact%20format%20(Output%20Example)%3A%0AGRAMMAR_ANALYSIS(Parsing%20required)%3A%0A1.%20Grammar%20and%20Style%20Issues">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">code</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code>Analyze <span class="hljs-keyword inline">this</span> sentence: <span class="hljs-string inline">&quot;{sentence}&quot;</span>

Follow <span class="hljs-keyword inline">this</span> exact format (Output Example):

GRAMMAR_ANALYSIS(Parsing required):
<span class="hljs-number inline">1.</span> Grammar and Style Issues
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">Combined版本（双语）</strong>：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="" data-code="%E5%88%86%E6%9E%90%E8%BF%99%E4%B8%AA%E5%8F%A5%E5%AD%90%3A%20%22%7Bsentence%7D%22%0A%E8%AF%B7%E4%B8%A5%E6%A0%BC%E6%8C%89%E7%85%A7%E4%BB%A5%E4%B8%8B%E6%A0%BC%E5%BC%8F%E8%BE%93%E5%87%BA%EF%BC%88%E8%BE%93%E5%87%BA%E7%A4%BA%E4%BE%8B%EF%BC%89%EF%BC%9A%0AGRAMMAR_ANALYSIS(Parsing%20required)%3A%0A1.%20%E8%AF%AD%E6%B3%95%E5%92%8C%E9%A3%8E%E6%A0%BC%E9%97%AE%E9%A2%98">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">code</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code>分析这个句子: <span class="hljs-string inline">&quot;{sentence}&quot;</span>

请严格按照以下格式输出（输出示例）：

<span class="hljs-function inline"><span class="hljs-title inline">GRAMMAR_ANALYSIS</span><span class="hljs-params inline">(Parsing required)</span></span>:
<span class="hljs-number inline">1</span>. 语法和风格问题
</code></pre>
            </div>
        
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Pure版本</strong>：面向英语学习者，提供纯正的英语环境</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Combined版本</strong>：面向中文用户，降低理解门槛，提供双语对照</li>
</ul>
<h2 id="缓存机制与性能优化" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#缓存机制与性能优化" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 缓存机制与性能优化">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            缓存机制与性能优化
        </h2>
<h3 id="map-vs-object的性能对比" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#map-vs-object的性能对比" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Map vs Object的性能对比">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Map vs Object的性能对比
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="%2F%2F%20%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E4%BC%AA%E4%BB%A3%E7%A0%81%0Aconst%20iterations%20%3D%201000000%3B%0A%2F%2F%20Map%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%0Aconst%20mapCache%20%3D%20new%20Map()%3B%0Aconsole.time('Map')%3B%0Afor%20(let%20i%20%3D%200%3B%20i%20set(%60key%24%7Bi%7D%60%2C%20%60value%24%7Bi%7D%60)%3B%0AmapCache.get(%60key%24%7Bi%7D%60)%3B%0A%7D%0Aconsole.timeEnd('Map')%3B%0A%2F%2F%20Object%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%0Aconst%20objCache%20%3D%20%7B%7D%3B%0Aconsole.time('Object')%3B%0Afor%20(let%20i%20%3D%200%3B%20i%20%60key%24%7Bi%7D%60%5D%20%3D%20%60value%24%7Bi%7D%60%3B%0Aconst%20value%20%3D%20objCache%5B%60key%24%7Bi%7D%60%5D%3B%0A%7D%0Aconsole.timeEnd('Object')%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-comment inline">// 性能测试伪代码</span>
<span class="hljs-keyword inline">const</span> iterations = <span class="hljs-number inline">1000000</span>;

<span class="hljs-comment inline">// Map性能测试</span>
<span class="hljs-keyword inline">const</span> mapCache = <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Map</span>();
<span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">time</span>(<span class="hljs-string inline">&#x27;Map&#x27;</span>);
<span class="hljs-keyword inline">for</span> (<span class="hljs-keyword inline">let</span> i = <span class="hljs-number inline">0</span>; i &lt; iterations; i++) {
    mapCache.<span class="hljs-title function_ inline">set</span>(<span class="hljs-string inline">`key<span class="hljs-subst inline">${i}</span>`</span>, <span class="hljs-string inline">`value<span class="hljs-subst inline">${i}</span>`</span>);
    mapCache.<span class="hljs-title function_ inline">get</span>(<span class="hljs-string inline">`key<span class="hljs-subst inline">${i}</span>`</span>);
}
<span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">timeEnd</span>(<span class="hljs-string inline">&#x27;Map&#x27;</span>);

<span class="hljs-comment inline">// Object性能测试</span>
<span class="hljs-keyword inline">const</span> objCache = {};
<span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">time</span>(<span class="hljs-string inline">&#x27;Object&#x27;</span>);
<span class="hljs-keyword inline">for</span> (<span class="hljs-keyword inline">let</span> i = <span class="hljs-number inline">0</span>; i &lt; iterations; i++) {
    objCache[<span class="hljs-string inline">`key<span class="hljs-subst inline">${i}</span>`</span>] = <span class="hljs-string inline">`value<span class="hljs-subst inline">${i}</span>`</span>;
    <span class="hljs-keyword inline">const</span> value = objCache[<span class="hljs-string inline">`key<span class="hljs-subst inline">${i}</span>`</span>];
}
<span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">timeEnd</span>(<span class="hljs-string inline">&#x27;Object&#x27;</span>);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">实际测试结果</strong>：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed">Map: ~661.084ms</li>
<li class="text-foreground leading-relaxed">Object: ~1005ms</li>
</ul>
<p class="text-base leading-7 mb-4 text-foreground">Map在大量操作时有约52%的性能优势！</p>
<h2 id="降级策略的容错设计" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#降级策略的容错设计" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 降级策略的容错设计">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            降级策略的容错设计
        </h2>
<h3 id="pure-→-combined的降级逻辑" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#pure-→-combined的降级逻辑" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Pure → Combined的降级逻辑">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Pure → Combined的降级逻辑
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="%2F%2F%20%E5%A6%82%E6%9E%9Cpure%E7%89%88%E6%9C%AC%E5%A4%B1%E8%B4%A5%EF%BC%8C%E9%99%8D%E7%BA%A7%E5%88%B0combined%E7%89%88%E6%9C%AC%0Aif%20(grammarLanguageOption%20%3D%3D%3D%20'pure')%20%7B%0Aconsole.warn(%60Falling%20back%20to%20combined%20prompt%20for%20%24%7Btype%7D%60)%3B%0Areturn%20this.loadPrompt(type%2C%20'combined')%3B%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-comment inline">// 如果pure版本失败，降级到combined版本</span>
<span class="hljs-keyword inline">if</span> (grammarLanguageOption === <span class="hljs-string inline">&#x27;pure&#x27;</span>) {
    <span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">warn</span>(<span class="hljs-string inline">`Falling back to combined prompt for <span class="hljs-subst inline">${type}</span>`</span>);
    <span class="hljs-keyword inline">return</span> <span class="hljs-variable language_ inline">this</span>.<span class="hljs-title function_ inline">loadPrompt</span>(type, <span class="hljs-string inline">&#x27;combined&#x27;</span>);
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">降级决策的状态机</strong>：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="" data-code="%E2%94%8C%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%90%0A%E2%94%82%20%20%E5%8A%A0%E8%BD%BDPure%20%20%20%E2%94%82%0A%E2%94%94%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%AC%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%98%0A%E2%94%82%0A%E2%94%8C%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%96%BC%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%90%20%20%20%20%20%E5%90%A6%0A%E2%94%82%20%E6%88%90%E5%8A%9F%EF%BC%9F%20%20%20%E2%94%82%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%0A%E2%94%94%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%AC%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%98%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%E6%98%AF%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%E2%94%8C%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%96%BC%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%90%20%20%20%20%E2%94%8C%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%96%BC%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%90%0A%E2%94%82%20%E8%BF%94%E5%9B%9E%E5%86%85%E5%AE%B9%20%E2%94%82%20%20%20%20%E2%94%82%20%E5%B0%9D%E8%AF%95Combined%20%20%E2%94%82%0A%E2%94%94%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%98%20%20%20%20%E2%94%94%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%AC%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%98%0A%E2%94%82%0A%E2%94%8C%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%96%BC%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%90%0A%E2%94%82%20%E6%88%90%E5%8A%9F%EF%BC%9F%20%20%20%E2%94%82%0A%E2%94%94%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%AC%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%98%0A%E6%98%AF%20%20%E2%94%82%20%20%E5%90%A6%0A%E2%94%8C%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%96%BC%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%90%20%20%20%20%E2%94%8C%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%90%0A%E2%94%82%20%E8%BF%94%E5%9B%9E%E5%86%85%E5%AE%B9%20%E2%94%82%20%20%20%20%E2%94%82%20%E6%8A%9B%E5%87%BA%E9%94%99%E8%AF%AF%20%E2%94%82%0A%E2%94%94%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%98%20%20%20%20%E2%94%94%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%98">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">code</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code>                    ┌─────────────┐
                    │  加载Pure   │
                    └─────┬───────┘
                          │
                     ┌────▼────┐     否
                     │ 成功？   │────────────
                     └────┬────┘           │
                      是  │                 │
                     ┌────▼────┐    ┌───────▼───────┐
                     │ 返回内容 │    │ 尝试<span class="hljs-keyword inline">Combined</span>  │
                     └─────────┘    └───────┬───────┘
                                            │
                                       ┌────▼────┐
                                       │ 成功？   │
                                       └────┬────┘
                                        是  │  否
                                   ┌────▼────┐    ┌─────────┐
                                   │ 返回内容 │    │ 抛出错误 │
                                   └─────────┘    └─────────┘
</code></pre>
            </div>
        
<h3 id="系统健壮性保障" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#系统健壮性保障" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 系统健壮性保障">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            系统健壮性保障
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="validatePromptFiles()%20%7B%0Aconst%20requiredPrompts%20%3D%20%5B%0A'sentence-check-pure.txt'%2C%0A'sentence-check-combined.txt'%2C%0A'sentence-generation-pure.txt'%2C%0A'sentence-generation-combined.txt'%0A%5D%3B%0Aconst%20missing%20%3D%20%5B%5D%3B%0Aconst%20existing%20%3D%20%5B%5D%3B%0Afor%20(const%20filename%20of%20requiredPrompts)%20%7B%0Aconst%20filepath%20%3D%20path.join(this.promptsDir%2C%20filename)%3B%0Aif%20(fs.existsSync(filepath))%20%7B%0Aexisting.push(filename)%3B%0A%7D%20else%20%7B%0Amissing.push(filename)%3B%0A%7D%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-title function_ inline">validatePromptFiles</span>(<span class="hljs-params inline"></span>) {
    <span class="hljs-keyword inline">const</span> requiredPrompts = [
        <span class="hljs-string inline">&#x27;sentence-check-pure.txt&#x27;</span>,
        <span class="hljs-string inline">&#x27;sentence-check-combined.txt&#x27;</span>,
        <span class="hljs-string inline">&#x27;sentence-generation-pure.txt&#x27;</span>,
        <span class="hljs-string inline">&#x27;sentence-generation-combined.txt&#x27;</span>
    ];

    <span class="hljs-keyword inline">const</span> missing = [];
    <span class="hljs-keyword inline">const</span> existing = [];

    <span class="hljs-keyword inline">for</span> (<span class="hljs-keyword inline">const</span> filename <span class="hljs-keyword inline">of</span> requiredPrompts) {
        <span class="hljs-keyword inline">const</span> filepath = path.<span class="hljs-title function_ inline">join</span>(<span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">promptsDir</span>, filename);
        <span class="hljs-keyword inline">if</span> (fs.<span class="hljs-title function_ inline">existsSync</span>(filepath)) {
            existing.<span class="hljs-title function_ inline">push</span>(filename);
        } <span class="hljs-keyword inline">else</span> {
            missing.<span class="hljs-title function_ inline">push</span>(filename);
        }
    }
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">启动时验证</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">系统启动时进行完整性检查，遵循&quot;Fast Fail&quot;原则：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">早期发现</strong>：部署时就能发现问题</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">明确反馈</strong>：哪些文件缺失一目了然</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">运维友好</strong>：减少生产环境的调试时间</li>
</ul>
<h2 id="parsesentencecheckresponse深度剖析" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#parsesentencecheckresponse深度剖析" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to parseSentenceCheckResponse深度剖析">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            parseSentenceCheckResponse深度剖析
        </h2>
<h3 id="标记化响应格式的设计" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#标记化响应格式的设计" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 标记化响应格式的设计">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            标记化响应格式的设计
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="%2F%2F%20%E5%8F%A5%E5%AD%90%E6%A3%80%E6%9F%A5%E7%9A%84%E5%93%8D%E5%BA%94%E6%A0%BC%E5%BC%8F%E9%85%8D%E7%BD%AE%0Athis.checkResponseFormat%20%3D%20%7B%0AgrammarAnalysisMarker%3A%20%22GRAMMAR_ANALYSIS%3A%22%2C%0AgrammarCorrectionMarker%3A%20%22GRAMMAR_CORRECTION%3A%22%2C%0AkeywordAnalysisMarker%3A%20%22KEYWORD_ANALYSIS%3A%22%2C%0AchineseDefinitionMarker%3A%20%22CHINESE_DEFINITION%3A%22%2C%0AendMarker%3A%20%22END_FORMAT%22%0A%7D%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-comment inline">// 句子检查的响应格式配置</span>
<span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">checkResponseFormat</span> = {
    <span class="hljs-attr inline">grammarAnalysisMarker</span>: <span class="hljs-string inline">&quot;GRAMMAR_ANALYSIS:&quot;</span>,
    <span class="hljs-attr inline">grammarCorrectionMarker</span>: <span class="hljs-string inline">&quot;GRAMMAR_CORRECTION:&quot;</span>,
    <span class="hljs-attr inline">keywordAnalysisMarker</span>: <span class="hljs-string inline">&quot;KEYWORD_ANALYSIS:&quot;</span>,
    <span class="hljs-attr inline">chineseDefinitionMarker</span>: <span class="hljs-string inline">&quot;CHINESE_DEFINITION:&quot;</span>,
    <span class="hljs-attr inline">endMarker</span>: <span class="hljs-string inline">&quot;END_FORMAT&quot;</span>
};
</code></pre>
            </div>
        
<h3 id="鲁棒性解析算法" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#鲁棒性解析算法" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 鲁棒性解析算法">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            鲁棒性解析算法
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="parseSentenceCheckResponse(content%2C%20locale%20%3D%20'en')%20%7B%0Atry%20%7B%0Aconst%20%7B%0AgrammarAnalysisMarker%2C%0AgrammarCorrectionMarker%2C%0AkeywordAnalysisMarker%2C%0AchineseDefinitionMarker%2C%0AendMarker%0A%7D%20%3D%20this.checkResponseFormat%3B%0A%2F%2F%20%E5%AD%98%E5%82%A8%E5%8E%9F%E5%A7%8B%E5%86%85%E5%AE%B9%E7%94%A8%E4%BA%8E%E5%9B%9E%E9%80%80%0Aconst%20rawContent%20%3D%20content%3B%0A%2F%2F%20%E6%B8%85%E7%90%86%E5%86%85%E5%AE%B9%20-%20%E7%A7%BB%E9%99%A4%22(Parsing%20required)%22%E5%92%8C%E5%85%B6%E4%BB%96%E4%B8%8D%E9%9C%80%E8%A6%81%E7%9A%84%E6%96%87%E6%9C%AC%0Alet%20cleanedContent%20%3D%20this.cleanResponseContent(content)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-title function_ inline">parseSentenceCheckResponse</span>(<span class="hljs-params inline">content, locale = <span class="hljs-string inline">&#x27;en&#x27;</span></span>) {
    <span class="hljs-keyword inline">try</span> {
        <span class="hljs-keyword inline">const</span> {
            grammarAnalysisMarker,
            grammarCorrectionMarker,
            keywordAnalysisMarker,
            chineseDefinitionMarker,
            endMarker
        } = <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">checkResponseFormat</span>;

        <span class="hljs-comment inline">// 存储原始内容用于回退</span>
        <span class="hljs-keyword inline">const</span> rawContent = content;

        <span class="hljs-comment inline">// 清理内容 - 移除&quot;(Parsing required)&quot;和其他不需要的文本</span>
        <span class="hljs-keyword inline">let</span> cleanedContent = <span class="hljs-variable language_ inline">this</span>.<span class="hljs-title function_ inline">cleanResponseContent</span>(content);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">内容清理</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">AI生成的内容可能包含：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed">多余的标记：<code>(Parsing required)</code></li>
<li class="text-foreground leading-relaxed">格式错误：多余的空行</li>
<li class="text-foreground leading-relaxed">无关内容：额外的说明文字</li>
</ul>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="cleanResponseContent(content)%20%7B%0Aif%20(!content)%20return%20''%3B%0Alet%20cleaned%20%3D%20content%3B%0A%2F%2F%20%E7%A7%BB%E9%99%A4%22(Parsing%20required)%22%E6%96%87%E6%9C%AC%0Acleaned%20%3D%20cleaned.replace(%2F%5C(Parsing%20required%5C)%2Fgi%2C%20'')%3B%0A%2F%2F%20%E7%A7%BB%E9%99%A4%E8%BF%87%E5%A4%9A%E7%9A%84%E7%A9%BA%E7%99%BD%E5%AD%97%E7%AC%A6%EF%BC%8C%E5%90%8C%E6%97%B6%E4%BF%9D%E6%8C%81%E7%BB%93%E6%9E%84%0Acleaned%20%3D%20cleaned.replace(%2F%5Cn%7B3%2C%7D%2Fg%2C%20'%5Cn%5Cn')%3B%0A%2F%2F%20%E7%A7%BB%E9%99%A4%E6%AF%8F%E8%A1%8C%E7%9A%84%E9%A6%96%E5%B0%BE%E7%A9%BA%E7%99%BD%E5%AD%97%E7%AC%A6%EF%BC%8C%E5%90%8C%E6%97%B6%E4%BF%9D%E6%8C%81%E6%95%B4%E4%BD%93%E7%BB%93%E6%9E%84%0Acleaned%20%3D%20cleaned.split('%5Cn')%0A.map(line%20%3D%3E%20line.trim())%0A.join('%5Cn')%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-title function_ inline">cleanResponseContent</span>(<span class="hljs-params inline">content</span>) {
    <span class="hljs-keyword inline">if</span> (!content) <span class="hljs-keyword inline">return</span> <span class="hljs-string inline">&#x27;&#x27;</span>;

    <span class="hljs-keyword inline">let</span> cleaned = content;

    <span class="hljs-comment inline">// 移除&quot;(Parsing required)&quot;文本</span>
    cleaned = cleaned.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/\(Parsing required\)/gi</span>, <span class="hljs-string inline">&#x27;&#x27;</span>);

    <span class="hljs-comment inline">// 移除过多的空白字符，同时保持结构</span>
    cleaned = cleaned.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/\n{3,}/g</span>, <span class="hljs-string inline">&#x27;\n\n&#x27;</span>);

    <span class="hljs-comment inline">// 移除每行的首尾空白字符，同时保持整体结构</span>
    cleaned = cleaned.<span class="hljs-title function_ inline">split</span>(<span class="hljs-string inline">&#x27;\n&#x27;</span>)
        .<span class="hljs-title function_ inline">map</span>(<span class="hljs-function inline"><span class="hljs-params inline">line</span> =&gt;</span> line.<span class="hljs-title function_ inline">trim</span>())
        .<span class="hljs-title function_ inline">join</span>(<span class="hljs-string inline">&#x27;\n&#x27;</span>);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">清理算法的设计思路</strong>：</p>
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">保留结构</strong>：不破坏原有的段落结构</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">移除噪声</strong>：去除AI生成的标记文本</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">标准化空白</strong>：统一空行和缩进</li>
</ol>
<h3 id="部分解析的容错机制" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#部分解析的容错机制" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 部分解析的容错机制">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            部分解析的容错机制
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="%2F%2F%20%E8%B7%9F%E8%B8%AA%E5%93%AA%E4%BA%9B%E6%A0%87%E8%AE%B0%E5%AD%98%E5%9C%A8%0Aconst%20markerPresence%20%3D%20%7B%0AgrammarAnalysis%3A%20cleanedContent.includes(grammarAnalysisMarker)%2C%0AgrammarCorrection%3A%20cleanedContent.includes(grammarCorrectionMarker)%2C%0AkeywordAnalysis%3A%20cleanedContent.includes(keywordAnalysisMarker)%2C%0AchineseDefinition%3A%20cleanedContent.includes(chineseDefinitionMarker)%0A%7D%3B%0Aconst%20presentMarkers%20%3D%20Object.values(markerPresence).filter(Boolean).length%3B%0A%2F%2F%20%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%9C%89%E6%A0%87%E8%AE%B0%E5%AD%98%E5%9C%A8%EF%BC%8C%E8%BF%99%E6%98%AF%E5%AE%8C%E5%85%A8%E5%A4%B1%E8%B4%A5%0Aif%20(presentMarkers%20%3D%3D%3D%200)%20%7B%0Areturn%20%7B%0AisValid%3A%20false%2C%0Aerror%3A%20i18n.t('ai.noValidMarkers'%2C%20locale)%20%2B%20%60%20%7C%20Response%20preview%3A%20%22%24%7BcleanedContent.substring(0%2C%20200)%7D...%22%60%2C%0AgrammarAnalysis%3A%20''%2C%0AgrammarCorrection%3A%20''%2C%0AkeywordAnalysis%3A%20''%2C%0AchineseDefinition%3A%20''%2C%0ArawResponseContent%3A%20rawContent%0A%7D%3B%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-comment inline">// 跟踪哪些标记存在</span>
<span class="hljs-keyword inline">const</span> markerPresence = {
    <span class="hljs-attr inline">grammarAnalysis</span>: cleanedContent.<span class="hljs-title function_ inline">includes</span>(grammarAnalysisMarker),
    <span class="hljs-attr inline">grammarCorrection</span>: cleanedContent.<span class="hljs-title function_ inline">includes</span>(grammarCorrectionMarker),
    <span class="hljs-attr inline">keywordAnalysis</span>: cleanedContent.<span class="hljs-title function_ inline">includes</span>(keywordAnalysisMarker),
    <span class="hljs-attr inline">chineseDefinition</span>: cleanedContent.<span class="hljs-title function_ inline">includes</span>(chineseDefinitionMarker)
};

<span class="hljs-keyword inline">const</span> presentMarkers = <span class="hljs-title class_ inline">Object</span>.<span class="hljs-title function_ inline">values</span>(markerPresence).<span class="hljs-title function_ inline">filter</span>(<span class="hljs-title class_ inline">Boolean</span>).<span class="hljs-property inline">length</span>;

<span class="hljs-comment inline">// 如果没有标记存在，这是完全失败</span>
<span class="hljs-keyword inline">if</span> (presentMarkers === <span class="hljs-number inline">0</span>) {
    <span class="hljs-keyword inline">return</span> {
        <span class="hljs-attr inline">isValid</span>: <span class="hljs-literal inline">false</span>,
        <span class="hljs-attr inline">error</span>: i18n.<span class="hljs-title function_ inline">t</span>(<span class="hljs-string inline">&#x27;ai.noValidMarkers&#x27;</span>, locale) + <span class="hljs-string inline">` | Response preview: &quot;<span class="hljs-subst inline">${cleanedContent.substring(<span class="hljs-number inline">0</span>, <span class="hljs-number inline">200</span>)}</span>...&quot;`</span>,
        <span class="hljs-attr inline">grammarAnalysis</span>: <span class="hljs-string inline">&#x27;&#x27;</span>,
        <span class="hljs-attr inline">grammarCorrection</span>: <span class="hljs-string inline">&#x27;&#x27;</span>,
        <span class="hljs-attr inline">keywordAnalysis</span>: <span class="hljs-string inline">&#x27;&#x27;</span>,
        <span class="hljs-attr inline">chineseDefinition</span>: <span class="hljs-string inline">&#x27;&#x27;</span>,
        <span class="hljs-attr inline">rawResponseContent</span>: rawContent
    };
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">部分解析的哲学</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">宁可给用户部分有用的信息，也不要因为格式不完整就全盘否定。</p>
<h2 id="parsestructuredresponse结构化解析" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#parsestructuredresponse结构化解析" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to parseStructuredResponse结构化解析">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            parseStructuredResponse结构化解析
        </h2>
<h3 id="结构化标记的提取逻辑" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#结构化标记的提取逻辑" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 结构化标记的提取逻辑">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            结构化标记的提取逻辑
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="parseStructuredResponse(content%2C%20locale%20%3D%20'en')%20%7B%0Atry%20%7B%0Aconst%20%7BsentenceMarker%2C%20grammarMarker%2C%20chineseMarker%2C%20endMarker%7D%20%3D%20this.responseFormat%3B%0A%2F%2F%20%E5%AD%98%E5%82%A8%E5%8E%9F%E5%A7%8B%E5%86%85%E5%AE%B9%E7%94%A8%E4%BA%8E%E5%9B%9E%E9%80%80%0Aconst%20rawContent%20%3D%20content%3B%0A%2F%2F%20%E6%B8%85%E7%90%86%E5%86%85%E5%AE%B9%20-%20%E7%A7%BB%E9%99%A4%22(Parsing%20required)%22%E5%92%8C%E5%85%B6%E4%BB%96%E4%B8%8D%E9%9C%80%E8%A6%81%E7%9A%84%E6%96%87%E6%9C%AC%0Alet%20cleanedContent%20%3D%20this.cleanResponseContent(content)%3B%0A%2F%2F%20%E5%A6%82%E6%9E%9C%E7%BC%BA%E5%B0%91END_FORMAT%E4%BD%86%E5%85%B6%E4%BB%96%E6%A0%87%E8%AE%B0%E5%AD%98%E5%9C%A8%EF%BC%8C%E5%88%99%E6%B7%BB%E5%8A%A0%0Aif%20(!cleanedContent.includes(endMarker))%20%7B%0Aconst%20hasOtherMarkers%20%3D%20%5BsentenceMarker%2C%20grammarMarker%2C%20chineseMarker%5D%0A.some(marker%20%3D%3E%20cleanedContent.includes(marker))%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-title function_ inline">parseStructuredResponse</span>(<span class="hljs-params inline">content, locale = <span class="hljs-string inline">&#x27;en&#x27;</span></span>) {
    <span class="hljs-keyword inline">try</span> {
        <span class="hljs-keyword inline">const</span> {sentenceMarker, grammarMarker, chineseMarker, endMarker} = <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">responseFormat</span>;

        <span class="hljs-comment inline">// 存储原始内容用于回退</span>
        <span class="hljs-keyword inline">const</span> rawContent = content;

        <span class="hljs-comment inline">// 清理内容 - 移除&quot;(Parsing required)&quot;和其他不需要的文本</span>
        <span class="hljs-keyword inline">let</span> cleanedContent = <span class="hljs-variable language_ inline">this</span>.<span class="hljs-title function_ inline">cleanResponseContent</span>(content);

        <span class="hljs-comment inline">// 如果缺少END_FORMAT但其他标记存在，则添加</span>
        <span class="hljs-keyword inline">if</span> (!cleanedContent.<span class="hljs-title function_ inline">includes</span>(endMarker)) {
            <span class="hljs-keyword inline">const</span> hasOtherMarkers = [sentenceMarker, grammarMarker, chineseMarker]
                .<span class="hljs-title function_ inline">some</span>(<span class="hljs-function inline"><span class="hljs-params inline">marker</span> =&gt;</span> cleanedContent.<span class="hljs-title function_ inline">includes</span>(marker));
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">自动修复机制</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">系统会自动添加缺失的结束标记，这种检测修复逻辑可以大大提高解析成功率：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20%E8%87%AA%E5%8A%A8%E4%BF%AE%E5%A4%8D%E9%80%BB%E8%BE%91%0Aif%20(!cleanedContent.includes(endMarker))%20%7B%0Aconst%20hasOtherMarkers%20%3D%20%5BsentenceMarker%2C%20grammarMarker%2C%20chineseMarker%5D%0A.some(marker%20%3D%3E%20cleanedContent.includes(marker))%3B%0Aif%20(hasOtherMarkers)%20%7B%0AcleanedContent%20%2B%3D%20%60%5Cn%5Cn%24%7BendMarker%7D%60%3B%20%20%2F%2F%20%E8%87%AA%E5%8A%A8%E6%B7%BB%E5%8A%A0%E7%BB%93%E6%9D%9F%E6%A0%87%E8%AE%B0%0A%7D%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// 自动修复逻辑</span>
<span class="hljs-keyword inline">if</span> (!cleanedContent.<span class="hljs-title function_ inline">includes</span>(endMarker)) {
    <span class="hljs-keyword inline">const</span> hasOtherMarkers = [sentenceMarker, grammarMarker, chineseMarker]
        .<span class="hljs-title function_ inline">some</span>(<span class="hljs-function inline"><span class="hljs-params inline">marker</span> =&gt;</span> cleanedContent.<span class="hljs-title function_ inline">includes</span>(marker));

    <span class="hljs-keyword inline">if</span> (hasOtherMarkers) {
        cleanedContent += <span class="hljs-string inline">`\n\n<span class="hljs-subst inline">${endMarker}</span>`</span>;  <span class="hljs-comment inline">// 自动添加结束标记</span>
    }
}
</code></pre>
            </div>
        
<h3 id="响应验证机制" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#响应验证机制" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 响应验证机制">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            响应验证机制
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="extractSectionsRobust(content%2C%20markers)%20%7B%0Aconst%20sections%20%3D%20%7B%7D%3B%0A%2F%2F%20%E5%AF%B9%E4%BA%8E%E5%8F%A5%E5%AD%90%E6%A3%80%E6%9F%A5%E5%93%8D%E5%BA%94%0Aif%20(markers.grammarAnalysisMarker)%20%7B%0Asections.grammarAnalysis%20%3D%20this.extractSection(%0Acontent%2C%0Amarkers.grammarAnalysisMarker%2C%0A%5Bmarkers.grammarCorrectionMarker%2C%20markers.keywordAnalysisMarker%2C%20markers.chineseDefinitionMarker%2C%20markers.endMarker%5D%0A)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-title function_ inline">extractSectionsRobust</span>(<span class="hljs-params inline">content, markers</span>) {
    <span class="hljs-keyword inline">const</span> sections = {};

    <span class="hljs-comment inline">// 对于句子检查响应</span>
    <span class="hljs-keyword inline">if</span> (markers.<span class="hljs-property inline">grammarAnalysisMarker</span>) {
        sections.<span class="hljs-property inline">grammarAnalysis</span> = <span class="hljs-variable language_ inline">this</span>.<span class="hljs-title function_ inline">extractSection</span>(
            content,
            markers.<span class="hljs-property inline">grammarAnalysisMarker</span>,
            [markers.<span class="hljs-property inline">grammarCorrectionMarker</span>, markers.<span class="hljs-property inline">keywordAnalysisMarker</span>, markers.<span class="hljs-property inline">chineseDefinitionMarker</span>, markers.<span class="hljs-property inline">endMarker</span>]
        );
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">鲁棒性提取的算法设计</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">每个section的提取都使用了优先级队列的思想：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="extractSection(content%2C%20startMarker%2C%20endMarkers%20%3D%20%5B%5D)%20%7B%0Aconst%20startIndex%20%3D%20content.indexOf(startMarker)%3B%0Aif%20(startIndex%20%3D%3D%3D%20-1)%20%7B%0Areturn%20null%3B%20%2F%2F%20%E6%A0%87%E8%AE%B0%E6%9C%AA%E6%89%BE%E5%88%B0%0A%7D%0Aconst%20contentStart%20%3D%20startIndex%20%2B%20startMarker.length%3B%0A%2F%2F%20%E6%89%BE%E5%88%B0%E6%9C%80%E6%97%A9%E7%9A%84%E7%BB%93%E6%9D%9F%E6%A0%87%E8%AE%B0%0Alet%20endIndex%20%3D%20content.length%3B%20%2F%2F%20%E9%BB%98%E8%AE%A4%E5%88%B0%E5%86%85%E5%AE%B9%E7%BB%93%E5%B0%BE%0Afor%20(const%20endMarker%20of%20endMarkers)%20%7B%0Aconst%20markerIndex%20%3D%20content.indexOf(endMarker%2C%20contentStart)%3B%0Aif%20(markerIndex%20!%3D%3D%20-1%20%26%26%20markerIndex%20%2F%2F%20%E6%9B%B4%E6%96%B0%E6%9C%80%E6%97%A9%E7%9A%84%E7%BB%93%E6%9D%9F%E4%BD%8D%E7%BD%AE%0A%7D%0A%7D%0Aconst%20extractedContent%20%3D%20content.substring(contentStart%2C%20endIndex).trim()%3B%0Areturn%20extractedContent.length%20%3E%3D%205%20%3F%20extractedContent%20%3A%20null%3B%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-title function_ inline">extractSection</span>(<span class="hljs-params inline">content, startMarker, endMarkers = []</span>) {
    <span class="hljs-keyword inline">const</span> startIndex = content.<span class="hljs-title function_ inline">indexOf</span>(startMarker);
    <span class="hljs-keyword inline">if</span> (startIndex === -<span class="hljs-number inline">1</span>) {
        <span class="hljs-keyword inline">return</span> <span class="hljs-literal inline">null</span>; <span class="hljs-comment inline">// 标记未找到</span>
    }

    <span class="hljs-keyword inline">const</span> contentStart = startIndex + startMarker.<span class="hljs-property inline">length</span>;

    <span class="hljs-comment inline">// 找到最早的结束标记</span>
    <span class="hljs-keyword inline">let</span> endIndex = content.<span class="hljs-property inline">length</span>; <span class="hljs-comment inline">// 默认到内容结尾</span>

    <span class="hljs-keyword inline">for</span> (<span class="hljs-keyword inline">const</span> endMarker <span class="hljs-keyword inline">of</span> endMarkers) {
        <span class="hljs-keyword inline">const</span> markerIndex = content.<span class="hljs-title function_ inline">indexOf</span>(endMarker, contentStart);
        <span class="hljs-keyword inline">if</span> (markerIndex !== -<span class="hljs-number inline">1</span> &amp;&amp; markerIndex &lt; endIndex) {
            endIndex = markerIndex;  <span class="hljs-comment inline">// 更新最早的结束位置</span>
        }
    }

    <span class="hljs-keyword inline">const</span> extractedContent = content.<span class="hljs-title function_ inline">substring</span>(contentStart, endIndex).<span class="hljs-title function_ inline">trim</span>();
    <span class="hljs-keyword inline">return</span> extractedContent.<span class="hljs-property inline">length</span> &gt;= <span class="hljs-number inline">5</span> ? extractedContent : <span class="hljs-literal inline">null</span>;
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">算法复杂度分析</strong>：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">时间复杂度</strong>：O(n × m)，其中n是内容长度，m是结束标记数量</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">空间复杂度</strong>：O(1)，不需要额外的存储空间</li>
</ul>
<h3 id="数据清洗和格式化" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#数据清洗和格式化" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 数据清洗和格式化">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            数据清洗和格式化
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="%2F%2F%20%E6%B8%85%E7%90%86%E5%8F%AF%E8%83%BD%E5%B9%B2%E6%89%B0%E7%9A%84markdown%E7%97%95%E8%BF%B9%0Acleaned%20%3D%20cleaned.replace(%2F%60%60%60%5B%5Cs%5CS%5D*%3F%60%60%60%2Fg%2C%20'')%3B%20%2F%2F%20%E7%A7%BB%E9%99%A4%E4%BB%A3%E7%A0%81%E5%9D%97%0Acleaned%20%3D%20cleaned.replace(%2F%5E%5Cs*%23%7B1%2C6%7D%5Cs*%2Fgm%2C%20'')%3B%20%2F%2F%20%E7%A7%BB%E9%99%A4markdown%E6%A0%87%E9%A2%98%0Areturn%20cleaned.trim()%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-comment inline">// 清理可能干扰的markdown痕迹</span>
cleaned = cleaned.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/```[\s\S]*?```/g</span>, <span class="hljs-string inline">&#x27;&#x27;</span>); <span class="hljs-comment inline">// 移除代码块</span>
cleaned = cleaned.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/^\s*#{1,6}\s*/gm</span>, <span class="hljs-string inline">&#x27;&#x27;</span>); <span class="hljs-comment inline">// 移除markdown标题</span>

<span class="hljs-keyword inline">return</span> cleaned.<span class="hljs-title function_ inline">trim</span>();
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">清洗规则的设计原则</strong>：</p>
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">保留内容</strong>：不删除有意义的文本</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">移除干扰</strong>：删除格式化标记</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">标准化</strong>：统一空白字符处理</li>
</ol>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">正则表达式的性能考量</strong>：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20%E4%BB%A3%E7%A0%81%E5%9D%97%E6%B8%85%E7%90%86%0Acleaned%20%3D%20cleaned.replace(%2F%60%60%60%5B%5Cs%5CS%5D*%3F%60%60%60%2Fg%2C%20'')%3B%0A%2F%2F%20%E6%A0%87%E9%A2%98%E6%B8%85%E7%90%86%0Acleaned%20%3D%20cleaned.replace(%2F%5E%5Cs*%23%7B1%2C6%7D%5Cs*%2Fgm%2C%20'')%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// 代码块清理</span>
cleaned = cleaned.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/```[\s\S]*?```/g</span>, <span class="hljs-string inline">&#x27;&#x27;</span>);

<span class="hljs-comment inline">// 标题清理</span>
cleaned = cleaned.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/^\s*#{1,6}\s*/gm</span>, <span class="hljs-string inline">&#x27;&#x27;</span>);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">这些正则表达式的性能特征：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">非贪婪匹配</strong>：<code>*?</code>确保最小匹配</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">多行模式</strong>：<code>m</code>标志处理多行文本</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">字符类</strong>：<code>\s</code>比<code>[ \t\n\r]</code>更高效</li>
</ul>
<h2 id="完整解析流程的架构设计" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#完整解析流程的架构设计" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 完整解析流程的架构设计">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            完整解析流程的架构设计
        </h2>
<h3 id="从模板加载到响应解析的生命周期" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#从模板加载到响应解析的生命周期" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 从模板加载到响应解析的生命周期">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            从模板加载到响应解析的生命周期
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">完整的请求流程：</p>
<div class="mermaid block" id="mermaid-1765738202116-9snn1pf">graph TD
    A[用户请求] --> B[AIService.checkSentence]
    B --> C[promptLoader.getSentenceCheckPrompt]
    C --> D[loadPrompt缓存查找]
    D --> E{缓存命中?}
    E -->|是| F[返回缓存内容]
    E -->|否| G[读取文件]
    G --> H[缓存存储]
    H --> I[模板变量替换]
    I --> J[发送AI请求]
    J --> K[接收AI响应]
    K --> L[parseSentenceCheckResponse]
    L --> M[内容清理]
    M --> N[标记识别]
    N --> O[分段提取]
    O --> P[验证完整性]
    P --> Q[返回结构化结果]</div>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">组件职责</strong>：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">PromptLoader</strong>：负责模板管理和缓存</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">AIService</strong>：负责请求处理和响应解析</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">HttpUtils</strong>：负责HTTP请求的封装</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">i18n</strong>：负责国际化和错误信息</li>
</ul>
<h3 id="数据流向和状态管理" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#数据流向和状态管理" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 数据流向和状态管理">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            数据流向和状态管理
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20%E6%95%B0%E6%8D%AE%E6%B5%81%E5%90%91%E7%9A%84TypeScript%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89%0Ainterface%20RequestFlow%20%7B%0Ainput%3A%20%7B%0Asentence%3A%20string%3B%0AuserId%3F%3A%20string%3B%0AgrammarLanguageOption%3A%20'pure'%20%7C%20'combined'%3B%0A%7D%3B%0Aprocessing%3A%20%7B%0ApromptTemplate%3A%20string%3B%0AfilledPrompt%3A%20string%3B%0AaiResponse%3A%20string%3B%0AcleanedContent%3A%20string%3B%0A%7D%3B%0Aoutput%3A%20%7B%0AgrammarAnalysis%3A%20string%3B%0AgrammarCorrection%3A%20string%3B%0AkeywordAnalysis%3A%20string%3B%0AchineseDefinition%3A%20string%3B%0Asuccess%3A%20boolean%3B%0Aerror%3F%3A%20string%3B%0A%7D%3B%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// 数据流向的TypeScript类型定义</span>
<span class="hljs-keyword inline">interface</span> <span class="hljs-title class_ inline">RequestFlow</span> {
    <span class="hljs-attr inline">input</span>: {
        <span class="hljs-attr inline">sentence</span>: <span class="hljs-built_in inline">string</span>;
        <span class="hljs-attr inline">userId</span>?: <span class="hljs-built_in inline">string</span>;
        <span class="hljs-attr inline">grammarLanguageOption</span>: <span class="hljs-string inline">&#x27;pure&#x27;</span> | <span class="hljs-string inline">&#x27;combined&#x27;</span>;
    };
    
    <span class="hljs-attr inline">processing</span>: {
        <span class="hljs-attr inline">promptTemplate</span>: <span class="hljs-built_in inline">string</span>;
        <span class="hljs-attr inline">filledPrompt</span>: <span class="hljs-built_in inline">string</span>;
        <span class="hljs-attr inline">aiResponse</span>: <span class="hljs-built_in inline">string</span>;
        <span class="hljs-attr inline">cleanedContent</span>: <span class="hljs-built_in inline">string</span>;
    };
    
    <span class="hljs-attr inline">output</span>: {
        <span class="hljs-attr inline">grammarAnalysis</span>: <span class="hljs-built_in inline">string</span>;
        <span class="hljs-attr inline">grammarCorrection</span>: <span class="hljs-built_in inline">string</span>;
        <span class="hljs-attr inline">keywordAnalysis</span>: <span class="hljs-built_in inline">string</span>;
        <span class="hljs-attr inline">chineseDefinition</span>: <span class="hljs-built_in inline">string</span>;
        <span class="hljs-attr inline">success</span>: <span class="hljs-built_in inline">boolean</span>;
        <span class="hljs-attr inline">error</span>?: <span class="hljs-built_in inline">string</span>;
    };
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">状态管理的不可变性</strong>：</p>
<p class="text-base leading-7 mb-4 text-foreground">每个处理步骤都产生新的状态，而不是修改原有状态：</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20%E4%B8%8D%E5%8F%AF%E5%8F%98%E7%9A%84%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2%0Aconst%20state1%20%3D%20%7B%20content%3A%20rawContent%20%7D%3B%0Aconst%20state2%20%3D%20%7B%20...state1%2C%20content%3A%20cleanedContent%20%7D%3B%0Aconst%20state3%20%3D%20%7B%20...state2%2C%20sections%3A%20extractedSections%20%7D%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// 不可变的状态转换</span>
<span class="hljs-keyword inline">const</span> state1 = { <span class="hljs-attr inline">content</span>: rawContent };
<span class="hljs-keyword inline">const</span> state2 = { ...state1, <span class="hljs-attr inline">content</span>: cleanedContent };
<span class="hljs-keyword inline">const</span> state3 = { ...state2, <span class="hljs-attr inline">sections</span>: extractedSections };
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">这种设计的优势：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">调试友好</strong>：每个状态都可以独立检查</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">错误追踪</strong>：容易定位问题发生的环节</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">并发安全</strong>：避免状态竞争问题</li>
</ul>
<h2 id="系统架构图与技术要点总结" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#系统架构图与技术要点总结" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 系统架构图与技术要点总结">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            系统架构图与技术要点总结
        </h2>
<h3 id="完整的系统架构流程图" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#完整的系统架构流程图" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 完整的系统架构流程图">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            完整的系统架构流程图
        </h3>
<div class="mermaid block" id="mermaid-1765738202116-ytubo81">graph TB
    subgraph "用户请求层"
        A[用户输入] --> B[API路由]
    end
    
    subgraph "业务逻辑层"
        B --> C[AIService]
        C --> D[动态模型选择]
        D --> E[提示词加载]
    end
    
    subgraph "提示词管理层"
        E --> F[PromptLoader]
        F --> G{缓存命中?}
        G -->|是| H[返回缓存]
        G -->|否| I[文件读取]
        I --> J[缓存更新]
        J --> K[模板替换]
    end
    
    subgraph "AI交互层"
        K --> L[HTTP请求]
        L --> M[AI响应]
        M --> N[响应解析]
    end
    
    subgraph "解析处理层"
        N --> O[内容清理]
        O --> P[标记识别]
        P --> Q[分段提取]
        Q --> R[验证完整性]
        R --> S[结构化输出]
    end
    
    subgraph "容错处理层"
        I --> T{文件存在?}
        T -->|是| J
        T -->|否| U[降级策略]
        U --> V[Combined版本]
        V --> W{加载成功?}
        W -->|是| J
        W -->|否| X[错误处理]
        N --> Y{解析成功?}
        Y -->|是| S
        Y -->|否| Z[部分解析]
    end
    
    S --> AA[返回结果]
    X --> AA
    Z --> AA
    H --> K</div>
<h2 id="完整源码全解析" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#完整源码全解析" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 完整源码全解析">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            完整源码全解析
        </h2>
<h3 id="promptloader完整源码解析" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#promptloader完整源码解析" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to PromptLoader完整源码解析">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            PromptLoader完整源码解析
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E4%BE%9D%E8%B5%96%E5%AF%BC%E5%85%A5%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Aconst%20fs%20%3D%20require('fs')%3B%20%20%20%20%20%20%20%20%2F%2F%20Node.js%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%A8%A1%E5%9D%97%EF%BC%8C%E7%94%A8%E4%BA%8E%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%0Aconst%20path%20%3D%20require('path')%3B%20%20%20%20%2F%2F%20Node.js%E8%B7%AF%E5%BE%84%E6%A8%A1%E5%9D%97%EF%BC%8C%E7%94%A8%E4%BA%8E%E8%B7%A8%E5%B9%B3%E5%8F%B0%E8%B7%AF%E5%BE%84%E5%A4%84%E7%90%86%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20PromptLoader%E6%A0%B8%E5%BF%83%E7%B1%BB%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Aclass%20PromptLoader%20%7B%0Aconstructor()%20%7B%0A%2F%2F%20%E4%BD%BF%E7%94%A8Map%E8%80%8C%E9%9D%9EObject%E5%AD%98%E5%82%A8%E7%BC%93%E5%AD%98%EF%BC%8C%E8%8E%B7%E5%BE%97%E6%9B%B4%E5%A5%BD%E7%9A%84%E6%80%A7%E8%83%BD%E5%92%8C%E7%B1%BB%E5%9E%8B%E5%AE%89%E5%85%A8%0Athis.promptCache%20%3D%20new%20Map()%3B%0A%2F%2F%20%E4%BD%BF%E7%94%A8path.join%E7%A1%AE%E4%BF%9D%E8%B7%A8%E5%B9%B3%E5%8F%B0%E8%B7%AF%E5%BE%84%E5%85%BC%E5%AE%B9%E6%80%A7%0A%2F%2F%20__dirname%E6%8C%87%E5%90%91%E5%BD%93%E5%89%8D%E6%96%87%E4%BB%B6%E6%89%80%E5%9C%A8%E7%9B%AE%E5%BD%95%EF%BC%8C..%2Fprompts%E6%8C%87%E5%90%91prompts%E6%96%87%E4%BB%B6%E5%A4%B9%0Athis.promptsDir%20%3D%20path.join(__dirname%2C%20'..%2Fprompts')%3B%0A%7D%0A%2F**%0A*%20%E6%A0%B8%E5%BF%83%E6%96%B9%E6%B3%95%EF%BC%9A%E4%BB%8E%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD%E6%8F%90%E7%A4%BA%E8%AF%8D%E6%A8%A1%E6%9D%BF%E5%B9%B6%E7%BC%93%E5%AD%98%0A*%20%40param%20%7Bstring%7D%20type%20-%20%E6%8F%90%E7%A4%BA%E8%AF%8D%E7%B1%BB%E5%9E%8B%20('sentence-check'%20%E6%88%96%20'sentence-generation')%0A*%20%40param%20%7Bstring%7D%20grammarLanguageOption%20-%20%E8%AF%AD%E6%B3%95%E8%AF%AD%E8%A8%80%E9%80%89%E9%A1%B9%20('combined'%20%E6%88%96%20'pure')%0A*%20%40returns%20%7Bstring%7D%20%E6%8F%90%E7%A4%BA%E8%AF%8D%E6%A8%A1%E6%9D%BF%E5%AD%97%E7%AC%A6%E4%B8%B2%0A*%2F%0AloadPrompt(type%2C%20grammarLanguageOption%20%3D%20'combined')%20%7B%0A%2F%2F%20%E6%9E%84%E9%80%A0%E7%BC%93%E5%AD%98%E9%94%AE%EF%BC%9A%E7%B1%BB%E5%9E%8B-%E8%AF%AD%E8%A8%80%E9%80%89%E9%A1%B9%E7%9A%84%E5%A4%8D%E5%90%88%E9%94%AE%0A%2F%2F%20%E4%BE%8B%E5%A6%82%EF%BC%9A'sentence-check-combined'%2C%20'sentence-generation-pure'%0Aconst%20cacheKey%20%3D%20%60%24%7Btype%7D-%24%7BgrammarLanguageOption%7D%60%3B%0A%2F%2F%20%E7%BC%93%E5%AD%98%E4%BC%98%E5%85%88%E7%AD%96%E7%95%A5%EF%BC%9A%E5%A6%82%E6%9E%9C%E7%BC%93%E5%AD%98%E4%B8%AD%E5%AD%98%E5%9C%A8%EF%BC%8C%E7%9B%B4%E6%8E%A5%E8%BF%94%E5%9B%9E%0A%2F%2F%20Map.has()%E5%92%8CMap.get()%E9%83%BD%E6%98%AFO(1)%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6%0Aif%20(this.promptCache.has(cacheKey))%20%7B%0Areturn%20this.promptCache.get(cacheKey)%3B%0A%7D%0Atry%20%7B%0A%2F%2F%20%E6%A0%B9%E6%8D%AE%E7%BA%A6%E5%AE%9A%E6%9E%84%E9%80%A0%E6%96%87%E4%BB%B6%E5%90%8D%EF%BC%9A%E7%B1%BB%E5%9E%8B-%E9%80%89%E9%A1%B9.txt%0Aconst%20filename%20%3D%20%60%24%7Btype%7D-%24%7BgrammarLanguageOption%7D.txt%60%3B%0A%2F%2F%20%E6%9E%84%E9%80%A0%E5%AE%8C%E6%95%B4%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84%EF%BC%8Cpath.join%E8%87%AA%E5%8A%A8%E5%A4%84%E7%90%86%E8%B7%AF%E5%BE%84%E5%88%86%E9%9A%94%E7%AC%A6%0Aconst%20filepath%20%3D%20path.join(this.promptsDir%2C%20filename)%3B%0A%2F%2F%20%E9%98%B2%E5%BE%A1%E6%80%A7%E7%BC%96%E7%A8%8B%EF%BC%9A%E5%85%88%E6%A3%80%E6%9F%A5%E6%96%87%E4%BB%B6%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%0A%2F%2F%20%E9%81%BF%E5%85%8Dfs.readFileSync%E6%8A%9B%E5%87%BA%E9%9A%BE%E4%BB%A5%E7%90%86%E8%A7%A3%E7%9A%84ENOENT%E9%94%99%E8%AF%AF%0Aif%20(!fs.existsSync(filepath))%20%7B%0Athrow%20new%20Error(%60Prompt%20file%20not%20found%3A%20%24%7Bfilepath%7D%60)%3B%0A%7D%0A%2F%2F%20%E5%90%8C%E6%AD%A5%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%EF%BC%8C%E4%BD%BF%E7%94%A8utf8%E7%BC%96%E7%A0%81%E7%A1%AE%E4%BF%9D%E4%B8%AD%E6%96%87%E6%AD%A3%E7%A1%AE%E6%98%BE%E7%A4%BA%0Aconst%20promptTemplate%20%3D%20fs.readFileSync(filepath%2C%20'utf8')%3B%0A%2F%2F%20%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5%EF%BC%9A%E5%8F%AA%E6%9C%89%E6%88%90%E5%8A%9F%E8%AF%BB%E5%8F%96%E7%9A%84%E5%86%85%E5%AE%B9%E6%89%8D%E4%BC%9A%E8%A2%AB%E7%BC%93%E5%AD%98%0A%2F%2F%20%E9%81%BF%E5%85%8D%E7%BC%93%E5%AD%98%E9%94%99%E8%AF%AF%E6%88%96%E4%B8%8D%E5%AE%8C%E6%95%B4%E7%9A%84%E6%95%B0%E6%8D%AE%0Athis.promptCache.set(cacheKey%2C%20promptTemplate)%3B%0Areturn%20promptTemplate%3B%0A%7D%20catch%20(error)%20%7B%0A%2F%2F%20%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E7%AC%AC%E4%B8%80%E5%B1%82%EF%BC%9A%E8%AE%B0%E5%BD%95%E8%AF%A6%E7%BB%86%E7%9A%84%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF%0Aconsole.error(%60Error%20loading%20prompt%20%24%7Btype%7D-%24%7BgrammarLanguageOption%7D%3A%60%2C%20error.message)%3B%0A%2F%2F%20%E9%99%8D%E7%BA%A7%E7%AD%96%E7%95%A5%EF%BC%9A%E5%A6%82%E6%9E%9Cpure%E7%89%88%E6%9C%AC%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%B0%9D%E8%AF%95combined%E7%89%88%E6%9C%AC%0A%2F%2F%20%E8%BF%99%E6%98%AF%E4%B8%80%E4%B8%AA%E4%BC%98%E9%9B%85%E7%9A%84%E5%9B%9E%E9%80%80%E6%9C%BA%E5%88%B6%EF%BC%8C%E7%A1%AE%E4%BF%9D%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%8F%AF%E7%94%A8%E6%80%A7%0Aif%20(grammarLanguageOption%20%3D%3D%3D%20'pure')%20%7B%0Aconsole.warn(%60Falling%20back%20to%20combined%20prompt%20for%20%24%7Btype%7D%60)%3B%0A%2F%2F%20%E9%80%92%E5%BD%92%E8%B0%83%E7%94%A8%E8%87%AA%E8%BA%AB%EF%BC%8C%E4%BD%86%E4%BD%BF%E7%94%A8combined%E9%80%89%E9%A1%B9%0Areturn%20this.loadPrompt(type%2C%20'combined')%3B%0A%7D%0A%2F%2F%20%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%9C%80%E5%90%8E%E4%B8%80%E9%81%93%E9%98%B2%E7%BA%BF%EF%BC%9A%E5%A6%82%E6%9E%9Ccombined%E7%89%88%E6%9C%AC%E4%B9%9F%E5%A4%B1%E8%B4%A5%EF%BC%8C%E6%8A%9B%E5%87%BA%E6%98%8E%E7%A1%AE%E7%9A%84%E9%94%99%E8%AF%AF%0Athrow%20new%20Error(%60Failed%20to%20load%20prompt%20template%3A%20%24%7Btype%7D-%24%7BgrammarLanguageOption%7D%60)%3B%0A%7D%0A%7D%0A%2F**%0A*%20%E8%8E%B7%E5%8F%96%E5%8F%A5%E5%AD%90%E6%A3%80%E6%9F%A5%E6%8F%90%E7%A4%BA%E8%AF%8D%EF%BC%88%E5%B8%A6%E5%8F%98%E9%87%8F%E6%9B%BF%E6%8D%A2%EF%BC%89%0A*%20%40param%20%7Bstring%7D%20sentence%20-%20%E8%A6%81%E5%88%86%E6%9E%90%E7%9A%84%E5%8F%A5%E5%AD%90%0A*%20%40param%20%7Bstring%7D%20grammarLanguageOption%20-%20%E8%AF%AD%E8%A8%80%E9%80%89%E9%A1%B9%0A*%20%40returns%20%7Bstring%7D%20%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%90%8E%E7%9A%84%E6%8F%90%E7%A4%BA%E8%AF%8D%0A*%2F%0AgetSentenceCheckPrompt(sentence%2C%20grammarLanguageOption%20%3D%20'combined')%20%7B%0A%2F%2F%20%E5%85%88%E8%8E%B7%E5%8F%96%E6%A8%A1%E6%9D%BF%EF%BC%8C%E5%88%A9%E7%94%A8loadPrompt%E7%9A%84%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6%0Aconst%20template%20%3D%20this.loadPrompt('sentence-check'%2C%20grammarLanguageOption)%3B%0A%2F%2F%20%E7%AE%80%E5%8D%95%E8%80%8C%E6%9C%89%E6%95%88%E7%9A%84%E6%A8%A1%E6%9D%BF%E5%8F%98%E9%87%8F%E6%9B%BF%E6%8D%A2%0A%2F%2F%20%E4%BD%BF%E7%94%A8String.replace%E8%80%8C%E9%9D%9E%E5%A4%8D%E6%9D%82%E7%9A%84%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%EF%BC%8C%E5%87%8F%E5%B0%91%E4%BE%9D%E8%B5%96%E5%92%8C%E5%A4%8D%E6%9D%82%E5%BA%A6%0Areturn%20template.replace('%7Bsentence%7D'%2C%20sentence)%3B%0A%7D%0A%2F**%0A*%20%E8%8E%B7%E5%8F%96%E5%8F%A5%E5%AD%90%E7%94%9F%E6%88%90%E6%8F%90%E7%A4%BA%E8%AF%8D%EF%BC%88%E5%B8%A6%E5%8F%98%E9%87%8F%E6%9B%BF%E6%8D%A2%EF%BC%89%0A*%20%40param%20%7BArray%7D%20words%20-%20%E8%A6%81%E4%BD%BF%E7%94%A8%E7%9A%84%E5%8D%95%E8%AF%8D%E6%95%B0%E7%BB%84%0A*%20%40param%20%7Bstring%7D%20grammarLanguageOption%20-%20%E8%AF%AD%E8%A8%80%E9%80%89%E9%A1%B9%0A*%20%40returns%20%7Bstring%7D%20%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%90%8E%E7%9A%84%E6%8F%90%E7%A4%BA%E8%AF%8D%0A*%2F%0AgetSentenceGenerationPrompt(words%2C%20grammarLanguageOption%20%3D%20'combined')%20%7B%0Aconst%20template%20%3D%20this.loadPrompt('sentence-generation'%2C%20grammarLanguageOption)%3B%0A%2F%2F%20%E7%B1%BB%E5%9E%8B%E5%AE%89%E5%85%A8%E7%9A%84%E6%95%B0%E7%BB%84%E5%A4%84%E7%90%86%EF%BC%9A%E7%A1%AE%E4%BF%9Dwords%E6%98%AF%E6%95%B0%E7%BB%84%E5%90%8E%E5%86%8Djoin%0A%2F%2F%20%E5%A6%82%E6%9E%9C%E4%B8%8D%E6%98%AF%E6%95%B0%E7%BB%84%EF%BC%8C%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8%E5%8E%9F%E5%80%BC%0Aconst%20wordsString%20%3D%20Array.isArray(words)%20%3F%20words.join('%2C%20')%20%3A%20words%3B%0Areturn%20template.replace('%7Bwords%7D'%2C%20wordsString)%3B%0A%7D%0A%2F**%0A*%20%E6%B8%85%E7%A9%BA%E7%BC%93%E5%AD%98%EF%BC%88%E5%BC%80%E5%8F%91%E5%92%8C%E6%B5%8B%E8%AF%95%E6%97%B6%E6%9C%89%E7%94%A8%EF%BC%89%0A*%2F%0AclearCache()%20%7B%0A%2F%2F%20Map.clear()%E6%98%AFO(1)%E6%93%8D%E4%BD%9C%EF%BC%8C%E7%9B%B4%E6%8E%A5%E6%B8%85%E7%A9%BA%E6%89%80%E6%9C%89%E7%BC%93%E5%AD%98%0Athis.promptCache.clear()%3B%0A%7D%0A%2F**%0A*%20%E8%8E%B7%E5%8F%96%E7%BC%93%E5%AD%98%E7%8A%B6%E6%80%81%E4%BF%A1%E6%81%AF%EF%BC%88%E8%B0%83%E8%AF%95%E7%94%A8%EF%BC%89%0A*%20%40returns%20%7BObject%7D%20%E5%8C%85%E5%90%AB%E7%BC%93%E5%AD%98%E5%A4%A7%E5%B0%8F%E5%92%8C%E5%B7%B2%E7%BC%93%E5%AD%98%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BF%A1%E6%81%AF%0A*%2F%0AgetCacheInfo()%20%7B%0Areturn%20%7B%0A%2F%2F%20Map.size%E6%98%AFO(1)%E6%93%8D%E4%BD%9C%EF%BC%8C%E8%8E%B7%E5%8F%96%E7%BC%93%E5%AD%98%E9%A1%B9%E7%9B%AE%E6%95%B0%E9%87%8F%0AcacheSize%3A%20this.promptCache.size%2C%0A%2F%2F%20%E5%B0%86Map%E7%9A%84%E9%94%AE%E8%BD%AC%E6%8D%A2%E4%B8%BA%E6%95%B0%E7%BB%84%EF%BC%8C%E4%BE%BF%E4%BA%8E%E8%B0%83%E8%AF%95%E6%9F%A5%E7%9C%8B%0AcachedPrompts%3A%20Array.from(this.promptCache.keys())%0A%7D%3B%0A%7D%0A%2F**%0A*%20%E9%AA%8C%E8%AF%81%E6%89%80%E6%9C%89%E5%BF%85%E9%9C%80%E7%9A%84%E6%8F%90%E7%A4%BA%E8%AF%8D%E6%96%87%E4%BB%B6%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%0A*%20%40returns%20%7BObject%7D%20%E9%AA%8C%E8%AF%81%E7%BB%93%E6%9E%9C%EF%BC%8C%E5%8C%85%E5%90%AB%E5%AD%98%E5%9C%A8%2F%E7%BC%BA%E5%A4%B1%E7%9A%84%E6%96%87%E4%BB%B6%E5%88%97%E8%A1%A8%0A*%2F%0AvalidatePromptFiles()%20%7B%0A%2F%2F%20%E5%AE%9A%E4%B9%89%E7%B3%BB%E7%BB%9F%E5%BF%85%E9%9C%80%E7%9A%84%E6%8F%90%E7%A4%BA%E8%AF%8D%E6%96%87%E4%BB%B6%E5%88%97%E8%A1%A8%0A%2F%2F%20%E8%BF%99%E4%B8%AA%E6%95%B0%E7%BB%84%E5%AE%9A%E4%B9%89%E4%BA%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%8C%E6%95%B4%E6%80%A7%E8%A6%81%E6%B1%82%0Aconst%20requiredPrompts%20%3D%20%5B%0A'sentence-check-pure.txt'%2C%0A'sentence-check-combined.txt'%2C%0A'sentence-generation-pure.txt'%2C%0A'sentence-generation-combined.txt'%0A%5D%3B%0Aconst%20missing%20%3D%20%5B%5D%3B%20%20%20%2F%2F%20%E7%BC%BA%E5%A4%B1%E7%9A%84%E6%96%87%E4%BB%B6%0Aconst%20existing%20%3D%20%5B%5D%3B%20%20%2F%2F%20%E5%AD%98%E5%9C%A8%E7%9A%84%E6%96%87%E4%BB%B6%0A%2F%2F%20%E9%81%8D%E5%8E%86%E6%89%80%E6%9C%89%E5%BF%85%E9%9C%80%E6%96%87%E4%BB%B6%EF%BC%8C%E6%A3%80%E6%9F%A5%E5%AD%98%E5%9C%A8%E6%80%A7%0Afor%20(const%20filename%20of%20requiredPrompts)%20%7B%0Aconst%20filepath%20%3D%20path.join(this.promptsDir%2C%20filename)%3B%0A%2F%2F%20fs.existsSync%E6%98%AF%E5%90%8C%E6%AD%A5%E6%A3%80%E6%9F%A5%EF%BC%8C%E9%80%82%E5%90%88%E5%90%AF%E5%8A%A8%E6%97%B6%E7%9A%84%E4%B8%80%E6%AC%A1%E6%80%A7%E9%AA%8C%E8%AF%81%0Aif%20(fs.existsSync(filepath))%20%7B%0Aexisting.push(filename)%3B%0A%7D%20else%20%7B%0Amissing.push(filename)%3B%0A%7D%0A%7D%0Areturn%20%7B%0A%2F%2F%20%E7%B3%BB%E7%BB%9F%E5%AE%8C%E6%95%B4%E6%80%A7%E6%A0%87%E5%BF%97%EF%BC%9A%E5%8F%AA%E6%9C%89%E5%BD%93%E6%89%80%E6%9C%89%E6%96%87%E4%BB%B6%E9%83%BD%E5%AD%98%E5%9C%A8%E6%97%B6%E6%89%8D%E4%B8%BAtrue%0Avalid%3A%20missing.length%20%3D%3D%3D%200%2C%0Aexisting%2C%0Amissing%2C%0A%2F%2F%20%E6%8F%90%E4%BE%9B%E6%8F%90%E7%A4%BA%E8%AF%8D%E7%9B%AE%E5%BD%95%E8%B7%AF%E5%BE%84%EF%BC%8C%E4%BE%BF%E4%BA%8E%E8%BF%90%E7%BB%B4%E4%BA%BA%E5%91%98%E5%AE%9A%E4%BD%8D%E9%97%AE%E9%A2%98%0ApromptsDirectory%3A%20this.promptsDir%0A%7D%3B%0A%7D%0A%7D%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%87%BA%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F%2F%20%E5%AF%BC%E5%87%BA%E5%8D%95%E4%BE%8B%E5%AE%9E%E4%BE%8B%EF%BC%8C%E8%80%8C%E4%B8%8D%E6%98%AF%E7%B1%BB%E6%9C%AC%E8%BA%AB%0A%2F%2F%20%E8%BF%99%E7%A1%AE%E4%BF%9D%E4%BA%86%E5%85%A8%E5%B1%80%E5%8F%AA%E6%9C%89%E4%B8%80%E4%B8%AAPromptLoader%E5%AE%9E%E4%BE%8B%EF%BC%8C%E8%8A%82%E7%9C%81%E5%86%85%E5%AD%98%E4%B8%94%E4%BF%9D%E8%AF%81%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%0Amodule.exports%20%3D%20new%20PromptLoader()%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-comment inline">// ==================== 依赖导入 ====================</span>
<span class="hljs-keyword inline">const</span> fs = <span class="hljs-built_in inline">require</span>(<span class="hljs-string inline">&#x27;fs&#x27;</span>);        <span class="hljs-comment inline">// Node.js文件系统模块，用于文件操作</span>
<span class="hljs-keyword inline">const</span> path = <span class="hljs-built_in inline">require</span>(<span class="hljs-string inline">&#x27;path&#x27;</span>);    <span class="hljs-comment inline">// Node.js路径模块，用于跨平台路径处理</span>

<span class="hljs-comment inline">// ==================== PromptLoader核心类 ====================</span>
<span class="hljs-keyword inline">class</span> <span class="hljs-title class_ inline">PromptLoader</span> {
    <span class="hljs-title function_ inline">constructor</span>(<span class="hljs-params inline"></span>) {
        <span class="hljs-comment inline">// 使用Map而非Object存储缓存，获得更好的性能和类型安全</span>
        <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">promptCache</span> = <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Map</span>();
        
        <span class="hljs-comment inline">// 使用path.join确保跨平台路径兼容性</span>
        <span class="hljs-comment inline">// __dirname指向当前文件所在目录，../prompts指向prompts文件夹</span>
        <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">promptsDir</span> = path.<span class="hljs-title function_ inline">join</span>(__dirname, <span class="hljs-string inline">&#x27;../prompts&#x27;</span>);
    }

    <span class="hljs-comment inline">/**
     * 核心方法：从文件加载提示词模板并缓存
     * <span class="hljs-doctag inline">@param</span> {<span class="hljs-type inline">string</span>} <span class="hljs-variable inline">type</span> - 提示词类型 (&#x27;sentence-check&#x27; 或 &#x27;sentence-generation&#x27;)
     * <span class="hljs-doctag inline">@param</span> {<span class="hljs-type inline">string</span>} <span class="hljs-variable inline">grammarLanguageOption</span> - 语法语言选项 (&#x27;combined&#x27; 或 &#x27;pure&#x27;)
     * <span class="hljs-doctag inline">@returns</span> {<span class="hljs-type inline">string</span>} 提示词模板字符串
     */</span>
    <span class="hljs-title function_ inline">loadPrompt</span>(<span class="hljs-params inline">type, grammarLanguageOption = <span class="hljs-string inline">&#x27;combined&#x27;</span></span>) {
        <span class="hljs-comment inline">// 构造缓存键：类型-语言选项的复合键</span>
        <span class="hljs-comment inline">// 例如：&#x27;sentence-check-combined&#x27;, &#x27;sentence-generation-pure&#x27;</span>
        <span class="hljs-keyword inline">const</span> cacheKey = <span class="hljs-string inline">`<span class="hljs-subst inline">${type}</span>-<span class="hljs-subst inline">${grammarLanguageOption}</span>`</span>;
        
        <span class="hljs-comment inline">// 缓存优先策略：如果缓存中存在，直接返回</span>
        <span class="hljs-comment inline">// Map.has()和Map.get()都是O(1)时间复杂度</span>
        <span class="hljs-keyword inline">if</span> (<span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">promptCache</span>.<span class="hljs-title function_ inline">has</span>(cacheKey)) {
            <span class="hljs-keyword inline">return</span> <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">promptCache</span>.<span class="hljs-title function_ inline">get</span>(cacheKey);
        }

        <span class="hljs-keyword inline">try</span> {
            <span class="hljs-comment inline">// 根据约定构造文件名：类型-选项.txt</span>
            <span class="hljs-keyword inline">const</span> filename = <span class="hljs-string inline">`<span class="hljs-subst inline">${type}</span>-<span class="hljs-subst inline">${grammarLanguageOption}</span>.txt`</span>;
            
            <span class="hljs-comment inline">// 构造完整文件路径，path.join自动处理路径分隔符</span>
            <span class="hljs-keyword inline">const</span> filepath = path.<span class="hljs-title function_ inline">join</span>(<span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">promptsDir</span>, filename);
            
            <span class="hljs-comment inline">// 防御性编程：先检查文件是否存在</span>
            <span class="hljs-comment inline">// 避免fs.readFileSync抛出难以理解的ENOENT错误</span>
            <span class="hljs-keyword inline">if</span> (!fs.<span class="hljs-title function_ inline">existsSync</span>(filepath)) {
                <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">`Prompt file not found: <span class="hljs-subst inline">${filepath}</span>`</span>);
            }

            <span class="hljs-comment inline">// 同步读取文件内容，使用utf8编码确保中文正确显示</span>
            <span class="hljs-keyword inline">const</span> promptTemplate = fs.<span class="hljs-title function_ inline">readFileSync</span>(filepath, <span class="hljs-string inline">&#x27;utf8&#x27;</span>);
            
            <span class="hljs-comment inline">// 缓存策略：只有成功读取的内容才会被缓存</span>
            <span class="hljs-comment inline">// 避免缓存错误或不完整的数据</span>
            <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">promptCache</span>.<span class="hljs-title function_ inline">set</span>(cacheKey, promptTemplate);
            
            <span class="hljs-keyword inline">return</span> promptTemplate;
        } <span class="hljs-keyword inline">catch</span> (error) {
            <span class="hljs-comment inline">// 错误处理第一层：记录详细的错误信息</span>
            <span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">error</span>(<span class="hljs-string inline">`Error loading prompt <span class="hljs-subst inline">${type}</span>-<span class="hljs-subst inline">${grammarLanguageOption}</span>:`</span>, error.<span class="hljs-property inline">message</span>);
            
            <span class="hljs-comment inline">// 降级策略：如果pure版本失败，尝试combined版本</span>
            <span class="hljs-comment inline">// 这是一个优雅的回退机制，确保服务的可用性</span>
            <span class="hljs-keyword inline">if</span> (grammarLanguageOption === <span class="hljs-string inline">&#x27;pure&#x27;</span>) {
                <span class="hljs-variable language_ inline">console</span>.<span class="hljs-title function_ inline">warn</span>(<span class="hljs-string inline">`Falling back to combined prompt for <span class="hljs-subst inline">${type}</span>`</span>);
                <span class="hljs-comment inline">// 递归调用自身，但使用combined选项</span>
                <span class="hljs-keyword inline">return</span> <span class="hljs-variable language_ inline">this</span>.<span class="hljs-title function_ inline">loadPrompt</span>(type, <span class="hljs-string inline">&#x27;combined&#x27;</span>);
            }
            
            <span class="hljs-comment inline">// 错误处理最后一道防线：如果combined版本也失败，抛出明确的错误</span>
            <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">Error</span>(<span class="hljs-string inline">`Failed to load prompt template: <span class="hljs-subst inline">${type}</span>-<span class="hljs-subst inline">${grammarLanguageOption}</span>`</span>);
        }
    }

    <span class="hljs-comment inline">/**
     * 获取句子检查提示词（带变量替换）
     * <span class="hljs-doctag inline">@param</span> {<span class="hljs-type inline">string</span>} <span class="hljs-variable inline">sentence</span> - 要分析的句子
     * <span class="hljs-doctag inline">@param</span> {<span class="hljs-type inline">string</span>} <span class="hljs-variable inline">grammarLanguageOption</span> - 语言选项
     * <span class="hljs-doctag inline">@returns</span> {<span class="hljs-type inline">string</span>} 格式化后的提示词
     */</span>
    <span class="hljs-title function_ inline">getSentenceCheckPrompt</span>(<span class="hljs-params inline">sentence, grammarLanguageOption = <span class="hljs-string inline">&#x27;combined&#x27;</span></span>) {
        <span class="hljs-comment inline">// 先获取模板，利用loadPrompt的缓存机制</span>
        <span class="hljs-keyword inline">const</span> template = <span class="hljs-variable language_ inline">this</span>.<span class="hljs-title function_ inline">loadPrompt</span>(<span class="hljs-string inline">&#x27;sentence-check&#x27;</span>, grammarLanguageOption);
        
        <span class="hljs-comment inline">// 简单而有效的模板变量替换</span>
        <span class="hljs-comment inline">// 使用String.replace而非复杂的模板引擎，减少依赖和复杂度</span>
        <span class="hljs-keyword inline">return</span> template.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-string inline">&#x27;{sentence}&#x27;</span>, sentence);
    }

    <span class="hljs-comment inline">/**
     * 获取句子生成提示词（带变量替换）
     * <span class="hljs-doctag inline">@param</span> {<span class="hljs-type inline">Array</span>} <span class="hljs-variable inline">words</span> - 要使用的单词数组
     * <span class="hljs-doctag inline">@param</span> {<span class="hljs-type inline">string</span>} <span class="hljs-variable inline">grammarLanguageOption</span> - 语言选项
     * <span class="hljs-doctag inline">@returns</span> {<span class="hljs-type inline">string</span>} 格式化后的提示词
     */</span>
    <span class="hljs-title function_ inline">getSentenceGenerationPrompt</span>(<span class="hljs-params inline">words, grammarLanguageOption = <span class="hljs-string inline">&#x27;combined&#x27;</span></span>) {
        <span class="hljs-keyword inline">const</span> template = <span class="hljs-variable language_ inline">this</span>.<span class="hljs-title function_ inline">loadPrompt</span>(<span class="hljs-string inline">&#x27;sentence-generation&#x27;</span>, grammarLanguageOption);
        
        <span class="hljs-comment inline">// 类型安全的数组处理：确保words是数组后再join</span>
        <span class="hljs-comment inline">// 如果不是数组，直接使用原值</span>
        <span class="hljs-keyword inline">const</span> wordsString = <span class="hljs-title class_ inline">Array</span>.<span class="hljs-title function_ inline">isArray</span>(words) ? words.<span class="hljs-title function_ inline">join</span>(<span class="hljs-string inline">&#x27;, &#x27;</span>) : words;
        
        <span class="hljs-keyword inline">return</span> template.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-string inline">&#x27;{words}&#x27;</span>, wordsString);
    }

    <span class="hljs-comment inline">/**
     * 清空缓存（开发和测试时有用）
     */</span>
    <span class="hljs-title function_ inline">clearCache</span>(<span class="hljs-params inline"></span>) {
        <span class="hljs-comment inline">// Map.clear()是O(1)操作，直接清空所有缓存</span>
        <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">promptCache</span>.<span class="hljs-title function_ inline">clear</span>();
    }

    <span class="hljs-comment inline">/**
     * 获取缓存状态信息（调试用）
     * <span class="hljs-doctag inline">@returns</span> {<span class="hljs-type inline">Object</span>} 包含缓存大小和已缓存项目的信息
     */</span>
    <span class="hljs-title function_ inline">getCacheInfo</span>(<span class="hljs-params inline"></span>) {
        <span class="hljs-keyword inline">return</span> {
            <span class="hljs-comment inline">// Map.size是O(1)操作，获取缓存项目数量</span>
            <span class="hljs-attr inline">cacheSize</span>: <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">promptCache</span>.<span class="hljs-property inline">size</span>,
            <span class="hljs-comment inline">// 将Map的键转换为数组，便于调试查看</span>
            <span class="hljs-attr inline">cachedPrompts</span>: <span class="hljs-title class_ inline">Array</span>.<span class="hljs-title function_ inline">from</span>(<span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">promptCache</span>.<span class="hljs-title function_ inline">keys</span>())
        };
    }

    <span class="hljs-comment inline">/**
     * 验证所有必需的提示词文件是否存在
     * <span class="hljs-doctag inline">@returns</span> {<span class="hljs-type inline">Object</span>} 验证结果，包含存在/缺失的文件列表
     */</span>
    <span class="hljs-title function_ inline">validatePromptFiles</span>(<span class="hljs-params inline"></span>) {
        <span class="hljs-comment inline">// 定义系统必需的提示词文件列表</span>
        <span class="hljs-comment inline">// 这个数组定义了系统的完整性要求</span>
        <span class="hljs-keyword inline">const</span> requiredPrompts = [
            <span class="hljs-string inline">&#x27;sentence-check-pure.txt&#x27;</span>,
            <span class="hljs-string inline">&#x27;sentence-check-combined.txt&#x27;</span>,
            <span class="hljs-string inline">&#x27;sentence-generation-pure.txt&#x27;</span>,
            <span class="hljs-string inline">&#x27;sentence-generation-combined.txt&#x27;</span>
        ];

        <span class="hljs-keyword inline">const</span> missing = [];   <span class="hljs-comment inline">// 缺失的文件</span>
        <span class="hljs-keyword inline">const</span> existing = [];  <span class="hljs-comment inline">// 存在的文件</span>

        <span class="hljs-comment inline">// 遍历所有必需文件，检查存在性</span>
        <span class="hljs-keyword inline">for</span> (<span class="hljs-keyword inline">const</span> filename <span class="hljs-keyword inline">of</span> requiredPrompts) {
            <span class="hljs-keyword inline">const</span> filepath = path.<span class="hljs-title function_ inline">join</span>(<span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">promptsDir</span>, filename);
            <span class="hljs-comment inline">// fs.existsSync是同步检查，适合启动时的一次性验证</span>
            <span class="hljs-keyword inline">if</span> (fs.<span class="hljs-title function_ inline">existsSync</span>(filepath)) {
                existing.<span class="hljs-title function_ inline">push</span>(filename);
            } <span class="hljs-keyword inline">else</span> {
                missing.<span class="hljs-title function_ inline">push</span>(filename);
            }
        }

        <span class="hljs-keyword inline">return</span> {
            <span class="hljs-comment inline">// 系统完整性标志：只有当所有文件都存在时才为true</span>
            <span class="hljs-attr inline">valid</span>: missing.<span class="hljs-property inline">length</span> === <span class="hljs-number inline">0</span>,
            existing,
            missing,
            <span class="hljs-comment inline">// 提供提示词目录路径，便于运维人员定位问题</span>
            <span class="hljs-attr inline">promptsDirectory</span>: <span class="hljs-variable language_ inline">this</span>.<span class="hljs-property inline">promptsDir</span>
        };
    }
}

<span class="hljs-comment inline">// ==================== 模块导出 ====================</span>
<span class="hljs-comment inline">// 导出单例实例，而不是类本身</span>
<span class="hljs-comment inline">// 这确保了全局只有一个PromptLoader实例，节省内存且保证缓存一致性</span>
<span class="hljs-variable language_ inline">module</span>.<span class="hljs-property inline">exports</span> = <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">PromptLoader</span>();
</code></pre>
            </div>
        
<h3 id="响应解析核心算法解析" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#响应解析核心算法解析" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 响应解析核心算法解析">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            响应解析核心算法解析
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E5%86%85%E5%AE%B9%E6%B8%85%E7%90%86%E7%AE%97%E6%B3%95%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0AcleanResponseContent(content)%20%7B%0Aif%20(!content)%20return%20''%3B%0Alet%20cleaned%20%3D%20content%3B%0A%2F%2F%20%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E7%A7%BB%E9%99%A4AI%E7%94%9F%E6%88%90%E7%9A%84%E5%85%83%E6%A0%87%E8%AE%B0%0Acleaned%20%3D%20cleaned.replace(%2F%5C(Parsing%20required%5C)%2Fgi%2C%20'')%3B%0A%2F%2F%20%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E6%A0%87%E5%87%86%E5%8C%96%E7%A9%BA%E7%99%BD%E5%AD%97%E7%AC%A6%EF%BC%8C%E4%BF%9D%E6%8C%81%E7%BB%93%E6%9E%84%E5%AE%8C%E6%95%B4%E6%80%A7%0Acleaned%20%3D%20cleaned.replace(%2F%5Cn%7B3%2C%7D%2Fg%2C%20'%5Cn%5Cn')%3B%0A%2F%2F%20%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E6%B8%85%E7%90%86%E6%AF%8F%E8%A1%8C%E7%9A%84%E8%BE%B9%E7%BC%98%E7%A9%BA%E7%99%BD%EF%BC%8C%E4%BD%86%E4%BF%9D%E6%8C%81%E6%95%B4%E4%BD%93%E5%B8%83%E5%B1%80%0Acleaned%20%3D%20cleaned.split('%5Cn')%0A.map(line%20%3D%3E%20line.trim())%0A.join('%5Cn')%3B%0A%2F%2F%20%E7%AC%AC%E5%9B%9B%E6%AD%A5%EF%BC%9A%E7%A7%BB%E9%99%A4%E5%8F%AF%E8%83%BD%E5%B9%B2%E6%89%B0%E8%A7%A3%E6%9E%90%E7%9A%84markdown%E5%85%83%E7%B4%A0%0Acleaned%20%3D%20cleaned.replace(%2F%60%60%60%5B%5Cs%5CS%5D*%3F%60%60%60%2Fg%2C%20'')%3B%0Acleaned%20%3D%20cleaned.replace(%2F%5E%5Cs*%23%7B1%2C6%7D%5Cs*%2Fgm%2C%20'')%3B%0Areturn%20cleaned.trim()%3B%0A%7D%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E6%A0%87%E8%AE%B0%E6%8F%90%E5%8F%96%E7%AE%97%E6%B3%95%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0AextractSection(content%2C%20startMarker%2C%20endMarkers%20%3D%20%5B%5D)%20%7B%0A%2F%2F%20%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E5%AE%9A%E4%BD%8D%E8%B5%B7%E5%A7%8B%E6%A0%87%E8%AE%B0%0Aconst%20startIndex%20%3D%20content.indexOf(startMarker)%3B%0Aif%20(startIndex%20%3D%3D%3D%20-1)%20%7B%0Areturn%20null%3B%20%2F%2F%20%E6%A0%87%E8%AE%B0%E6%9C%AA%E6%89%BE%E5%88%B0%EF%BC%8C%E8%BF%94%E5%9B%9Enull%E8%80%8C%E9%9D%9E%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8%0A%7D%0A%2F%2F%20%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E8%AE%A1%E7%AE%97%E5%86%85%E5%AE%B9%E8%B5%B7%E5%A7%8B%E4%BD%8D%E7%BD%AE%0Aconst%20contentStart%20%3D%20startIndex%20%2B%20startMarker.length%3B%0A%2F%2F%20%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E5%AF%BB%E6%89%BE%E6%9C%80%E8%BF%91%E7%9A%84%E7%BB%93%E6%9D%9F%E6%A0%87%E8%AE%B0%EF%BC%88%E8%B4%AA%E5%A9%AA%E7%AE%97%E6%B3%95%EF%BC%89%0Alet%20endIndex%20%3D%20content.length%3B%20%2F%2F%20%E9%BB%98%E8%AE%A4%E5%88%B0%E5%86%85%E5%AE%B9%E7%BB%93%E5%B0%BE%0Afor%20(const%20endMarker%20of%20endMarkers)%20%7B%0Aconst%20markerIndex%20%3D%20content.indexOf(endMarker%2C%20contentStart)%3B%0Aif%20(markerIndex%20!%3D%3D%20-1%20%26%26%20markerIndex%20%2F%2F%20%E6%9B%B4%E6%96%B0%E4%B8%BA%E6%9B%B4%E6%97%A9%E7%9A%84%E4%BD%8D%E7%BD%AE%0A%7D%0A%7D%0A%2F%2F%20%E7%AC%AC%E5%9B%9B%E6%AD%A5%EF%BC%9A%E6%8F%90%E5%8F%96%E5%B9%B6%E9%AA%8C%E8%AF%81%E5%86%85%E5%AE%B9%0Aconst%20extractedContent%20%3D%20content.substring(contentStart%2C%20endIndex).trim()%3B%0A%2F%2F%20%E5%86%85%E5%AE%B9%E8%B4%A8%E9%87%8F%E6%A3%80%E6%9F%A5%EF%BC%9A%E9%95%BF%E5%BA%A6%E8%87%B3%E5%B0%915%E4%B8%AA%E5%AD%97%E7%AC%A6%E6%89%8D%E8%A2%AB%E8%AE%A4%E4%B8%BA%E6%98%AF%E6%9C%89%E6%95%88%E5%86%85%E5%AE%B9%0Areturn%20extractedContent.length%20%3E%3D%205%20%3F%20extractedContent%20%3A%20null%3B%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="复制代码">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">复制</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-comment inline">// ==================== 内容清理算法 ====================</span>
<span class="hljs-title function_ inline">cleanResponseContent</span>(<span class="hljs-params inline">content</span>) {
    <span class="hljs-keyword inline">if</span> (!content) <span class="hljs-keyword inline">return</span> <span class="hljs-string inline">&#x27;&#x27;</span>;

    <span class="hljs-keyword inline">let</span> cleaned = content;

    <span class="hljs-comment inline">// 第一步：移除AI生成的元标记</span>
    cleaned = cleaned.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/\(Parsing required\)/gi</span>, <span class="hljs-string inline">&#x27;&#x27;</span>);

    <span class="hljs-comment inline">// 第二步：标准化空白字符，保持结构完整性</span>
    cleaned = cleaned.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/\n{3,}/g</span>, <span class="hljs-string inline">&#x27;\n\n&#x27;</span>);

    <span class="hljs-comment inline">// 第三步：清理每行的边缘空白，但保持整体布局</span>
    cleaned = cleaned.<span class="hljs-title function_ inline">split</span>(<span class="hljs-string inline">&#x27;\n&#x27;</span>)
        .<span class="hljs-title function_ inline">map</span>(<span class="hljs-function inline"><span class="hljs-params inline">line</span> =&gt;</span> line.<span class="hljs-title function_ inline">trim</span>())
        .<span class="hljs-title function_ inline">join</span>(<span class="hljs-string inline">&#x27;\n&#x27;</span>);

    <span class="hljs-comment inline">// 第四步：移除可能干扰解析的markdown元素</span>
    cleaned = cleaned.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/```[\s\S]*?```/g</span>, <span class="hljs-string inline">&#x27;&#x27;</span>);
    cleaned = cleaned.<span class="hljs-title function_ inline">replace</span>(<span class="hljs-regexp inline">/^\s*#{1,6}\s*/gm</span>, <span class="hljs-string inline">&#x27;&#x27;</span>);

    <span class="hljs-keyword inline">return</span> cleaned.<span class="hljs-title function_ inline">trim</span>();
}

<span class="hljs-comment inline">// ==================== 标记提取算法 ====================</span>
<span class="hljs-title function_ inline">extractSection</span>(<span class="hljs-params inline">content, startMarker, endMarkers = []</span>) {
    <span class="hljs-comment inline">// 第一步：定位起始标记</span>
    <span class="hljs-keyword inline">const</span> startIndex = content.<span class="hljs-title function_ inline">indexOf</span>(startMarker);
    <span class="hljs-keyword inline">if</span> (startIndex === -<span class="hljs-number inline">1</span>) {
        <span class="hljs-keyword inline">return</span> <span class="hljs-literal inline">null</span>; <span class="hljs-comment inline">// 标记未找到，返回null而非抛出异常</span>
    }

    <span class="hljs-comment inline">// 第二步：计算内容起始位置</span>
    <span class="hljs-keyword inline">const</span> contentStart = startIndex + startMarker.<span class="hljs-property inline">length</span>;

    <span class="hljs-comment inline">// 第三步：寻找最近的结束标记（贪婪算法）</span>
    <span class="hljs-keyword inline">let</span> endIndex = content.<span class="hljs-property inline">length</span>; <span class="hljs-comment inline">// 默认到内容结尾</span>

    <span class="hljs-keyword inline">for</span> (<span class="hljs-keyword inline">const</span> endMarker <span class="hljs-keyword inline">of</span> endMarkers) {
        <span class="hljs-keyword inline">const</span> markerIndex = content.<span class="hljs-title function_ inline">indexOf</span>(endMarker, contentStart);
        <span class="hljs-keyword inline">if</span> (markerIndex !== -<span class="hljs-number inline">1</span> &amp;&amp; markerIndex &lt; endIndex) {
            endIndex = markerIndex;  <span class="hljs-comment inline">// 更新为更早的位置</span>
        }
    }

    <span class="hljs-comment inline">// 第四步：提取并验证内容</span>
    <span class="hljs-keyword inline">const</span> extractedContent = content.<span class="hljs-title function_ inline">substring</span>(contentStart, endIndex).<span class="hljs-title function_ inline">trim</span>();
    
    <span class="hljs-comment inline">// 内容质量检查：长度至少5个字符才被认为是有效内容</span>
    <span class="hljs-keyword inline">return</span> extractedContent.<span class="hljs-property inline">length</span> &gt;= <span class="hljs-number inline">5</span> ? extractedContent : <span class="hljs-literal inline">null</span>;
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">提取算法的时间复杂度分析</strong>：</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">最好情况</strong>：O(n)，其中n是内容长度（只需要扫描一次）</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">最坏情况</strong>：O(n × m)，其中m是结束标记数量</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">平均情况</strong>：O(n)，因为通常第一个标记就能匹配</li>
</ul>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">空间复杂度</strong>：O(1)，只使用常量级别的额外空间</p>
<h2 id="写在最后" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#写在最后" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to 写在最后">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            写在最后
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">如你所见，实际上MCP的原始设计思路就是这么朴实无华。与AI约定一套数据交互格式，并让其它应用读取这套格式，从而理解AI的输出，最终实现&quot;AI调用外部工具&quot;的效果。</p>
<p class="text-base leading-7 mb-4 text-foreground">经过这次完整的源码解析，我们看到了一个看似简单的提示词管理系统背后的精妙设计：从单例模式的内存优化，到Map缓存的性能提升，从降级策略的服务可用性，到防御性编程的健壮性保障。</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">每一行代码都不是偶然的，每一个设计决策都有其深刻的考量。</strong></p>
<p class="text-base leading-7 mb-4 text-foreground"><em class="italic text-foreground">愿你的提示词如春风化雨，让AI理解你的每一个意图；愿你的解析算法如庖丁解牛，将复杂的响应化为清晰的结构。在这个AI与人类智慧交融的时代，让我们一起用代码编织更美好的明天！</em> ✨</p>
</div></article><footer class="mt-16 pt-8 border-t border-foreground/20"><div class="flex items-center justify-between"><a class="inline-flex items-center px-4 py-2 bg-primary text-foreground rounded-lg hover:bg-primary/90 transition-colors" href="/documents/">documents.backToDocuments</a><div class="text-sm text-foreground/60"><span>documents.byAuthor<!-- --> <!-- -->MilkWind</span></div></div></footer></div></div><!--$--><!--/$--><!--$--><!--/$--><!--/$--><!--/$--><script src="/_next/static/chunks/webpack-d118f969809e6d65.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[38735,[\"1899\",\"static/chunks/1899-6f0bb42883f79753.js\",\"7177\",\"static/chunks/app/layout-5c95b441a38f3a56.js\"],\"default\"]\n3:I[19945,[\"1899\",\"static/chunks/1899-6f0bb42883f79753.js\",\"7177\",\"static/chunks/app/layout-5c95b441a38f3a56.js\"],\"default\"]\n4:I[65337,[\"1899\",\"static/chunks/1899-6f0bb42883f79753.js\",\"7177\",\"static/chunks/app/layout-5c95b441a38f3a56.js\"],\"default\"]\n5:I[96190,[\"1899\",\"static/chunks/1899-6f0bb42883f79753.js\",\"7177\",\"static/chunks/app/layout-5c95b441a38f3a56.js\"],\"ClientProviders\"]\n6:I[87555,[],\"\"]\n7:I[51901,[\"8039\",\"static/chunks/app/error-10ebab2e11865aaf.js\"],\"default\"]\n8:I[31295,[],\"\"]\n9:I[6874,[\"6874\",\"static/chunks/6874-fbe9a08eb79b991c.js\",\"4345\",\"static/chunks/app/not-found-38b9d1a0bc95ac08.js\"],\"\"]\na:I[94970,[],\"ClientSegmentRoot\"]\nb:I[44065,[\"206\",\"static/chunks/206-4f4cbf4d7156f437.js\",\"3092\",\"static/chunks/app/documents/layout-5f4e66d848ce7829.js\"],\"default\"]\ne:I[59665,[],\"MetadataBoundary\"]\n10:I[59665,[],\"OutletBoundary\"]\n13:I[74911,[],\"AsyncMetadataOutlet\"]\n15:I[39460,[\"2415\",\"static/chunks/2415-689c103fb3d2c28d.js\",\"8610\",\"static/chunks/8610-7bd3f91f3cf2a4d6.js\",\"5650\",\"static/chunks/app/documents/loading-552c4cd17346a076.js\"],\"default\"]\n16:I[88610,[\"2415\",\"static/chunks/2415-689c103fb3d2c28d.js\",\"8610\",\"static/chunks/8610-7bd3f91f3cf2a4d6.js\",\"4209\",\"static/chunks/app/loading-0c530d99d5132c05.js\"],\"default\"]\n17:I[59665,[],\"ViewportBoundary\"]\n19:I[26614,[],\"\"]\n:HL[\"/_next/static/css/de70bee13400563f.css\",\"style\"]\n:HL[\"/_next/static/css/38943437573ce53c.css\",\"style\"]\n:HL[\"/_next/static/css/5eacd01f773eed7f.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"xMcHYm_FvwjrVB7JmFp9i\",\"p\":\"\",\"c\":[\"\",\"documents\",\"zh\",\"dark\",\"questions-party\",\"prompt-word-analysis\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"documents\",{\"children\":[[\"slug\",\"zh/dark/questions-party/prompt-word-analysis\",\"c\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/de70bee13400563f.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/38943437573ce53c.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"__variable_188709 __variable_9a8899 font-sans antialiased min-h-screen bg-background text-foreground\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"$L2\",null,{}],[\"$\",\"$L3\",null,{}],[\"$\",\"$L4\",null,{}],[\"$\",\"$L5\",null,{\"children\":[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$7\",\"errorStyles\":[],\"errorScripts\":[],\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"div\",null,{\"className\":\"z-10 relative min-h-screen flex items-center justify-center bg-background p-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"text-center max-w-md\",\"children\":[[\"$\",\"div\",null,{\"className\":\"text-8xl font-bold text-primary mb-4\",\"children\":\"404\"}],[\"$\",\"h2\",null,{\"className\":\"text-2xl font-bold text-foreground mb-4\",\"children\":\"Page Not Found\"}],[\"$\",\"p\",null,{\"className\":\"text-foreground/70 mb-8\",\"children\":\"The page you're looking for doesn't exist or has been moved to a different location.\"}],[\"$\",\"div\",null,{\"className\":\"flex flex-col sm:flex-row gap-4 justify-center\",\"children\":[[\"$\",\"$L9\",null,{\"href\":\"/\",\"className\":\"px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary/80 transition-colors\",\"children\":\"Go Home\"}],[\"$\",\"$L9\",null,{\"href\":\"/works\",\"className\":\"px-6 py-2 border border-primary text-primary rounded-lg hover:bg-primary/10 transition-colors\",\"children\":\"View Works\"}]]}],[\"$\",\"div\",null,{\"className\":\"absolute inset-0 overflow-hidden pointer-events-none -z-10\",\"children\":[[\"$\",\"div\",null,{\"className\":\"absolute top-1/4 left-1/4 w-2 h-2 bg-primary/20 rounded-full animate-float\"}],[\"$\",\"div\",null,{\"className\":\"absolute top-3/4 right-1/4 w-3 h-3 bg-accent/20 rounded-full animate-float\",\"style\":{\"animationDelay\":\"1s\"}}],[\"$\",\"div\",null,{\"className\":\"absolute bottom-1/4 left-1/3 w-1 h-1 bg-secondary/20 rounded-full animate-float\",\"style\":{\"animationDelay\":\"2s\"}}]]}]]}]}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}]}]]}],{\"children\":[\"documents\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$La\",null,{\"Component\":\"$b\",\"slots\":{\"children\":[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]},\"params\":{},\"promise\":\"$@c\"}]]}],{\"children\":[[\"slug\",\"zh/dark/questions-party/prompt-word-analysis\",\"c\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L8\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$Ld\",[\"$\",\"$Le\",null,{\"children\":\"$Lf\"}],[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/5eacd01f773eed7f.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L10\",null,{\"children\":[\"$L11\",\"$L12\",[\"$\",\"$L13\",null,{\"promise\":\"$@14\"}]]}]]}],{},null,false]},null,false]},[[\"$\",\"$L15\",\"l\",{}],[],[]],false]},[[\"$\",\"$L16\",\"l\",{}],[],[]],false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"56N-RGMHZ5H7C3J1t0Fgs\",{\"children\":[[\"$\",\"$L17\",null,{\"children\":\"$L18\"}],null]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$19\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"1a:\"$Sreact.suspense\"\n1b:I[74911,[],\"AsyncMetadata\"]\nc:{}\nf:[\"$\",\"$1a\",null,{\"fallback\":null,\"children\":[\"$\",\"$L1b\",null,{\"promise\":\"$@1c\"}]}]\n"])</script><script>self.__next_f.push([1,"1d:I[57340,[\"5584\",\"static/chunks/b498d07c-095637f0f10883c6.js\",\"2415\",\"static/chunks/2415-689c103fb3d2c28d.js\",\"6874\",\"static/chunks/6874-fbe9a08eb79b991c.js\",\"9554\",\"static/chunks/9554-b714f9de28e85d30.js\",\"1873\",\"static/chunks/app/documents/%5B...slug%5D/page-9ee3d086bd3810e0.js\"],\"DocumentPageClient\"]\n1e:T2c3f5,"])</script><script>self.__next_f.push([1,"\u003ch1 id=\"提示词生成与响应解析：另一种机器语言的诞生\" class=\"group relative text-4xl font-bold mt-8 mb-4 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#提示词生成与响应解析：另一种机器语言的诞生\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 提示词生成与响应解析：另一种机器语言的诞生\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            提示词生成与响应解析：另一种机器语言的诞生\n        \u003c/h1\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e我时常会想，让计算机能够识别机器语言是编程领域的第一大里程碑，那如今能够让AI识别自然语言算不算第二大里程碑？\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e本文将全面解析Questions Party项目中的提示词管理系统，从PromptLoader的架构设计到响应解析的鲁棒性实现，带你阅览MCP的原始原理。\u003c/p\u003e\n\u003ch2 id=\"promptloader核心架构\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#promptloader核心架构\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to PromptLoader核心架构\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            PromptLoader核心架构\n        \u003c/h2\u003e\n\u003ch3 id=\"单例模式设计\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#单例模式设计\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 单例模式设计\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            单例模式设计\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"const%20fs%20%3D%20require('fs')%3B%0Aconst%20path%20%3D%20require('path')%3B%0Aclass%20PromptLoader%20%7B%0Aconstructor()%20%7B%0Athis.promptCache%20%3D%20new%20Map()%3B%0Athis.promptsDir%20%3D%20path.join(__dirname%2C%20'..%2Fprompts')%3B%0A%7D%0A%7D%0A**%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F**%EF%BC%9A%0A%E5%9C%A8%E6%95%B4%E4%B8%AA%E5%BA%94%E7%94%A8%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E4%B8%AD%EF%BC%8CPromptLoader%E5%8F%AA%E9%9C%80%E8%A6%81%E4%B8%80%E4%B8%AA%E5%AE%9E%E4%BE%8B%E5%B0%B1%E5%A4%9F%E4%BA%86%E2%80%94%E2%80%94%E6%AF%95%E7%AB%9F%E6%8F%90%E7%A4%BA%E8%AF%8D%E6%A8%A1%E6%9D%BF%E4%B8%8D%E4%BC%9A%E8%B7%91%E8%B7%AF%EF%BC%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B9%9F%E4%B8%8D%E4%BC%9A%E7%AA%81%E7%84%B6%E5%8F%98%E8%84%B8%E3%80%82%0A%23%23%23%20%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E7%9A%84%E7%BA%A6%E5%AE%9A%0A%60%60%60typescript%0A%2F%2F%20%E5%AE%9E%E9%99%85%E7%9A%84%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%0Asrc%2Fprompts%2F%0A%E2%94%9C%E2%94%80%E2%94%80%20sentence-check-pure.txt%20%20%20%20%20%20%20%20%23%20%E7%BA%AF%E8%8B%B1%E6%96%87%E5%8F%A5%E5%AD%90%E6%A3%80%E6%9F%A5%E6%A8%A1%E6%9D%BF%0A%E2%94%9C%E2%94%80%E2%94%80%20sentence-check-combined.txt%20%20%20%20%23%20%E5%8F%8C%E8%AF%AD%E5%8F%A5%E5%AD%90%E6%A3%80%E6%9F%A5%E6%A8%A1%E6%9D%BF%0A%E2%94%9C%E2%94%80%E2%94%80%20sentence-generation-pure.txt%20%20%20%23%20%E7%BA%AF%E8%8B%B1%E6%96%87%E5%8F%A5%E5%AD%90%E7%94%9F%E6%88%90%E6%A8%A1%E6%9D%BF%0A%E2%94%9C%E2%94%80%E2%94%80%20sentence-generation-combined.txt%20%20%23%20%E5%8F%8C%E8%AF%AD%E5%8F%A5%E5%AD%90%E7%94%9F%E6%88%90%E6%A8%A1%E6%9D%BF%0A%E2%94%94%E2%94%80%E2%94%80%20README.md%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20%E6%96%87%E6%A1%A3%E8%AF%B4\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e fs = \u003cspan class=\"hljs-built_in inline\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;fs\u0026#x27;\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e path = \u003cspan class=\"hljs-built_in inline\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;path\u0026#x27;\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword inline\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003ePromptLoader\u003c/span\u003e {\n    \u003cspan class=\"hljs-title function_ inline\"\u003econstructor\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003c/span\u003e) {\n        \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epromptCache\u003c/span\u003e = \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eMap\u003c/span\u003e();\n        \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epromptsDir\u003c/span\u003e = path.\u003cspan class=\"hljs-title function_ inline\"\u003ejoin\u003c/span\u003e(__dirname, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;../prompts\u0026#x27;\u003c/span\u003e);\n    }\n}\n\n**为什么选择单例模式**：\n\n在整个应用生命周期中，\u003cspan class=\"hljs-title class_ inline\"\u003ePromptLoader\u003c/span\u003e只需要一个实例就够了——毕竟提示词模板不会跑路，文件系统也不会突然变脸。\n\n### 目录结构的约定\n\n\u003cspan class=\"hljs-string inline\"\u003e``\u003c/span\u003e\u003cspan class=\"hljs-string inline\"\u003e`typescript\n// 实际的目录结构\nsrc/prompts/\n├── sentence-check-pure.txt        # 纯英文句子检查模板\n├── sentence-check-combined.txt    # 双语句子检查模板\n├── sentence-generation-pure.txt   # 纯英文句子生成模板\n├── sentence-generation-combined.txt  # 双语句子生成模板\n└── README.md                      # 文档说\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch3 id=\"map缓存\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#map缓存\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to Map缓存\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            Map缓存\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"this.promptCache%20%3D%20new%20Map()%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epromptCache\u003c/span\u003e = \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eMap\u003c/span\u003e();\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e为什么选择Map而不是Object\u003c/strong\u003e？\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e这是一个经典的数据结构选择问题：\u003c/p\u003e\n\u003ctable class=\"w-full border-collapse mb-4 shadow-sm rounded-lg overflow-hidden\"\u003e\n\u003cthead class=\"bg-surface\"\u003e\n\u003ctr class=\"border-b border-gray-200\"\u003e\u003cth class=\"px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface\"\u003e特性\u003c/th\u003e\u003cth class=\"px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface\"\u003eMap\u003c/th\u003e\u003cth class=\"px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface\"\u003eObject\u003c/th\u003e\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody class=\"bg-background divide-y divide-gray-200\"\u003e\n\u003ctr class=\"border-b border-gray-200\"\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e键类型\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e任意类型\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e字符串/Symbol\u003c/td\u003e\u003c/tr\u003e\n\u003ctr class=\"border-b border-gray-200\"\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e大小获取\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003eO(1)\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003eO(n)\u003c/td\u003e\u003c/tr\u003e\n\u003ctr class=\"border-b border-gray-200\"\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e迭代性能\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e优秀\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e一般\u003c/td\u003e\u003c/tr\u003e\n\u003ctr class=\"border-b border-gray-200\"\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e原型污染\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e无\u003c/td\u003e\u003ctd class=\"px-4 py-3 text-sm text-foreground\"\u003e有风险\u003c/td\u003e\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e缓存性能的数学分析\u003c/strong\u003e：\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e假设每个提示词文件平均2KB，系统有4个模板文件：\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e无缓存\u003c/strong\u003e：每次请求都需要读取文件，IO时间约1-5ms\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e有缓存\u003c/strong\u003e：首次读取后，访问时间降至0.01ms以下\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e缓存命中率达到90%时，性能提升约：\u003cbr class=\"block\"\u003e\n\u003cspan class=\"katex-display inline\"\u003e\u003cspan class=\"katex inline\"\u003e\u003cspan class=\"katex-mathml inline\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmtext\u003e性能提升\u003c/mtext\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmfrac\u003e\u003cmrow\u003e\u003cmn\u003e5\u003c/mn\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmi\u003es\u003c/mi\u003e\u003c/mrow\u003e\u003cmrow\u003e\u003cmn\u003e0.01\u003c/mn\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmi\u003es\u003c/mi\u003e\u003c/mrow\u003e\u003c/mfrac\u003e\u003cmo\u003e×\u003c/mo\u003e\u003cmn\u003e0.9\u003c/mn\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmn\u003e450\u003c/mn\u003e\u003cmtext\u003e倍\u003c/mtext\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e性能提升 = \\frac{5ms}{0.01ms} \\times 0.9 = 450倍\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html inline\" aria-hidden=\"true\" style=\"display:none\"\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord cjk_fallback inline\"\u003e性能提升\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:2.0074em;vertical-align:-0.686em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mopen nulldelimiter inline\"\u003e\u003c/span\u003e\u003cspan class=\"mfrac inline\"\u003e\u003cspan class=\"vlist-t vlist-t2 inline\"\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:1.3214em;\"\u003e\u003cspan style=\"top:-2.314em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord inline\"\u003e0.01\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003em\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003es\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.23em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"frac-line inline\" style=\"border-bottom-width:0.04em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.677em;\" class=\"inline\"\u003e\u003cspan class=\"pstrut inline\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e\u003cspan class=\"mord inline\"\u003e5\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003em\u003c/span\u003e\u003cspan class=\"mord mathnormal inline\"\u003es\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s inline\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r inline\"\u003e\u003cspan class=\"vlist inline\" style=\"height:0.686em;\"\u003e\u003cspan class=\"inline\"\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose nulldelimiter inline\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin inline\"\u003e×\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e0.9\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel inline\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace inline\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base inline\"\u003e\u003cspan class=\"strut inline\" style=\"height:0.6833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord inline\"\u003e450\u003c/span\u003e\u003cspan class=\"mord cjk_fallback inline\"\u003e倍\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/p\u003e\n\u003ch2 id=\"loadprompt函数\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#loadprompt函数\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to loadPrompt函数\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            loadPrompt函数\n        \u003c/h2\u003e\n\u003ch3 id=\"缓存优先策略\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#缓存优先策略\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 缓存优先策略\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            缓存优先策略\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"loadPrompt(type%2C%20grammarLanguageOption%20%3D%20'combined')%20%7B%0Aconst%20cacheKey%20%3D%20%60%24%7Btype%7D-%24%7BgrammarLanguageOption%7D%60%3B%0A%2F%2F%20%E5%A6%82%E6%9E%9C%E7%BC%93%E5%AD%98%E4%B8%AD%E6%9C%89%EF%BC%8C%E8%BF%94%E5%9B%9E%E7%BC%93%E5%AD%98%E7%9A%84%E7%89%88%E6%9C%AC%0Aif%20(this.promptCache.has(cacheKey))%20%7B%0Areturn%20this.promptCache.get(cacheKey)%3B%0A%7D%0Atry%20%7B%0Aconst%20filename%20%3D%20%60%24%7Btype%7D-%24%7BgrammarLanguageOption%7D.txt%60%3B%0Aconst%20filepath%20%3D%20path.join(this.promptsDir%2C%20filename)%3B%0Aif%20(!fs.existsSync(filepath))%20%7B%0Athrow%20new%20Error(%60Prompt%20file%20not%20found%3A%20%24%7Bfilepath%7D%60)%3B%0A%7D%0Aconst%20promptTemplate%20%3D%20fs.readFileSync(filepath%2C%20'utf8')%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-title function_ inline\"\u003eloadPrompt\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003etype, grammarLanguageOption = \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;combined\u0026#x27;\u003c/span\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e cacheKey = \u003cspan class=\"hljs-string inline\"\u003e`\u003cspan class=\"hljs-subst inline\"\u003e${type}\u003c/span\u003e-\u003cspan class=\"hljs-subst inline\"\u003e${grammarLanguageOption}\u003c/span\u003e`\u003c/span\u003e;\n    \n    \u003cspan class=\"hljs-comment inline\"\u003e// 如果缓存中有，返回缓存的版本\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epromptCache\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003ehas\u003c/span\u003e(cacheKey)) {\n        \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epromptCache\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eget\u003c/span\u003e(cacheKey);\n    }\n\n    \u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e filename = \u003cspan class=\"hljs-string inline\"\u003e`\u003cspan class=\"hljs-subst inline\"\u003e${type}\u003c/span\u003e-\u003cspan class=\"hljs-subst inline\"\u003e${grammarLanguageOption}\u003c/span\u003e.txt`\u003c/span\u003e;\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e filepath = path.\u003cspan class=\"hljs-title function_ inline\"\u003ejoin\u003c/span\u003e(\u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epromptsDir\u003c/span\u003e, filename);\n        \n        \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!fs.\u003cspan class=\"hljs-title function_ inline\"\u003eexistsSync\u003c/span\u003e(filepath)) {\n            \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`Prompt file not found: \u003cspan class=\"hljs-subst inline\"\u003e${filepath}\u003c/span\u003e`\u003c/span\u003e);\n        }\n\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e promptTemplate = fs.\u003cspan class=\"hljs-title function_ inline\"\u003ereadFileSync\u003c/span\u003e(filepath, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;utf8\u0026#x27;\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e缓存键设计\u003c/strong\u003e：\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003ccode\u003e${type}-${grammarLanguageOption}\u003c/code\u003e是一个复合键，分别对应\u0026quot;功能-语言\u0026quot;。\u003c/p\u003e\n\u003ch3 id=\"文件系统的安全操作\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#文件系统的安全操作\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 文件系统的安全操作\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            文件系统的安全操作\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"if%20(!fs.existsSync(filepath))%20%7B%0Athrow%20new%20Error(%60Prompt%20file%20not%20found%3A%20%24%7Bfilepath%7D%60)%3B%0A%7D\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!fs.\u003cspan class=\"hljs-title function_ inline\"\u003eexistsSync\u003c/span\u003e(filepath)) {\n    \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`Prompt file not found: \u003cspan class=\"hljs-subst inline\"\u003e${filepath}\u003c/span\u003e`\u003c/span\u003e);\n}\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e为什么先检查文件存在性\u003c/strong\u003e？\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e这是防御性编程的经典案例：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"%2F%2F%20%E2%9D%8C%20%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E5%81%9A%E6%B3%95%0Aconst%20content%20%3D%20fs.readFileSync(filepath%2C%20'utf8')%3B%20%20%2F%2F%20%E5%8F%AF%E8%83%BD%E6%8A%9B%E5%87%BAENOENT%E9%94%99%E8%AF%AF%0A%2F%2F%20%E2%9C%85%20%E5%AE%89%E5%85%A8%E7%9A%84%E5%81%9A%E6%B3%95%0Aif%20(!fs.existsSync(filepath))%20%7B%0Athrow%20new%20Error(%60Prompt%20file%20not%20found%3A%20%24%7Bfilepath%7D%60)%3B%0A%7D%0Aconst%20content%20%3D%20fs.readFileSync(filepath%2C%20'utf8')%3B%20%20%2F%2F%20%E6%98%8E%E7%A1%AE%E7%9A%84%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// ❌ 不安全的做法\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e content = fs.\u003cspan class=\"hljs-title function_ inline\"\u003ereadFileSync\u003c/span\u003e(filepath, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;utf8\u0026#x27;\u003c/span\u003e);  \u003cspan class=\"hljs-comment inline\"\u003e// 可能抛出ENOENT错误\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment inline\"\u003e// ✅ 安全的做法\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!fs.\u003cspan class=\"hljs-title function_ inline\"\u003eexistsSync\u003c/span\u003e(filepath)) {\n    \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`Prompt file not found: \u003cspan class=\"hljs-subst inline\"\u003e${filepath}\u003c/span\u003e`\u003c/span\u003e);\n}\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e content = fs.\u003cspan class=\"hljs-title function_ inline\"\u003ereadFileSync\u003c/span\u003e(filepath, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;utf8\u0026#x27;\u003c/span\u003e);  \u003cspan class=\"hljs-comment inline\"\u003e// 明确的错误信息\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e路径拼接兼容\u003c/strong\u003e：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"const%20filepath%20%3D%20path.join(this.promptsDir%2C%20filename)%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e filepath = path.\u003cspan class=\"hljs-title function_ inline\"\u003ejoin\u003c/span\u003e(\u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epromptsDir\u003c/span\u003e, filename);\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e使用\u003ccode\u003epath.join\u003c/code\u003e而不是字符串拼接，避免了路径分隔符的跨平台问题：\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003eWindows: \u003ccode\u003e\\\u003c/code\u003e\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003eUnix/Linux: \u003ccode\u003e/\u003c/code\u003e\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003eNode.js自动处理\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"提示词加载降级处理\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#提示词加载降级处理\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 提示词加载降级处理\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            提示词加载降级处理\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"%7D%20catch%20(error)%20%7B%0Aconsole.error(%60Error%20loading%20prompt%20%24%7Btype%7D-%24%7BgrammarLanguageOption%7D%3A%60%2C%20error.message)%3B%0A%2F%2F%20%E5%A6%82%E6%9E%9Cpure%E7%89%88%E6%9C%AC%E5%A4%B1%E8%B4%A5%EF%BC%8C%E9%99%8D%E7%BA%A7%E5%88%B0combined%E7%89%88%E6%9C%AC%0Aif%20(grammarLanguageOption%20%3D%3D%3D%20'pure')%20%7B%0Aconsole.warn(%60Falling%20back%20to%20combined%20prompt%20for%20%24%7Btype%7D%60)%3B%0Areturn%20this.loadPrompt(type%2C%20'combined')%3B%0A%7D%0A%2F%2F%20%E5%A6%82%E6%9E%9Ccombined%E7%89%88%E6%9C%AC%E4%B9%9F%E5%A4%B1%E8%B4%A5%EF%BC%8C%E6%8A%9B%E5%87%BA%E9%94%99%E8%AF%AF%0Athrow%20new%20Error(%60Failed%20to%20load%20prompt%20template%3A%20%24%7Btype%7D-%24%7BgrammarLanguageOption%7D%60)%3B%0A%7D\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e} \u003cspan class=\"hljs-keyword inline\"\u003ecatch\u003c/span\u003e (error) {\n    \u003cspan class=\"hljs-variable language_ inline\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eerror\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`Error loading prompt \u003cspan class=\"hljs-subst inline\"\u003e${type}\u003c/span\u003e-\u003cspan class=\"hljs-subst inline\"\u003e${grammarLanguageOption}\u003c/span\u003e:`\u003c/span\u003e, error.\u003cspan class=\"hljs-property inline\"\u003emessage\u003c/span\u003e);\n    \n    \u003cspan class=\"hljs-comment inline\"\u003e// 如果pure版本失败，降级到combined版本\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (grammarLanguageOption === \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;pure\u0026#x27;\u003c/span\u003e) {\n        \u003cspan class=\"hljs-variable language_ inline\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003ewarn\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`Falling back to combined prompt for \u003cspan class=\"hljs-subst inline\"\u003e${type}\u003c/span\u003e`\u003c/span\u003e);\n        \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eloadPrompt\u003c/span\u003e(type, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;combined\u0026#x27;\u003c/span\u003e);\n    }\n    \n    \u003cspan class=\"hljs-comment inline\"\u003e// 如果combined版本也失败，抛出错误\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`Failed to load prompt template: \u003cspan class=\"hljs-subst inline\"\u003e${type}\u003c/span\u003e-\u003cspan class=\"hljs-subst inline\"\u003e${grammarLanguageOption}\u003c/span\u003e`\u003c/span\u003e);\n}\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e递归降级顺序：\u003ccode\u003epure → combined → error\u003c/code\u003e\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e错误处理的决策树：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"\" data-code=\"%E5%8A%A0%E8%BD%BDpure%E7%89%88%E6%9C%AC%0A%E2%86%93%0A%E5%A4%B1%E8%B4%A5%EF%BC%9F%E2%86%92%20%E6%98%AF%20%E2%86%92%20%E5%B0%9D%E8%AF%95combined%E7%89%88%E6%9C%AC%0A%E2%86%93%20%20%20%20%20%20%20%20%20%E2%86%93%0A%E5%90%A6%20%20%20%20%20%20%20%20%E5%A4%B1%E8%B4%A5%EF%BC%9F%E2%86%92%20%E6%98%AF%20%E2%86%92%20%E6%8A%9B%E5%87%BA%E9%94%99%E8%AF%AF%0A%E2%86%93%20%20%20%20%20%20%20%20%20%E2%86%93%0A%E8%BF%94%E5%9B%9E%E5%86%85%E5%AE%B9%20%20%20%20%20%20%20%E5%90%A6%0A%E2%86%93%0A%E8%BF%94%E5%9B%9E%E5%86%85%E5%AE%B9\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ecode\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode\u003e加载\u003cspan class=\"hljs-keyword inline\"\u003epure\u003c/span\u003e版本\n    ↓\n失败？→ 是 → 尝试combined版本\n    ↓         ↓\n   否        失败？→ 是 → 抛出错误\n    ↓         ↓\n返回内容       否\n              ↓\n           返回内容\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch2 id=\"提示词结构化设计\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#提示词结构化设计\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 提示词结构化设计\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            提示词结构化设计\n        \u003c/h2\u003e\n\u003ch3 id=\"combined-vs-pure：双语教学\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#combined-vs-pure：双语教学\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to Combined vs Pure：双语教学\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            Combined vs Pure：双语教学\n        \u003c/h3\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003ePure版本（纯英文）\u003c/strong\u003e：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"\" data-code=\"Analyze%20this%20sentence%3A%20%22%7Bsentence%7D%22%0AFollow%20this%20exact%20format%20(Output%20Example)%3A%0AGRAMMAR_ANALYSIS(Parsing%20required)%3A%0A1.%20Grammar%20and%20Style%20Issues\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ecode\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode\u003eAnalyze \u003cspan class=\"hljs-keyword inline\"\u003ethis\u003c/span\u003e sentence: \u003cspan class=\"hljs-string inline\"\u003e\u0026quot;{sentence}\u0026quot;\u003c/span\u003e\n\nFollow \u003cspan class=\"hljs-keyword inline\"\u003ethis\u003c/span\u003e exact format (Output Example):\n\nGRAMMAR_ANALYSIS(Parsing required):\n\u003cspan class=\"hljs-number inline\"\u003e1.\u003c/span\u003e Grammar and Style Issues\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003eCombined版本（双语）\u003c/strong\u003e：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"\" data-code=\"%E5%88%86%E6%9E%90%E8%BF%99%E4%B8%AA%E5%8F%A5%E5%AD%90%3A%20%22%7Bsentence%7D%22%0A%E8%AF%B7%E4%B8%A5%E6%A0%BC%E6%8C%89%E7%85%A7%E4%BB%A5%E4%B8%8B%E6%A0%BC%E5%BC%8F%E8%BE%93%E5%87%BA%EF%BC%88%E8%BE%93%E5%87%BA%E7%A4%BA%E4%BE%8B%EF%BC%89%EF%BC%9A%0AGRAMMAR_ANALYSIS(Parsing%20required)%3A%0A1.%20%E8%AF%AD%E6%B3%95%E5%92%8C%E9%A3%8E%E6%A0%BC%E9%97%AE%E9%A2%98\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ecode\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode\u003e分析这个句子: \u003cspan class=\"hljs-string inline\"\u003e\u0026quot;{sentence}\u0026quot;\u003c/span\u003e\n\n请严格按照以下格式输出（输出示例）：\n\n\u003cspan class=\"hljs-function inline\"\u003e\u003cspan class=\"hljs-title inline\"\u003eGRAMMAR_ANALYSIS\u003c/span\u003e\u003cspan class=\"hljs-params inline\"\u003e(Parsing required)\u003c/span\u003e\u003c/span\u003e:\n\u003cspan class=\"hljs-number inline\"\u003e1\u003c/span\u003e. 语法和风格问题\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003ePure版本\u003c/strong\u003e：面向英语学习者，提供纯正的英语环境\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003eCombined版本\u003c/strong\u003e：面向中文用户，降低理解门槛，提供双语对照\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"缓存机制与性能优化\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#缓存机制与性能优化\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 缓存机制与性能优化\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            缓存机制与性能优化\n        \u003c/h2\u003e\n\u003ch3 id=\"map-vs-object的性能对比\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#map-vs-object的性能对比\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to Map vs Object的性能对比\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            Map vs Object的性能对比\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"%2F%2F%20%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E4%BC%AA%E4%BB%A3%E7%A0%81%0Aconst%20iterations%20%3D%201000000%3B%0A%2F%2F%20Map%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%0Aconst%20mapCache%20%3D%20new%20Map()%3B%0Aconsole.time('Map')%3B%0Afor%20(let%20i%20%3D%200%3B%20i%20set(%60key%24%7Bi%7D%60%2C%20%60value%24%7Bi%7D%60)%3B%0AmapCache.get(%60key%24%7Bi%7D%60)%3B%0A%7D%0Aconsole.timeEnd('Map')%3B%0A%2F%2F%20Object%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%0Aconst%20objCache%20%3D%20%7B%7D%3B%0Aconsole.time('Object')%3B%0Afor%20(let%20i%20%3D%200%3B%20i%20%60key%24%7Bi%7D%60%5D%20%3D%20%60value%24%7Bi%7D%60%3B%0Aconst%20value%20%3D%20objCache%5B%60key%24%7Bi%7D%60%5D%3B%0A%7D%0Aconsole.timeEnd('Object')%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 性能测试伪代码\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e iterations = \u003cspan class=\"hljs-number inline\"\u003e1000000\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment inline\"\u003e// Map性能测试\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e mapCache = \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eMap\u003c/span\u003e();\n\u003cspan class=\"hljs-variable language_ inline\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003etime\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;Map\u0026#x27;\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword inline\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword inline\"\u003elet\u003c/span\u003e i = \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e; i \u0026lt; iterations; i++) {\n    mapCache.\u003cspan class=\"hljs-title function_ inline\"\u003eset\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`key\u003cspan class=\"hljs-subst inline\"\u003e${i}\u003c/span\u003e`\u003c/span\u003e, \u003cspan class=\"hljs-string inline\"\u003e`value\u003cspan class=\"hljs-subst inline\"\u003e${i}\u003c/span\u003e`\u003c/span\u003e);\n    mapCache.\u003cspan class=\"hljs-title function_ inline\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`key\u003cspan class=\"hljs-subst inline\"\u003e${i}\u003c/span\u003e`\u003c/span\u003e);\n}\n\u003cspan class=\"hljs-variable language_ inline\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003etimeEnd\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;Map\u0026#x27;\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment inline\"\u003e// Object性能测试\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e objCache = {};\n\u003cspan class=\"hljs-variable language_ inline\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003etime\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;Object\u0026#x27;\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword inline\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword inline\"\u003elet\u003c/span\u003e i = \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e; i \u0026lt; iterations; i++) {\n    objCache[\u003cspan class=\"hljs-string inline\"\u003e`key\u003cspan class=\"hljs-subst inline\"\u003e${i}\u003c/span\u003e`\u003c/span\u003e] = \u003cspan class=\"hljs-string inline\"\u003e`value\u003cspan class=\"hljs-subst inline\"\u003e${i}\u003c/span\u003e`\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e value = objCache[\u003cspan class=\"hljs-string inline\"\u003e`key\u003cspan class=\"hljs-subst inline\"\u003e${i}\u003c/span\u003e`\u003c/span\u003e];\n}\n\u003cspan class=\"hljs-variable language_ inline\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003etimeEnd\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;Object\u0026#x27;\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e实际测试结果\u003c/strong\u003e：\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003eMap: ~661.084ms\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003eObject: ~1005ms\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003eMap在大量操作时有约52%的性能优势！\u003c/p\u003e\n\u003ch2 id=\"降级策略的容错设计\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#降级策略的容错设计\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 降级策略的容错设计\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            降级策略的容错设计\n        \u003c/h2\u003e\n\u003ch3 id=\"pure-→-combined的降级逻辑\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#pure-→-combined的降级逻辑\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to Pure → Combined的降级逻辑\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            Pure → Combined的降级逻辑\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"%2F%2F%20%E5%A6%82%E6%9E%9Cpure%E7%89%88%E6%9C%AC%E5%A4%B1%E8%B4%A5%EF%BC%8C%E9%99%8D%E7%BA%A7%E5%88%B0combined%E7%89%88%E6%9C%AC%0Aif%20(grammarLanguageOption%20%3D%3D%3D%20'pure')%20%7B%0Aconsole.warn(%60Falling%20back%20to%20combined%20prompt%20for%20%24%7Btype%7D%60)%3B%0Areturn%20this.loadPrompt(type%2C%20'combined')%3B%0A%7D\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 如果pure版本失败，降级到combined版本\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (grammarLanguageOption === \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;pure\u0026#x27;\u003c/span\u003e) {\n    \u003cspan class=\"hljs-variable language_ inline\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003ewarn\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`Falling back to combined prompt for \u003cspan class=\"hljs-subst inline\"\u003e${type}\u003c/span\u003e`\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eloadPrompt\u003c/span\u003e(type, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;combined\u0026#x27;\u003c/span\u003e);\n}\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e降级决策的状态机\u003c/strong\u003e：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"\" data-code=\"%E2%94%8C%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%90%0A%E2%94%82%20%20%E5%8A%A0%E8%BD%BDPure%20%20%20%E2%94%82%0A%E2%94%94%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%AC%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%98%0A%E2%94%82%0A%E2%94%8C%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%96%BC%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%90%20%20%20%20%20%E5%90%A6%0A%E2%94%82%20%E6%88%90%E5%8A%9F%EF%BC%9F%20%20%20%E2%94%82%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%0A%E2%94%94%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%AC%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%98%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%E6%98%AF%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%E2%94%8C%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%96%BC%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%90%20%20%20%20%E2%94%8C%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%96%BC%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%90%0A%E2%94%82%20%E8%BF%94%E5%9B%9E%E5%86%85%E5%AE%B9%20%E2%94%82%20%20%20%20%E2%94%82%20%E5%B0%9D%E8%AF%95Combined%20%20%E2%94%82%0A%E2%94%94%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%98%20%20%20%20%E2%94%94%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%AC%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%98%0A%E2%94%82%0A%E2%94%8C%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%96%BC%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%90%0A%E2%94%82%20%E6%88%90%E5%8A%9F%EF%BC%9F%20%20%20%E2%94%82%0A%E2%94%94%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%AC%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%98%0A%E6%98%AF%20%20%E2%94%82%20%20%E5%90%A6%0A%E2%94%8C%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%96%BC%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%90%20%20%20%20%E2%94%8C%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%90%0A%E2%94%82%20%E8%BF%94%E5%9B%9E%E5%86%85%E5%AE%B9%20%E2%94%82%20%20%20%20%E2%94%82%20%E6%8A%9B%E5%87%BA%E9%94%99%E8%AF%AF%20%E2%94%82%0A%E2%94%94%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%98%20%20%20%20%E2%94%94%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%98\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ecode\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode\u003e                    ┌─────────────┐\n                    │  加载Pure   │\n                    └─────┬───────┘\n                          │\n                     ┌────▼────┐     否\n                     │ 成功？   │────────────\n                     └────┬────┘           │\n                      是  │                 │\n                     ┌────▼────┐    ┌───────▼───────┐\n                     │ 返回内容 │    │ 尝试\u003cspan class=\"hljs-keyword inline\"\u003eCombined\u003c/span\u003e  │\n                     └─────────┘    └───────┬───────┘\n                                            │\n                                       ┌────▼────┐\n                                       │ 成功？   │\n                                       └────┬────┘\n                                        是  │  否\n                                   ┌────▼────┐    ┌─────────┐\n                                   │ 返回内容 │    │ 抛出错误 │\n                                   └─────────┘    └─────────┘\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch3 id=\"系统健壮性保障\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#系统健壮性保障\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 系统健壮性保障\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            系统健壮性保障\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"validatePromptFiles()%20%7B%0Aconst%20requiredPrompts%20%3D%20%5B%0A'sentence-check-pure.txt'%2C%0A'sentence-check-combined.txt'%2C%0A'sentence-generation-pure.txt'%2C%0A'sentence-generation-combined.txt'%0A%5D%3B%0Aconst%20missing%20%3D%20%5B%5D%3B%0Aconst%20existing%20%3D%20%5B%5D%3B%0Afor%20(const%20filename%20of%20requiredPrompts)%20%7B%0Aconst%20filepath%20%3D%20path.join(this.promptsDir%2C%20filename)%3B%0Aif%20(fs.existsSync(filepath))%20%7B%0Aexisting.push(filename)%3B%0A%7D%20else%20%7B%0Amissing.push(filename)%3B%0A%7D%0A%7D\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-title function_ inline\"\u003evalidatePromptFiles\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e requiredPrompts = [\n        \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;sentence-check-pure.txt\u0026#x27;\u003c/span\u003e,\n        \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;sentence-check-combined.txt\u0026#x27;\u003c/span\u003e,\n        \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;sentence-generation-pure.txt\u0026#x27;\u003c/span\u003e,\n        \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;sentence-generation-combined.txt\u0026#x27;\u003c/span\u003e\n    ];\n\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e missing = [];\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e existing = [];\n\n    \u003cspan class=\"hljs-keyword inline\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e filename \u003cspan class=\"hljs-keyword inline\"\u003eof\u003c/span\u003e requiredPrompts) {\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e filepath = path.\u003cspan class=\"hljs-title function_ inline\"\u003ejoin\u003c/span\u003e(\u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epromptsDir\u003c/span\u003e, filename);\n        \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (fs.\u003cspan class=\"hljs-title function_ inline\"\u003eexistsSync\u003c/span\u003e(filepath)) {\n            existing.\u003cspan class=\"hljs-title function_ inline\"\u003epush\u003c/span\u003e(filename);\n        } \u003cspan class=\"hljs-keyword inline\"\u003eelse\u003c/span\u003e {\n            missing.\u003cspan class=\"hljs-title function_ inline\"\u003epush\u003c/span\u003e(filename);\n        }\n    }\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e启动时验证\u003c/strong\u003e：\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e系统启动时进行完整性检查，遵循\u0026quot;Fast Fail\u0026quot;原则：\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e早期发现\u003c/strong\u003e：部署时就能发现问题\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e明确反馈\u003c/strong\u003e：哪些文件缺失一目了然\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e运维友好\u003c/strong\u003e：减少生产环境的调试时间\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"parsesentencecheckresponse深度剖析\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#parsesentencecheckresponse深度剖析\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to parseSentenceCheckResponse深度剖析\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            parseSentenceCheckResponse深度剖析\n        \u003c/h2\u003e\n\u003ch3 id=\"标记化响应格式的设计\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#标记化响应格式的设计\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 标记化响应格式的设计\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            标记化响应格式的设计\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"%2F%2F%20%E5%8F%A5%E5%AD%90%E6%A3%80%E6%9F%A5%E7%9A%84%E5%93%8D%E5%BA%94%E6%A0%BC%E5%BC%8F%E9%85%8D%E7%BD%AE%0Athis.checkResponseFormat%20%3D%20%7B%0AgrammarAnalysisMarker%3A%20%22GRAMMAR_ANALYSIS%3A%22%2C%0AgrammarCorrectionMarker%3A%20%22GRAMMAR_CORRECTION%3A%22%2C%0AkeywordAnalysisMarker%3A%20%22KEYWORD_ANALYSIS%3A%22%2C%0AchineseDefinitionMarker%3A%20%22CHINESE_DEFINITION%3A%22%2C%0AendMarker%3A%20%22END_FORMAT%22%0A%7D%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 句子检查的响应格式配置\u003c/span\u003e\n\u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003echeckResponseFormat\u003c/span\u003e = {\n    \u003cspan class=\"hljs-attr inline\"\u003egrammarAnalysisMarker\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026quot;GRAMMAR_ANALYSIS:\u0026quot;\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr inline\"\u003egrammarCorrectionMarker\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026quot;GRAMMAR_CORRECTION:\u0026quot;\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr inline\"\u003ekeywordAnalysisMarker\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026quot;KEYWORD_ANALYSIS:\u0026quot;\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr inline\"\u003echineseDefinitionMarker\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026quot;CHINESE_DEFINITION:\u0026quot;\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr inline\"\u003eendMarker\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026quot;END_FORMAT\u0026quot;\u003c/span\u003e\n};\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch3 id=\"鲁棒性解析算法\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#鲁棒性解析算法\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 鲁棒性解析算法\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            鲁棒性解析算法\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"parseSentenceCheckResponse(content%2C%20locale%20%3D%20'en')%20%7B%0Atry%20%7B%0Aconst%20%7B%0AgrammarAnalysisMarker%2C%0AgrammarCorrectionMarker%2C%0AkeywordAnalysisMarker%2C%0AchineseDefinitionMarker%2C%0AendMarker%0A%7D%20%3D%20this.checkResponseFormat%3B%0A%2F%2F%20%E5%AD%98%E5%82%A8%E5%8E%9F%E5%A7%8B%E5%86%85%E5%AE%B9%E7%94%A8%E4%BA%8E%E5%9B%9E%E9%80%80%0Aconst%20rawContent%20%3D%20content%3B%0A%2F%2F%20%E6%B8%85%E7%90%86%E5%86%85%E5%AE%B9%20-%20%E7%A7%BB%E9%99%A4%22(Parsing%20required)%22%E5%92%8C%E5%85%B6%E4%BB%96%E4%B8%8D%E9%9C%80%E8%A6%81%E7%9A%84%E6%96%87%E6%9C%AC%0Alet%20cleanedContent%20%3D%20this.cleanResponseContent(content)%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-title function_ inline\"\u003eparseSentenceCheckResponse\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003econtent, locale = \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;en\u0026#x27;\u003c/span\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e {\n            grammarAnalysisMarker,\n            grammarCorrectionMarker,\n            keywordAnalysisMarker,\n            chineseDefinitionMarker,\n            endMarker\n        } = \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003echeckResponseFormat\u003c/span\u003e;\n\n        \u003cspan class=\"hljs-comment inline\"\u003e// 存储原始内容用于回退\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e rawContent = content;\n\n        \u003cspan class=\"hljs-comment inline\"\u003e// 清理内容 - 移除\u0026quot;(Parsing required)\u0026quot;和其他不需要的文本\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003elet\u003c/span\u003e cleanedContent = \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003ecleanResponseContent\u003c/span\u003e(content);\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e内容清理\u003c/strong\u003e：\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003eAI生成的内容可能包含：\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e多余的标记：\u003ccode\u003e(Parsing required)\u003c/code\u003e\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e格式错误：多余的空行\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e无关内容：额外的说明文字\u003c/li\u003e\n\u003c/ul\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"cleanResponseContent(content)%20%7B%0Aif%20(!content)%20return%20''%3B%0Alet%20cleaned%20%3D%20content%3B%0A%2F%2F%20%E7%A7%BB%E9%99%A4%22(Parsing%20required)%22%E6%96%87%E6%9C%AC%0Acleaned%20%3D%20cleaned.replace(%2F%5C(Parsing%20required%5C)%2Fgi%2C%20'')%3B%0A%2F%2F%20%E7%A7%BB%E9%99%A4%E8%BF%87%E5%A4%9A%E7%9A%84%E7%A9%BA%E7%99%BD%E5%AD%97%E7%AC%A6%EF%BC%8C%E5%90%8C%E6%97%B6%E4%BF%9D%E6%8C%81%E7%BB%93%E6%9E%84%0Acleaned%20%3D%20cleaned.replace(%2F%5Cn%7B3%2C%7D%2Fg%2C%20'%5Cn%5Cn')%3B%0A%2F%2F%20%E7%A7%BB%E9%99%A4%E6%AF%8F%E8%A1%8C%E7%9A%84%E9%A6%96%E5%B0%BE%E7%A9%BA%E7%99%BD%E5%AD%97%E7%AC%A6%EF%BC%8C%E5%90%8C%E6%97%B6%E4%BF%9D%E6%8C%81%E6%95%B4%E4%BD%93%E7%BB%93%E6%9E%84%0Acleaned%20%3D%20cleaned.split('%5Cn')%0A.map(line%20%3D%3E%20line.trim())%0A.join('%5Cn')%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-title function_ inline\"\u003ecleanResponseContent\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003econtent\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!content) \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-keyword inline\"\u003elet\u003c/span\u003e cleaned = content;\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 移除\u0026quot;(Parsing required)\u0026quot;文本\u003c/span\u003e\n    cleaned = cleaned.\u003cspan class=\"hljs-title function_ inline\"\u003ereplace\u003c/span\u003e(\u003cspan class=\"hljs-regexp inline\"\u003e/\\(Parsing required\\)/gi\u003c/span\u003e, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 移除过多的空白字符，同时保持结构\u003c/span\u003e\n    cleaned = cleaned.\u003cspan class=\"hljs-title function_ inline\"\u003ereplace\u003c/span\u003e(\u003cspan class=\"hljs-regexp inline\"\u003e/\\n{3,}/g\u003c/span\u003e, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\\n\\n\u0026#x27;\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 移除每行的首尾空白字符，同时保持整体结构\u003c/span\u003e\n    cleaned = cleaned.\u003cspan class=\"hljs-title function_ inline\"\u003esplit\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\\n\u0026#x27;\u003c/span\u003e)\n        .\u003cspan class=\"hljs-title function_ inline\"\u003emap\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e\u003cspan class=\"hljs-params inline\"\u003eline\u003c/span\u003e =\u0026gt;\u003c/span\u003e line.\u003cspan class=\"hljs-title function_ inline\"\u003etrim\u003c/span\u003e())\n        .\u003cspan class=\"hljs-title function_ inline\"\u003ejoin\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\\n\u0026#x27;\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e清理算法的设计思路\u003c/strong\u003e：\u003c/p\u003e\n\u003col class=\"list-decimal list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e保留结构\u003c/strong\u003e：不破坏原有的段落结构\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e移除噪声\u003c/strong\u003e：去除AI生成的标记文本\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e标准化空白\u003c/strong\u003e：统一空行和缩进\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"部分解析的容错机制\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#部分解析的容错机制\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 部分解析的容错机制\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            部分解析的容错机制\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"%2F%2F%20%E8%B7%9F%E8%B8%AA%E5%93%AA%E4%BA%9B%E6%A0%87%E8%AE%B0%E5%AD%98%E5%9C%A8%0Aconst%20markerPresence%20%3D%20%7B%0AgrammarAnalysis%3A%20cleanedContent.includes(grammarAnalysisMarker)%2C%0AgrammarCorrection%3A%20cleanedContent.includes(grammarCorrectionMarker)%2C%0AkeywordAnalysis%3A%20cleanedContent.includes(keywordAnalysisMarker)%2C%0AchineseDefinition%3A%20cleanedContent.includes(chineseDefinitionMarker)%0A%7D%3B%0Aconst%20presentMarkers%20%3D%20Object.values(markerPresence).filter(Boolean).length%3B%0A%2F%2F%20%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%9C%89%E6%A0%87%E8%AE%B0%E5%AD%98%E5%9C%A8%EF%BC%8C%E8%BF%99%E6%98%AF%E5%AE%8C%E5%85%A8%E5%A4%B1%E8%B4%A5%0Aif%20(presentMarkers%20%3D%3D%3D%200)%20%7B%0Areturn%20%7B%0AisValid%3A%20false%2C%0Aerror%3A%20i18n.t('ai.noValidMarkers'%2C%20locale)%20%2B%20%60%20%7C%20Response%20preview%3A%20%22%24%7BcleanedContent.substring(0%2C%20200)%7D...%22%60%2C%0AgrammarAnalysis%3A%20''%2C%0AgrammarCorrection%3A%20''%2C%0AkeywordAnalysis%3A%20''%2C%0AchineseDefinition%3A%20''%2C%0ArawResponseContent%3A%20rawContent%0A%7D%3B%0A%7D\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 跟踪哪些标记存在\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e markerPresence = {\n    \u003cspan class=\"hljs-attr inline\"\u003egrammarAnalysis\u003c/span\u003e: cleanedContent.\u003cspan class=\"hljs-title function_ inline\"\u003eincludes\u003c/span\u003e(grammarAnalysisMarker),\n    \u003cspan class=\"hljs-attr inline\"\u003egrammarCorrection\u003c/span\u003e: cleanedContent.\u003cspan class=\"hljs-title function_ inline\"\u003eincludes\u003c/span\u003e(grammarCorrectionMarker),\n    \u003cspan class=\"hljs-attr inline\"\u003ekeywordAnalysis\u003c/span\u003e: cleanedContent.\u003cspan class=\"hljs-title function_ inline\"\u003eincludes\u003c/span\u003e(keywordAnalysisMarker),\n    \u003cspan class=\"hljs-attr inline\"\u003echineseDefinition\u003c/span\u003e: cleanedContent.\u003cspan class=\"hljs-title function_ inline\"\u003eincludes\u003c/span\u003e(chineseDefinitionMarker)\n};\n\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e presentMarkers = \u003cspan class=\"hljs-title class_ inline\"\u003eObject\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003evalues\u003c/span\u003e(markerPresence).\u003cspan class=\"hljs-title function_ inline\"\u003efilter\u003c/span\u003e(\u003cspan class=\"hljs-title class_ inline\"\u003eBoolean\u003c/span\u003e).\u003cspan class=\"hljs-property inline\"\u003elength\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment inline\"\u003e// 如果没有标记存在，这是完全失败\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (presentMarkers === \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e {\n        \u003cspan class=\"hljs-attr inline\"\u003eisValid\u003c/span\u003e: \u003cspan class=\"hljs-literal inline\"\u003efalse\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr inline\"\u003eerror\u003c/span\u003e: i18n.\u003cspan class=\"hljs-title function_ inline\"\u003et\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;ai.noValidMarkers\u0026#x27;\u003c/span\u003e, locale) + \u003cspan class=\"hljs-string inline\"\u003e` | Response preview: \u0026quot;\u003cspan class=\"hljs-subst inline\"\u003e${cleanedContent.substring(\u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number inline\"\u003e200\u003c/span\u003e)}\u003c/span\u003e...\u0026quot;`\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr inline\"\u003egrammarAnalysis\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr inline\"\u003egrammarCorrection\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr inline\"\u003ekeywordAnalysis\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr inline\"\u003echineseDefinition\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr inline\"\u003erawResponseContent\u003c/span\u003e: rawContent\n    };\n}\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e部分解析的哲学\u003c/strong\u003e：\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e宁可给用户部分有用的信息，也不要因为格式不完整就全盘否定。\u003c/p\u003e\n\u003ch2 id=\"parsestructuredresponse结构化解析\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#parsestructuredresponse结构化解析\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to parseStructuredResponse结构化解析\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            parseStructuredResponse结构化解析\n        \u003c/h2\u003e\n\u003ch3 id=\"结构化标记的提取逻辑\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#结构化标记的提取逻辑\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 结构化标记的提取逻辑\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            结构化标记的提取逻辑\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"parseStructuredResponse(content%2C%20locale%20%3D%20'en')%20%7B%0Atry%20%7B%0Aconst%20%7BsentenceMarker%2C%20grammarMarker%2C%20chineseMarker%2C%20endMarker%7D%20%3D%20this.responseFormat%3B%0A%2F%2F%20%E5%AD%98%E5%82%A8%E5%8E%9F%E5%A7%8B%E5%86%85%E5%AE%B9%E7%94%A8%E4%BA%8E%E5%9B%9E%E9%80%80%0Aconst%20rawContent%20%3D%20content%3B%0A%2F%2F%20%E6%B8%85%E7%90%86%E5%86%85%E5%AE%B9%20-%20%E7%A7%BB%E9%99%A4%22(Parsing%20required)%22%E5%92%8C%E5%85%B6%E4%BB%96%E4%B8%8D%E9%9C%80%E8%A6%81%E7%9A%84%E6%96%87%E6%9C%AC%0Alet%20cleanedContent%20%3D%20this.cleanResponseContent(content)%3B%0A%2F%2F%20%E5%A6%82%E6%9E%9C%E7%BC%BA%E5%B0%91END_FORMAT%E4%BD%86%E5%85%B6%E4%BB%96%E6%A0%87%E8%AE%B0%E5%AD%98%E5%9C%A8%EF%BC%8C%E5%88%99%E6%B7%BB%E5%8A%A0%0Aif%20(!cleanedContent.includes(endMarker))%20%7B%0Aconst%20hasOtherMarkers%20%3D%20%5BsentenceMarker%2C%20grammarMarker%2C%20chineseMarker%5D%0A.some(marker%20%3D%3E%20cleanedContent.includes(marker))%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-title function_ inline\"\u003eparseStructuredResponse\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003econtent, locale = \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;en\u0026#x27;\u003c/span\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e {sentenceMarker, grammarMarker, chineseMarker, endMarker} = \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eresponseFormat\u003c/span\u003e;\n\n        \u003cspan class=\"hljs-comment inline\"\u003e// 存储原始内容用于回退\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e rawContent = content;\n\n        \u003cspan class=\"hljs-comment inline\"\u003e// 清理内容 - 移除\u0026quot;(Parsing required)\u0026quot;和其他不需要的文本\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003elet\u003c/span\u003e cleanedContent = \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003ecleanResponseContent\u003c/span\u003e(content);\n\n        \u003cspan class=\"hljs-comment inline\"\u003e// 如果缺少END_FORMAT但其他标记存在，则添加\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!cleanedContent.\u003cspan class=\"hljs-title function_ inline\"\u003eincludes\u003c/span\u003e(endMarker)) {\n            \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e hasOtherMarkers = [sentenceMarker, grammarMarker, chineseMarker]\n                .\u003cspan class=\"hljs-title function_ inline\"\u003esome\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e\u003cspan class=\"hljs-params inline\"\u003emarker\u003c/span\u003e =\u0026gt;\u003c/span\u003e cleanedContent.\u003cspan class=\"hljs-title function_ inline\"\u003eincludes\u003c/span\u003e(marker));\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e自动修复机制\u003c/strong\u003e：\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e系统会自动添加缺失的结束标记，这种检测修复逻辑可以大大提高解析成功率：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"%2F%2F%20%E8%87%AA%E5%8A%A8%E4%BF%AE%E5%A4%8D%E9%80%BB%E8%BE%91%0Aif%20(!cleanedContent.includes(endMarker))%20%7B%0Aconst%20hasOtherMarkers%20%3D%20%5BsentenceMarker%2C%20grammarMarker%2C%20chineseMarker%5D%0A.some(marker%20%3D%3E%20cleanedContent.includes(marker))%3B%0Aif%20(hasOtherMarkers)%20%7B%0AcleanedContent%20%2B%3D%20%60%5Cn%5Cn%24%7BendMarker%7D%60%3B%20%20%2F%2F%20%E8%87%AA%E5%8A%A8%E6%B7%BB%E5%8A%A0%E7%BB%93%E6%9D%9F%E6%A0%87%E8%AE%B0%0A%7D%0A%7D\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 自动修复逻辑\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!cleanedContent.\u003cspan class=\"hljs-title function_ inline\"\u003eincludes\u003c/span\u003e(endMarker)) {\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e hasOtherMarkers = [sentenceMarker, grammarMarker, chineseMarker]\n        .\u003cspan class=\"hljs-title function_ inline\"\u003esome\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e\u003cspan class=\"hljs-params inline\"\u003emarker\u003c/span\u003e =\u0026gt;\u003c/span\u003e cleanedContent.\u003cspan class=\"hljs-title function_ inline\"\u003eincludes\u003c/span\u003e(marker));\n\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (hasOtherMarkers) {\n        cleanedContent += \u003cspan class=\"hljs-string inline\"\u003e`\\n\\n\u003cspan class=\"hljs-subst inline\"\u003e${endMarker}\u003c/span\u003e`\u003c/span\u003e;  \u003cspan class=\"hljs-comment inline\"\u003e// 自动添加结束标记\u003c/span\u003e\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch3 id=\"响应验证机制\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#响应验证机制\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 响应验证机制\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            响应验证机制\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"extractSectionsRobust(content%2C%20markers)%20%7B%0Aconst%20sections%20%3D%20%7B%7D%3B%0A%2F%2F%20%E5%AF%B9%E4%BA%8E%E5%8F%A5%E5%AD%90%E6%A3%80%E6%9F%A5%E5%93%8D%E5%BA%94%0Aif%20(markers.grammarAnalysisMarker)%20%7B%0Asections.grammarAnalysis%20%3D%20this.extractSection(%0Acontent%2C%0Amarkers.grammarAnalysisMarker%2C%0A%5Bmarkers.grammarCorrectionMarker%2C%20markers.keywordAnalysisMarker%2C%20markers.chineseDefinitionMarker%2C%20markers.endMarker%5D%0A)%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-title function_ inline\"\u003eextractSectionsRobust\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003econtent, markers\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e sections = {};\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 对于句子检查响应\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (markers.\u003cspan class=\"hljs-property inline\"\u003egrammarAnalysisMarker\u003c/span\u003e) {\n        sections.\u003cspan class=\"hljs-property inline\"\u003egrammarAnalysis\u003c/span\u003e = \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eextractSection\u003c/span\u003e(\n            content,\n            markers.\u003cspan class=\"hljs-property inline\"\u003egrammarAnalysisMarker\u003c/span\u003e,\n            [markers.\u003cspan class=\"hljs-property inline\"\u003egrammarCorrectionMarker\u003c/span\u003e, markers.\u003cspan class=\"hljs-property inline\"\u003ekeywordAnalysisMarker\u003c/span\u003e, markers.\u003cspan class=\"hljs-property inline\"\u003echineseDefinitionMarker\u003c/span\u003e, markers.\u003cspan class=\"hljs-property inline\"\u003eendMarker\u003c/span\u003e]\n        );\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e鲁棒性提取的算法设计\u003c/strong\u003e：\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e每个section的提取都使用了优先级队列的思想：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"extractSection(content%2C%20startMarker%2C%20endMarkers%20%3D%20%5B%5D)%20%7B%0Aconst%20startIndex%20%3D%20content.indexOf(startMarker)%3B%0Aif%20(startIndex%20%3D%3D%3D%20-1)%20%7B%0Areturn%20null%3B%20%2F%2F%20%E6%A0%87%E8%AE%B0%E6%9C%AA%E6%89%BE%E5%88%B0%0A%7D%0Aconst%20contentStart%20%3D%20startIndex%20%2B%20startMarker.length%3B%0A%2F%2F%20%E6%89%BE%E5%88%B0%E6%9C%80%E6%97%A9%E7%9A%84%E7%BB%93%E6%9D%9F%E6%A0%87%E8%AE%B0%0Alet%20endIndex%20%3D%20content.length%3B%20%2F%2F%20%E9%BB%98%E8%AE%A4%E5%88%B0%E5%86%85%E5%AE%B9%E7%BB%93%E5%B0%BE%0Afor%20(const%20endMarker%20of%20endMarkers)%20%7B%0Aconst%20markerIndex%20%3D%20content.indexOf(endMarker%2C%20contentStart)%3B%0Aif%20(markerIndex%20!%3D%3D%20-1%20%26%26%20markerIndex%20%2F%2F%20%E6%9B%B4%E6%96%B0%E6%9C%80%E6%97%A9%E7%9A%84%E7%BB%93%E6%9D%9F%E4%BD%8D%E7%BD%AE%0A%7D%0A%7D%0Aconst%20extractedContent%20%3D%20content.substring(contentStart%2C%20endIndex).trim()%3B%0Areturn%20extractedContent.length%20%3E%3D%205%20%3F%20extractedContent%20%3A%20null%3B%0A%7D\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-title function_ inline\"\u003eextractSection\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003econtent, startMarker, endMarkers = []\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e startIndex = content.\u003cspan class=\"hljs-title function_ inline\"\u003eindexOf\u003c/span\u003e(startMarker);\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (startIndex === -\u003cspan class=\"hljs-number inline\"\u003e1\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal inline\"\u003enull\u003c/span\u003e; \u003cspan class=\"hljs-comment inline\"\u003e// 标记未找到\u003c/span\u003e\n    }\n\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e contentStart = startIndex + startMarker.\u003cspan class=\"hljs-property inline\"\u003elength\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 找到最早的结束标记\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003elet\u003c/span\u003e endIndex = content.\u003cspan class=\"hljs-property inline\"\u003elength\u003c/span\u003e; \u003cspan class=\"hljs-comment inline\"\u003e// 默认到内容结尾\u003c/span\u003e\n\n    \u003cspan class=\"hljs-keyword inline\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e endMarker \u003cspan class=\"hljs-keyword inline\"\u003eof\u003c/span\u003e endMarkers) {\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e markerIndex = content.\u003cspan class=\"hljs-title function_ inline\"\u003eindexOf\u003c/span\u003e(endMarker, contentStart);\n        \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (markerIndex !== -\u003cspan class=\"hljs-number inline\"\u003e1\u003c/span\u003e \u0026amp;\u0026amp; markerIndex \u0026lt; endIndex) {\n            endIndex = markerIndex;  \u003cspan class=\"hljs-comment inline\"\u003e// 更新最早的结束位置\u003c/span\u003e\n        }\n    }\n\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e extractedContent = content.\u003cspan class=\"hljs-title function_ inline\"\u003esubstring\u003c/span\u003e(contentStart, endIndex).\u003cspan class=\"hljs-title function_ inline\"\u003etrim\u003c/span\u003e();\n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e extractedContent.\u003cspan class=\"hljs-property inline\"\u003elength\u003c/span\u003e \u0026gt;= \u003cspan class=\"hljs-number inline\"\u003e5\u003c/span\u003e ? extractedContent : \u003cspan class=\"hljs-literal inline\"\u003enull\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e算法复杂度分析\u003c/strong\u003e：\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e时间复杂度\u003c/strong\u003e：O(n × m)，其中n是内容长度，m是结束标记数量\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e空间复杂度\u003c/strong\u003e：O(1)，不需要额外的存储空间\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"数据清洗和格式化\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#数据清洗和格式化\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 数据清洗和格式化\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            数据清洗和格式化\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"%2F%2F%20%E6%B8%85%E7%90%86%E5%8F%AF%E8%83%BD%E5%B9%B2%E6%89%B0%E7%9A%84markdown%E7%97%95%E8%BF%B9%0Acleaned%20%3D%20cleaned.replace(%2F%60%60%60%5B%5Cs%5CS%5D*%3F%60%60%60%2Fg%2C%20'')%3B%20%2F%2F%20%E7%A7%BB%E9%99%A4%E4%BB%A3%E7%A0%81%E5%9D%97%0Acleaned%20%3D%20cleaned.replace(%2F%5E%5Cs*%23%7B1%2C6%7D%5Cs*%2Fgm%2C%20'')%3B%20%2F%2F%20%E7%A7%BB%E9%99%A4markdown%E6%A0%87%E9%A2%98%0Areturn%20cleaned.trim()%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 清理可能干扰的markdown痕迹\u003c/span\u003e\ncleaned = cleaned.\u003cspan class=\"hljs-title function_ inline\"\u003ereplace\u003c/span\u003e(\u003cspan class=\"hljs-regexp inline\"\u003e/```[\\s\\S]*?```/g\u003c/span\u003e, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e); \u003cspan class=\"hljs-comment inline\"\u003e// 移除代码块\u003c/span\u003e\ncleaned = cleaned.\u003cspan class=\"hljs-title function_ inline\"\u003ereplace\u003c/span\u003e(\u003cspan class=\"hljs-regexp inline\"\u003e/^\\s*#{1,6}\\s*/gm\u003c/span\u003e, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e); \u003cspan class=\"hljs-comment inline\"\u003e// 移除markdown标题\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e cleaned.\u003cspan class=\"hljs-title function_ inline\"\u003etrim\u003c/span\u003e();\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e清洗规则的设计原则\u003c/strong\u003e：\u003c/p\u003e\n\u003col class=\"list-decimal list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e保留内容\u003c/strong\u003e：不删除有意义的文本\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e移除干扰\u003c/strong\u003e：删除格式化标记\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e标准化\u003c/strong\u003e：统一空白字符处理\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e正则表达式的性能考量\u003c/strong\u003e：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"%2F%2F%20%E4%BB%A3%E7%A0%81%E5%9D%97%E6%B8%85%E7%90%86%0Acleaned%20%3D%20cleaned.replace(%2F%60%60%60%5B%5Cs%5CS%5D*%3F%60%60%60%2Fg%2C%20'')%3B%0A%2F%2F%20%E6%A0%87%E9%A2%98%E6%B8%85%E7%90%86%0Acleaned%20%3D%20cleaned.replace(%2F%5E%5Cs*%23%7B1%2C6%7D%5Cs*%2Fgm%2C%20'')%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 代码块清理\u003c/span\u003e\ncleaned = cleaned.\u003cspan class=\"hljs-title function_ inline\"\u003ereplace\u003c/span\u003e(\u003cspan class=\"hljs-regexp inline\"\u003e/```[\\s\\S]*?```/g\u003c/span\u003e, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment inline\"\u003e// 标题清理\u003c/span\u003e\ncleaned = cleaned.\u003cspan class=\"hljs-title function_ inline\"\u003ereplace\u003c/span\u003e(\u003cspan class=\"hljs-regexp inline\"\u003e/^\\s*#{1,6}\\s*/gm\u003c/span\u003e, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e这些正则表达式的性能特征：\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e非贪婪匹配\u003c/strong\u003e：\u003ccode\u003e*?\u003c/code\u003e确保最小匹配\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e多行模式\u003c/strong\u003e：\u003ccode\u003em\u003c/code\u003e标志处理多行文本\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e字符类\u003c/strong\u003e：\u003ccode\u003e\\s\u003c/code\u003e比\u003ccode\u003e[ \\t\\n\\r]\u003c/code\u003e更高效\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"完整解析流程的架构设计\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#完整解析流程的架构设计\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 完整解析流程的架构设计\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            完整解析流程的架构设计\n        \u003c/h2\u003e\n\u003ch3 id=\"从模板加载到响应解析的生命周期\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#从模板加载到响应解析的生命周期\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 从模板加载到响应解析的生命周期\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            从模板加载到响应解析的生命周期\n        \u003c/h3\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e完整的请求流程：\u003c/p\u003e\n\u003cdiv class=\"mermaid block\" id=\"mermaid-1765738202116-9snn1pf\"\u003egraph TD\n    A[用户请求] --\u003e B[AIService.checkSentence]\n    B --\u003e C[promptLoader.getSentenceCheckPrompt]\n    C --\u003e D[loadPrompt缓存查找]\n    D --\u003e E{缓存命中?}\n    E --\u003e|是| F[返回缓存内容]\n    E --\u003e|否| G[读取文件]\n    G --\u003e H[缓存存储]\n    H --\u003e I[模板变量替换]\n    I --\u003e J[发送AI请求]\n    J --\u003e K[接收AI响应]\n    K --\u003e L[parseSentenceCheckResponse]\n    L --\u003e M[内容清理]\n    M --\u003e N[标记识别]\n    N --\u003e O[分段提取]\n    O --\u003e P[验证完整性]\n    P --\u003e Q[返回结构化结果]\u003c/div\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e组件职责\u003c/strong\u003e：\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003ePromptLoader\u003c/strong\u003e：负责模板管理和缓存\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003eAIService\u003c/strong\u003e：负责请求处理和响应解析\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003eHttpUtils\u003c/strong\u003e：负责HTTP请求的封装\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003ei18n\u003c/strong\u003e：负责国际化和错误信息\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"数据流向和状态管理\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#数据流向和状态管理\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 数据流向和状态管理\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            数据流向和状态管理\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"%2F%2F%20%E6%95%B0%E6%8D%AE%E6%B5%81%E5%90%91%E7%9A%84TypeScript%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89%0Ainterface%20RequestFlow%20%7B%0Ainput%3A%20%7B%0Asentence%3A%20string%3B%0AuserId%3F%3A%20string%3B%0AgrammarLanguageOption%3A%20'pure'%20%7C%20'combined'%3B%0A%7D%3B%0Aprocessing%3A%20%7B%0ApromptTemplate%3A%20string%3B%0AfilledPrompt%3A%20string%3B%0AaiResponse%3A%20string%3B%0AcleanedContent%3A%20string%3B%0A%7D%3B%0Aoutput%3A%20%7B%0AgrammarAnalysis%3A%20string%3B%0AgrammarCorrection%3A%20string%3B%0AkeywordAnalysis%3A%20string%3B%0AchineseDefinition%3A%20string%3B%0Asuccess%3A%20boolean%3B%0Aerror%3F%3A%20string%3B%0A%7D%3B%0A%7D\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 数据流向的TypeScript类型定义\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003einterface\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eRequestFlow\u003c/span\u003e {\n    \u003cspan class=\"hljs-attr inline\"\u003einput\u003c/span\u003e: {\n        \u003cspan class=\"hljs-attr inline\"\u003esentence\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e;\n        \u003cspan class=\"hljs-attr inline\"\u003euserId\u003c/span\u003e?: \u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e;\n        \u003cspan class=\"hljs-attr inline\"\u003egrammarLanguageOption\u003c/span\u003e: \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;pure\u0026#x27;\u003c/span\u003e | \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;combined\u0026#x27;\u003c/span\u003e;\n    };\n    \n    \u003cspan class=\"hljs-attr inline\"\u003eprocessing\u003c/span\u003e: {\n        \u003cspan class=\"hljs-attr inline\"\u003epromptTemplate\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e;\n        \u003cspan class=\"hljs-attr inline\"\u003efilledPrompt\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e;\n        \u003cspan class=\"hljs-attr inline\"\u003eaiResponse\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e;\n        \u003cspan class=\"hljs-attr inline\"\u003ecleanedContent\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e;\n    };\n    \n    \u003cspan class=\"hljs-attr inline\"\u003eoutput\u003c/span\u003e: {\n        \u003cspan class=\"hljs-attr inline\"\u003egrammarAnalysis\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e;\n        \u003cspan class=\"hljs-attr inline\"\u003egrammarCorrection\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e;\n        \u003cspan class=\"hljs-attr inline\"\u003ekeywordAnalysis\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e;\n        \u003cspan class=\"hljs-attr inline\"\u003echineseDefinition\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e;\n        \u003cspan class=\"hljs-attr inline\"\u003esuccess\u003c/span\u003e: \u003cspan class=\"hljs-built_in inline\"\u003eboolean\u003c/span\u003e;\n        \u003cspan class=\"hljs-attr inline\"\u003eerror\u003c/span\u003e?: \u003cspan class=\"hljs-built_in inline\"\u003estring\u003c/span\u003e;\n    };\n}\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e状态管理的不可变性\u003c/strong\u003e：\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e每个处理步骤都产生新的状态，而不是修改原有状态：\u003c/p\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"typescript\" data-code=\"%2F%2F%20%E4%B8%8D%E5%8F%AF%E5%8F%98%E7%9A%84%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2%0Aconst%20state1%20%3D%20%7B%20content%3A%20rawContent%20%7D%3B%0Aconst%20state2%20%3D%20%7B%20...state1%2C%20content%3A%20cleanedContent%20%7D%3B%0Aconst%20state3%20%3D%20%7B%20...state2%2C%20sections%3A%20extractedSections%20%7D%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003etypescript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// 不可变的状态转换\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e state1 = { \u003cspan class=\"hljs-attr inline\"\u003econtent\u003c/span\u003e: rawContent };\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e state2 = { ...state1, \u003cspan class=\"hljs-attr inline\"\u003econtent\u003c/span\u003e: cleanedContent };\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e state3 = { ...state2, \u003cspan class=\"hljs-attr inline\"\u003esections\u003c/span\u003e: extractedSections };\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e这种设计的优势：\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e调试友好\u003c/strong\u003e：每个状态都可以独立检查\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e错误追踪\u003c/strong\u003e：容易定位问题发生的环节\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e并发安全\u003c/strong\u003e：避免状态竞争问题\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"系统架构图与技术要点总结\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#系统架构图与技术要点总结\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 系统架构图与技术要点总结\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            系统架构图与技术要点总结\n        \u003c/h2\u003e\n\u003ch3 id=\"完整的系统架构流程图\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#完整的系统架构流程图\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 完整的系统架构流程图\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            完整的系统架构流程图\n        \u003c/h3\u003e\n\u003cdiv class=\"mermaid block\" id=\"mermaid-1765738202116-ytubo81\"\u003egraph TB\n    subgraph \"用户请求层\"\n        A[用户输入] --\u003e B[API路由]\n    end\n    \n    subgraph \"业务逻辑层\"\n        B --\u003e C[AIService]\n        C --\u003e D[动态模型选择]\n        D --\u003e E[提示词加载]\n    end\n    \n    subgraph \"提示词管理层\"\n        E --\u003e F[PromptLoader]\n        F --\u003e G{缓存命中?}\n        G --\u003e|是| H[返回缓存]\n        G --\u003e|否| I[文件读取]\n        I --\u003e J[缓存更新]\n        J --\u003e K[模板替换]\n    end\n    \n    subgraph \"AI交互层\"\n        K --\u003e L[HTTP请求]\n        L --\u003e M[AI响应]\n        M --\u003e N[响应解析]\n    end\n    \n    subgraph \"解析处理层\"\n        N --\u003e O[内容清理]\n        O --\u003e P[标记识别]\n        P --\u003e Q[分段提取]\n        Q --\u003e R[验证完整性]\n        R --\u003e S[结构化输出]\n    end\n    \n    subgraph \"容错处理层\"\n        I --\u003e T{文件存在?}\n        T --\u003e|是| J\n        T --\u003e|否| U[降级策略]\n        U --\u003e V[Combined版本]\n        V --\u003e W{加载成功?}\n        W --\u003e|是| J\n        W --\u003e|否| X[错误处理]\n        N --\u003e Y{解析成功?}\n        Y --\u003e|是| S\n        Y --\u003e|否| Z[部分解析]\n    end\n    \n    S --\u003e AA[返回结果]\n    X --\u003e AA\n    Z --\u003e AA\n    H --\u003e K\u003c/div\u003e\n\u003ch2 id=\"完整源码全解析\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#完整源码全解析\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 完整源码全解析\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            完整源码全解析\n        \u003c/h2\u003e\n\u003ch3 id=\"promptloader完整源码解析\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#promptloader完整源码解析\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to PromptLoader完整源码解析\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            PromptLoader完整源码解析\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E4%BE%9D%E8%B5%96%E5%AF%BC%E5%85%A5%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Aconst%20fs%20%3D%20require('fs')%3B%20%20%20%20%20%20%20%20%2F%2F%20Node.js%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%A8%A1%E5%9D%97%EF%BC%8C%E7%94%A8%E4%BA%8E%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%0Aconst%20path%20%3D%20require('path')%3B%20%20%20%20%2F%2F%20Node.js%E8%B7%AF%E5%BE%84%E6%A8%A1%E5%9D%97%EF%BC%8C%E7%94%A8%E4%BA%8E%E8%B7%A8%E5%B9%B3%E5%8F%B0%E8%B7%AF%E5%BE%84%E5%A4%84%E7%90%86%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20PromptLoader%E6%A0%B8%E5%BF%83%E7%B1%BB%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Aclass%20PromptLoader%20%7B%0Aconstructor()%20%7B%0A%2F%2F%20%E4%BD%BF%E7%94%A8Map%E8%80%8C%E9%9D%9EObject%E5%AD%98%E5%82%A8%E7%BC%93%E5%AD%98%EF%BC%8C%E8%8E%B7%E5%BE%97%E6%9B%B4%E5%A5%BD%E7%9A%84%E6%80%A7%E8%83%BD%E5%92%8C%E7%B1%BB%E5%9E%8B%E5%AE%89%E5%85%A8%0Athis.promptCache%20%3D%20new%20Map()%3B%0A%2F%2F%20%E4%BD%BF%E7%94%A8path.join%E7%A1%AE%E4%BF%9D%E8%B7%A8%E5%B9%B3%E5%8F%B0%E8%B7%AF%E5%BE%84%E5%85%BC%E5%AE%B9%E6%80%A7%0A%2F%2F%20__dirname%E6%8C%87%E5%90%91%E5%BD%93%E5%89%8D%E6%96%87%E4%BB%B6%E6%89%80%E5%9C%A8%E7%9B%AE%E5%BD%95%EF%BC%8C..%2Fprompts%E6%8C%87%E5%90%91prompts%E6%96%87%E4%BB%B6%E5%A4%B9%0Athis.promptsDir%20%3D%20path.join(__dirname%2C%20'..%2Fprompts')%3B%0A%7D%0A%2F**%0A*%20%E6%A0%B8%E5%BF%83%E6%96%B9%E6%B3%95%EF%BC%9A%E4%BB%8E%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD%E6%8F%90%E7%A4%BA%E8%AF%8D%E6%A8%A1%E6%9D%BF%E5%B9%B6%E7%BC%93%E5%AD%98%0A*%20%40param%20%7Bstring%7D%20type%20-%20%E6%8F%90%E7%A4%BA%E8%AF%8D%E7%B1%BB%E5%9E%8B%20('sentence-check'%20%E6%88%96%20'sentence-generation')%0A*%20%40param%20%7Bstring%7D%20grammarLanguageOption%20-%20%E8%AF%AD%E6%B3%95%E8%AF%AD%E8%A8%80%E9%80%89%E9%A1%B9%20('combined'%20%E6%88%96%20'pure')%0A*%20%40returns%20%7Bstring%7D%20%E6%8F%90%E7%A4%BA%E8%AF%8D%E6%A8%A1%E6%9D%BF%E5%AD%97%E7%AC%A6%E4%B8%B2%0A*%2F%0AloadPrompt(type%2C%20grammarLanguageOption%20%3D%20'combined')%20%7B%0A%2F%2F%20%E6%9E%84%E9%80%A0%E7%BC%93%E5%AD%98%E9%94%AE%EF%BC%9A%E7%B1%BB%E5%9E%8B-%E8%AF%AD%E8%A8%80%E9%80%89%E9%A1%B9%E7%9A%84%E5%A4%8D%E5%90%88%E9%94%AE%0A%2F%2F%20%E4%BE%8B%E5%A6%82%EF%BC%9A'sentence-check-combined'%2C%20'sentence-generation-pure'%0Aconst%20cacheKey%20%3D%20%60%24%7Btype%7D-%24%7BgrammarLanguageOption%7D%60%3B%0A%2F%2F%20%E7%BC%93%E5%AD%98%E4%BC%98%E5%85%88%E7%AD%96%E7%95%A5%EF%BC%9A%E5%A6%82%E6%9E%9C%E7%BC%93%E5%AD%98%E4%B8%AD%E5%AD%98%E5%9C%A8%EF%BC%8C%E7%9B%B4%E6%8E%A5%E8%BF%94%E5%9B%9E%0A%2F%2F%20Map.has()%E5%92%8CMap.get()%E9%83%BD%E6%98%AFO(1)%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6%0Aif%20(this.promptCache.has(cacheKey))%20%7B%0Areturn%20this.promptCache.get(cacheKey)%3B%0A%7D%0Atry%20%7B%0A%2F%2F%20%E6%A0%B9%E6%8D%AE%E7%BA%A6%E5%AE%9A%E6%9E%84%E9%80%A0%E6%96%87%E4%BB%B6%E5%90%8D%EF%BC%9A%E7%B1%BB%E5%9E%8B-%E9%80%89%E9%A1%B9.txt%0Aconst%20filename%20%3D%20%60%24%7Btype%7D-%24%7BgrammarLanguageOption%7D.txt%60%3B%0A%2F%2F%20%E6%9E%84%E9%80%A0%E5%AE%8C%E6%95%B4%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84%EF%BC%8Cpath.join%E8%87%AA%E5%8A%A8%E5%A4%84%E7%90%86%E8%B7%AF%E5%BE%84%E5%88%86%E9%9A%94%E7%AC%A6%0Aconst%20filepath%20%3D%20path.join(this.promptsDir%2C%20filename)%3B%0A%2F%2F%20%E9%98%B2%E5%BE%A1%E6%80%A7%E7%BC%96%E7%A8%8B%EF%BC%9A%E5%85%88%E6%A3%80%E6%9F%A5%E6%96%87%E4%BB%B6%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%0A%2F%2F%20%E9%81%BF%E5%85%8Dfs.readFileSync%E6%8A%9B%E5%87%BA%E9%9A%BE%E4%BB%A5%E7%90%86%E8%A7%A3%E7%9A%84ENOENT%E9%94%99%E8%AF%AF%0Aif%20(!fs.existsSync(filepath))%20%7B%0Athrow%20new%20Error(%60Prompt%20file%20not%20found%3A%20%24%7Bfilepath%7D%60)%3B%0A%7D%0A%2F%2F%20%E5%90%8C%E6%AD%A5%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%EF%BC%8C%E4%BD%BF%E7%94%A8utf8%E7%BC%96%E7%A0%81%E7%A1%AE%E4%BF%9D%E4%B8%AD%E6%96%87%E6%AD%A3%E7%A1%AE%E6%98%BE%E7%A4%BA%0Aconst%20promptTemplate%20%3D%20fs.readFileSync(filepath%2C%20'utf8')%3B%0A%2F%2F%20%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5%EF%BC%9A%E5%8F%AA%E6%9C%89%E6%88%90%E5%8A%9F%E8%AF%BB%E5%8F%96%E7%9A%84%E5%86%85%E5%AE%B9%E6%89%8D%E4%BC%9A%E8%A2%AB%E7%BC%93%E5%AD%98%0A%2F%2F%20%E9%81%BF%E5%85%8D%E7%BC%93%E5%AD%98%E9%94%99%E8%AF%AF%E6%88%96%E4%B8%8D%E5%AE%8C%E6%95%B4%E7%9A%84%E6%95%B0%E6%8D%AE%0Athis.promptCache.set(cacheKey%2C%20promptTemplate)%3B%0Areturn%20promptTemplate%3B%0A%7D%20catch%20(error)%20%7B%0A%2F%2F%20%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E7%AC%AC%E4%B8%80%E5%B1%82%EF%BC%9A%E8%AE%B0%E5%BD%95%E8%AF%A6%E7%BB%86%E7%9A%84%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF%0Aconsole.error(%60Error%20loading%20prompt%20%24%7Btype%7D-%24%7BgrammarLanguageOption%7D%3A%60%2C%20error.message)%3B%0A%2F%2F%20%E9%99%8D%E7%BA%A7%E7%AD%96%E7%95%A5%EF%BC%9A%E5%A6%82%E6%9E%9Cpure%E7%89%88%E6%9C%AC%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%B0%9D%E8%AF%95combined%E7%89%88%E6%9C%AC%0A%2F%2F%20%E8%BF%99%E6%98%AF%E4%B8%80%E4%B8%AA%E4%BC%98%E9%9B%85%E7%9A%84%E5%9B%9E%E9%80%80%E6%9C%BA%E5%88%B6%EF%BC%8C%E7%A1%AE%E4%BF%9D%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%8F%AF%E7%94%A8%E6%80%A7%0Aif%20(grammarLanguageOption%20%3D%3D%3D%20'pure')%20%7B%0Aconsole.warn(%60Falling%20back%20to%20combined%20prompt%20for%20%24%7Btype%7D%60)%3B%0A%2F%2F%20%E9%80%92%E5%BD%92%E8%B0%83%E7%94%A8%E8%87%AA%E8%BA%AB%EF%BC%8C%E4%BD%86%E4%BD%BF%E7%94%A8combined%E9%80%89%E9%A1%B9%0Areturn%20this.loadPrompt(type%2C%20'combined')%3B%0A%7D%0A%2F%2F%20%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%9C%80%E5%90%8E%E4%B8%80%E9%81%93%E9%98%B2%E7%BA%BF%EF%BC%9A%E5%A6%82%E6%9E%9Ccombined%E7%89%88%E6%9C%AC%E4%B9%9F%E5%A4%B1%E8%B4%A5%EF%BC%8C%E6%8A%9B%E5%87%BA%E6%98%8E%E7%A1%AE%E7%9A%84%E9%94%99%E8%AF%AF%0Athrow%20new%20Error(%60Failed%20to%20load%20prompt%20template%3A%20%24%7Btype%7D-%24%7BgrammarLanguageOption%7D%60)%3B%0A%7D%0A%7D%0A%2F**%0A*%20%E8%8E%B7%E5%8F%96%E5%8F%A5%E5%AD%90%E6%A3%80%E6%9F%A5%E6%8F%90%E7%A4%BA%E8%AF%8D%EF%BC%88%E5%B8%A6%E5%8F%98%E9%87%8F%E6%9B%BF%E6%8D%A2%EF%BC%89%0A*%20%40param%20%7Bstring%7D%20sentence%20-%20%E8%A6%81%E5%88%86%E6%9E%90%E7%9A%84%E5%8F%A5%E5%AD%90%0A*%20%40param%20%7Bstring%7D%20grammarLanguageOption%20-%20%E8%AF%AD%E8%A8%80%E9%80%89%E9%A1%B9%0A*%20%40returns%20%7Bstring%7D%20%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%90%8E%E7%9A%84%E6%8F%90%E7%A4%BA%E8%AF%8D%0A*%2F%0AgetSentenceCheckPrompt(sentence%2C%20grammarLanguageOption%20%3D%20'combined')%20%7B%0A%2F%2F%20%E5%85%88%E8%8E%B7%E5%8F%96%E6%A8%A1%E6%9D%BF%EF%BC%8C%E5%88%A9%E7%94%A8loadPrompt%E7%9A%84%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6%0Aconst%20template%20%3D%20this.loadPrompt('sentence-check'%2C%20grammarLanguageOption)%3B%0A%2F%2F%20%E7%AE%80%E5%8D%95%E8%80%8C%E6%9C%89%E6%95%88%E7%9A%84%E6%A8%A1%E6%9D%BF%E5%8F%98%E9%87%8F%E6%9B%BF%E6%8D%A2%0A%2F%2F%20%E4%BD%BF%E7%94%A8String.replace%E8%80%8C%E9%9D%9E%E5%A4%8D%E6%9D%82%E7%9A%84%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%EF%BC%8C%E5%87%8F%E5%B0%91%E4%BE%9D%E8%B5%96%E5%92%8C%E5%A4%8D%E6%9D%82%E5%BA%A6%0Areturn%20template.replace('%7Bsentence%7D'%2C%20sentence)%3B%0A%7D%0A%2F**%0A*%20%E8%8E%B7%E5%8F%96%E5%8F%A5%E5%AD%90%E7%94%9F%E6%88%90%E6%8F%90%E7%A4%BA%E8%AF%8D%EF%BC%88%E5%B8%A6%E5%8F%98%E9%87%8F%E6%9B%BF%E6%8D%A2%EF%BC%89%0A*%20%40param%20%7BArray%7D%20words%20-%20%E8%A6%81%E4%BD%BF%E7%94%A8%E7%9A%84%E5%8D%95%E8%AF%8D%E6%95%B0%E7%BB%84%0A*%20%40param%20%7Bstring%7D%20grammarLanguageOption%20-%20%E8%AF%AD%E8%A8%80%E9%80%89%E9%A1%B9%0A*%20%40returns%20%7Bstring%7D%20%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%90%8E%E7%9A%84%E6%8F%90%E7%A4%BA%E8%AF%8D%0A*%2F%0AgetSentenceGenerationPrompt(words%2C%20grammarLanguageOption%20%3D%20'combined')%20%7B%0Aconst%20template%20%3D%20this.loadPrompt('sentence-generation'%2C%20grammarLanguageOption)%3B%0A%2F%2F%20%E7%B1%BB%E5%9E%8B%E5%AE%89%E5%85%A8%E7%9A%84%E6%95%B0%E7%BB%84%E5%A4%84%E7%90%86%EF%BC%9A%E7%A1%AE%E4%BF%9Dwords%E6%98%AF%E6%95%B0%E7%BB%84%E5%90%8E%E5%86%8Djoin%0A%2F%2F%20%E5%A6%82%E6%9E%9C%E4%B8%8D%E6%98%AF%E6%95%B0%E7%BB%84%EF%BC%8C%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8%E5%8E%9F%E5%80%BC%0Aconst%20wordsString%20%3D%20Array.isArray(words)%20%3F%20words.join('%2C%20')%20%3A%20words%3B%0Areturn%20template.replace('%7Bwords%7D'%2C%20wordsString)%3B%0A%7D%0A%2F**%0A*%20%E6%B8%85%E7%A9%BA%E7%BC%93%E5%AD%98%EF%BC%88%E5%BC%80%E5%8F%91%E5%92%8C%E6%B5%8B%E8%AF%95%E6%97%B6%E6%9C%89%E7%94%A8%EF%BC%89%0A*%2F%0AclearCache()%20%7B%0A%2F%2F%20Map.clear()%E6%98%AFO(1)%E6%93%8D%E4%BD%9C%EF%BC%8C%E7%9B%B4%E6%8E%A5%E6%B8%85%E7%A9%BA%E6%89%80%E6%9C%89%E7%BC%93%E5%AD%98%0Athis.promptCache.clear()%3B%0A%7D%0A%2F**%0A*%20%E8%8E%B7%E5%8F%96%E7%BC%93%E5%AD%98%E7%8A%B6%E6%80%81%E4%BF%A1%E6%81%AF%EF%BC%88%E8%B0%83%E8%AF%95%E7%94%A8%EF%BC%89%0A*%20%40returns%20%7BObject%7D%20%E5%8C%85%E5%90%AB%E7%BC%93%E5%AD%98%E5%A4%A7%E5%B0%8F%E5%92%8C%E5%B7%B2%E7%BC%93%E5%AD%98%E9%A1%B9%E7%9B%AE%E7%9A%84%E4%BF%A1%E6%81%AF%0A*%2F%0AgetCacheInfo()%20%7B%0Areturn%20%7B%0A%2F%2F%20Map.size%E6%98%AFO(1)%E6%93%8D%E4%BD%9C%EF%BC%8C%E8%8E%B7%E5%8F%96%E7%BC%93%E5%AD%98%E9%A1%B9%E7%9B%AE%E6%95%B0%E9%87%8F%0AcacheSize%3A%20this.promptCache.size%2C%0A%2F%2F%20%E5%B0%86Map%E7%9A%84%E9%94%AE%E8%BD%AC%E6%8D%A2%E4%B8%BA%E6%95%B0%E7%BB%84%EF%BC%8C%E4%BE%BF%E4%BA%8E%E8%B0%83%E8%AF%95%E6%9F%A5%E7%9C%8B%0AcachedPrompts%3A%20Array.from(this.promptCache.keys())%0A%7D%3B%0A%7D%0A%2F**%0A*%20%E9%AA%8C%E8%AF%81%E6%89%80%E6%9C%89%E5%BF%85%E9%9C%80%E7%9A%84%E6%8F%90%E7%A4%BA%E8%AF%8D%E6%96%87%E4%BB%B6%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%0A*%20%40returns%20%7BObject%7D%20%E9%AA%8C%E8%AF%81%E7%BB%93%E6%9E%9C%EF%BC%8C%E5%8C%85%E5%90%AB%E5%AD%98%E5%9C%A8%2F%E7%BC%BA%E5%A4%B1%E7%9A%84%E6%96%87%E4%BB%B6%E5%88%97%E8%A1%A8%0A*%2F%0AvalidatePromptFiles()%20%7B%0A%2F%2F%20%E5%AE%9A%E4%B9%89%E7%B3%BB%E7%BB%9F%E5%BF%85%E9%9C%80%E7%9A%84%E6%8F%90%E7%A4%BA%E8%AF%8D%E6%96%87%E4%BB%B6%E5%88%97%E8%A1%A8%0A%2F%2F%20%E8%BF%99%E4%B8%AA%E6%95%B0%E7%BB%84%E5%AE%9A%E4%B9%89%E4%BA%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%8C%E6%95%B4%E6%80%A7%E8%A6%81%E6%B1%82%0Aconst%20requiredPrompts%20%3D%20%5B%0A'sentence-check-pure.txt'%2C%0A'sentence-check-combined.txt'%2C%0A'sentence-generation-pure.txt'%2C%0A'sentence-generation-combined.txt'%0A%5D%3B%0Aconst%20missing%20%3D%20%5B%5D%3B%20%20%20%2F%2F%20%E7%BC%BA%E5%A4%B1%E7%9A%84%E6%96%87%E4%BB%B6%0Aconst%20existing%20%3D%20%5B%5D%3B%20%20%2F%2F%20%E5%AD%98%E5%9C%A8%E7%9A%84%E6%96%87%E4%BB%B6%0A%2F%2F%20%E9%81%8D%E5%8E%86%E6%89%80%E6%9C%89%E5%BF%85%E9%9C%80%E6%96%87%E4%BB%B6%EF%BC%8C%E6%A3%80%E6%9F%A5%E5%AD%98%E5%9C%A8%E6%80%A7%0Afor%20(const%20filename%20of%20requiredPrompts)%20%7B%0Aconst%20filepath%20%3D%20path.join(this.promptsDir%2C%20filename)%3B%0A%2F%2F%20fs.existsSync%E6%98%AF%E5%90%8C%E6%AD%A5%E6%A3%80%E6%9F%A5%EF%BC%8C%E9%80%82%E5%90%88%E5%90%AF%E5%8A%A8%E6%97%B6%E7%9A%84%E4%B8%80%E6%AC%A1%E6%80%A7%E9%AA%8C%E8%AF%81%0Aif%20(fs.existsSync(filepath))%20%7B%0Aexisting.push(filename)%3B%0A%7D%20else%20%7B%0Amissing.push(filename)%3B%0A%7D%0A%7D%0Areturn%20%7B%0A%2F%2F%20%E7%B3%BB%E7%BB%9F%E5%AE%8C%E6%95%B4%E6%80%A7%E6%A0%87%E5%BF%97%EF%BC%9A%E5%8F%AA%E6%9C%89%E5%BD%93%E6%89%80%E6%9C%89%E6%96%87%E4%BB%B6%E9%83%BD%E5%AD%98%E5%9C%A8%E6%97%B6%E6%89%8D%E4%B8%BAtrue%0Avalid%3A%20missing.length%20%3D%3D%3D%200%2C%0Aexisting%2C%0Amissing%2C%0A%2F%2F%20%E6%8F%90%E4%BE%9B%E6%8F%90%E7%A4%BA%E8%AF%8D%E7%9B%AE%E5%BD%95%E8%B7%AF%E5%BE%84%EF%BC%8C%E4%BE%BF%E4%BA%8E%E8%BF%90%E7%BB%B4%E4%BA%BA%E5%91%98%E5%AE%9A%E4%BD%8D%E9%97%AE%E9%A2%98%0ApromptsDirectory%3A%20this.promptsDir%0A%7D%3B%0A%7D%0A%7D%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%87%BA%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F%2F%20%E5%AF%BC%E5%87%BA%E5%8D%95%E4%BE%8B%E5%AE%9E%E4%BE%8B%EF%BC%8C%E8%80%8C%E4%B8%8D%E6%98%AF%E7%B1%BB%E6%9C%AC%E8%BA%AB%0A%2F%2F%20%E8%BF%99%E7%A1%AE%E4%BF%9D%E4%BA%86%E5%85%A8%E5%B1%80%E5%8F%AA%E6%9C%89%E4%B8%80%E4%B8%AAPromptLoader%E5%AE%9E%E4%BE%8B%EF%BC%8C%E8%8A%82%E7%9C%81%E5%86%85%E5%AD%98%E4%B8%94%E4%BF%9D%E8%AF%81%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%0Amodule.exports%20%3D%20new%20PromptLoader()%3B\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// ==================== 依赖导入 ====================\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e fs = \u003cspan class=\"hljs-built_in inline\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;fs\u0026#x27;\u003c/span\u003e);        \u003cspan class=\"hljs-comment inline\"\u003e// Node.js文件系统模块，用于文件操作\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e path = \u003cspan class=\"hljs-built_in inline\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;path\u0026#x27;\u003c/span\u003e);    \u003cspan class=\"hljs-comment inline\"\u003e// Node.js路径模块，用于跨平台路径处理\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment inline\"\u003e// ==================== PromptLoader核心类 ====================\u003c/span\u003e\n\u003cspan class=\"hljs-keyword inline\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003ePromptLoader\u003c/span\u003e {\n    \u003cspan class=\"hljs-title function_ inline\"\u003econstructor\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003c/span\u003e) {\n        \u003cspan class=\"hljs-comment inline\"\u003e// 使用Map而非Object存储缓存，获得更好的性能和类型安全\u003c/span\u003e\n        \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epromptCache\u003c/span\u003e = \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eMap\u003c/span\u003e();\n        \n        \u003cspan class=\"hljs-comment inline\"\u003e// 使用path.join确保跨平台路径兼容性\u003c/span\u003e\n        \u003cspan class=\"hljs-comment inline\"\u003e// __dirname指向当前文件所在目录，../prompts指向prompts文件夹\u003c/span\u003e\n        \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epromptsDir\u003c/span\u003e = path.\u003cspan class=\"hljs-title function_ inline\"\u003ejoin\u003c/span\u003e(__dirname, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;../prompts\u0026#x27;\u003c/span\u003e);\n    }\n\n    \u003cspan class=\"hljs-comment inline\"\u003e/**\n     * 核心方法：从文件加载提示词模板并缓存\n     * \u003cspan class=\"hljs-doctag inline\"\u003e@param\u003c/span\u003e {\u003cspan class=\"hljs-type inline\"\u003estring\u003c/span\u003e} \u003cspan class=\"hljs-variable inline\"\u003etype\u003c/span\u003e - 提示词类型 (\u0026#x27;sentence-check\u0026#x27; 或 \u0026#x27;sentence-generation\u0026#x27;)\n     * \u003cspan class=\"hljs-doctag inline\"\u003e@param\u003c/span\u003e {\u003cspan class=\"hljs-type inline\"\u003estring\u003c/span\u003e} \u003cspan class=\"hljs-variable inline\"\u003egrammarLanguageOption\u003c/span\u003e - 语法语言选项 (\u0026#x27;combined\u0026#x27; 或 \u0026#x27;pure\u0026#x27;)\n     * \u003cspan class=\"hljs-doctag inline\"\u003e@returns\u003c/span\u003e {\u003cspan class=\"hljs-type inline\"\u003estring\u003c/span\u003e} 提示词模板字符串\n     */\u003c/span\u003e\n    \u003cspan class=\"hljs-title function_ inline\"\u003eloadPrompt\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003etype, grammarLanguageOption = \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;combined\u0026#x27;\u003c/span\u003e\u003c/span\u003e) {\n        \u003cspan class=\"hljs-comment inline\"\u003e// 构造缓存键：类型-语言选项的复合键\u003c/span\u003e\n        \u003cspan class=\"hljs-comment inline\"\u003e// 例如：\u0026#x27;sentence-check-combined\u0026#x27;, \u0026#x27;sentence-generation-pure\u0026#x27;\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e cacheKey = \u003cspan class=\"hljs-string inline\"\u003e`\u003cspan class=\"hljs-subst inline\"\u003e${type}\u003c/span\u003e-\u003cspan class=\"hljs-subst inline\"\u003e${grammarLanguageOption}\u003c/span\u003e`\u003c/span\u003e;\n        \n        \u003cspan class=\"hljs-comment inline\"\u003e// 缓存优先策略：如果缓存中存在，直接返回\u003c/span\u003e\n        \u003cspan class=\"hljs-comment inline\"\u003e// Map.has()和Map.get()都是O(1)时间复杂度\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epromptCache\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003ehas\u003c/span\u003e(cacheKey)) {\n            \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epromptCache\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eget\u003c/span\u003e(cacheKey);\n        }\n\n        \u003cspan class=\"hljs-keyword inline\"\u003etry\u003c/span\u003e {\n            \u003cspan class=\"hljs-comment inline\"\u003e// 根据约定构造文件名：类型-选项.txt\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e filename = \u003cspan class=\"hljs-string inline\"\u003e`\u003cspan class=\"hljs-subst inline\"\u003e${type}\u003c/span\u003e-\u003cspan class=\"hljs-subst inline\"\u003e${grammarLanguageOption}\u003c/span\u003e.txt`\u003c/span\u003e;\n            \n            \u003cspan class=\"hljs-comment inline\"\u003e// 构造完整文件路径，path.join自动处理路径分隔符\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e filepath = path.\u003cspan class=\"hljs-title function_ inline\"\u003ejoin\u003c/span\u003e(\u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epromptsDir\u003c/span\u003e, filename);\n            \n            \u003cspan class=\"hljs-comment inline\"\u003e// 防御性编程：先检查文件是否存在\u003c/span\u003e\n            \u003cspan class=\"hljs-comment inline\"\u003e// 避免fs.readFileSync抛出难以理解的ENOENT错误\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!fs.\u003cspan class=\"hljs-title function_ inline\"\u003eexistsSync\u003c/span\u003e(filepath)) {\n                \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`Prompt file not found: \u003cspan class=\"hljs-subst inline\"\u003e${filepath}\u003c/span\u003e`\u003c/span\u003e);\n            }\n\n            \u003cspan class=\"hljs-comment inline\"\u003e// 同步读取文件内容，使用utf8编码确保中文正确显示\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e promptTemplate = fs.\u003cspan class=\"hljs-title function_ inline\"\u003ereadFileSync\u003c/span\u003e(filepath, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;utf8\u0026#x27;\u003c/span\u003e);\n            \n            \u003cspan class=\"hljs-comment inline\"\u003e// 缓存策略：只有成功读取的内容才会被缓存\u003c/span\u003e\n            \u003cspan class=\"hljs-comment inline\"\u003e// 避免缓存错误或不完整的数据\u003c/span\u003e\n            \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epromptCache\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eset\u003c/span\u003e(cacheKey, promptTemplate);\n            \n            \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e promptTemplate;\n        } \u003cspan class=\"hljs-keyword inline\"\u003ecatch\u003c/span\u003e (error) {\n            \u003cspan class=\"hljs-comment inline\"\u003e// 错误处理第一层：记录详细的错误信息\u003c/span\u003e\n            \u003cspan class=\"hljs-variable language_ inline\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eerror\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`Error loading prompt \u003cspan class=\"hljs-subst inline\"\u003e${type}\u003c/span\u003e-\u003cspan class=\"hljs-subst inline\"\u003e${grammarLanguageOption}\u003c/span\u003e:`\u003c/span\u003e, error.\u003cspan class=\"hljs-property inline\"\u003emessage\u003c/span\u003e);\n            \n            \u003cspan class=\"hljs-comment inline\"\u003e// 降级策略：如果pure版本失败，尝试combined版本\u003c/span\u003e\n            \u003cspan class=\"hljs-comment inline\"\u003e// 这是一个优雅的回退机制，确保服务的可用性\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (grammarLanguageOption === \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;pure\u0026#x27;\u003c/span\u003e) {\n                \u003cspan class=\"hljs-variable language_ inline\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003ewarn\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`Falling back to combined prompt for \u003cspan class=\"hljs-subst inline\"\u003e${type}\u003c/span\u003e`\u003c/span\u003e);\n                \u003cspan class=\"hljs-comment inline\"\u003e// 递归调用自身，但使用combined选项\u003c/span\u003e\n                \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eloadPrompt\u003c/span\u003e(type, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;combined\u0026#x27;\u003c/span\u003e);\n            }\n            \n            \u003cspan class=\"hljs-comment inline\"\u003e// 错误处理最后一道防线：如果combined版本也失败，抛出明确的错误\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword inline\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e`Failed to load prompt template: \u003cspan class=\"hljs-subst inline\"\u003e${type}\u003c/span\u003e-\u003cspan class=\"hljs-subst inline\"\u003e${grammarLanguageOption}\u003c/span\u003e`\u003c/span\u003e);\n        }\n    }\n\n    \u003cspan class=\"hljs-comment inline\"\u003e/**\n     * 获取句子检查提示词（带变量替换）\n     * \u003cspan class=\"hljs-doctag inline\"\u003e@param\u003c/span\u003e {\u003cspan class=\"hljs-type inline\"\u003estring\u003c/span\u003e} \u003cspan class=\"hljs-variable inline\"\u003esentence\u003c/span\u003e - 要分析的句子\n     * \u003cspan class=\"hljs-doctag inline\"\u003e@param\u003c/span\u003e {\u003cspan class=\"hljs-type inline\"\u003estring\u003c/span\u003e} \u003cspan class=\"hljs-variable inline\"\u003egrammarLanguageOption\u003c/span\u003e - 语言选项\n     * \u003cspan class=\"hljs-doctag inline\"\u003e@returns\u003c/span\u003e {\u003cspan class=\"hljs-type inline\"\u003estring\u003c/span\u003e} 格式化后的提示词\n     */\u003c/span\u003e\n    \u003cspan class=\"hljs-title function_ inline\"\u003egetSentenceCheckPrompt\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003esentence, grammarLanguageOption = \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;combined\u0026#x27;\u003c/span\u003e\u003c/span\u003e) {\n        \u003cspan class=\"hljs-comment inline\"\u003e// 先获取模板，利用loadPrompt的缓存机制\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e template = \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eloadPrompt\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;sentence-check\u0026#x27;\u003c/span\u003e, grammarLanguageOption);\n        \n        \u003cspan class=\"hljs-comment inline\"\u003e// 简单而有效的模板变量替换\u003c/span\u003e\n        \u003cspan class=\"hljs-comment inline\"\u003e// 使用String.replace而非复杂的模板引擎，减少依赖和复杂度\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e template.\u003cspan class=\"hljs-title function_ inline\"\u003ereplace\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;{sentence}\u0026#x27;\u003c/span\u003e, sentence);\n    }\n\n    \u003cspan class=\"hljs-comment inline\"\u003e/**\n     * 获取句子生成提示词（带变量替换）\n     * \u003cspan class=\"hljs-doctag inline\"\u003e@param\u003c/span\u003e {\u003cspan class=\"hljs-type inline\"\u003eArray\u003c/span\u003e} \u003cspan class=\"hljs-variable inline\"\u003ewords\u003c/span\u003e - 要使用的单词数组\n     * \u003cspan class=\"hljs-doctag inline\"\u003e@param\u003c/span\u003e {\u003cspan class=\"hljs-type inline\"\u003estring\u003c/span\u003e} \u003cspan class=\"hljs-variable inline\"\u003egrammarLanguageOption\u003c/span\u003e - 语言选项\n     * \u003cspan class=\"hljs-doctag inline\"\u003e@returns\u003c/span\u003e {\u003cspan class=\"hljs-type inline\"\u003estring\u003c/span\u003e} 格式化后的提示词\n     */\u003c/span\u003e\n    \u003cspan class=\"hljs-title function_ inline\"\u003egetSentenceGenerationPrompt\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003ewords, grammarLanguageOption = \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;combined\u0026#x27;\u003c/span\u003e\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e template = \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eloadPrompt\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;sentence-generation\u0026#x27;\u003c/span\u003e, grammarLanguageOption);\n        \n        \u003cspan class=\"hljs-comment inline\"\u003e// 类型安全的数组处理：确保words是数组后再join\u003c/span\u003e\n        \u003cspan class=\"hljs-comment inline\"\u003e// 如果不是数组，直接使用原值\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e wordsString = \u003cspan class=\"hljs-title class_ inline\"\u003eArray\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eisArray\u003c/span\u003e(words) ? words.\u003cspan class=\"hljs-title function_ inline\"\u003ejoin\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;, \u0026#x27;\u003c/span\u003e) : words;\n        \n        \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e template.\u003cspan class=\"hljs-title function_ inline\"\u003ereplace\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;{words}\u0026#x27;\u003c/span\u003e, wordsString);\n    }\n\n    \u003cspan class=\"hljs-comment inline\"\u003e/**\n     * 清空缓存（开发和测试时有用）\n     */\u003c/span\u003e\n    \u003cspan class=\"hljs-title function_ inline\"\u003eclearCache\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003c/span\u003e) {\n        \u003cspan class=\"hljs-comment inline\"\u003e// Map.clear()是O(1)操作，直接清空所有缓存\u003c/span\u003e\n        \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epromptCache\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003eclear\u003c/span\u003e();\n    }\n\n    \u003cspan class=\"hljs-comment inline\"\u003e/**\n     * 获取缓存状态信息（调试用）\n     * \u003cspan class=\"hljs-doctag inline\"\u003e@returns\u003c/span\u003e {\u003cspan class=\"hljs-type inline\"\u003eObject\u003c/span\u003e} 包含缓存大小和已缓存项目的信息\n     */\u003c/span\u003e\n    \u003cspan class=\"hljs-title function_ inline\"\u003egetCacheInfo\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e {\n            \u003cspan class=\"hljs-comment inline\"\u003e// Map.size是O(1)操作，获取缓存项目数量\u003c/span\u003e\n            \u003cspan class=\"hljs-attr inline\"\u003ecacheSize\u003c/span\u003e: \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epromptCache\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003esize\u003c/span\u003e,\n            \u003cspan class=\"hljs-comment inline\"\u003e// 将Map的键转换为数组，便于调试查看\u003c/span\u003e\n            \u003cspan class=\"hljs-attr inline\"\u003ecachedPrompts\u003c/span\u003e: \u003cspan class=\"hljs-title class_ inline\"\u003eArray\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003efrom\u003c/span\u003e(\u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epromptCache\u003c/span\u003e.\u003cspan class=\"hljs-title function_ inline\"\u003ekeys\u003c/span\u003e())\n        };\n    }\n\n    \u003cspan class=\"hljs-comment inline\"\u003e/**\n     * 验证所有必需的提示词文件是否存在\n     * \u003cspan class=\"hljs-doctag inline\"\u003e@returns\u003c/span\u003e {\u003cspan class=\"hljs-type inline\"\u003eObject\u003c/span\u003e} 验证结果，包含存在/缺失的文件列表\n     */\u003c/span\u003e\n    \u003cspan class=\"hljs-title function_ inline\"\u003evalidatePromptFiles\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003e\u003c/span\u003e) {\n        \u003cspan class=\"hljs-comment inline\"\u003e// 定义系统必需的提示词文件列表\u003c/span\u003e\n        \u003cspan class=\"hljs-comment inline\"\u003e// 这个数组定义了系统的完整性要求\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e requiredPrompts = [\n            \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;sentence-check-pure.txt\u0026#x27;\u003c/span\u003e,\n            \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;sentence-check-combined.txt\u0026#x27;\u003c/span\u003e,\n            \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;sentence-generation-pure.txt\u0026#x27;\u003c/span\u003e,\n            \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;sentence-generation-combined.txt\u0026#x27;\u003c/span\u003e\n        ];\n\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e missing = [];   \u003cspan class=\"hljs-comment inline\"\u003e// 缺失的文件\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e existing = [];  \u003cspan class=\"hljs-comment inline\"\u003e// 存在的文件\u003c/span\u003e\n\n        \u003cspan class=\"hljs-comment inline\"\u003e// 遍历所有必需文件，检查存在性\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword inline\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e filename \u003cspan class=\"hljs-keyword inline\"\u003eof\u003c/span\u003e requiredPrompts) {\n            \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e filepath = path.\u003cspan class=\"hljs-title function_ inline\"\u003ejoin\u003c/span\u003e(\u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epromptsDir\u003c/span\u003e, filename);\n            \u003cspan class=\"hljs-comment inline\"\u003e// fs.existsSync是同步检查，适合启动时的一次性验证\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (fs.\u003cspan class=\"hljs-title function_ inline\"\u003eexistsSync\u003c/span\u003e(filepath)) {\n                existing.\u003cspan class=\"hljs-title function_ inline\"\u003epush\u003c/span\u003e(filename);\n            } \u003cspan class=\"hljs-keyword inline\"\u003eelse\u003c/span\u003e {\n                missing.\u003cspan class=\"hljs-title function_ inline\"\u003epush\u003c/span\u003e(filename);\n            }\n        }\n\n        \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e {\n            \u003cspan class=\"hljs-comment inline\"\u003e// 系统完整性标志：只有当所有文件都存在时才为true\u003c/span\u003e\n            \u003cspan class=\"hljs-attr inline\"\u003evalid\u003c/span\u003e: missing.\u003cspan class=\"hljs-property inline\"\u003elength\u003c/span\u003e === \u003cspan class=\"hljs-number inline\"\u003e0\u003c/span\u003e,\n            existing,\n            missing,\n            \u003cspan class=\"hljs-comment inline\"\u003e// 提供提示词目录路径，便于运维人员定位问题\u003c/span\u003e\n            \u003cspan class=\"hljs-attr inline\"\u003epromptsDirectory\u003c/span\u003e: \u003cspan class=\"hljs-variable language_ inline\"\u003ethis\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003epromptsDir\u003c/span\u003e\n        };\n    }\n}\n\n\u003cspan class=\"hljs-comment inline\"\u003e// ==================== 模块导出 ====================\u003c/span\u003e\n\u003cspan class=\"hljs-comment inline\"\u003e// 导出单例实例，而不是类本身\u003c/span\u003e\n\u003cspan class=\"hljs-comment inline\"\u003e// 这确保了全局只有一个PromptLoader实例，节省内存且保证缓存一致性\u003c/span\u003e\n\u003cspan class=\"hljs-variable language_ inline\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property inline\"\u003eexports\u003c/span\u003e = \u003cspan class=\"hljs-keyword inline\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_ inline\"\u003ePromptLoader\u003c/span\u003e();\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003ch3 id=\"响应解析核心算法解析\" class=\"group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug\"\u003e\n            \u003ca href=\"#响应解析核心算法解析\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 响应解析核心算法解析\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            响应解析核心算法解析\n        \u003c/h3\u003e\n\n            \u003cdiv class=\"enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\" data-enhanced-codeblock=\"true\" data-language=\"javascript\" data-code=\"%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E5%86%85%E5%AE%B9%E6%B8%85%E7%90%86%E7%AE%97%E6%B3%95%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0AcleanResponseContent(content)%20%7B%0Aif%20(!content)%20return%20''%3B%0Alet%20cleaned%20%3D%20content%3B%0A%2F%2F%20%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E7%A7%BB%E9%99%A4AI%E7%94%9F%E6%88%90%E7%9A%84%E5%85%83%E6%A0%87%E8%AE%B0%0Acleaned%20%3D%20cleaned.replace(%2F%5C(Parsing%20required%5C)%2Fgi%2C%20'')%3B%0A%2F%2F%20%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E6%A0%87%E5%87%86%E5%8C%96%E7%A9%BA%E7%99%BD%E5%AD%97%E7%AC%A6%EF%BC%8C%E4%BF%9D%E6%8C%81%E7%BB%93%E6%9E%84%E5%AE%8C%E6%95%B4%E6%80%A7%0Acleaned%20%3D%20cleaned.replace(%2F%5Cn%7B3%2C%7D%2Fg%2C%20'%5Cn%5Cn')%3B%0A%2F%2F%20%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E6%B8%85%E7%90%86%E6%AF%8F%E8%A1%8C%E7%9A%84%E8%BE%B9%E7%BC%98%E7%A9%BA%E7%99%BD%EF%BC%8C%E4%BD%86%E4%BF%9D%E6%8C%81%E6%95%B4%E4%BD%93%E5%B8%83%E5%B1%80%0Acleaned%20%3D%20cleaned.split('%5Cn')%0A.map(line%20%3D%3E%20line.trim())%0A.join('%5Cn')%3B%0A%2F%2F%20%E7%AC%AC%E5%9B%9B%E6%AD%A5%EF%BC%9A%E7%A7%BB%E9%99%A4%E5%8F%AF%E8%83%BD%E5%B9%B2%E6%89%B0%E8%A7%A3%E6%9E%90%E7%9A%84markdown%E5%85%83%E7%B4%A0%0Acleaned%20%3D%20cleaned.replace(%2F%60%60%60%5B%5Cs%5CS%5D*%3F%60%60%60%2Fg%2C%20'')%3B%0Acleaned%20%3D%20cleaned.replace(%2F%5E%5Cs*%23%7B1%2C6%7D%5Cs*%2Fgm%2C%20'')%3B%0Areturn%20cleaned.trim()%3B%0A%7D%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20%E6%A0%87%E8%AE%B0%E6%8F%90%E5%8F%96%E7%AE%97%E6%B3%95%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0AextractSection(content%2C%20startMarker%2C%20endMarkers%20%3D%20%5B%5D)%20%7B%0A%2F%2F%20%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E5%AE%9A%E4%BD%8D%E8%B5%B7%E5%A7%8B%E6%A0%87%E8%AE%B0%0Aconst%20startIndex%20%3D%20content.indexOf(startMarker)%3B%0Aif%20(startIndex%20%3D%3D%3D%20-1)%20%7B%0Areturn%20null%3B%20%2F%2F%20%E6%A0%87%E8%AE%B0%E6%9C%AA%E6%89%BE%E5%88%B0%EF%BC%8C%E8%BF%94%E5%9B%9Enull%E8%80%8C%E9%9D%9E%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8%0A%7D%0A%2F%2F%20%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E8%AE%A1%E7%AE%97%E5%86%85%E5%AE%B9%E8%B5%B7%E5%A7%8B%E4%BD%8D%E7%BD%AE%0Aconst%20contentStart%20%3D%20startIndex%20%2B%20startMarker.length%3B%0A%2F%2F%20%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E5%AF%BB%E6%89%BE%E6%9C%80%E8%BF%91%E7%9A%84%E7%BB%93%E6%9D%9F%E6%A0%87%E8%AE%B0%EF%BC%88%E8%B4%AA%E5%A9%AA%E7%AE%97%E6%B3%95%EF%BC%89%0Alet%20endIndex%20%3D%20content.length%3B%20%2F%2F%20%E9%BB%98%E8%AE%A4%E5%88%B0%E5%86%85%E5%AE%B9%E7%BB%93%E5%B0%BE%0Afor%20(const%20endMarker%20of%20endMarkers)%20%7B%0Aconst%20markerIndex%20%3D%20content.indexOf(endMarker%2C%20contentStart)%3B%0Aif%20(markerIndex%20!%3D%3D%20-1%20%26%26%20markerIndex%20%2F%2F%20%E6%9B%B4%E6%96%B0%E4%B8%BA%E6%9B%B4%E6%97%A9%E7%9A%84%E4%BD%8D%E7%BD%AE%0A%7D%0A%7D%0A%2F%2F%20%E7%AC%AC%E5%9B%9B%E6%AD%A5%EF%BC%9A%E6%8F%90%E5%8F%96%E5%B9%B6%E9%AA%8C%E8%AF%81%E5%86%85%E5%AE%B9%0Aconst%20extractedContent%20%3D%20content.substring(contentStart%2C%20endIndex).trim()%3B%0A%2F%2F%20%E5%86%85%E5%AE%B9%E8%B4%A8%E9%87%8F%E6%A3%80%E6%9F%A5%EF%BC%9A%E9%95%BF%E5%BA%A6%E8%87%B3%E5%B0%915%E4%B8%AA%E5%AD%97%E7%AC%A6%E6%89%8D%E8%A2%AB%E8%AE%A4%E4%B8%BA%E6%98%AF%E6%9C%89%E6%95%88%E5%86%85%E5%AE%B9%0Areturn%20extractedContent.length%20%3E%3D%205%20%3F%20extractedContent%20%3A%20null%3B%0A%7D\"\u003e\n                \u003cdiv class=\"codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700\"\u003e\n                    \u003cspan class=\"codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline\"\u003ejavascript\u003c/span\u003e\n                    \u003cbutton class=\"codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95\" title=\"复制代码\"\u003e\n                        \u003csvg class=\"copy-icon w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" /\u003e\n                            \u003cpath d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" /\u003e\n                        \u003c/svg\u003e\n                        \u003csvg class=\"copied-icon w-4 h-4 hidden\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                            \u003cpath fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\" /\u003e\n                        \u003c/svg\u003e\n                        \u003cspan class=\"copy-text inline\"\u003e复制\u003c/span\u003e\n                    \u003c/button\u003e\n                \u003c/div\u003e\n                \u003cpre class=\"codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-comment inline\"\u003e// ==================== 内容清理算法 ====================\u003c/span\u003e\n\u003cspan class=\"hljs-title function_ inline\"\u003ecleanResponseContent\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003econtent\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (!content) \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-keyword inline\"\u003elet\u003c/span\u003e cleaned = content;\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 第一步：移除AI生成的元标记\u003c/span\u003e\n    cleaned = cleaned.\u003cspan class=\"hljs-title function_ inline\"\u003ereplace\u003c/span\u003e(\u003cspan class=\"hljs-regexp inline\"\u003e/\\(Parsing required\\)/gi\u003c/span\u003e, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 第二步：标准化空白字符，保持结构完整性\u003c/span\u003e\n    cleaned = cleaned.\u003cspan class=\"hljs-title function_ inline\"\u003ereplace\u003c/span\u003e(\u003cspan class=\"hljs-regexp inline\"\u003e/\\n{3,}/g\u003c/span\u003e, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\\n\\n\u0026#x27;\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 第三步：清理每行的边缘空白，但保持整体布局\u003c/span\u003e\n    cleaned = cleaned.\u003cspan class=\"hljs-title function_ inline\"\u003esplit\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\\n\u0026#x27;\u003c/span\u003e)\n        .\u003cspan class=\"hljs-title function_ inline\"\u003emap\u003c/span\u003e(\u003cspan class=\"hljs-function inline\"\u003e\u003cspan class=\"hljs-params inline\"\u003eline\u003c/span\u003e =\u0026gt;\u003c/span\u003e line.\u003cspan class=\"hljs-title function_ inline\"\u003etrim\u003c/span\u003e())\n        .\u003cspan class=\"hljs-title function_ inline\"\u003ejoin\u003c/span\u003e(\u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\\n\u0026#x27;\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 第四步：移除可能干扰解析的markdown元素\u003c/span\u003e\n    cleaned = cleaned.\u003cspan class=\"hljs-title function_ inline\"\u003ereplace\u003c/span\u003e(\u003cspan class=\"hljs-regexp inline\"\u003e/```[\\s\\S]*?```/g\u003c/span\u003e, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e);\n    cleaned = cleaned.\u003cspan class=\"hljs-title function_ inline\"\u003ereplace\u003c/span\u003e(\u003cspan class=\"hljs-regexp inline\"\u003e/^\\s*#{1,6}\\s*/gm\u003c/span\u003e, \u003cspan class=\"hljs-string inline\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e cleaned.\u003cspan class=\"hljs-title function_ inline\"\u003etrim\u003c/span\u003e();\n}\n\n\u003cspan class=\"hljs-comment inline\"\u003e// ==================== 标记提取算法 ====================\u003c/span\u003e\n\u003cspan class=\"hljs-title function_ inline\"\u003eextractSection\u003c/span\u003e(\u003cspan class=\"hljs-params inline\"\u003econtent, startMarker, endMarkers = []\u003c/span\u003e) {\n    \u003cspan class=\"hljs-comment inline\"\u003e// 第一步：定位起始标记\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e startIndex = content.\u003cspan class=\"hljs-title function_ inline\"\u003eindexOf\u003c/span\u003e(startMarker);\n    \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (startIndex === -\u003cspan class=\"hljs-number inline\"\u003e1\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal inline\"\u003enull\u003c/span\u003e; \u003cspan class=\"hljs-comment inline\"\u003e// 标记未找到，返回null而非抛出异常\u003c/span\u003e\n    }\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 第二步：计算内容起始位置\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e contentStart = startIndex + startMarker.\u003cspan class=\"hljs-property inline\"\u003elength\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 第三步：寻找最近的结束标记（贪婪算法）\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003elet\u003c/span\u003e endIndex = content.\u003cspan class=\"hljs-property inline\"\u003elength\u003c/span\u003e; \u003cspan class=\"hljs-comment inline\"\u003e// 默认到内容结尾\u003c/span\u003e\n\n    \u003cspan class=\"hljs-keyword inline\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e endMarker \u003cspan class=\"hljs-keyword inline\"\u003eof\u003c/span\u003e endMarkers) {\n        \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e markerIndex = content.\u003cspan class=\"hljs-title function_ inline\"\u003eindexOf\u003c/span\u003e(endMarker, contentStart);\n        \u003cspan class=\"hljs-keyword inline\"\u003eif\u003c/span\u003e (markerIndex !== -\u003cspan class=\"hljs-number inline\"\u003e1\u003c/span\u003e \u0026amp;\u0026amp; markerIndex \u0026lt; endIndex) {\n            endIndex = markerIndex;  \u003cspan class=\"hljs-comment inline\"\u003e// 更新为更早的位置\u003c/span\u003e\n        }\n    }\n\n    \u003cspan class=\"hljs-comment inline\"\u003e// 第四步：提取并验证内容\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003econst\u003c/span\u003e extractedContent = content.\u003cspan class=\"hljs-title function_ inline\"\u003esubstring\u003c/span\u003e(contentStart, endIndex).\u003cspan class=\"hljs-title function_ inline\"\u003etrim\u003c/span\u003e();\n    \n    \u003cspan class=\"hljs-comment inline\"\u003e// 内容质量检查：长度至少5个字符才被认为是有效内容\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword inline\"\u003ereturn\u003c/span\u003e extractedContent.\u003cspan class=\"hljs-property inline\"\u003elength\u003c/span\u003e \u0026gt;= \u003cspan class=\"hljs-number inline\"\u003e5\u003c/span\u003e ? extractedContent : \u003cspan class=\"hljs-literal inline\"\u003enull\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\n            \u003c/div\u003e\n        \n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e提取算法的时间复杂度分析\u003c/strong\u003e：\u003c/p\u003e\n\u003cul class=\"list-disc list-inside mb-4 pl-6 space-y-2\"\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e最好情况\u003c/strong\u003e：O(n)，其中n是内容长度（只需要扫描一次）\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e最坏情况\u003c/strong\u003e：O(n × m)，其中m是结束标记数量\u003c/li\u003e\n\u003cli class=\"text-foreground leading-relaxed\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e平均情况\u003c/strong\u003e：O(n)，因为通常第一个标记就能匹配\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e空间复杂度\u003c/strong\u003e：O(1)，只使用常量级别的额外空间\u003c/p\u003e\n\u003ch2 id=\"写在最后\" class=\"group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight\"\u003e\n            \u003ca href=\"#写在最后\" class=\"absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary\" aria-label=\"Link to 写在最后\"\u003e\n                \u003csvg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\"\u003e\n                    \u003cpath fill-rule=\"evenodd\" d=\"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z\" clip-rule=\"evenodd\" /\u003e\n                \u003c/svg\u003e\n            \u003c/a\u003e\n            写在最后\n        \u003c/h2\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e如你所见，实际上MCP的原始设计思路就是这么朴实无华。与AI约定一套数据交互格式，并让其它应用读取这套格式，从而理解AI的输出，最终实现\u0026quot;AI调用外部工具\u0026quot;的效果。\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e经过这次完整的源码解析，我们看到了一个看似简单的提示词管理系统背后的精妙设计：从单例模式的内存优化，到Map缓存的性能提升，从降级策略的服务可用性，到防御性编程的健壮性保障。\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cstrong class=\"font-bold text-foreground\"\u003e每一行代码都不是偶然的，每一个设计决策都有其深刻的考量。\u003c/strong\u003e\u003c/p\u003e\n\u003cp class=\"text-base leading-7 mb-4 text-foreground\"\u003e\u003cem class=\"italic text-foreground\"\u003e愿你的提示词如春风化雨，让AI理解你的每一个意图；愿你的解析算法如庖丁解牛，将复杂的响应化为清晰的结构。在这个AI与人类智慧交融的时代，让我们一起用代码编织更美好的明天！\u003c/em\u003e ✨\u003c/p\u003e\n"])</script><script>self.__next_f.push([1,"d:[\"$\",\"$L1d\",null,{\"htmlContent\":\"$1e\",\"frontMatter\":{\"title\":\"提示词炼金术：从模板到智能的语言解析之旅\",\"description\":\"深度解析AI服务中提示词加载、结构化解析、缓存优化与容错机制的完整实现原理\",\"date\":\"2025-06-22\",\"author\":\"MilkWind\",\"tags\":[\"AI\"],\"references\":{}},\"readingTime\":\"24 min read\",\"category\":\"questions-party\",\"tocItems\":[{\"id\":\"提示词生成与响应解析：另一种机器语言的诞生\",\"text\":\"提示词生成与响应解析：另一种机器语言的诞生\",\"level\":1},{\"id\":\"promptloader核心架构\",\"text\":\"PromptLoader核心架构\",\"level\":2},{\"id\":\"单例模式设计\",\"text\":\"单例模式设计\",\"level\":3},{\"id\":\"map缓存\",\"text\":\"Map缓存\",\"level\":3},{\"id\":\"loadprompt函数\",\"text\":\"loadPrompt函数\",\"level\":2},{\"id\":\"缓存优先策略\",\"text\":\"缓存优先策略\",\"level\":3},{\"id\":\"文件系统的安全操作\",\"text\":\"文件系统的安全操作\",\"level\":3},{\"id\":\"提示词加载降级处理\",\"text\":\"提示词加载降级处理\",\"level\":3},{\"id\":\"提示词结构化设计\",\"text\":\"提示词结构化设计\",\"level\":2},{\"id\":\"combined-vs-pure：双语教学\",\"text\":\"Combined vs Pure：双语教学\",\"level\":3},{\"id\":\"缓存机制与性能优化\",\"text\":\"缓存机制与性能优化\",\"level\":2},{\"id\":\"map-vs-object的性能对比\",\"text\":\"Map vs Object的性能对比\",\"level\":3},{\"id\":\"降级策略的容错设计\",\"text\":\"降级策略的容错设计\",\"level\":2},{\"id\":\"pure-→-combined的降级逻辑\",\"text\":\"Pure → Combined的降级逻辑\",\"level\":3},{\"id\":\"系统健壮性保障\",\"text\":\"系统健壮性保障\",\"level\":3},{\"id\":\"parsesentencecheckresponse深度剖析\",\"text\":\"parseSentenceCheckResponse深度剖析\",\"level\":2},{\"id\":\"标记化响应格式的设计\",\"text\":\"标记化响应格式的设计\",\"level\":3},{\"id\":\"鲁棒性解析算法\",\"text\":\"鲁棒性解析算法\",\"level\":3},{\"id\":\"部分解析的容错机制\",\"text\":\"部分解析的容错机制\",\"level\":3},{\"id\":\"parsestructuredresponse结构化解析\",\"text\":\"parseStructuredResponse结构化解析\",\"level\":2},{\"id\":\"结构化标记的提取逻辑\",\"text\":\"结构化标记的提取逻辑\",\"level\":3},{\"id\":\"响应验证机制\",\"text\":\"响应验证机制\",\"level\":3},{\"id\":\"数据清洗和格式化\",\"text\":\"数据清洗和格式化\",\"level\":3},{\"id\":\"完整解析流程的架构设计\",\"text\":\"完整解析流程的架构设计\",\"level\":2},{\"id\":\"从模板加载到响应解析的生命周期\",\"text\":\"从模板加载到响应解析的生命周期\",\"level\":3},{\"id\":\"数据流向和状态管理\",\"text\":\"数据流向和状态管理\",\"level\":3},{\"id\":\"系统架构图与技术要点总结\",\"text\":\"系统架构图与技术要点总结\",\"level\":2},{\"id\":\"完整的系统架构流程图\",\"text\":\"完整的系统架构流程图\",\"level\":3},{\"id\":\"完整源码全解析\",\"text\":\"完整源码全解析\",\"level\":2},{\"id\":\"promptloader完整源码解析\",\"text\":\"PromptLoader完整源码解析\",\"level\":3},{\"id\":\"响应解析核心算法解析\",\"text\":\"响应解析核心算法解析\",\"level\":3},{\"id\":\"写在最后\",\"text\":\"写在最后\",\"level\":2}],\"translations\":{\"common\":{\"welcome\":\"欢迎\",\"loading\":\"加载中...\",\"error\":\"出现了一些问题\",\"retry\":\"重试\",\"theme\":\"主题\",\"language\":\"语言\",\"light\":\"浅色\",\"dark\":\"深色\"},\"navigation\":{\"home\":\"首页\",\"personal\":\"个人\",\"works\":\"作品\",\"contributions\":\"贡献\",\"documents\":\"文档\",\"about\":\"关于\",\"contact\":\"联系\"},\"personal\":{\"technicalSkills\":\"技术技能\",\"email\":\"邮箱\",\"github\":\"代码仓库\",\"resume\":\"简历\",\"codeRepository\":\"代码仓库\",\"loadingPersonalInfo\":\"加载个人信息中...\",\"loadingResume\":\"加载简历中...\",\"closeResume\":\"关闭简历\",\"emailCopied\":\"邮箱已复制到剪贴板！\",\"galaxyDefaultDescription\":\"精通全栈开发技术，具备跨平台架构能力，擅长AI技术整合与高性能系统优化\",\"skillGalaxy\":\"技能星系\",\"stirGalaxy\":\"搅动星系\",\"stirring\":\"搅动中...\",\"fullStackEngineer\":\"MilkWind - 全栈工程师\",\"professionalProfile\":\"关于我\"},\"documents\":{\"technicalDocuments\":\"技术文档\",\"description\":\"基本原理、代码拆分以及一些碎碎念。\",\"articles\":\"文章\",\"categories\":\"分类\",\"allCategories\":\"所有分类\",\"noArticlesFound\":\"未找到文章\",\"noArticlesAvailable\":\"中文暂无文章。\",\"noArticlesInCategory\":\"该分类下未找到文章。\",\"readMore\":\"阅读更多\",\"loadingDocuments\":\"加载文档中...\",\"backToDocuments\":\"← 返回文档\",\"documentNotFound\":\"文档未找到\",\"documentNotFoundDescription\":\"请求的文档无法找到。\",\"technicalInsights\":\"技术拆解\",\"untitledDocument\":\"无标题文档\",\"byAuthor\":\"作者：\",\"search\":\"搜索文章...\",\"searchByTags\":\"按标签筛选\",\"searching\":\"搜索中...\",\"noSearchResults\":\"没有找到符合搜索条件的文章\",\"clearSearch\":\"清除搜索\",\"selectedTags\":\"已选标签\",\"allTags\":\"所有标签\",\"searchInTitle\":\"在标题、描述和内容中搜索\",\"enterImmersiveMode\":\"沉浸阅读\",\"exitImmersiveMode\":\"退出沉浸模式\",\"immersiveReading\":\"沉浸阅读模式\",\"exploreContent\":\"按分类探索内容\",\"browseBy\":\"浏览方式\",\"exploreAll\":\"所有内容汇总\",\"categoryDescription\":\"该分类下的文章\",\"totalArticles\":\"文章\",\"totalCategories\":\"分类\",\"foundArticles\":\"找到文章\",\"categoriesWithResults\":\"有结果的分类\"},\"works\":{\"workCases\":\"作品案例\",\"projects\":\"作品集\",\"loadingProjects\":\"加载项目中...\",\"grid\":\"网格\",\"stack\":\"堆叠\",\"of\":\"共\",\"workCasesPageTitle\":\"作品案例页面\",\"pageWorkingCorrectly\":\"此页面运行正常！路由配置正确。\",\"try3DVersion\":\"尝试3D版本\",\"dragToScroll\":\"拖拽滚动\",\"dragToChange\":\"拖拽切换\",\"swipeCards\":\"切换卡片\",\"keyboardNav\":\"键盘导航\"},\"contributions\":{\"contributionCases\":\"开源项目\",\"contributions\":\"贡献\",\"loadingContributions\":\"加载贡献中...\",\"grid\":\"网格\",\"stack\":\"堆叠\",\"of\":\"共\",\"contributionCasesPageTitle\":\"贡献案例页面\",\"pageWorkingCorrectly\":\"此页面运行正常！路由配置正确。\",\"try3DVersion\":\"尝试3D版本\",\"dragToScroll\":\"拖拽滚动\",\"dragToChange\":\"拖拽切换\",\"swipeCards\":\"切换卡片\",\"keyboardNav\":\"键盘导航\"},\"contribution\":{\"contributionPreview\":\"贡献预览\",\"accessible\":\"可访问\",\"code\":\"代码\",\"maintenance\":\"维护\",\"enhancement\":\"增强\",\"documentation\":\"文档\",\"community\":\"社区\",\"moreItems\":\"更多\",\"technicalDetails\":\"技术详情\",\"technologies\":\"技术栈：\",\"contributionDetail\":\"贡献详情\",\"description\":\"描述：\",\"seeDetails\":\"查看详情\",\"github\":\"代码仓库\",\"viewContribution\":\"查看贡献\",\"viewCode\":\"查看代码\"},\"project\":{\"projectPreview\":\"项目预览\",\"accessible\":\"可访问\",\"tool\":\"工具\",\"plugin\":\"插件\",\"toy\":\"小玩意\",\"moreItems\":\"更多\",\"technicalDetails\":\"技术详情\",\"technologies\":\"技术栈：\",\"description\":\"描述：\",\"seeDetails\":\"查看详情\",\"github\":\"GitHub\",\"gitee\":\"Gitee\",\"viewLiveDemo\":\"查看演示\",\"viewCode\":\"查看代码\",\"access\":\"访问\",\"videos\":\"视频\",\"watchVideo\":\"观看视频\",\"hasVideo\":\"有视频\"},\"codeblock\":{\"copy\":\"复制\",\"copySuccess\":\"代码已复制到剪贴板！\",\"copyError\":\"复制代码失败\",\"copyTooltip\":\"复制代码\"},\"toc\":{\"contents\":\"目录\",\"autoScroll\":\"自动滚动到章节\",\"collapse\":\"折叠\",\"expand\":\"展开\"},\"loading\":{\"loading\":\"加载中\",\"preparingExperience\":\"准备体验中\"}},\"lang\":\"zh\",\"theme\":\"dark\"}]\n"])</script><script>self.__next_f.push([1,"12:null\n"])</script><script>self.__next_f.push([1,"18:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n11:null\n"])</script><script>self.__next_f.push([1,"1c:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"提示词炼金术：从模板到智能的语言解析之旅 | Interactive Portfolio\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"深度解析AI服务中提示词加载、结构化解析、缓存优化与容错机制的完整实现原理\"}],[\"$\",\"meta\",\"2\",{\"name\":\"author\",\"content\":\"Developer\"}],[\"$\",\"meta\",\"3\",{\"name\":\"keywords\",\"content\":\"portfolio,3D,interactive,web development,Three.js,Next.js\"}],[\"$\",\"meta\",\"4\",{\"property\":\"og:title\",\"content\":\"提示词炼金术：从模板到智能的语言解析之旅 | Interactive Portfolio\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:description\",\"content\":\"深度解析AI服务中提示词加载、结构化解析、缓存优化与容错机制的完整实现原理\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"7\",{\"property\":\"article:published_time\",\"content\":\"2025-06-22\"}],[\"$\",\"meta\",\"8\",{\"property\":\"article:tag\",\"content\":\"AI\"}],[\"$\",\"meta\",\"9\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"10\",{\"name\":\"twitter:title\",\"content\":\"提示词炼金术：从模板到智能的语言解析之旅 | Interactive Portfolio\"}],[\"$\",\"meta\",\"11\",{\"name\":\"twitter:description\",\"content\":\"深度解析AI服务中提示词加载、结构化解析、缓存优化与容错机制的完整实现原理\"}],[\"$\",\"link\",\"12\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"32x32\"}]],\"error\":null,\"digest\":\"$undefined\"}\n14:{\"metadata\":\"$1c:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script></body></html>