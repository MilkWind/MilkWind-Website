1:"$Sreact.fragment"
2:I[38735,["46","static/chunks/46-268e24d727b280ef.js","7177","static/chunks/app/layout-af4a6e723c0ff668.js"],"default"]
3:I[19945,["46","static/chunks/46-268e24d727b280ef.js","7177","static/chunks/app/layout-af4a6e723c0ff668.js"],"default"]
4:I[65337,["46","static/chunks/46-268e24d727b280ef.js","7177","static/chunks/app/layout-af4a6e723c0ff668.js"],"default"]
5:I[96190,["46","static/chunks/46-268e24d727b280ef.js","7177","static/chunks/app/layout-af4a6e723c0ff668.js"],"ClientProviders"]
6:I[87555,[],""]
7:I[51901,["8039","static/chunks/app/error-dda32be1d095a86c.js"],"default"]
8:I[31295,[],""]
9:I[6874,["6874","static/chunks/6874-fbe9a08eb79b991c.js","4345","static/chunks/app/not-found-9ff98b2ccf24cac7.js"],""]
a:I[94970,[],"ClientSegmentRoot"]
b:I[44065,["206","static/chunks/206-4f4cbf4d7156f437.js","3092","static/chunks/app/documents/layout-28408791defde09e.js"],"default"]
e:I[59665,[],"MetadataBoundary"]
10:I[59665,[],"OutletBoundary"]
13:I[74911,[],"AsyncMetadataOutlet"]
15:I[39460,["2415","static/chunks/2415-689c103fb3d2c28d.js","8610","static/chunks/8610-7bd3f91f3cf2a4d6.js","5650","static/chunks/app/documents/loading-1fa3f98b6e5a8e78.js"],"default"]
16:I[88610,["2415","static/chunks/2415-689c103fb3d2c28d.js","8610","static/chunks/8610-7bd3f91f3cf2a4d6.js","4209","static/chunks/app/loading-68f227fb49b3ac8c.js"],"default"]
17:I[59665,[],"ViewportBoundary"]
19:I[26614,[],""]
:HL["/MilkWind-Website/_next/static/css/f034c804622acb16.css","style"]
:HL["/MilkWind-Website/_next/static/css/276b387d8ca46690.css","style"]
:HL["/MilkWind-Website/_next/static/css/5eacd01f773eed7f.css","style"]
0:{"P":null,"b":"ARIfyKTG2kypPJcFndv6Z","p":"/MilkWind-Website","c":["","documents","en","light","all-chat-on-this","metrics",""],"i":false,"f":[[["",{"children":["documents",{"children":[["slug","en/light/all-chat-on-this/metrics","c"],{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/MilkWind-Website/_next/static/css/f034c804622acb16.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}],["$","link","1",{"rel":"stylesheet","href":"/MilkWind-Website/_next/static/css/276b387d8ca46690.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","suppressHydrationWarning":true,"children":["$","body",null,{"className":"__variable_9b7fb1 __variable_ca2a15 __variable_591dcc font-sans antialiased min-h-screen bg-background text-foreground","suppressHydrationWarning":true,"children":[["$","$L2",null,{}],["$","$L3",null,{}],["$","$L4",null,{}],["$","$L5",null,{"children":["$","$L6",null,{"parallelRouterKey":"children","error":"$7","errorStyles":[],"errorScripts":[],"template":["$","$L8",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","div",null,{"className":"z-10 relative min-h-screen flex items-center justify-center bg-background p-8","children":["$","div",null,{"className":"text-center max-w-md","children":[["$","div",null,{"className":"text-8xl font-bold text-primary mb-4","children":"404"}],["$","h2",null,{"className":"text-2xl font-bold text-foreground mb-4","children":"Page Not Found"}],["$","p",null,{"className":"text-foreground/70 mb-8","children":"The page you're looking for doesn't exist or has been moved to a different location."}],["$","div",null,{"className":"flex flex-col sm:flex-row gap-4 justify-center","children":[["$","$L9",null,{"href":"/","className":"px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary/80 transition-colors","children":"Go Home"}],["$","$L9",null,{"href":"/works","className":"px-6 py-2 border border-primary text-primary rounded-lg hover:bg-primary/10 transition-colors","children":"View Works"}]]}],["$","div",null,{"className":"absolute inset-0 overflow-hidden pointer-events-none -z-10","children":[["$","div",null,{"className":"absolute top-1/4 left-1/4 w-2 h-2 bg-primary/20 rounded-full animate-float"}],["$","div",null,{"className":"absolute top-3/4 right-1/4 w-3 h-3 bg-accent/20 rounded-full animate-float","style":{"animationDelay":"1s"}}],["$","div",null,{"className":"absolute bottom-1/4 left-1/3 w-1 h-1 bg-secondary/20 rounded-full animate-float","style":{"animationDelay":"2s"}}]]}]]}]}],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]}]]}]}]]}],{"children":["documents",["$","$1","c",{"children":[null,["$","$La",null,{"Component":"$b","slots":{"children":["$","$L6",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L8",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]},"params":{},"promise":"$@c"}]]}],{"children":[["slug","en/light/all-chat-on-this/metrics","c"],["$","$1","c",{"children":[null,["$","$L6",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L8",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":["$Ld",["$","$Le",null,{"children":"$Lf"}],[["$","link","0",{"rel":"stylesheet","href":"/MilkWind-Website/_next/static/css/5eacd01f773eed7f.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","$L10",null,{"children":["$L11","$L12",["$","$L13",null,{"promise":"$@14"}]]}]]}],{},null,false]},null,false]},[["$","$L15","l",{}],[],[]],false]},[["$","$L16","l",{}],[],[]],false],["$","$1","h",{"children":[null,["$","$1","iH37RLS5Ie1pDPfblc3-U",{"children":[["$","$L17",null,{"children":"$L18"}],null]}],null]}],false]],"m":"$undefined","G":["$19","$undefined"],"s":false,"S":true}
1a:"$Sreact.suspense"
1b:I[74911,[],"AsyncMetadata"]
c:{}
f:["$","$1a",null,{"fallback":null,"children":["$","$L1b",null,{"promise":"$@1c"}]}]
1d:I[57340,["5584","static/chunks/b498d07c-095637f0f10883c6.js","2415","static/chunks/2415-689c103fb3d2c28d.js","6874","static/chunks/6874-fbe9a08eb79b991c.js","9554","static/chunks/9554-b714f9de28e85d30.js","1873","static/chunks/app/documents/%5B...slug%5D/page-8f3efa7e6c6c5377.js"],"DocumentPageClient"]
1e:T27d02,<h1 id="all-chat-on-this-endpoint-monitoring-and-exposure-implementation-from-aop-aspects-to-prometheus-monitoring-ecosystem" class="group relative text-4xl font-bold mt-8 mb-4 text-foreground leading-tight">
            <a href="#all-chat-on-this-endpoint-monitoring-and-exposure-implementation-from-aop-aspects-to-prometheus-monitoring-ecosystem" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to All-Chat-on-This Endpoint Monitoring and Exposure Implementation: From AOP Aspects to Prometheus Monitoring Ecosystem">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            All-Chat-on-This Endpoint Monitoring and Exposure Implementation: From AOP Aspects to Prometheus Monitoring Ecosystem
        </h1>
<p class="text-base leading-7 mb-4 text-foreground">“Let me see what users are doing” (Let me access!)</p>
<p class="text-base leading-7 mb-4 text-foreground">ACOT’s monitoring system design is relatively simple, currently only monitoring interface call counts and online users, but we can see the complete monitoring ecosystem process from data collection to visualization display through this simple application.</p>
<h2 id="monitoring-architecture-four-tier-separation-design" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#monitoring-architecture-four-tier-separation-design" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Monitoring Architecture: Four-Tier Separation Design">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Monitoring Architecture: Four-Tier Separation Design
        </h2>
<h3 id="layered-architecture-overview-data-flow-lifecycle" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#layered-architecture-overview-data-flow-lifecycle" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Layered Architecture Overview: Data Flow Lifecycle">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Layered Architecture Overview: Data Flow Lifecycle
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">ACOT’s monitoring system adopts a typical <strong class="font-bold text-foreground">four-tier separation architecture</strong>, where each layer has its unique responsibilities and technology selection:</p>
<div class="mermaid block" id="mermaid-1767322171915-seykyz9">graph TB
    A[Data Collection Layer] --> B[Metric Storage Layer]
    B --> C[Data Exposure Layer]
    C --> D[Monitoring Visualization Layer]
    
    A1[AOP Aspect Interception] --> A
    A2[Spring Security Events] --> A
    A3[HTTP Session Monitoring] --> A
    
    B1[Micrometer Core] --> B
    B2[Counter] --> B
    B3[Gauge] --> B
    
    C1[Spring Boot Actuator] --> C
    C2[Actuator Prometheus] --> C
    C3[Actuator Metrics] --> C
    
    D1[Prometheus Time Series Database] --> D
    D2[Grafana Visualization] --> D
    D3[Alert System] --> D</div>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">Why Layered Architecture?</strong></p>
<p class="text-base leading-7 mb-4 text-foreground">This layered design follows the principle of <strong class="font-bold text-foreground">separation of concerns</strong>:</p>
<p class="text-base leading-7 mb-4 text-foreground"><span class="katex-display inline"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>M</mi><mi>o</mi><mi>n</mi><mi>i</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>S</mi><mi>y</mi><mi>s</mi><mi>t</mi><mi>e</mi><mi>m</mi><mo>=</mo><mi>D</mi><mi>a</mi><mi>t</mi><mi>a</mi><mi>C</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>⊕</mo><mi>M</mi><mi>e</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>c</mi><mi>S</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>a</mi><mi>g</mi><mi>e</mi><mo>⊕</mo><mi>D</mi><mi>a</mi><mi>t</mi><mi>a</mi><mi>E</mi><mi>x</mi><mi>p</mi><mi>o</mi><mi>s</mi><mi>u</mi><mi>r</mi><mi>e</mi><mo>⊕</mo><mi>V</mi><mi>i</mi><mi>s</mi><mi>u</mi><mi>a</mi><mi>l</mi><mi>i</mi><mi>z</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>D</mi><mi>i</mi><mi>s</mi><mi>p</mi><mi>l</mi><mi>a</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">Monitoring System = Data Collection \oplus Metric Storage \oplus Data Exposure \oplus Visualization Display</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal inline" style="margin-right:0.10903em;">M</span><span class="mord mathnormal inline">o</span><span class="mord mathnormal inline">ni</span><span class="mord mathnormal inline">t</span><span class="mord mathnormal inline" style="margin-right:0.02778em;">or</span><span class="mord mathnormal inline">in</span><span class="mord mathnormal inline" style="margin-right:0.03588em;">g</span><span class="mord mathnormal inline" style="margin-right:0.05764em;">S</span><span class="mord mathnormal inline">ys</span><span class="mord mathnormal inline">t</span><span class="mord mathnormal inline">e</span><span class="mord mathnormal inline">m</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal inline" style="margin-right:0.02778em;">D</span><span class="mord mathnormal inline">a</span><span class="mord mathnormal inline">t</span><span class="mord mathnormal inline">a</span><span class="mord mathnormal inline" style="margin-right:0.07153em;">C</span><span class="mord mathnormal inline">o</span><span class="mord mathnormal inline" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal inline">ec</span><span class="mord mathnormal inline">t</span><span class="mord mathnormal inline">i</span><span class="mord mathnormal inline">o</span><span class="mord mathnormal inline">n</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">⊕</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal inline" style="margin-right:0.10903em;">M</span><span class="mord mathnormal inline">e</span><span class="mord mathnormal inline">t</span><span class="mord mathnormal inline" style="margin-right:0.02778em;">r</span><span class="mord mathnormal inline">i</span><span class="mord mathnormal inline">c</span><span class="mord mathnormal inline">St</span><span class="mord mathnormal inline" style="margin-right:0.02778em;">or</span><span class="mord mathnormal inline">a</span><span class="mord mathnormal inline" style="margin-right:0.03588em;">g</span><span class="mord mathnormal inline">e</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">⊕</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal inline" style="margin-right:0.02778em;">D</span><span class="mord mathnormal inline">a</span><span class="mord mathnormal inline">t</span><span class="mord mathnormal inline">a</span><span class="mord mathnormal inline" style="margin-right:0.05764em;">E</span><span class="mord mathnormal inline">x</span><span class="mord mathnormal inline">p</span><span class="mord mathnormal inline">os</span><span class="mord mathnormal inline">u</span><span class="mord mathnormal inline">re</span><span class="mspace inline" style="margin-right:0.2222em;"></span><span class="mbin inline">⊕</span><span class="mspace inline" style="margin-right:0.2222em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal inline">Vi</span><span class="mord mathnormal inline">s</span><span class="mord mathnormal inline">u</span><span class="mord mathnormal inline">a</span><span class="mord mathnormal inline" style="margin-right:0.01968em;">l</span><span class="mord mathnormal inline">i</span><span class="mord mathnormal inline" style="margin-right:0.04398em;">z</span><span class="mord mathnormal inline">a</span><span class="mord mathnormal inline">t</span><span class="mord mathnormal inline">i</span><span class="mord mathnormal inline">o</span><span class="mord mathnormal inline">n</span><span class="mord mathnormal inline" style="margin-right:0.02778em;">D</span><span class="mord mathnormal inline">i</span><span class="mord mathnormal inline">s</span><span class="mord mathnormal inline" style="margin-right:0.01968em;">pl</span><span class="mord mathnormal inline">a</span><span class="mord mathnormal inline" style="margin-right:0.03588em;">y</span></span></span></span></span></p>
<p class="text-base leading-7 mb-4 text-foreground">Each layer’s technology selection can evolve independently, such as:</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed">Data Collection Layer: Can switch from AOP to Filter or Interceptor</li>
<li class="text-foreground leading-relaxed">Metric Storage Layer: Can switch from Micrometer to other metric libraries</li>
<li class="text-foreground leading-relaxed">Data Exposure Layer: Can support multiple formats (Prometheus, JSON, XML, etc.)</li>
<li class="text-foreground leading-relaxed">Visualization Layer: Can switch from Grafana to other monitoring platforms</li>
</ul>
<h2 id="core-principles-of-endpoint-monitoring-aop" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#core-principles-of-endpoint-monitoring-aop" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Core Principles of Endpoint Monitoring: AOP">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Core Principles of Endpoint Monitoring: AOP
        </h2>
<h3 id="aop-aspect-oriented-programming-the-mysterious-enhancer" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#aop-aspect-oriented-programming-the-mysterious-enhancer" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to AOP Aspect-Oriented Programming: The Mysterious Enhancer">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            AOP Aspect-Oriented Programming: The Mysterious Enhancer
        </h3>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">What is AOP?</strong></p>
<p class="text-base leading-7 mb-4 text-foreground">AOP (Aspect-Oriented Programming) is programming that adds “enhancements” to methods without modifying original code.</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="java" data-code="%2F%2F%20Original%20business%20method%0Apublic%20String%20getUserInfo(Long%20userId)%20%7B%0Areturn%20userService.getUser(userId)%3B%0A%7D%0A%2F%2F%20Actual%20execution%20flow%20after%20AOP%20magic%0Apublic%20String%20getUserInfo(Long%20userId)%20%7B%0A%2F%2F%20%E2%86%93%20AOP%20Before%20Advice%3A%20Record%20call%20statistics%0AendpointMetrics.incrementEndpointCount(%22UserController%22%2C%20%22getUserInfo%22)%3B%0A%2F%2F%20%E2%86%93%20Original%20business%20logic%0AString%20result%20%3D%20userService.getUser(userId)%3B%0A%2F%2F%20%E2%86%93%20AOP%20After%20Advice%3A%20Record%20response%20time%2C%20exception%20handling%2C%20etc.%0Areturn%20result%3B%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">java</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-java"><span class="hljs-comment inline">// Original business method</span>
<span class="hljs-keyword inline">public</span> String <span class="hljs-title function_ inline">getUserInfo</span><span class="hljs-params inline">(Long userId)</span> {
    <span class="hljs-keyword inline">return</span> userService.getUser(userId);
}

<span class="hljs-comment inline">// Actual execution flow after AOP magic</span>
<span class="hljs-keyword inline">public</span> String <span class="hljs-title function_ inline">getUserInfo</span><span class="hljs-params inline">(Long userId)</span> {
    <span class="hljs-comment inline">// ↓ AOP Before Advice: Record call statistics</span>
    endpointMetrics.incrementEndpointCount(<span class="hljs-string inline">&quot;UserController&quot;</span>, <span class="hljs-string inline">&quot;getUserInfo&quot;</span>);
    
    <span class="hljs-comment inline">// ↓ Original business logic</span>
    <span class="hljs-type inline">String</span> <span class="hljs-variable inline">result</span> <span class="hljs-operator inline">=</span> userService.getUser(userId);
    
    <span class="hljs-comment inline">// ↓ AOP After Advice: Record response time, exception handling, etc.</span>
    <span class="hljs-keyword inline">return</span> result;
}
</code></pre>
            </div>
        
<h3 id="endpointmetricsaspect-aspect-interception" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#endpointmetricsaspect-aspect-interception" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to EndpointMetricsAspect: Aspect Interception">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            EndpointMetricsAspect: Aspect Interception
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="java" data-code="%40Aspect%0A%40Component%0A%40RequiredArgsConstructor%0A%40Slf4j%0Apublic%20class%20EndpointMetricsAspect%20%7B%0Aprivate%20final%20EndpointMetrics%20endpointMetrics%3B%0A%2F**%0A*%20Pointcut%20definition%3A%20Only%20intercept%20classes%20annotated%20with%20%40RestController%0A*%0A*%20Difference%20between%20%40within%20and%20%40target%3A%0A*%20-%20%40within%3A%20Class-level%20matching%2C%20determined%20at%20compile%20time%0A*%20-%20%40target%3A%20Object-level%20matching%2C%20determined%20at%20runtime%0A*%0A*%20Reason%20for%20choosing%20%40within%3A%20Better%20performance%2C%E5%88%87%E5%85%A5%E7%82%B9%20can%20be%20determined%20at%20compile%20time%0A*%2F%0A%40Pointcut(%22%40within(org.springframework.web.bind.annotation.RestController)%22)%0Apublic%20void%20controllerPointcut()%20%7B%0A%2F%2F%20Pointcut%20definition%20method%2C%20no%20implementation%20needed%0A%7D%0A%2F**%0A*%20Before%20Advice%3A%20Count%20calls%20before%20method%20execution%0A*%0A*%20Why%20choose%20%40Before%20instead%20of%20%40Around%3F%0A*%20-%20%40Before%3A%20Lightweight%2C%20only%20needs%20to%20record%20calls%0A*%20-%20%40Around%3A%20Heavyweight%2C%20needs%20to%20control%20method%20execution%20flow%0A*%2F%0A%40Before(%22controllerPointcut()%22)%0Apublic%20void%20beforeControllerMethod(JoinPoint%20joinPoint)%20%7B%0Atry%20%7B%0A%2F%2F%20Step%201%3A%20Get%20method%20signature%20information%0AMethodSignature%20signature%20%3D%20(MethodSignature)%20joinPoint.getSignature()%3B%0AMethod%20method%20%3D%20signature.getMethod()%3B%0AClass%20controllerClass%20%3D%20method.getDeclaringClass()%3B%0A%2F%2F%20Step%202%3A%20Extract%20class%20name%20and%20method%20name%0AString%20controllerName%20%3D%20controllerClass.getSimpleName()%3B%20%20%2F%2F%20UserController%0AString%20methodName%20%3D%20method.getName()%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20getUserInfo%0A%2F%2F%20Step%203%3A%20Verify%20if%20it's%20an%20HTTP%20endpoint%20(avoid%20intercepting%20internal%20methods)%0Aif%20(isHttpEndpoint(method))%20%7B%0A%2F%2F%20Step%204%3A%20Record%20endpoint%20call%20statistics%0AendpointMetrics.incrementEndpointCount(controllerName%2C%20methodName)%3B%0Alog.debug(%22Endpoint%20call%3A%20%7B%7D.%7B%7D%22%2C%20controllerName%2C%20methodName)%3B%0A%7D%0A%7D%20catch%20(Exception%20e)%20%7B%0A%2F%2F%20Key%20design%3A%20Exception%20isolation%2C%20monitoring%20failures%20should%20not%20affect%20business%0Alog.error(%22Endpoint%20metrics%20recording%20failed%22%2C%20e)%3B%0A%7D%0A%7D%0A%2F**%0A*%20HTTP%20endpoint%20identification%20algorithm%3A%20Supports%20all%20Spring%20Web%20annotations%0A*%0A*%20Why%20do%20we%20need%20this%20check%3F%0A*%20-%20%40RestController%20classes%20may%20have%20non-HTTP%20methods%20(like%20private%20helper%20methods)%0A*%20-%20Only%20real%20HTTP%20endpoints%20need%20to%20be%20counted%0A*%2F%0Aprivate%20boolean%20isHttpEndpoint(Method%20method)%20%7B%0Areturn%20method.isAnnotationPresent(RequestMapping.class)%20%7C%7C%20%20%20%20%20%20%2F%2F%20General%20mapping%0Amethod.isAnnotationPresent(GetMapping.class)%20%7C%7C%20%20%20%20%20%20%20%20%20%2F%2F%20GET%20request%0Amethod.isAnnotationPresent(PostMapping.class)%20%7C%7C%20%20%20%20%20%20%20%20%2F%2F%20POST%20request%0Amethod.isAnnotationPresent(PutMapping.class)%20%7C%7C%20%20%20%20%20%20%20%20%20%2F%2F%20PUT%20request%0Amethod.isAnnotationPresent(DeleteMapping.class)%20%7C%7C%20%20%20%20%20%20%2F%2F%20DELETE%20request%0Amethod.isAnnotationPresent(PatchMapping.class)%3B%20%20%20%20%20%20%20%20%20%2F%2F%20PATCH%20request%0A%7D%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">java</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-java"><span class="hljs-meta inline">@Aspect</span>
<span class="hljs-meta inline">@Component</span>
<span class="hljs-meta inline">@RequiredArgsConstructor</span>
<span class="hljs-meta inline">@Slf4j</span>
<span class="hljs-keyword inline">public</span> <span class="hljs-keyword inline">class</span> <span class="hljs-title class_ inline">EndpointMetricsAspect</span> {

    <span class="hljs-keyword inline">private</span> <span class="hljs-keyword inline">final</span> EndpointMetrics endpointMetrics;

    <span class="hljs-comment inline">/**
     * Pointcut definition: Only intercept classes annotated with <span class="hljs-doctag inline">@RestController</span>
     * 
     * Difference between <span class="hljs-doctag inline">@within</span> and <span class="hljs-doctag inline">@target</span>:
     * - <span class="hljs-doctag inline">@within</span>: Class-level matching, determined at compile time
     * - <span class="hljs-doctag inline">@target</span>: Object-level matching, determined at runtime
     * 
     * Reason for choosing <span class="hljs-doctag inline">@within</span>: Better performance,切入点 can be determined at compile time
     */</span>
    <span class="hljs-meta inline">@Pointcut(&quot;@within(org.springframework.web.bind.annotation.RestController)&quot;)</span>
    <span class="hljs-keyword inline">public</span> <span class="hljs-keyword inline">void</span> <span class="hljs-title function_ inline">controllerPointcut</span><span class="hljs-params inline">()</span> {
        <span class="hljs-comment inline">// Pointcut definition method, no implementation needed</span>
    }

    <span class="hljs-comment inline">/**
     * Before Advice: Count calls before method execution
     * 
     * Why choose <span class="hljs-doctag inline">@Before</span> instead of <span class="hljs-doctag inline">@Around</span>?
     * - <span class="hljs-doctag inline">@Before</span>: Lightweight, only needs to record calls
     * - <span class="hljs-doctag inline">@Around</span>: Heavyweight, needs to control method execution flow
     */</span>
    <span class="hljs-meta inline">@Before(&quot;controllerPointcut()&quot;)</span>
    <span class="hljs-keyword inline">public</span> <span class="hljs-keyword inline">void</span> <span class="hljs-title function_ inline">beforeControllerMethod</span><span class="hljs-params inline">(JoinPoint joinPoint)</span> {
        <span class="hljs-keyword inline">try</span> {
            <span class="hljs-comment inline">// Step 1: Get method signature information</span>
            <span class="hljs-type inline">MethodSignature</span> <span class="hljs-variable inline">signature</span> <span class="hljs-operator inline">=</span> (MethodSignature) joinPoint.getSignature();
            <span class="hljs-type inline">Method</span> <span class="hljs-variable inline">method</span> <span class="hljs-operator inline">=</span> signature.getMethod();
            Class&lt;?&gt; controllerClass = method.getDeclaringClass();
            
            <span class="hljs-comment inline">// Step 2: Extract class name and method name</span>
            <span class="hljs-type inline">String</span> <span class="hljs-variable inline">controllerName</span> <span class="hljs-operator inline">=</span> controllerClass.getSimpleName();  <span class="hljs-comment inline">// UserController</span>
            <span class="hljs-type inline">String</span> <span class="hljs-variable inline">methodName</span> <span class="hljs-operator inline">=</span> method.getName();                     <span class="hljs-comment inline">// getUserInfo</span>

            <span class="hljs-comment inline">// Step 3: Verify if it&#x27;s an HTTP endpoint (avoid intercepting internal methods)</span>
            <span class="hljs-keyword inline">if</span> (isHttpEndpoint(method)) {
                <span class="hljs-comment inline">// Step 4: Record endpoint call statistics</span>
                endpointMetrics.incrementEndpointCount(controllerName, methodName);
                log.debug(<span class="hljs-string inline">&quot;Endpoint call: {}.{}&quot;</span>, controllerName, methodName);
            }
        } <span class="hljs-keyword inline">catch</span> (Exception e) {
            <span class="hljs-comment inline">// Key design: Exception isolation, monitoring failures should not affect business</span>
            log.error(<span class="hljs-string inline">&quot;Endpoint metrics recording failed&quot;</span>, e);
        }
    }

    <span class="hljs-comment inline">/**
     * HTTP endpoint identification algorithm: Supports all Spring Web annotations
     * 
     * Why do we need this check?
     * - <span class="hljs-doctag inline">@RestController</span> classes may have non-HTTP methods (like private helper methods)
     * - Only real HTTP endpoints need to be counted
     */</span>
    <span class="hljs-keyword inline">private</span> <span class="hljs-type inline">boolean</span> <span class="hljs-title function_ inline">isHttpEndpoint</span><span class="hljs-params inline">(Method method)</span> {
        <span class="hljs-keyword inline">return</span> method.isAnnotationPresent(RequestMapping.class) ||      <span class="hljs-comment inline">// General mapping</span>
                method.isAnnotationPresent(GetMapping.class) ||         <span class="hljs-comment inline">// GET request</span>
                method.isAnnotationPresent(PostMapping.class) ||        <span class="hljs-comment inline">// POST request</span>
                method.isAnnotationPresent(PutMapping.class) ||         <span class="hljs-comment inline">// PUT request</span>
                method.isAnnotationPresent(DeleteMapping.class) ||      <span class="hljs-comment inline">// DELETE request</span>
                method.isAnnotationPresent(PatchMapping.class);         <span class="hljs-comment inline">// PATCH request</span>
    }
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">JoinPoint Information Extraction Chain:</strong></p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="java" data-code="%2F%2F%20Complete%20chain%20of%20JoinPoint%20information%20extraction%0AJoinPoint%20joinPoint%20%3D%20%2F%2F%20Injected%20by%20AOP%20framework%0A%E2%86%93%0AMethodSignature%20signature%20%3D%20(MethodSignature)%20joinPoint.getSignature()%3B%0A%E2%86%93%0AMethod%20method%20%3D%20signature.getMethod()%3B%20%20%2F%2F%20Get%20Method%20object%0A%E2%86%93%0AClass%20clazz%20%3D%20method.getDeclaringClass()%3B%20%20%2F%2F%20Get%20declaring%20class%0A%E2%86%93%0AString%20className%20%3D%20clazz.getSimpleName()%3B%20%20%20%20%20%2F%2F%20UserController%0AString%20methodName%20%3D%20method.getName()%3B%20%20%20%20%20%20%20%20%20%2F%2F%20getUserInfo">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">java</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-java"><span class="hljs-comment inline">// Complete chain of JoinPoint information extraction</span>
<span class="hljs-type inline">JoinPoint</span> <span class="hljs-variable inline">joinPoint</span> <span class="hljs-operator inline">=</span> <span class="hljs-comment inline">// Injected by AOP framework</span>
    ↓
<span class="hljs-type inline">MethodSignature</span> <span class="hljs-variable inline">signature</span> <span class="hljs-operator inline">=</span> (MethodSignature) joinPoint.getSignature();
    ↓
<span class="hljs-type inline">Method</span> <span class="hljs-variable inline">method</span> <span class="hljs-operator inline">=</span> signature.getMethod();  <span class="hljs-comment inline">// Get Method object</span>
    ↓
Class&lt;?&gt; clazz = method.getDeclaringClass();  <span class="hljs-comment inline">// Get declaring class</span>
    ↓
<span class="hljs-type inline">String</span> <span class="hljs-variable inline">className</span> <span class="hljs-operator inline">=</span> clazz.getSimpleName();     <span class="hljs-comment inline">// UserController</span>
<span class="hljs-type inline">String</span> <span class="hljs-variable inline">methodName</span> <span class="hljs-operator inline">=</span> method.getName();         <span class="hljs-comment inline">// getUserInfo</span>
</code></pre>
            </div>
        
<h3 id="thread-safe-counter-design-endpointmetrics-concurrency" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#thread-safe-counter-design-endpointmetrics-concurrency" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Thread-Safe Counter Design: EndpointMetrics Concurrency">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Thread-Safe Counter Design: EndpointMetrics Concurrency
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">How to ensure counter accuracy in high-concurrency environments? Let’s see the implementation——</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="java" data-code="%40Component%0Apublic%20class%20EndpointMetrics%20%7B%0A%2F%2F%20Core%20component%3A%20Micrometer's%20meter%20registry%0Aprivate%20final%20MeterRegistry%20meterRegistry%3B%0A%2F%2F%20Thread-safe%20counter%20cache%3A%20Avoid%20repeated%20Counter%20creation%0Aprivate%20final%20Map%20endpointCounters%20%3D%20new%20ConcurrentHashMap()%3B%0A%2F%2F%20Atomic%20operation%20for%20online%20user%20counter%0Aprivate%20final%20AtomicInteger%20onlineUsers%20%3D%20new%20AtomicInteger(0)%3B%0A%2F**%0A*%20Constructor%3A%20Register%20Gauge%20metric%20for%20online%20users%0A*%0A*%20Difference%20between%20Gauge%20and%20Counter%3A%0A*%20-%20Gauge%3A%20Instant%20value%20metric%2C%20such%20as%20current%20online%20users%2C%20memory%20usage%0A*%20-%20Counter%3A%20Cumulative%20metric%2C%20such%20as%20API%20call%20count%2C%20error%20count%0A*%2F%0Apublic%20EndpointMetrics(MeterRegistry%20meterRegistry)%20%7B%0Athis.meterRegistry%20%3D%20meterRegistry%3B%0A%2F%2F%20Register%20Gauge%3A%20Reflect%20real-time%20online%20users%0AGauge.builder(%22acot.online.users%22%2C%20onlineUsers%3A%3Aget)%20%20%2F%2F%20Reference%20atomic%20class's%20get%20method%0A.description(%22Current%20number%20of%20online%20users%22)%0A.register(meterRegistry)%3B%0A%7D%0A%2F**%0A*%20Increment%20endpoint%20call%20count%3A%20Core%20thread-safe%20algorithm%0A*%0A*%20%40param%20controllerName%20Controller%20name%0A*%20%40param%20methodName%20Method%20name%0A*%2F%0Apublic%20void%20incrementEndpointCount(String%20controllerName%2C%20String%20methodName)%20%7B%0A%2F%2F%20Construct%20endpoint%20identifier%0AString%20endpoint%20%3D%20controllerName%20%2B%20%22.%22%20%2B%20methodName%3B%0A%2F%2F%20Key%20algorithm%3A%20Atomic%20guarantee%20of%20computeIfAbsent%0ACounter%20counter%20%3D%20endpointCounters.computeIfAbsent(endpoint%2C%20k%20-%3E%0ACounter.builder(%22acot.endpoint.calls%22)%0A%2F%2F%20Multi-dimensional%20tags%3A%20Support%20complex%20Prometheus%20queries%0A.tags(Arrays.asList(%0ATag.of(%22controller%22%2C%20controllerName)%2C%20%20%2F%2F%20Group%20by%20controller%0ATag.of(%22method%22%2C%20methodName)))%20%20%20%20%20%20%20%20%20%2F%2F%20Group%20by%20method%0A.description(%22Endpoint%20call%20count%20statistics%22)%0A.register(meterRegistry))%3B%20%20%2F%2F%20Register%20with%20Micrometer%0A%2F%2F%20Atomic%20increment%20operation%0Acounter.increment()%3B%0A%7D%0A%2F**%0A*%20User%20login%3A%20Atomically%20increment%20online%20user%20count%0A*%2F%0Apublic%20void%20userLoggedIn()%20%7B%0AonlineUsers.incrementAndGet()%3B%20%20%2F%2F%20Atomic%20operation%3A%20current%20%2B%201%0A%7D%0A%2F**%0A*%20User%20logout%3A%20Atomically%20decrement%20with%20boundary%20check%0A*%2F%0Apublic%20void%20userLoggedOut()%20%7B%0A%2F%2F%20Atomic%20operation%20to%20prevent%20negative%20values%3A%20max(0%2C%20current%20-%201)%0AonlineUsers.updateAndGet(current%20-%3E%20Math.max(0%2C%20current%20-%201))%3B%0A%7D%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">java</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-java"><span class="hljs-meta inline">@Component</span>
<span class="hljs-keyword inline">public</span> <span class="hljs-keyword inline">class</span> <span class="hljs-title class_ inline">EndpointMetrics</span> {
    
    <span class="hljs-comment inline">// Core component: Micrometer&#x27;s meter registry</span>
    <span class="hljs-keyword inline">private</span> <span class="hljs-keyword inline">final</span> MeterRegistry meterRegistry;
    
    <span class="hljs-comment inline">// Thread-safe counter cache: Avoid repeated Counter creation</span>
    <span class="hljs-keyword inline">private</span> <span class="hljs-keyword inline">final</span> Map&lt;String, Counter&gt; endpointCounters = <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">ConcurrentHashMap</span>&lt;&gt;();
    
    <span class="hljs-comment inline">// Atomic operation for online user counter</span>
    <span class="hljs-keyword inline">private</span> <span class="hljs-keyword inline">final</span> <span class="hljs-type inline">AtomicInteger</span> <span class="hljs-variable inline">onlineUsers</span> <span class="hljs-operator inline">=</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">AtomicInteger</span>(<span class="hljs-number inline">0</span>);

    <span class="hljs-comment inline">/**
     * Constructor: Register Gauge metric for online users
     * 
     * Difference between Gauge and Counter:
     * - Gauge: Instant value metric, such as current online users, memory usage
     * - Counter: Cumulative metric, such as API call count, error count
     */</span>
    <span class="hljs-keyword inline">public</span> <span class="hljs-title function_ inline">EndpointMetrics</span><span class="hljs-params inline">(MeterRegistry meterRegistry)</span> {
        <span class="hljs-built_in inline">this</span>.meterRegistry = meterRegistry;
        
        <span class="hljs-comment inline">// Register Gauge: Reflect real-time online users</span>
        Gauge.builder(<span class="hljs-string inline">&quot;acot.online.users&quot;</span>, onlineUsers::get)  <span class="hljs-comment inline">// Reference atomic class&#x27;s get method</span>
                .description(<span class="hljs-string inline">&quot;Current number of online users&quot;</span>)
                .register(meterRegistry);
    }

    <span class="hljs-comment inline">/**
     * Increment endpoint call count: Core thread-safe algorithm
     * 
     * <span class="hljs-doctag inline">@param</span> controllerName Controller name
     * <span class="hljs-doctag inline">@param</span> methodName Method name
     */</span>
    <span class="hljs-keyword inline">public</span> <span class="hljs-keyword inline">void</span> <span class="hljs-title function_ inline">incrementEndpointCount</span><span class="hljs-params inline">(String controllerName, String methodName)</span> {
        <span class="hljs-comment inline">// Construct endpoint identifier</span>
        <span class="hljs-type inline">String</span> <span class="hljs-variable inline">endpoint</span> <span class="hljs-operator inline">=</span> controllerName + <span class="hljs-string inline">&quot;.&quot;</span> + methodName;
        
        <span class="hljs-comment inline">// Key algorithm: Atomic guarantee of computeIfAbsent</span>
        <span class="hljs-type inline">Counter</span> <span class="hljs-variable inline">counter</span> <span class="hljs-operator inline">=</span> endpointCounters.computeIfAbsent(endpoint, k -&gt;
                Counter.builder(<span class="hljs-string inline">&quot;acot.endpoint.calls&quot;</span>)
                        <span class="hljs-comment inline">// Multi-dimensional tags: Support complex Prometheus queries</span>
                        .tags(Arrays.asList(
                                Tag.of(<span class="hljs-string inline">&quot;controller&quot;</span>, controllerName),  <span class="hljs-comment inline">// Group by controller</span>
                                Tag.of(<span class="hljs-string inline">&quot;method&quot;</span>, methodName)))         <span class="hljs-comment inline">// Group by method</span>
                        .description(<span class="hljs-string inline">&quot;Endpoint call count statistics&quot;</span>)
                        .register(meterRegistry));  <span class="hljs-comment inline">// Register with Micrometer</span>
        
        <span class="hljs-comment inline">// Atomic increment operation</span>
        counter.increment();
    }

    <span class="hljs-comment inline">/**
     * User login: Atomically increment online user count
     */</span>
    <span class="hljs-keyword inline">public</span> <span class="hljs-keyword inline">void</span> <span class="hljs-title function_ inline">userLoggedIn</span><span class="hljs-params inline">()</span> {
        onlineUsers.incrementAndGet();  <span class="hljs-comment inline">// Atomic operation: current + 1</span>
    }

    <span class="hljs-comment inline">/**
     * User logout: Atomically decrement with boundary check
     */</span>
    <span class="hljs-keyword inline">public</span> <span class="hljs-keyword inline">void</span> <span class="hljs-title function_ inline">userLoggedOut</span><span class="hljs-params inline">()</span> {
        <span class="hljs-comment inline">// Atomic operation to prevent negative values: max(0, current - 1)</span>
        onlineUsers.updateAndGet(current -&gt; Math.max(<span class="hljs-number inline">0</span>, current - <span class="hljs-number inline">1</span>));
    }
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">Why choose ConcurrentHashMap + computeIfAbsent?</strong></p>
<p class="text-base leading-7 mb-4 text-foreground">The advantages of this combination are:</p>
<p class="text-base leading-7 mb-4 text-foreground">Incorrect approach:</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="java" data-code="%2F%2F%20%E2%9D%8C%20Error%20implementation%20with%20race%20condition%0Aif%20(!endpointCounters.containsKey(endpoint))%20%7B%0A%2F%2F%20Problem%3A%20Two%20threads%20might%20execute%20here%20simultaneously%0AendpointCounters.put(endpoint%2C%20createNewCounter(endpoint))%3B%0A%7D%0ACounter%20counter%20%3D%20endpointCounters.get(endpoint)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">java</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-java"><span class="hljs-comment inline">// ❌ Error implementation with race condition</span>
<span class="hljs-keyword inline">if</span> (!endpointCounters.containsKey(endpoint)) {
    <span class="hljs-comment inline">// Problem: Two threads might execute here simultaneously</span>
    endpointCounters.put(endpoint, createNewCounter(endpoint));
}
<span class="hljs-type inline">Counter</span> <span class="hljs-variable inline">counter</span> <span class="hljs-operator inline">=</span> endpointCounters.get(endpoint);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">Correct approach:</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="java" data-code="%2F%2F%20%E2%9C%85%20Atomic%20operation%2C%20thread-safe%0ACounter%20counter%20%3D%20endpointCounters.computeIfAbsent(endpoint%2C%20k%20-%3E%20createNewCounter(k))%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">java</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-java"><span class="hljs-comment inline">// ✅ Atomic operation, thread-safe</span>
<span class="hljs-type inline">Counter</span> <span class="hljs-variable inline">counter</span> <span class="hljs-operator inline">=</span> endpointCounters.computeIfAbsent(endpoint, k -&gt; createNewCounter(k));
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">Time complexity analysis of computeIfAbsent:</strong></p>
<p class="text-base leading-7 mb-4 text-foreground">In ideal conditions:</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed">First access: <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal inline" style="margin-right:0.02778em;">O</span><span class="mopen inline">(</span><span class="mord inline">1</span><span class="mclose inline">)</span></span></span></span> creation + <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal inline" style="margin-right:0.02778em;">O</span><span class="mopen inline">(</span><span class="mord inline">1</span><span class="mclose inline">)</span></span></span></span> insertion = <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal inline" style="margin-right:0.02778em;">O</span><span class="mopen inline">(</span><span class="mord inline">1</span><span class="mclose inline">)</span></span></span></span></li>
<li class="text-foreground leading-relaxed">Subsequent accesses: <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal inline" style="margin-right:0.02778em;">O</span><span class="mopen inline">(</span><span class="mord inline">1</span><span class="mclose inline">)</span></span></span></span> lookup</li>
</ul>
<h3 id="dual-guarantee-mechanism-for-online-user-statistics" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#dual-guarantee-mechanism-for-online-user-statistics" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Dual Guarantee Mechanism for Online User Statistics">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Dual Guarantee Mechanism for Online User Statistics
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">ACOT implements a “double insurance” user statistics system:</p>
<div class="mermaid block" id="mermaid-1767322171915-sfcod3f">sequenceDiagram
    participant User as User
    participant Security as Spring Security
    participant Session as HTTP Session
    participant Listener1 as UserActivityMetricsConfig
    participant Listener2 as SessionEventListener
    participant Metrics as EndpointMetrics

    User->>Security: Login
    Security->>Listener1: AuthenticationSuccessEvent
    Listener1->>Metrics: userLoggedIn() [+1]
    
    User->>Security: Normal logout
    Security->>Listener1: LogoutSuccessEvent
    Listener1->>Metrics: userLoggedOut() [-1]
    
    Note over Session: Session timeout or abnormal disconnection
    Session->>Listener2: sessionDestroyed
    Listener2->>Metrics: userLoggedOut() [-1]</div>
<h3 id="useractivitymetricsconfig-spring-security-event-handling" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#useractivitymetricsconfig-spring-security-event-handling" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to UserActivityMetricsConfig: Spring Security Event Handling">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            UserActivityMetricsConfig: Spring Security Event Handling
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="java" data-code="%40Configuration%0A%40RequiredArgsConstructor%0A%40Slf4j%0Apublic%20class%20UserActivityMetricsConfig%20%7B%0Aprivate%20final%20EndpointMetrics%20endpointMetrics%3B%0A%2F**%0A*%20Login%20success%20event%20listener%0A*%0A*%20Advantages%20of%20Spring%20event%20mechanism%3A%0A*%20-%20Loose%20coupling%3A%20No%20direct%20dependency%20between%20listener%20and%20event%20publisher%0A*%20-%20Asynchronous%20support%3A%20Can%20be%20configured%20for%20asynchronous%20processing%0A*%20-%20Multiple%20listeners%3A%20Multiple%20listeners%20for%20the%20same%20event%0A*%2F%0A%40EventListener%0Apublic%20void%20handleAuthenticationSuccess(AuthenticationSuccessEvent%20event)%20%7B%0AAuthentication%20authentication%20%3D%20event.getAuthentication()%3B%0AString%20username%20%3D%20authentication.getName()%3B%0Alog.debug(%22User%20login%3A%20%7B%7D%22%2C%20username)%3B%0A%2F%2F%20Increment%20online%20user%20count%0AendpointMetrics.userLoggedIn()%3B%0A%7D%0A%2F**%0A*%20Logout%20success%20event%20listener%0A*%0A*%20Note%3A%20authentication%20might%20be%20null%20in%20some%20logout%20scenarios%0A*%20For%20example%3A%20Active%20logout%20after%20session%20timeout%0A*%2F%0A%40EventListener%0Apublic%20void%20handleLogout(LogoutSuccessEvent%20event)%20%7B%0AAuthentication%20authentication%20%3D%20event.getAuthentication()%3B%0Aif%20(authentication%20!%3D%20null)%20%7B%0AString%20username%20%3D%20authentication.getName()%3B%0Alog.debug(%22User%20logout%3A%20%7B%7D%22%2C%20username)%3B%0A%7D%0A%2F%2F%20Decrement%20online%20user%20count%20(regardless%20of%20whether%20authentication%20is%20null)%0AendpointMetrics.userLoggedOut()%3B%0A%7D%0A%2F**%0A*%20Custom%20authentication%20success%20handler%3A%20Avoid%20duplicate%20statistics%0A*%0A*%20Why%20do%20we%20need%20this%20Bean%3F%0A*%20-%20Form-based%20login%20might%20be%20needed%20in%20some%20cases%0A*%20-%20This%20handler%20only%20handles%20logging%2C%20does%20not%20repeat%20metric%20statistics%0A*%2F%0A%40Bean%0Apublic%20AuthenticationSuccessHandler%20loggingAuthenticationSuccessHandler()%20%7B%0Areturn%20(request%2C%20response%2C%20authentication)%20-%3E%20%7B%0AString%20username%20%3D%20authentication.getName()%3B%0Alog.debug(%22Form%20login%20success%3A%20%7B%7D%22%2C%20username)%3B%0A%2F%2F%20Note%3A%20Do%20not%20call%20endpointMetrics.userLoggedIn()%20here%0A%2F%2F%20Because%20%40EventListener%20already%20handles%20statistics%0A%7D%3B%0A%7D%0A%2F**%0A*%20Custom%20logout%20success%20handler%3A%20Avoid%20duplicate%20statistics%0A*%2F%0A%40Bean%0Apublic%20LogoutSuccessHandler%20loggingLogoutSuccessHandler()%20%7B%0Areturn%20(request%2C%20response%2C%20authentication)%20-%3E%20%7B%0Aif%20(authentication%20!%3D%20null)%20%7B%0AString%20username%20%3D%20authentication.getName()%3B%0Alog.debug(%22Form%20logout%20success%3A%20%7B%7D%22%2C%20username)%3B%0A%7D%0A%2F%2F%20Note%3A%20Do%20not%20call%20endpointMetrics.userLoggedOut()%20here%0A%2F%2F%20Because%20%40EventListener%20already%20handles%20statistics%0A%7D%3B%0A%7D%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">java</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-java"><span class="hljs-meta inline">@Configuration</span>
<span class="hljs-meta inline">@RequiredArgsConstructor</span>
<span class="hljs-meta inline">@Slf4j</span>
<span class="hljs-keyword inline">public</span> <span class="hljs-keyword inline">class</span> <span class="hljs-title class_ inline">UserActivityMetricsConfig</span> {

    <span class="hljs-keyword inline">private</span> <span class="hljs-keyword inline">final</span> EndpointMetrics endpointMetrics;

    <span class="hljs-comment inline">/**
     * Login success event listener
     * 
     * Advantages of Spring event mechanism:
     * - Loose coupling: No direct dependency between listener and event publisher
     * - Asynchronous support: Can be configured for asynchronous processing
     * - Multiple listeners: Multiple listeners for the same event
     */</span>
    <span class="hljs-meta inline">@EventListener</span>
    <span class="hljs-keyword inline">public</span> <span class="hljs-keyword inline">void</span> <span class="hljs-title function_ inline">handleAuthenticationSuccess</span><span class="hljs-params inline">(AuthenticationSuccessEvent event)</span> {
        <span class="hljs-type inline">Authentication</span> <span class="hljs-variable inline">authentication</span> <span class="hljs-operator inline">=</span> event.getAuthentication();
        <span class="hljs-type inline">String</span> <span class="hljs-variable inline">username</span> <span class="hljs-operator inline">=</span> authentication.getName();
        
        log.debug(<span class="hljs-string inline">&quot;User login: {}&quot;</span>, username);
        
        <span class="hljs-comment inline">// Increment online user count</span>
        endpointMetrics.userLoggedIn();
    }

    <span class="hljs-comment inline">/**
     * Logout success event listener
     * 
     * Note: authentication might be null in some logout scenarios
     * For example: Active logout after session timeout
     */</span>
    <span class="hljs-meta inline">@EventListener</span>
    <span class="hljs-keyword inline">public</span> <span class="hljs-keyword inline">void</span> <span class="hljs-title function_ inline">handleLogout</span><span class="hljs-params inline">(LogoutSuccessEvent event)</span> {
        <span class="hljs-type inline">Authentication</span> <span class="hljs-variable inline">authentication</span> <span class="hljs-operator inline">=</span> event.getAuthentication();
        
        <span class="hljs-keyword inline">if</span> (authentication != <span class="hljs-literal inline">null</span>) {
            <span class="hljs-type inline">String</span> <span class="hljs-variable inline">username</span> <span class="hljs-operator inline">=</span> authentication.getName();
            log.debug(<span class="hljs-string inline">&quot;User logout: {}&quot;</span>, username);
        }
        
        <span class="hljs-comment inline">// Decrement online user count (regardless of whether authentication is null)</span>
        endpointMetrics.userLoggedOut();
    }

    <span class="hljs-comment inline">/**
     * Custom authentication success handler: Avoid duplicate statistics
     * 
     * Why do we need this Bean?
     * - Form-based login might be needed in some cases
     * - This handler only handles logging, does not repeat metric statistics
     */</span>
    <span class="hljs-meta inline">@Bean</span>
    <span class="hljs-keyword inline">public</span> AuthenticationSuccessHandler <span class="hljs-title function_ inline">loggingAuthenticationSuccessHandler</span><span class="hljs-params inline">()</span> {
        <span class="hljs-keyword inline">return</span> (request, response, authentication) -&gt; {
            <span class="hljs-type inline">String</span> <span class="hljs-variable inline">username</span> <span class="hljs-operator inline">=</span> authentication.getName();
            log.debug(<span class="hljs-string inline">&quot;Form login success: {}&quot;</span>, username);
            <span class="hljs-comment inline">// Note: Do not call endpointMetrics.userLoggedIn() here</span>
            <span class="hljs-comment inline">// Because @EventListener already handles statistics</span>
        };
    }

    <span class="hljs-comment inline">/**
     * Custom logout success handler: Avoid duplicate statistics
     */</span>
    <span class="hljs-meta inline">@Bean</span>
    <span class="hljs-keyword inline">public</span> LogoutSuccessHandler <span class="hljs-title function_ inline">loggingLogoutSuccessHandler</span><span class="hljs-params inline">()</span> {
        <span class="hljs-keyword inline">return</span> (request, response, authentication) -&gt; {
            <span class="hljs-keyword inline">if</span> (authentication != <span class="hljs-literal inline">null</span>) {
                <span class="hljs-type inline">String</span> <span class="hljs-variable inline">username</span> <span class="hljs-operator inline">=</span> authentication.getName();
                log.debug(<span class="hljs-string inline">&quot;Form logout success: {}&quot;</span>, username);
            }
            <span class="hljs-comment inline">// Note: Do not call endpointMetrics.userLoggedOut() here</span>
            <span class="hljs-comment inline">// Because @EventListener already handles statistics</span>
        };
    }
}
</code></pre>
            </div>
        
<h3 id="sessioneventlistener-fallback-mechanism-for-session-lifecycle" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#sessioneventlistener-fallback-mechanism-for-session-lifecycle" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to SessionEventListener: Fallback Mechanism for Session Lifecycle">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            SessionEventListener: Fallback Mechanism for Session Lifecycle
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="java" data-code="%40Component%0A%40Slf4j%0A%40RequiredArgsConstructor%0Apublic%20class%20SessionEventListener%20implements%20HttpSessionListener%20%7B%0Aprivate%20final%20EndpointMetrics%20endpointMetrics%3B%0A%2F**%0A*%20Session%20destruction%20listener%3A%20Handle%20users%20who%20%22silently%20leave%22%0A*%0A*%20Trigger%20scenarios%20for%20session%20destruction%3A%0A*%201.%20Session%20timeout%20(most%20common)%0A*%202.%20User%20actively%20closes%20browser%0A*%203.%20Calling%20session.invalidate()%0A*%204.%20Application%20server%20shutdown%0A*%2F%0A%40Override%0Apublic%20void%20sessionDestroyed(HttpSessionEvent%20se)%20%7B%0AString%20sessionId%20%3D%20se.getSession().getId()%3B%0Alog.debug(%22Session%20destroyed%3A%20%7B%7D%22%2C%20sessionId)%3B%0A%2F%2F%20Fallback%20mechanism%3A%20Ensure%20accurate%20user%20count%20statistics%0AendpointMetrics.userLoggedOut()%3B%0A%7D%0A%2F%2F%20Note%3A%20sessionCreated%20method%20is%20not%20implemented%20here%0A%2F%2F%20Because%20session%20creation%20does%20not%20equal%20user%20login%0A%2F%2F%20Anonymous%20users%20also%20create%20sessions%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">java</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-java"><span class="hljs-meta inline">@Component</span>
<span class="hljs-meta inline">@Slf4j</span>
<span class="hljs-meta inline">@RequiredArgsConstructor</span>
<span class="hljs-keyword inline">public</span> <span class="hljs-keyword inline">class</span> <span class="hljs-title class_ inline">SessionEventListener</span> <span class="hljs-keyword inline">implements</span> <span class="hljs-title class_ inline">HttpSessionListener</span> {

    <span class="hljs-keyword inline">private</span> <span class="hljs-keyword inline">final</span> EndpointMetrics endpointMetrics;

    <span class="hljs-comment inline">/**
     * Session destruction listener: Handle users who &quot;silently leave&quot;
     * 
     * Trigger scenarios for session destruction:
     * 1. Session timeout (most common)
     * 2. User actively closes browser
     * 3. Calling session.invalidate()
     * 4. Application server shutdown
     */</span>
    <span class="hljs-meta inline">@Override</span>
    <span class="hljs-keyword inline">public</span> <span class="hljs-keyword inline">void</span> <span class="hljs-title function_ inline">sessionDestroyed</span><span class="hljs-params inline">(HttpSessionEvent se)</span> {
        <span class="hljs-type inline">String</span> <span class="hljs-variable inline">sessionId</span> <span class="hljs-operator inline">=</span> se.getSession().getId();
        log.debug(<span class="hljs-string inline">&quot;Session destroyed: {}&quot;</span>, sessionId);
        
        <span class="hljs-comment inline">// Fallback mechanism: Ensure accurate user count statistics</span>
        endpointMetrics.userLoggedOut();
    }

    <span class="hljs-comment inline">// Note: sessionCreated method is not implemented here</span>
    <span class="hljs-comment inline">// Because session creation does not equal user login</span>
    <span class="hljs-comment inline">// Anonymous users also create sessions</span>
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">Why do we need SessionEventListener?</strong></p>
<p class="text-base leading-7 mb-4 text-foreground">Spring Security event listening has a blind spot: Users who &quot;silently leave&quot;.</p>
<table class="w-full border-collapse mb-4 shadow-sm rounded-lg overflow-hidden">
<thead class="bg-surface">
<tr class="border-b border-gray-200"><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">Leaving Method</th><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">Spring Security Event</th><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">Session Event</th><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">Statistics Accuracy</th></tr>
</thead>
<tbody class="bg-background divide-y divide-gray-200">
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">Normal logout</td><td class="px-4 py-3 text-sm text-foreground">✅ LogoutSuccessEvent</td><td class="px-4 py-3 text-sm text-foreground">✅ sessionDestroyed</td><td class="px-4 py-3 text-sm text-foreground">✅ Double guarantee</td></tr>
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">Close browser</td><td class="px-4 py-3 text-sm text-foreground">❌ No event</td><td class="px-4 py-3 text-sm text-foreground">✅ sessionDestroyed (delayed)</td><td class="px-4 py-3 text-sm text-foreground">✅ Fallback mechanism</td></tr>
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">Network disconnected</td><td class="px-4 py-3 text-sm text-foreground">❌ No event</td><td class="px-4 py-3 text-sm text-foreground">✅ sessionDestroyed (delayed)</td><td class="px-4 py-3 text-sm text-foreground">✅ Fallback mechanism</td></tr>
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">Session timeout</td><td class="px-4 py-3 text-sm text-foreground">❌ No event</td><td class="px-4 py-3 text-sm text-foreground">✅ sessionDestroyed</td><td class="px-4 py-3 text-sm text-foreground">✅ Fallback mechanism</td></tr>
</tbody>
</table>
<h2 id="prometheus-time-series-database" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#prometheus-time-series-database" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Prometheus: Time Series Database">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Prometheus: Time Series Database
        </h2>
<h3 id="why-choose-prometheus" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#why-choose-prometheus" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Why Choose Prometheus?">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Why Choose Prometheus?
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">Prometheus is more than just a monitoring system; it’s like a “time magician” that can record the ever-changing system state into queryable, analyzable time series data.</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">Core advantages of Prometheus:</strong></p>
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Elegance of Pull mode:</strong>
<div class="mermaid block" id="mermaid-1767322171915-70tsejj"></div></li>
</ol>
<p class="text-base leading-7 mb-4 text-foreground">graph LR<br class="block">
A[Prometheus Server] --&gt;|Pull every 15s| B[ACOT App 1:8080/actuator/prometheus]<br class="block">
A --&gt;|Pull every 15s| C[ACOT App 2:8081/actuator/prometheus]<br class="block">
A --&gt;|Pull every 15s| D[Other services:9090/metrics]</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="" data-code="2.%20**Multi-dimensional%20label%20system%3A**%0A%60%60%60promql%0A%23%20Query%20call%20count%20for%20specific%20controller%0Aacot_endpoint_calls_total%7Bcontroller%3D%22UserController%22%7D%0A%23%20Query%20call%20count%20for%20specific%20method%0Aacot_endpoint_calls_total%7Bmethod%3D%22getUserInfo%22%7D%0A%23%20Query%20combination%20of%20specific%20controller%20%2B%20method%0Aacot_endpoint_calls_total%7Bcontroller%3D%22UserController%22%2C%20method%3D%22getUserInfo%22%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">code</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code>
2. **Multi-dimensional label system:**
```promql
<span class="hljs-comment inline"># Query call count for specific controller</span>
acot_endpoint_calls_total{<span class="hljs-attribute inline">controller</span>=<span class="hljs-string inline">&quot;UserController&quot;</span>}

<span class="hljs-comment inline"># Query call count for specific method</span>
acot_endpoint_calls_total{<span class="hljs-attribute inline">method</span>=<span class="hljs-string inline">&quot;getUserInfo&quot;</span>}

<span class="hljs-comment inline"># Query combination of specific controller + method</span>
acot_endpoint_calls_total{<span class="hljs-attribute inline">controller</span>=<span class="hljs-string inline">&quot;UserController&quot;</span>, <span class="hljs-attribute inline">method</span>=<span class="hljs-string inline">&quot;getUserInfo&quot;</span>}
</code></pre>
            </div>
        
<ol start="3" class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">Powerful query language PromQL:</strong></p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="promql" data-code="%23%20Query%20average%20online%20users%20in%20the%20past%205%20minutes%0Aavg_over_time(acot_online_users%5B5m%5D)%0A%23%20Query%20API%20call%20growth%20rate%0Arate(acot_endpoint_calls_total%5B5m%5D)%0A%23%20Query%20busiest%20endpoints%0Atopk(10%2C%20rate(acot_endpoint_calls_total%5B1h%5D))">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">promql</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-promql"><span class="hljs-comment inline"># Query average online users in the past 5 minutes</span>
<span class="hljs-attribute inline">avg_over_time</span>(acot_online_users[<span class="hljs-number inline">5</span>m])

<span class="hljs-comment inline"># Query API call growth rate</span>
<span class="hljs-attribute inline">rate</span>(acot_endpoint_calls_total[<span class="hljs-number inline">5</span>m])

<span class="hljs-comment inline"># Query busiest endpoints</span>
<span class="hljs-attribute inline">topk</span>(<span class="hljs-number inline">10</span>, rate(acot_endpoint_calls_total[<span class="hljs-number inline">1</span>h]))
</code></pre>
            </div>
        </li>
</ol>
<h3 id="time-series-data-model-fundamentals-of-timestamp-design" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#time-series-data-model-fundamentals-of-timestamp-design" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Time Series Data Model: Fundamentals of Timestamp Design">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Time Series Data Model: Fundamentals of Timestamp Design
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">Prometheus’s data model can be expressed with a mathematical formula:</p>
<p class="text-base leading-7 mb-4 text-foreground"><span class="katex-display inline"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>M</mi><mi>e</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>c</mi><mo>=</mo><mi>M</mi><mi>e</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>c</mi><mi>N</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo stretchy="false">{</mo><mi>l</mi><mi>a</mi><mi>b</mi><mi>e</mi><msub><mi>l</mi><mn>1</mn></msub><mo>=</mo><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><msub><mi>e</mi><mn>1</mn></msub><mo separator="true">,</mo><mi>l</mi><mi>a</mi><mi>b</mi><mi>e</mi><msub><mi>l</mi><mn>2</mn></msub><mo>=</mo><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><msub><mi>e</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo stretchy="false">}</mo><mo>→</mo><mo stretchy="false">(</mo><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>m</mi><mi>p</mi><mo separator="true">,</mo><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Metric = MetricName\{label_1=value_1, label_2=value_2, ...\} \rightarrow (timestamp, value)</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.6833em;"></span><span class="mord mathnormal inline" style="margin-right:0.10903em;">M</span><span class="mord mathnormal inline">e</span><span class="mord mathnormal inline">t</span><span class="mord mathnormal inline" style="margin-right:0.02778em;">r</span><span class="mord mathnormal inline">i</span><span class="mord mathnormal inline">c</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal inline" style="margin-right:0.10903em;">M</span><span class="mord mathnormal inline">e</span><span class="mord mathnormal inline">t</span><span class="mord mathnormal inline" style="margin-right:0.02778em;">r</span><span class="mord mathnormal inline">i</span><span class="mord mathnormal inline">c</span><span class="mord mathnormal inline" style="margin-right:0.10903em;">N</span><span class="mord mathnormal inline">am</span><span class="mord mathnormal inline">e</span><span class="mopen inline">{</span><span class="mord mathnormal inline" style="margin-right:0.01968em;">l</span><span class="mord mathnormal inline">ab</span><span class="mord mathnormal inline">e</span><span class="mord inline"><span class="mord mathnormal inline" style="margin-right:0.01968em;">l</span><span class="msupsub inline"><span class="vlist-t vlist-t2 inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline">1</span></span></span></span><span class="vlist-s inline">​</span></span><span class="vlist-r inline"><span class="vlist inline" style="height:0.15em;"><span class="inline"></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal inline" style="margin-right:0.03588em;">v</span><span class="mord mathnormal inline">a</span><span class="mord mathnormal inline" style="margin-right:0.01968em;">l</span><span class="mord mathnormal inline">u</span><span class="mord inline"><span class="mord mathnormal inline">e</span><span class="msupsub inline"><span class="vlist-t vlist-t2 inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline">1</span></span></span></span><span class="vlist-s inline">​</span></span><span class="vlist-r inline"><span class="vlist inline" style="height:0.15em;"><span class="inline"></span></span></span></span></span></span><span class="mpunct inline">,</span><span class="mspace inline" style="margin-right:0.1667em;"></span><span class="mord mathnormal inline" style="margin-right:0.01968em;">l</span><span class="mord mathnormal inline">ab</span><span class="mord mathnormal inline">e</span><span class="mord inline"><span class="mord mathnormal inline" style="margin-right:0.01968em;">l</span><span class="msupsub inline"><span class="vlist-t vlist-t2 inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline">2</span></span></span></span><span class="vlist-s inline">​</span></span><span class="vlist-r inline"><span class="vlist inline" style="height:0.15em;"><span class="inline"></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal inline" style="margin-right:0.03588em;">v</span><span class="mord mathnormal inline">a</span><span class="mord mathnormal inline" style="margin-right:0.01968em;">l</span><span class="mord mathnormal inline">u</span><span class="mord inline"><span class="mord mathnormal inline">e</span><span class="msupsub inline"><span class="vlist-t vlist-t2 inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline">2</span></span></span></span><span class="vlist-s inline">​</span></span><span class="vlist-r inline"><span class="vlist inline" style="height:0.15em;"><span class="inline"></span></span></span></span></span></span><span class="mpunct inline">,</span><span class="mspace inline" style="margin-right:0.1667em;"></span><span class="mord inline">...</span><span class="mclose inline">}</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">→</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen inline">(</span><span class="mord mathnormal inline">t</span><span class="mord mathnormal inline">im</span><span class="mord mathnormal inline">es</span><span class="mord mathnormal inline">t</span><span class="mord mathnormal inline">am</span><span class="mord mathnormal inline">p</span><span class="mpunct inline">,</span><span class="mspace inline" style="margin-right:0.1667em;"></span><span class="mord mathnormal inline" style="margin-right:0.03588em;">v</span><span class="mord mathnormal inline">a</span><span class="mord mathnormal inline" style="margin-right:0.01968em;">l</span><span class="mord mathnormal inline">u</span><span class="mord mathnormal inline">e</span><span class="mclose inline">)</span></span></span></span></span></p>
<p class="text-base leading-7 mb-4 text-foreground">For example:</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="" data-code="acot_endpoint_calls_total%7Bcontroller%3D%22UserController%22%2C%20method%3D%22getUserInfo%22%7D%2042%20%401234567890">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">code</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code>acot_endpoint_calls_total{<span class="hljs-attribute inline">controller</span>=<span class="hljs-string inline">&quot;UserController&quot;</span>, <span class="hljs-attribute inline">method</span>=<span class="hljs-string inline">&quot;getUserInfo&quot;</span>} 42 @1234567890
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">Selection strategy for data types:</strong></p>
<table class="w-full border-collapse mb-4 shadow-sm rounded-lg overflow-hidden">
<thead class="bg-surface">
<tr class="border-b border-gray-200"><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">Metric Type</th><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">Applicable Scenario</th><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">Application in ACOT</th><th class="px-4 py-3 text-left text-xs font-medium text-foreground uppercase tracking-wider bg-surface">Mathematical Property</th></tr>
</thead>
<tbody class="bg-background divide-y divide-gray-200">
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">Counter</td><td class="px-4 py-3 text-sm text-foreground">Monotonically increasing</td><td class="px-4 py-3 text-sm text-foreground">API call count</td><td class="px-4 py-3 text-sm text-foreground"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><msub><mi>t</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo>≥</mo><mi>f</mi><mo stretchy="false">(</mo><msub><mi>t</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(t_2) \geq f(t_1)</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal inline" style="margin-right:0.10764em;">f</span><span class="mopen inline">(</span><span class="mord inline"><span class="mord mathnormal inline">t</span><span class="msupsub inline"><span class="vlist-t vlist-t2 inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline">2</span></span></span></span><span class="vlist-s inline">​</span></span><span class="vlist-r inline"><span class="vlist inline" style="height:0.15em;"><span class="inline"></span></span></span></span></span></span><span class="mclose inline">)</span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">≥</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal inline" style="margin-right:0.10764em;">f</span><span class="mopen inline">(</span><span class="mord inline"><span class="mord mathnormal inline">t</span><span class="msupsub inline"><span class="vlist-t vlist-t2 inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline">1</span></span></span></span><span class="vlist-s inline">​</span></span><span class="vlist-r inline"><span class="vlist inline" style="height:0.15em;"><span class="inline"></span></span></span></span></span></span><span class="mclose inline">)</span></span></span></span> when <span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mn>2</mn></msub><mo>&gt;</mo><msub><mi>t</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">t_2 &gt; t_1</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord inline"><span class="mord mathnormal inline">t</span><span class="msupsub inline"><span class="vlist-t vlist-t2 inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline">2</span></span></span></span><span class="vlist-s inline">​</span></span><span class="vlist-r inline"><span class="vlist inline" style="height:0.15em;"><span class="inline"></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">&gt;</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord inline"><span class="mord mathnormal inline">t</span><span class="msupsub inline"><span class="vlist-t vlist-t2 inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline">1</span></span></span></span><span class="vlist-s inline">​</span></span><span class="vlist-r inline"><span class="vlist inline" style="height:0.15em;"><span class="inline"></span></span></span></span></span></span></span></span></span></td></tr>
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">Gauge</td><td class="px-4 py-3 text-sm text-foreground">Instant value</td><td class="px-4 py-3 text-sm text-foreground">Online users</td><td class="px-4 py-3 text-sm text-foreground"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(t)</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal inline" style="margin-right:0.10764em;">f</span><span class="mopen inline">(</span><span class="mord mathnormal inline">t</span><span class="mclose inline">)</span></span></span></span> can change arbitrarily</td></tr>
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">Histogram</td><td class="px-4 py-3 text-sm text-foreground">Distribution statistics</td><td class="px-4 py-3 text-sm text-foreground">Response time distribution</td><td class="px-4 py-3 text-sm text-foreground"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mi>b</mi><mi>u</mi><mi>c</mi><mi>k</mi><mi>e</mi><msub><mi>t</mi><mi>i</mi></msub><mo>=</mo><mi>t</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi></mrow><annotation encoding="application/x-tex">\sum_{i=1}^{n} bucket_i = total</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:1.104em;vertical-align:-0.2997em;"></span><span class="mop inline"><span class="mop op-symbol small-op inline" style="position:relative;top:0em;">∑</span><span class="msupsub inline"><span class="vlist-t vlist-t2 inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline"><span class="mord mathnormal mtight inline">i</span><span class="mrel mtight inline">=</span><span class="mord mtight inline">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline"><span class="mord mathnormal mtight inline">n</span></span></span></span></span><span class="vlist-s inline">​</span></span><span class="vlist-r inline"><span class="vlist inline" style="height:0.2997em;"><span class="inline"></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.1667em;"></span><span class="mord mathnormal inline">b</span><span class="mord mathnormal inline">u</span><span class="mord mathnormal inline">c</span><span class="mord mathnormal inline" style="margin-right:0.03148em;">k</span><span class="mord mathnormal inline">e</span><span class="mord inline"><span class="mord mathnormal inline">t</span><span class="msupsub inline"><span class="vlist-t vlist-t2 inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mathnormal mtight inline">i</span></span></span></span><span class="vlist-s inline">​</span></span><span class="vlist-r inline"><span class="vlist inline" style="height:0.15em;"><span class="inline"></span></span></span></span></span></span><span class="mspace inline" style="margin-right:0.2778em;"></span><span class="mrel inline">=</span><span class="mspace inline" style="margin-right:0.2778em;"></span></span><span class="base inline"><span class="strut inline" style="height:0.6944em;"></span><span class="mord mathnormal inline">t</span><span class="mord mathnormal inline">o</span><span class="mord mathnormal inline">t</span><span class="mord mathnormal inline">a</span><span class="mord mathnormal inline" style="margin-right:0.01968em;">l</span></span></span></span></td></tr>
<tr class="border-b border-gray-200"><td class="px-4 py-3 text-sm text-foreground">Summary</td><td class="px-4 py-3 text-sm text-foreground">Quantile statistics</td><td class="px-4 py-3 text-sm text-foreground">Response time percentiles</td><td class="px-4 py-3 text-sm text-foreground"><span class="katex inline"><span class="katex-mathml inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>50</mn></msub><mo separator="true">,</mo><msub><mi>P</mi><mn>90</mn></msub><mo separator="true">,</mo><msub><mi>P</mi><mn>99</mn></msub></mrow><annotation encoding="application/x-tex">P_{50}, P_{90}, P_{99}</annotation></semantics></math></span><span class="katex-html inline" aria-hidden="true" style="display:none"><span class="base inline"><span class="strut inline" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord inline"><span class="mord mathnormal inline" style="margin-right:0.13889em;">P</span><span class="msupsub inline"><span class="vlist-t vlist-t2 inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline"><span class="mord mtight inline">50</span></span></span></span></span><span class="vlist-s inline">​</span></span><span class="vlist-r inline"><span class="vlist inline" style="height:0.15em;"><span class="inline"></span></span></span></span></span></span><span class="mpunct inline">,</span><span class="mspace inline" style="margin-right:0.1667em;"></span><span class="mord inline"><span class="mord mathnormal inline" style="margin-right:0.13889em;">P</span><span class="msupsub inline"><span class="vlist-t vlist-t2 inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline"><span class="mord mtight inline">90</span></span></span></span></span><span class="vlist-s inline">​</span></span><span class="vlist-r inline"><span class="vlist inline" style="height:0.15em;"><span class="inline"></span></span></span></span></span></span><span class="mpunct inline">,</span><span class="mspace inline" style="margin-right:0.1667em;"></span><span class="mord inline"><span class="mord mathnormal inline" style="margin-right:0.13889em;">P</span><span class="msupsub inline"><span class="vlist-t vlist-t2 inline"><span class="vlist-r inline"><span class="vlist inline" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;" class="inline"><span class="pstrut inline" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight inline"><span class="mord mtight inline"><span class="mord mtight inline">99</span></span></span></span></span><span class="vlist-s inline">​</span></span><span class="vlist-r inline"><span class="vlist inline" style="height:0.15em;"><span class="inline"></span></span></span></span></span></span></span></span></span></td></tr>
</tbody>
</table>
<h3 id="integration-of-spring-boot-and-prometheus" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#integration-of-spring-boot-and-prometheus" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Integration of Spring Boot and Prometheus">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Integration of Spring Boot and Prometheus
        </h3>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">Maven dependency configuration:</strong></p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="xml" data-code="dependency%3E%0AgroupId%3Eorg.springframework.bootgroupId%3E%0AartifactId%3Espring-boot-starter-actuatorartifactId%3E%0Adependency%3E%0Adependency%3E%0AgroupId%3Eio.micrometergroupId%3E%0AartifactId%3Emicrometer-registry-prometheusartifactId%3E%0Adependency%3E%0Adependency%3E%0AgroupId%3Eorg.springframework.bootgroupId%3E%0AartifactId%3Espring-boot-starter-aopartifactId%3E%0Adependency%3E">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">xml</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-xml"><span class="hljs-comment inline">&lt;!-- Spring Boot Actuator: Production-level application monitoring --&gt;</span>
<span class="hljs-tag inline">&lt;<span class="hljs-name inline">dependency</span>&gt;</span>
    <span class="hljs-tag inline">&lt;<span class="hljs-name inline">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag inline">&lt;/<span class="hljs-name inline">groupId</span>&gt;</span>
    <span class="hljs-tag inline">&lt;<span class="hljs-name inline">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="hljs-tag inline">&lt;/<span class="hljs-name inline">artifactId</span>&gt;</span>
<span class="hljs-tag inline">&lt;/<span class="hljs-name inline">dependency</span>&gt;</span>

<span class="hljs-comment inline">&lt;!-- Micrometer Prometheus: Prometheus exporter for metrics --&gt;</span>
<span class="hljs-tag inline">&lt;<span class="hljs-name inline">dependency</span>&gt;</span>
    <span class="hljs-tag inline">&lt;<span class="hljs-name inline">groupId</span>&gt;</span>io.micrometer<span class="hljs-tag inline">&lt;/<span class="hljs-name inline">groupId</span>&gt;</span>
    <span class="hljs-tag inline">&lt;<span class="hljs-name inline">artifactId</span>&gt;</span>micrometer-registry-prometheus<span class="hljs-tag inline">&lt;/<span class="hljs-name inline">artifactId</span>&gt;</span>
<span class="hljs-tag inline">&lt;/<span class="hljs-name inline">dependency</span>&gt;</span>

<span class="hljs-comment inline">&lt;!-- Spring AOP: Aspect-oriented programming support --&gt;</span>
<span class="hljs-tag inline">&lt;<span class="hljs-name inline">dependency</span>&gt;</span>
    <span class="hljs-tag inline">&lt;<span class="hljs-name inline">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag inline">&lt;/<span class="hljs-name inline">groupId</span>&gt;</span>
    <span class="hljs-tag inline">&lt;<span class="hljs-name inline">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="hljs-tag inline">&lt;/<span class="hljs-name inline">artifactId</span>&gt;</span>
<span class="hljs-tag inline">&lt;/<span class="hljs-name inline">dependency</span>&gt;</span>
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">application.yaml configuration:</strong></p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="yaml" data-code="management%3A%0Aendpoints%3A%0Aweb%3A%0Aexposure%3A%0A%23%20Security%20consideration%3A%20Only%20expose%20necessary%20endpoints%0Ainclude%3A%20%22health%2Cinfo%2Cmetrics%2Cprometheus%2Cenv%2Cthreaddump%2Cloggers%22%0Abase-path%3A%20%2Factuator%0Acors%3A%0A%23%20Development%20environment%20configuration%2C%20need%20restrictions%20in%20production%0Aallowed-origins%3A%20%22*%22%0Aallowed-methods%3A%20GET%2CPOST%2CPUT%2CDELETE%2COPTIONS%2CHEAD%0Aallowed-headers%3A%20%22*%22%0Aendpoint%3A%0Aprometheus%3A%0A%23%20Recommended%20to%20set%20to%20%22when_authorized%22%20in%20production%0Aaccess%3A%20unrestricted%0Ametrics%3A%0Aaccess%3A%20unrestricted%0Ametrics%3A%0Adistribution%3A%0Apercentiles-histogram%3A%0A%23%20Enable%20histogram%20statistics%20for%20HTTP%20request%20response%20time%0Ahttp.server.requests%3A%20true%0Atags%3A%0A%23%20Add%20application%20identification%20tag%20to%20all%20metrics%0Aapplication%3A%20%24%7Bspring.application.name%7D%0Aprometheus%3A%0Ametrics%3A%0Aexport%3A%0Aenabled%3A%20true%0A%23%20Push%20interval%20can%20be%20configured%2C%20not%20needed%20for%20pull%20mode%20by%20default%0A%23%20step%3A%2015s%0Ahealth%3A%0Adiskspace%3A%0Aenabled%3A%20true%0Adb%3A%0Aenabled%3A%20true%0A%23%20Enable%20debug%20logs%20to%20view%20metric%20registration%20process%0Alogging%3A%0Alevel%3A%0Acom.chat.allchatonthis.config.metrics%3A%20debug">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">yaml</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-yaml"><span class="hljs-attr inline">management:</span>
  <span class="hljs-attr inline">endpoints:</span>
    <span class="hljs-attr inline">web:</span>
      <span class="hljs-attr inline">exposure:</span>
        <span class="hljs-comment inline"># Security consideration: Only expose necessary endpoints</span>
        <span class="hljs-attr inline">include:</span> <span class="hljs-string inline">&quot;health,info,metrics,prometheus,env,threaddump,loggers&quot;</span>
        <span class="hljs-attr inline">base-path:</span> <span class="hljs-string inline">/actuator</span>
      <span class="hljs-attr inline">cors:</span>
        <span class="hljs-comment inline"># Development environment configuration, need restrictions in production</span>
        <span class="hljs-attr inline">allowed-origins:</span> <span class="hljs-string inline">&quot;*&quot;</span>
        <span class="hljs-attr inline">allowed-methods:</span> <span class="hljs-string inline">GET,POST,PUT,DELETE,OPTIONS,HEAD</span>
        <span class="hljs-attr inline">allowed-headers:</span> <span class="hljs-string inline">&quot;*&quot;</span>
  
  <span class="hljs-attr inline">endpoint:</span>
    <span class="hljs-attr inline">prometheus:</span>
      <span class="hljs-comment inline"># Recommended to set to &quot;when_authorized&quot; in production</span>
      <span class="hljs-attr inline">access:</span> <span class="hljs-string inline">unrestricted</span>
    <span class="hljs-attr inline">metrics:</span>
      <span class="hljs-attr inline">access:</span> <span class="hljs-string inline">unrestricted</span>
  
  <span class="hljs-attr inline">metrics:</span>
    <span class="hljs-attr inline">distribution:</span>
      <span class="hljs-attr inline">percentiles-histogram:</span>
        <span class="hljs-comment inline"># Enable histogram statistics for HTTP request response time</span>
        <span class="hljs-attr inline">http.server.requests:</span> <span class="hljs-literal inline">true</span>
    <span class="hljs-attr inline">tags:</span>
      <span class="hljs-comment inline"># Add application identification tag to all metrics</span>
      <span class="hljs-attr inline">application:</span> <span class="hljs-string inline">${spring.application.name}</span>
    
  <span class="hljs-attr inline">prometheus:</span>
    <span class="hljs-attr inline">metrics:</span>
      <span class="hljs-attr inline">export:</span>
        <span class="hljs-attr inline">enabled:</span> <span class="hljs-literal inline">true</span>
        <span class="hljs-comment inline"># Push interval can be configured, not needed for pull mode by default</span>
        <span class="hljs-comment inline"># step: 15s</span>
  
  <span class="hljs-attr inline">health:</span>
    <span class="hljs-attr inline">diskspace:</span>
      <span class="hljs-attr inline">enabled:</span> <span class="hljs-literal inline">true</span>
    <span class="hljs-attr inline">db:</span>
      <span class="hljs-attr inline">enabled:</span> <span class="hljs-literal inline">true</span>

<span class="hljs-comment inline"># Enable debug logs to view metric registration process</span>
<span class="hljs-attr inline">logging:</span>
  <span class="hljs-attr inline">level:</span>
    <span class="hljs-attr inline">com.chat.allchatonthis.config.metrics:</span> <span class="hljs-string inline">debug</span>
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">Prometheus configuration example:</strong></p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="yaml" data-code="%23%20prometheus.yml%0Aglobal%3A%0Ascrape_interval%3A%2015s%0Aevaluation_interval%3A%2015s%0Ascrape_configs%3A%0A-%20job_name%3A%20'acot-backend'%0Ametrics_path%3A%20'%2Factuator%2Fprometheus'%0Astatic_configs%3A%0A-%20targets%3A%20%5B'localhost%3A8080'%5D%0Ascrape_interval%3A%2010s%0Ascrape_timeout%3A%205s">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">yaml</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-yaml"><span class="hljs-comment inline"># prometheus.yml</span>
<span class="hljs-attr inline">global:</span>
  <span class="hljs-attr inline">scrape_interval:</span> <span class="hljs-string inline">15s</span>
  <span class="hljs-attr inline">evaluation_interval:</span> <span class="hljs-string inline">15s</span>

<span class="hljs-attr inline">scrape_configs:</span>
  <span class="hljs-bullet inline">-</span> <span class="hljs-attr inline">job_name:</span> <span class="hljs-string inline">&#x27;acot-backend&#x27;</span>
    <span class="hljs-attr inline">metrics_path:</span> <span class="hljs-string inline">&#x27;/actuator/prometheus&#x27;</span>
    <span class="hljs-attr inline">static_configs:</span>
      <span class="hljs-bullet inline">-</span> <span class="hljs-attr inline">targets:</span> [<span class="hljs-string inline">&#x27;localhost:8080&#x27;</span>]
    <span class="hljs-attr inline">scrape_interval:</span> <span class="hljs-string inline">10s</span>
    <span class="hljs-attr inline">scrape_timeout:</span> <span class="hljs-string inline">5s</span>
</code></pre>
            </div>
        
<h2 id="grafana-data-visualization" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#grafana-data-visualization" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Grafana: Data Visualization">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Grafana: Data Visualization
        </h2>
<h3 id="core-value-of-grafana" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#core-value-of-grafana" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Core Value of Grafana">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Core Value of Grafana
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">If Prometheus is the &quot;data collector&quot;, then Grafana is the &quot;data artist&quot;. It can transform cold numbers into intuitive charts, making monitoring data &quot;speak&quot;.</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">Construction ideas for ACOT monitoring dashboard:</strong></p>
<div class="mermaid block" id="mermaid-1767322171915-5duyjkr">graph TB
    subgraph "ACOT Grafana Dashboard"
        A[System Overview Panel] --> A1[Real-time Online Users Curve]
        A --> A2[Total API Calls]
        A --> A3[System Health Status]
        
        B[API Call Statistics Panel] --> B1[Popular API Ranking]
        B --> B2[API Call Trend Chart]
        B --> B3[Error Rate Statistics]
        
        C[User Activity Panel] --> C1[User Login/Logout Trend]
        C --> C2[User Active Period Analysis]
        C --> C3[Session Duration Distribution]
        
        D[Performance Metrics Panel] --> D1[Response Time Distribution]
        D --> D2[JVM Memory Usage]
        D --> D3[Database Connection Pool Status]
        
        E[Alert Status Panel]
    end</div>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">Key PromQL query statements:</strong></p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="promql" data-code="%23%201.%20Current%20online%20users%0Aacot_online_users%0A%23%202.%20API%20call%20rate%20(per%20second)%0Arate(acot_endpoint_calls_total%5B5m%5D)%0A%23%203.%20Most%20popular%20API%20endpoints%20(Top%2010)%0Atopk(10%2C%20increase(acot_endpoint_calls_total%5B1h%5D))%0A%23%204.%20User%20login%20rate%0Arate(acot_online_users%5B5m%5D)%20%3E%200%0A%23%205.%20System%20average%20response%20time%0Arate(http_server_requests_seconds_sum%5B5m%5D)%20%2F%20rate(http_server_requests_seconds_count%5B5m%5D)%0A%23%206.%20Error%20rate%20statistics%0Arate(http_server_requests_seconds_count%7Bstatus%3D~%224..%7C5..%22%7D%5B5m%5D)%20%2F%0Arate(http_server_requests_seconds_count%5B5m%5D)%20*%20100">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">promql</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-promql"><span class="hljs-comment inline"># 1. Current online users</span>
<span class="hljs-attribute inline">acot_online_users</span>

<span class="hljs-comment inline"># 2. API call rate (per second)</span>
<span class="hljs-attribute inline">rate</span>(acot_endpoint_calls_total[<span class="hljs-number inline">5</span>m])

<span class="hljs-comment inline"># 3. Most popular API endpoints (Top 10)</span>
<span class="hljs-attribute inline">topk</span>(<span class="hljs-number inline">10</span>, increase(acot_endpoint_calls_total[<span class="hljs-number inline">1</span>h]))

<span class="hljs-comment inline"># 4. User login rate</span>
<span class="hljs-attribute inline">rate</span>(acot_online_users[<span class="hljs-number inline">5</span>m]) &gt; <span class="hljs-number inline">0</span>

<span class="hljs-comment inline"># 5. System average response time</span>
<span class="hljs-attribute inline">rate</span>(http_server_requests_seconds_sum[<span class="hljs-number inline">5</span>m]) / rate(http_server_requests_seconds_count[<span class="hljs-number inline">5</span>m])

<span class="hljs-comment inline"># 6. Error rate statistics</span>
<span class="hljs-attribute inline">rate</span>(http_server_requests_seconds_count{status=~<span class="hljs-string inline">&quot;4..|5..&quot;</span>}[<span class="hljs-number inline">5</span>m]) / 
<span class="hljs-attribute inline">rate</span>(http_server_requests_seconds_count[<span class="hljs-number inline">5</span>m]) * <span class="hljs-number inline">100</span>
</code></pre>
            </div>
        
<h2 id="in-depth-code-analysis-line-by-line-dissection-of-monitoring-implementation-details" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#in-depth-code-analysis-line-by-line-dissection-of-monitoring-implementation-details" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to In-depth Code Analysis: Line-by-Line Dissection of Monitoring Implementation Details">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            In-depth Code Analysis: Line-by-Line Dissection of Monitoring Implementation Details
        </h2>
<h3 id="metricscontroller-http-exposure-interface-for-monitoring-data" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#metricscontroller-http-exposure-interface-for-monitoring-data" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to MetricsController: HTTP Exposure Interface for Monitoring Data">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            MetricsController: HTTP Exposure Interface for Monitoring Data
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="java" data-code="%40RestController%0A%40RequestMapping(%22%2Fmetrics%22)%0A%40RequiredArgsConstructor%0A%40Slf4j%0Apublic%20class%20MetricsController%20%7B%0Aprivate%20final%20MeterRegistry%20meterRegistry%3B%0A%2F**%0A*%20Get%20current%20online%20users%0A*%0A*%20Implementation%20principle%3A%0A*%201.%20Find%20Gauge%20named%20%22acot.online.users%22%20through%20MeterRegistry%0A*%202.%20Call%20gauge().value()%20to%20get%20current%20instant...%0A*%203.%20Convert%20to%20integer%20and%20return%0A*%2F%0A%40GetMapping(%22%2Fonline-users%22)%0Apublic%20CommonResult%20getOnlineUsers()%20%7B%0A%2F%2F%20Lookup%20chain%20for%20MeterRegistry.get()%20method%3A%0A%2F%2F%201.%20Find%20registered%20Meter%20by%20name%0A%2F%2F%202.%20Return%20first%20matching%20Meter%0A%2F%2F%203.%20Throw%20MeterNotFoundException%20if%20not%20found%0AInteger%20onlineUsers%20%3D%20(int)%20meterRegistry.get(%22acot.online.users%22).gauge().value()%3B%0Areturn%20CommonResult.success(onlineUsers)%3B%0A%7D%0A%2F**%0A*%20Get%20endpoint%20call%20statistics%0A*%0A*%20This%20method%20demonstrates%20the%20power%20of%20Micrometer%20Search%20API%0A*%2F%0A%40GetMapping(%22%2Fendpoints%22)%0Apublic%20CommonResult%3E%20getEndpointStats()%20%7B%0AMap%20stats%20%3D%20new%20HashMap()%3B%0A%2F%2F%20Streaming%20query%20with%20Micrometer%20Search%20API%0ASearch.in(meterRegistry)%0A.name(%22acot.endpoint.calls%22)%20%20%2F%2F%20Step%201%3A%20Filter%20by%20name%0A.counters()%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Step%202%3A%20Keep%20only%20Counter%20type%0A.forEach(counter%20-%3E%20%7B%20%20%20%20%20%20%20%20%20%2F%2F%20Step%203%3A%20Iterate%20all%20matching%20Counters%0A%2F%2F%20Extract%20Counter's%20tag%20information%0AIterable%20tags%20%3D%20counter.getId().getTags()%3B%0AString%20controller%20%3D%20%22%22%3B%0AString%20method%20%3D%20%22%22%3B%0A%2F%2F%20Iterate%20tags%20to%20extract%20controller%20and%20method%20information%0Afor%20(Tag%20tag%20%3A%20tags)%20%7B%0Aif%20(%22controller%22.equals(tag.getKey()))%20%7B%0Acontroller%20%3D%20tag.getValue()%3B%0A%7D%20else%20if%20(%22method%22.equals(tag.getKey()))%20%7B%0Amethod%20%3D%20tag.getValue()%3B%0A%7D%0A%7D%0A%2F%2F%20Construct%20endpoint%20identifier%20and%20record%20count%20value%0AString%20endpoint%20%3D%20controller%20%2B%20%22.%22%20%2B%20method%3B%0Astats.put(endpoint%2C%20(int)%20counter.count())%3B%0A%7D)%3B%0Areturn%20CommonResult.success(stats)%3B%0A%7D%0A%2F**%0A*%20Get%20monitoring%20data%20summary%0A*%0A*%20This%20method%20demonstrates%20how%20to%20aggregate%20multiple%20metrics%0A*%2F%0A%40GetMapping(%22%2Fsummary%22)%0Apublic%20CommonResult%3E%20getMetricsSummary()%20%7B%0AMap%20summary%20%3D%20new%20HashMap()%3B%0A%2F%2F%20Get%20online%20users%0AInteger%20onlineUsers%20%3D%20(int)%20meterRegistry.get(%22acot.online.users%22).gauge().value()%3B%0Asummary.put(%22onlineUsers%22%2C%20onlineUsers)%3B%0A%2F%2F%20Calculate%20total%20API%20calls%20(sum%20of%20all%20endpoint%20counters)%0Adouble%20totalApiCalls%20%3D%20Search.in(meterRegistry)%0A.name(%22acot.endpoint.calls%22)%0A.counters()%0A.stream()%0A.mapToDouble(counter%20-%3E%20counter.count())%20%20%2F%2F%20Extract%20each%20counter's%20value%0A.sum()%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Sum%20them%20up%0Asummary.put(%22totalApiCalls%22%2C%20(int)%20totalApiCalls)%3B%0Areturn%20CommonResult.success(summary)%3B%0A%7D%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">java</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-java"><span class="hljs-meta inline">@RestController</span>
<span class="hljs-meta inline">@RequestMapping(&quot;/metrics&quot;)</span>
<span class="hljs-meta inline">@RequiredArgsConstructor</span>
<span class="hljs-meta inline">@Slf4j</span>
<span class="hljs-keyword inline">public</span> <span class="hljs-keyword inline">class</span> <span class="hljs-title class_ inline">MetricsController</span> {

    <span class="hljs-keyword inline">private</span> <span class="hljs-keyword inline">final</span> MeterRegistry meterRegistry;

    <span class="hljs-comment inline">/**
     * Get current online users
     * 
     * Implementation principle:
     * 1. Find Gauge named &quot;acot.online.users&quot; through MeterRegistry
     * 2. Call gauge().value() to get current instant...
     * 3. Convert to integer and return
     */</span>
    <span class="hljs-meta inline">@GetMapping(&quot;/online-users&quot;)</span>
    <span class="hljs-keyword inline">public</span> CommonResult&lt;Integer&gt; <span class="hljs-title function_ inline">getOnlineUsers</span><span class="hljs-params inline">()</span> {
        <span class="hljs-comment inline">// Lookup chain for MeterRegistry.get() method:</span>
        <span class="hljs-comment inline">// 1. Find registered Meter by name</span>
        <span class="hljs-comment inline">// 2. Return first matching Meter</span>
        <span class="hljs-comment inline">// 3. Throw MeterNotFoundException if not found</span>
        <span class="hljs-type inline">Integer</span> <span class="hljs-variable inline">onlineUsers</span> <span class="hljs-operator inline">=</span> (<span class="hljs-type inline">int</span>) meterRegistry.get(<span class="hljs-string inline">&quot;acot.online.users&quot;</span>).gauge().value();
        
        <span class="hljs-keyword inline">return</span> CommonResult.success(onlineUsers);
    }

    <span class="hljs-comment inline">/**
     * Get endpoint call statistics
     * 
     * This method demonstrates the power of Micrometer Search API
     */</span>
    <span class="hljs-meta inline">@GetMapping(&quot;/endpoints&quot;)</span>
    <span class="hljs-keyword inline">public</span> CommonResult&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_ inline">getEndpointStats</span><span class="hljs-params inline">()</span> {
        Map&lt;String, Object&gt; stats = <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">HashMap</span>&lt;&gt;();
        
        <span class="hljs-comment inline">// Streaming query with Micrometer Search API</span>
        Search.in(meterRegistry)
            .name(<span class="hljs-string inline">&quot;acot.endpoint.calls&quot;</span>)  <span class="hljs-comment inline">// Step 1: Filter by name</span>
            .counters()                   <span class="hljs-comment inline">// Step 2: Keep only Counter type</span>
            .forEach(counter -&gt; {         <span class="hljs-comment inline">// Step 3: Iterate all matching Counters</span>
                <span class="hljs-comment inline">// Extract Counter&#x27;s tag information</span>
                Iterable&lt;Tag&gt; tags = counter.getId().getTags();
                
                <span class="hljs-type inline">String</span> <span class="hljs-variable inline">controller</span> <span class="hljs-operator inline">=</span> <span class="hljs-string inline">&quot;&quot;</span>;
                <span class="hljs-type inline">String</span> <span class="hljs-variable inline">method</span> <span class="hljs-operator inline">=</span> <span class="hljs-string inline">&quot;&quot;</span>;
                
                <span class="hljs-comment inline">// Iterate tags to extract controller and method information</span>
                <span class="hljs-keyword inline">for</span> (Tag tag : tags) {
                    <span class="hljs-keyword inline">if</span> (<span class="hljs-string inline">&quot;controller&quot;</span>.equals(tag.getKey())) {
                        controller = tag.getValue();
                    } <span class="hljs-keyword inline">else</span> <span class="hljs-keyword inline">if</span> (<span class="hljs-string inline">&quot;method&quot;</span>.equals(tag.getKey())) {
                        method = tag.getValue();
                    }
                }
                
                <span class="hljs-comment inline">// Construct endpoint identifier and record count value</span>
                <span class="hljs-type inline">String</span> <span class="hljs-variable inline">endpoint</span> <span class="hljs-operator inline">=</span> controller + <span class="hljs-string inline">&quot;.&quot;</span> + method;
                stats.put(endpoint, (<span class="hljs-type inline">int</span>) counter.count());
            });
        
        <span class="hljs-keyword inline">return</span> CommonResult.success(stats);
    }

    <span class="hljs-comment inline">/**
     * Get monitoring data summary
     * 
     * This method demonstrates how to aggregate multiple metrics
     */</span>
    <span class="hljs-meta inline">@GetMapping(&quot;/summary&quot;)</span>
    <span class="hljs-keyword inline">public</span> CommonResult&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_ inline">getMetricsSummary</span><span class="hljs-params inline">()</span> {
        Map&lt;String, Object&gt; summary = <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">HashMap</span>&lt;&gt;();
        
        <span class="hljs-comment inline">// Get online users</span>
        <span class="hljs-type inline">Integer</span> <span class="hljs-variable inline">onlineUsers</span> <span class="hljs-operator inline">=</span> (<span class="hljs-type inline">int</span>) meterRegistry.get(<span class="hljs-string inline">&quot;acot.online.users&quot;</span>).gauge().value();
        summary.put(<span class="hljs-string inline">&quot;onlineUsers&quot;</span>, onlineUsers);
        
        <span class="hljs-comment inline">// Calculate total API calls (sum of all endpoint counters)</span>
        <span class="hljs-type inline">double</span> <span class="hljs-variable inline">totalApiCalls</span> <span class="hljs-operator inline">=</span> Search.in(meterRegistry)
            .name(<span class="hljs-string inline">&quot;acot.endpoint.calls&quot;</span>)
            .counters()
            .stream()
            .mapToDouble(counter -&gt; counter.count())  <span class="hljs-comment inline">// Extract each counter&#x27;s value</span>
            .sum();                                   <span class="hljs-comment inline">// Sum them up</span>
        summary.put(<span class="hljs-string inline">&quot;totalApiCalls&quot;</span>, (<span class="hljs-type inline">int</span>) totalApiCalls);
        
        <span class="hljs-keyword inline">return</span> CommonResult.success(summary);
    }
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">Internal working mechanism of MeterRegistry:</strong></p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="java" data-code="%2F%2F%20Simplified%20lookup%20algorithm%20for%20MeterRegistry%0Apublic%20Meter%20get(String%20name)%20%7B%0Afor%20(Meter%20meter%20%3A%20this.meters)%20%7B%0Aif%20(meter.getId().getName().equals(name))%20%7B%0Areturn%20meter%3B%0A%7D%0A%7D%0Athrow%20new%20MeterNotFoundException(%22Meter%20not%20found%3A%20%22%20%2B%20name)%3B%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">java</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-java"><span class="hljs-comment inline">// Simplified lookup algorithm for MeterRegistry</span>
<span class="hljs-keyword inline">public</span> Meter <span class="hljs-title function_ inline">get</span><span class="hljs-params inline">(String name)</span> {
    <span class="hljs-keyword inline">for</span> (Meter meter : <span class="hljs-built_in inline">this</span>.meters) {
        <span class="hljs-keyword inline">if</span> (meter.getId().getName().equals(name)) {
            <span class="hljs-keyword inline">return</span> meter;
        }
    }
    <span class="hljs-keyword inline">throw</span> <span class="hljs-keyword inline">new</span> <span class="hljs-title class_ inline">MeterNotFoundException</span>(<span class="hljs-string inline">&quot;Meter not found: &quot;</span> + name);
}
</code></pre>
            </div>
        
<h3 id="complete-metric-data-flow-analysis" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#complete-metric-data-flow-analysis" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Complete Metric Data Flow Analysis">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Complete Metric Data Flow Analysis
        </h3>
<div class="mermaid block" id="mermaid-1767322171915-occ0i9z">sequenceDiagram
    participant Client as Client
    participant Controller as RestController
    participant Aspect as EndpointMetricsAspect
    participant Metrics as EndpointMetrics
    participant Registry as MeterRegistry
    participant Prometheus as Prometheus endpoint

    Client->>Controller: HTTP request
    Controller->>Aspect: Method call (AOP interception)
    Aspect->>Metrics: incrementEndpointCount()
    Metrics->>Registry: counter.increment()
    Controller->>Client: Return response
    
    Note over Registry: Metric data continues to accumulate
    
    Prometheus->>Controller: GET /actuator/prometheus
    Controller->>Registry: Get all metrics
    Registry->>Prometheus: Return Prometheus format data</div>
<h3 id="in-depth-analysis-of-configuration-files" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#in-depth-analysis-of-configuration-files" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to In-depth Analysis of Configuration Files">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            In-depth Analysis of Configuration Files
        </h3>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">Why do we need these configurations?</strong></p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="yaml" data-code="management%3A%0Aendpoints%3A%0Aweb%3A%0Aexposure%3A%0A%23%20Why%20only%20expose%20these%20endpoints%3F%0Ainclude%3A%20%22health%2Cinfo%2Cmetrics%2Cprometheus%2Cenv%2Cthreaddump%2Cloggers%22%0A%23%20Security%20considerations%3A%0A%23%20-%20health%3A%20Health%20check%20needed%20for%20load%20balancing%0A%23%20-%20metrics%3A%20Internal%20monitoring%20queries%0A%23%20-%20prometheus%3A%20External%20monitoring%20system%20pull%0A%23%20-%20Other%20sensitive%20endpoints%20not%20exposed%20to%20avoid%20information%20leakage">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">yaml</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-yaml"><span class="hljs-attr inline">management:</span>
  <span class="hljs-attr inline">endpoints:</span>
    <span class="hljs-attr inline">web:</span>
      <span class="hljs-attr inline">exposure:</span>
        <span class="hljs-comment inline"># Why only expose these endpoints?</span>
        <span class="hljs-attr inline">include:</span> <span class="hljs-string inline">&quot;health,info,metrics,prometheus,env,threaddump,loggers&quot;</span>
        <span class="hljs-comment inline"># Security considerations:</span>
        <span class="hljs-comment inline"># - health: Health check needed for load balancing</span>
        <span class="hljs-comment inline"># - metrics: Internal monitoring queries</span>
        <span class="hljs-comment inline"># - prometheus: External monitoring system pull</span>
        <span class="hljs-comment inline"># - Other sensitive endpoints not exposed to avoid information leakage</span>
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">Security configuration for production environment:</strong></p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="yaml" data-code="management%3A%0Aendpoints%3A%0Aweb%3A%0Aexposure%3A%0Ainclude%3A%20%22health%2Cprometheus%22%20%20%23%20Minimal%20exposure%20principle%0Abase-path%3A%20%2Finternal%2Factuator%20%20%23%20Internal%20path%20for%20gateway%20routing%20control%0Aendpoint%3A%0Aprometheus%3A%0Aaccess%3A%20when_authorized%20%20%23%20Requires%20authentication%0Ahealth%3A%0Ashow-details%3A%20when_authorized%20%20%23%20Detailed%20information%20requires%20authentication%0Aserver%3A%0Aport%3A%209090%20%20%23%20Independent%20management%20port%20for%20firewall%20policies">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">yaml</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-yaml"><span class="hljs-attr inline">management:</span>
  <span class="hljs-attr inline">endpoints:</span>
    <span class="hljs-attr inline">web:</span>
      <span class="hljs-attr inline">exposure:</span>
        <span class="hljs-attr inline">include:</span> <span class="hljs-string inline">&quot;health,prometheus&quot;</span>  <span class="hljs-comment inline"># Minimal exposure principle</span>
        <span class="hljs-attr inline">base-path:</span> <span class="hljs-string inline">/internal/actuator</span>  <span class="hljs-comment inline"># Internal path for gateway routing control</span>
  <span class="hljs-attr inline">endpoint:</span>
    <span class="hljs-attr inline">prometheus:</span>
      <span class="hljs-attr inline">access:</span> <span class="hljs-string inline">when_authorized</span>  <span class="hljs-comment inline"># Requires authentication</span>
    <span class="hljs-attr inline">health:</span>
      <span class="hljs-attr inline">show-details:</span> <span class="hljs-string inline">when_authorized</span>  <span class="hljs-comment inline"># Detailed information requires authentication</span>
  <span class="hljs-attr inline">server:</span>
    <span class="hljs-attr inline">port:</span> <span class="hljs-number inline">9090</span>  <span class="hljs-comment inline"># Independent management port for firewall policies</span>
</code></pre>
            </div>
        
<h2 id="final-thoughts" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#final-thoughts" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Final Thoughts">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Final Thoughts
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">Compared to using monitoring systems to focus on system health, I actually prefer using monitoring systems for user behavior analysis. Admittedly, security is more important than personalization, but isn’t the purpose of security to enable more possibilities afterward?</p>
<p class="text-base leading-7 mb-4 text-foreground">ACOT’s monitoring system design is relatively simple, but it demonstrates a system’s long-term sustainable development capability - a keen sense of user needs. After all, a system that can solve user needs is a good system.</p>
<p class="text-base leading-7 mb-4 text-foreground"><em class="italic text-foreground">May future systems be like intelligent spirits, listening attentively to visitors, becoming sharp tools in their hands, serving as operators of the future, making human wisdom shine in the universe.</em> ✨</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="java" data-code="%2F%2F%20Wish%20(monitoring%20version)%0Awhile%20(system.isRunning())%20%7B%0Amonitor.collect()%3B%0Aif%20(anomaly.detected())%20%7B%0Aalert.send()%3B%20%F0%9F%9A%A8%0Aengineer.fix()%3B%0A%7D%0Adashboard.update()%3B%20%F0%9F%93%8A%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">java</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-java"><span class="hljs-comment inline">// Wish (monitoring version)</span>
<span class="hljs-keyword inline">while</span> (system.isRunning()) {
    monitor.collect();
    <span class="hljs-keyword inline">if</span> (anomaly.detected()) {
        alert.send(); 🚨
        engineer.fix();
    }
    dashboard.update(); 📊
}
</code></pre>
            </div>
        
d:["$","$L1d",null,{"htmlContent":"$1e","frontMatter":{"title":"All-Chat-on-This Endpoint Monitoring and Exposure Implementation: From AOP Aspects to Prometheus Monitoring Ecosystem","description":"In-depth analysis of the complete implementation principles of endpoint monitoring, metric collection, and user activity tracking in Spring Boot applications, covering the technology stack of AOP, Micrometer, and Prometheus","date":"2025-01-15","author":"MilkWind","tags":["Spring Boot","Monitoring System","Prometheus","Micrometer","AOP"],"references":{}},"readingTime":"15 min read","category":"all-chat-on-this","tocItems":[{"id":"all-chat-on-this-endpoint-monitoring-and-exposure-implementation-from-aop-aspects-to-prometheus-monitoring-ecosystem","text":"All-Chat-on-This Endpoint Monitoring and Exposure Implementation: From AOP Aspects to Prometheus Monitoring Ecosystem","level":1},{"id":"monitoring-architecture-four-tier-separation-design","text":"Monitoring Architecture: Four-Tier Separation Design","level":2},{"id":"layered-architecture-overview-data-flow-lifecycle","text":"Layered Architecture Overview: Data Flow Lifecycle","level":3},{"id":"core-principles-of-endpoint-monitoring-aop","text":"Core Principles of Endpoint Monitoring: AOP","level":2},{"id":"aop-aspect-oriented-programming-the-mysterious-enhancer","text":"AOP Aspect-Oriented Programming: The Mysterious Enhancer","level":3},{"id":"endpointmetricsaspect-aspect-interception","text":"EndpointMetricsAspect: Aspect Interception","level":3},{"id":"thread-safe-counter-design-endpointmetrics-concurrency","text":"Thread-Safe Counter Design: EndpointMetrics Concurrency","level":3},{"id":"dual-guarantee-mechanism-for-online-user-statistics","text":"Dual Guarantee Mechanism for Online User Statistics","level":3},{"id":"useractivitymetricsconfig-spring-security-event-handling","text":"UserActivityMetricsConfig: Spring Security Event Handling","level":3},{"id":"sessioneventlistener-fallback-mechanism-for-session-lifecycle","text":"SessionEventListener: Fallback Mechanism for Session Lifecycle","level":3},{"id":"prometheus-time-series-database","text":"Prometheus: Time Series Database","level":2},{"id":"why-choose-prometheus","text":"Why Choose Prometheus?","level":3},{"id":"time-series-data-model-fundamentals-of-timestamp-design","text":"Time Series Data Model: Fundamentals of Timestamp Design","level":3},{"id":"integration-of-spring-boot-and-prometheus","text":"Integration of Spring Boot and Prometheus","level":3},{"id":"grafana-data-visualization","text":"Grafana: Data Visualization","level":2},{"id":"core-value-of-grafana","text":"Core Value of Grafana","level":3},{"id":"in-depth-code-analysis-line-by-line-dissection-of-monitoring-implementation-details","text":"In-depth Code Analysis: Line-by-Line Dissection of Monitoring Implementation Details","level":2},{"id":"metricscontroller-http-exposure-interface-for-monitoring-data","text":"MetricsController: HTTP Exposure Interface for Monitoring Data","level":3},{"id":"complete-metric-data-flow-analysis","text":"Complete Metric Data Flow Analysis","level":3},{"id":"in-depth-analysis-of-configuration-files","text":"In-depth Analysis of Configuration Files","level":3},{"id":"final-thoughts","text":"Final Thoughts","level":2}],"translations":{"common":{"welcome":"Welcome","loading":"Loading...","error":"Something went wrong","retry":"Try again","theme":"Theme","language":"Language","light":"Light","dark":"Dark"},"navigation":{"home":"Home","personal":"Personal","works":"Works","contributions":"Contributions","documents":"Documents","about":"About","contact":"Contact"},"personal":{"technicalSkills":"Technical Skills","email":"Email","github":"GitHub","resume":"Resume","codeRepository":"Code Repository","loadingPersonalInfo":"Loading personal information...","loadingResume":"Loading resume...","closeResume":"Close Resume","emailCopied":"Email copied to clipboard!","galaxyDefaultDescription":"Expert in full-stack development, cross-platform architecture, AI technology integration, and high-performance system optimization","skillGalaxy":"Skill Galaxy","stirGalaxy":"Stir Galaxy","stirring":"Stirring...","fullStackEngineer":"MilkWind - Full Stack Engineer","professionalProfile":"About Me"},"documents":{"technicalDocuments":"Technical Documents","description":"Basic principles, code splitting, and some random thoughts.","articles":"Articles","categories":"Categories","allCategories":"All Categories","noArticlesFound":"No articles found","noArticlesAvailable":"No articles available in English.","noArticlesInCategory":"No articles found in the category.","readMore":"Read more","loadingDocuments":"Loading documents...","backToDocuments":"← Back to Documents","documentNotFound":"Document Not Found","documentNotFoundDescription":"The requested document could not be found.","technicalInsights":"Insights","untitledDocument":"Untitled Document","byAuthor":"By","search":"Search articles...","searchByTags":"Filter by tags","searching":"Searching...","noSearchResults":"No articles match your search criteria","clearSearch":"Clear search","selectedTags":"Selected tags","allTags":"All tags","searchInTitle":"Search in titles, descriptions, and content","enterImmersiveMode":"Immersive Reading","exitImmersiveMode":"Exit Immersive Mode","immersiveReading":"Immersive Reading Mode","exploreContent":"Explore content by category","browseBy":"Browse by","exploreAll":"All content in one place","categoryDescription":"Articles in this category","totalArticles":"Articles","totalCategories":"Categories","foundArticles":"Found articles","categoriesWithResults":"Categories with results"},"works":{"workCases":"Work Cases","projects":"Portfolio","loadingProjects":"Loading projects...","grid":"Grid","stack":"Stack","of":"of","workCasesPageTitle":"Work Cases Page","pageWorkingCorrectly":"This page is working! The routing is correct.","try3DVersion":"Try 3D Version","dragToScroll":"Drag to scroll","dragToChange":"Drag to change","swipeCards":"Swipe cards","keyboardNav":"Keyboard navigation"},"contributions":{"contributionCases":"Open Source","contributions":"Contributions","loadingContributions":"Loading contributions...","grid":"Grid","stack":"Stack","of":"of","contributionCasesPageTitle":"Contribution Cases Page","pageWorkingCorrectly":"This page is working! The routing is correct.","try3DVersion":"Try 3D Version","dragToScroll":"Drag to scroll","dragToChange":"Drag to change","swipeCards":"Swipe cards","keyboardNav":"Keyboard navigation"},"contribution":{"contributionPreview":"Contribution Preview","accessible":"Accessible","code":"Code","maintenance":"Maintenance","enhancement":"Enhancement","documentation":"Documentation","community":"Community","moreItems":"more","technicalDetails":"Technical Details","technologies":"Technologies:","contributionDetail":"Contribution Detail","description":"Description:","seeDetails":"See Details","github":"GitHub","viewContribution":"View Contribution","viewCode":"View Code"},"project":{"projectPreview":"Project Preview","accessible":"Accessible","tool":"Tool","plugin":"Plugin","toy":"Toy","moreItems":"more","technicalDetails":"Technical Details","technologies":"Technologies:","description":"Description:","seeDetails":"See Details","github":"GitHub","gitee":"Gitee","viewLiveDemo":"View Live Demo","viewCode":"View Code","access":"Access","videos":"Videos","watchVideo":"Watch Video","hasVideo":"Has Video"},"codeblock":{"copy":"Copy","copySuccess":"Code copied to clipboard!","copyError":"Failed to copy code","copyTooltip":"Copy code"},"toc":{"contents":"Contents","autoScroll":"Auto-scroll to section","collapse":"Collapse","expand":"Expand"},"loading":{"loading":"LOADING","preparingExperience":"Preparing experience"}},"lang":"en","theme":"light"}]
12:null
18:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
11:null
1c:{"metadata":[["$","title","0",{"children":"All-Chat-on-This Endpoint Monitoring and Exposure Implementation: From AOP Aspects to Prometheus Monitoring Ecosystem | Interactive Portfolio"}],["$","meta","1",{"name":"description","content":"In-depth analysis of the complete implementation principles of endpoint monitoring, metric collection, and user activity tracking in Spring Boot applications, covering the technology stack of AOP, Micrometer, and Prometheus"}],["$","meta","2",{"name":"author","content":"Developer"}],["$","meta","3",{"name":"keywords","content":"portfolio,3D,interactive,web development,Three.js,Next.js"}],["$","meta","4",{"property":"og:title","content":"All-Chat-on-This Endpoint Monitoring and Exposure Implementation: From AOP Aspects to Prometheus Monitoring Ecosystem | Interactive Portfolio"}],["$","meta","5",{"property":"og:description","content":"In-depth analysis of the complete implementation principles of endpoint monitoring, metric collection, and user activity tracking in Spring Boot applications, covering the technology stack of AOP, Micrometer, and Prometheus"}],["$","meta","6",{"property":"og:type","content":"article"}],["$","meta","7",{"property":"article:published_time","content":"2025-01-15"}],["$","meta","8",{"property":"article:tag","content":"Spring Boot"}],["$","meta","9",{"property":"article:tag","content":"Monitoring System"}],["$","meta","10",{"property":"article:tag","content":"Prometheus"}],["$","meta","11",{"property":"article:tag","content":"Micrometer"}],["$","meta","12",{"property":"article:tag","content":"AOP"}],["$","meta","13",{"name":"twitter:card","content":"summary_large_image"}],["$","meta","14",{"name":"twitter:title","content":"All-Chat-on-This Endpoint Monitoring and Exposure Implementation: From AOP Aspects to Prometheus Monitoring Ecosystem | Interactive Portfolio"}],["$","meta","15",{"name":"twitter:description","content":"In-depth analysis of the complete implementation principles of endpoint monitoring, metric collection, and user activity tracking in Spring Boot applications, covering the technology stack of AOP, Micrometer, and Prometheus"}],["$","link","16",{"rel":"icon","href":"/MilkWind-Website/favicon.ico","type":"image/x-icon","sizes":"32x32"}]],"error":null,"digest":"$undefined"}
14:{"metadata":"$1c:metadata","error":null,"digest":"$undefined"}
