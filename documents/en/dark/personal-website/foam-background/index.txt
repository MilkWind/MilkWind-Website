1:"$Sreact.fragment"
2:I[38735,["46","static/chunks/46-268e24d727b280ef.js","7177","static/chunks/app/layout-af4a6e723c0ff668.js"],"default"]
3:I[19945,["46","static/chunks/46-268e24d727b280ef.js","7177","static/chunks/app/layout-af4a6e723c0ff668.js"],"default"]
4:I[65337,["46","static/chunks/46-268e24d727b280ef.js","7177","static/chunks/app/layout-af4a6e723c0ff668.js"],"default"]
5:I[96190,["46","static/chunks/46-268e24d727b280ef.js","7177","static/chunks/app/layout-af4a6e723c0ff668.js"],"ClientProviders"]
6:I[87555,[],""]
7:I[51901,["8039","static/chunks/app/error-dda32be1d095a86c.js"],"default"]
8:I[31295,[],""]
9:I[6874,["6874","static/chunks/6874-fbe9a08eb79b991c.js","4345","static/chunks/app/not-found-9ff98b2ccf24cac7.js"],""]
a:I[94970,[],"ClientSegmentRoot"]
b:I[44065,["206","static/chunks/206-4f4cbf4d7156f437.js","3092","static/chunks/app/documents/layout-28408791defde09e.js"],"default"]
e:I[59665,[],"MetadataBoundary"]
10:I[59665,[],"OutletBoundary"]
13:I[74911,[],"AsyncMetadataOutlet"]
15:I[39460,["2415","static/chunks/2415-689c103fb3d2c28d.js","8610","static/chunks/8610-7bd3f91f3cf2a4d6.js","5650","static/chunks/app/documents/loading-1fa3f98b6e5a8e78.js"],"default"]
16:I[88610,["2415","static/chunks/2415-689c103fb3d2c28d.js","8610","static/chunks/8610-7bd3f91f3cf2a4d6.js","4209","static/chunks/app/loading-68f227fb49b3ac8c.js"],"default"]
17:I[59665,[],"ViewportBoundary"]
19:I[26614,[],""]
:HL["/MilkWind-Website/_next/static/css/704956702722271c.css","style"]
:HL["/MilkWind-Website/_next/static/css/276b387d8ca46690.css","style"]
:HL["/MilkWind-Website/_next/static/css/5eacd01f773eed7f.css","style"]
0:{"P":null,"b":"hDcQihbPrZmyDn13A-ujS","p":"/MilkWind-Website","c":["","documents","en","dark","personal-website","foam-background",""],"i":false,"f":[[["",{"children":["documents",{"children":[["slug","en/dark/personal-website/foam-background","c"],{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/MilkWind-Website/_next/static/css/704956702722271c.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}],["$","link","1",{"rel":"stylesheet","href":"/MilkWind-Website/_next/static/css/276b387d8ca46690.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","suppressHydrationWarning":true,"children":["$","body",null,{"className":"__variable_9b7fb1 __variable_ca2a15 __variable_591dcc font-sans antialiased min-h-screen bg-background text-foreground","suppressHydrationWarning":true,"children":[["$","$L2",null,{}],["$","$L3",null,{}],["$","$L4",null,{}],["$","$L5",null,{"children":["$","$L6",null,{"parallelRouterKey":"children","error":"$7","errorStyles":[],"errorScripts":[],"template":["$","$L8",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","div",null,{"className":"z-10 relative min-h-screen flex items-center justify-center bg-background p-8","children":["$","div",null,{"className":"text-center max-w-md","children":[["$","div",null,{"className":"text-8xl font-bold text-primary mb-4","children":"404"}],["$","h2",null,{"className":"text-2xl font-bold text-foreground mb-4","children":"Page Not Found"}],["$","p",null,{"className":"text-foreground/70 mb-8","children":"The page you're looking for doesn't exist or has been moved to a different location."}],["$","div",null,{"className":"flex flex-col sm:flex-row gap-4 justify-center","children":[["$","$L9",null,{"href":"/","className":"px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary/80 transition-colors","children":"Go Home"}],["$","$L9",null,{"href":"/works","className":"px-6 py-2 border border-primary text-primary rounded-lg hover:bg-primary/10 transition-colors","children":"View Works"}]]}],["$","div",null,{"className":"absolute inset-0 overflow-hidden pointer-events-none -z-10","children":[["$","div",null,{"className":"absolute top-1/4 left-1/4 w-2 h-2 bg-primary/20 rounded-full animate-float"}],["$","div",null,{"className":"absolute top-3/4 right-1/4 w-3 h-3 bg-accent/20 rounded-full animate-float","style":{"animationDelay":"1s"}}],["$","div",null,{"className":"absolute bottom-1/4 left-1/3 w-1 h-1 bg-secondary/20 rounded-full animate-float","style":{"animationDelay":"2s"}}]]}]]}]}],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]}]]}]}]]}],{"children":["documents",["$","$1","c",{"children":[null,["$","$La",null,{"Component":"$b","slots":{"children":["$","$L6",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L8",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]},"params":{},"promise":"$@c"}]]}],{"children":[["slug","en/dark/personal-website/foam-background","c"],["$","$1","c",{"children":[null,["$","$L6",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L8",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":["$Ld",["$","$Le",null,{"children":"$Lf"}],[["$","link","0",{"rel":"stylesheet","href":"/MilkWind-Website/_next/static/css/5eacd01f773eed7f.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","$L10",null,{"children":["$L11","$L12",["$","$L13",null,{"promise":"$@14"}]]}]]}],{},null,false]},null,false]},[["$","$L15","l",{}],[],[]],false]},[["$","$L16","l",{}],[],[]],false],["$","$1","h",{"children":[null,["$","$1","vRsQsJNp-JkbFeIom4ome",{"children":[["$","$L17",null,{"children":"$L18"}],null]}],null]}],false]],"m":"$undefined","G":["$19","$undefined"],"s":false,"S":true}
1a:"$Sreact.suspense"
1b:I[74911,[],"AsyncMetadata"]
c:{}
f:["$","$1a",null,{"fallback":null,"children":["$","$L1b",null,{"promise":"$@1c"}]}]
1d:I[57340,["5584","static/chunks/b498d07c-095637f0f10883c6.js","2415","static/chunks/2415-689c103fb3d2c28d.js","6874","static/chunks/6874-fbe9a08eb79b991c.js","9554","static/chunks/9554-b714f9de28e85d30.js","1873","static/chunks/app/documents/%5B...slug%5D/page-8f3efa7e6c6c5377.js"],"DocumentPageClient"]
1e:T3f083,<h1 id="foam-background-from-canvas-thinking-to-dom-implementation-of-a-particle-world" class="group relative text-4xl font-bold mt-8 mb-4 text-foreground leading-tight">
            <a href="#foam-background-from-canvas-thinking-to-dom-implementation-of-a-particle-world" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Foam Background: From Canvas Thinking to DOM Implementation of a Particle World">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Foam Background: From Canvas Thinking to DOM Implementation of a Particle World
        </h1>
<p class="text-base leading-7 mb-4 text-foreground">Preface—This is part of the aesthetics plan.</p>
<p class="text-base leading-7 mb-4 text-foreground">In this article, I will start from the Canvas mindset and gradually demonstrate how to create smooth particle animation effects using DOM + CSS combinations, covering implementation details across all aspects including physics simulation, theme responsiveness, performance optimization, and more.</p>
<h2 id="translating-canvas-thinking-into-the-dom-world" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#translating-canvas-thinking-into-the-dom-world" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Translating Canvas Thinking into the DOM World">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Translating Canvas Thinking into the DOM World
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">Before we begin, let’s talk about why we’re “betraying” Canvas and embracing the DOM.</p>
<h3 id="canvas-vs-dom-a-philosophical-choice" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#canvas-vs-dom-a-philosophical-choice" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Canvas vs DOM: A Philosophical Choice">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Canvas vs DOM: A Philosophical Choice
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">In the Canvas world, particle system implementation is straightforward:</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="javascript" data-code="%2F%2F%20Canvas%20classic%20approach%0Afunction%20drawParticle(ctx%2C%20particle)%20%7B%0Actx.beginPath()%3B%0Actx.arc(particle.x%2C%20particle.y%2C%20particle.size%2C%200%2C%20Math.PI%20*%202)%3B%0Actx.fillStyle%20%3D%20particle.color%3B%0Actx.fill()%3B%0A%7D%0Afunction%20animateFrame()%20%7B%0Actx.clearRect(0%2C%200%2C%20canvas.width%2C%20canvas.height)%3B%0Aparticles.forEach(particle%20%3D%3E%20%7B%0AupdateParticle(particle)%3B%0AdrawParticle(ctx%2C%20particle)%3B%0A%7D)%3B%0ArequestAnimationFrame(animateFrame)%3B%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">javascript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-javascript"><span class="hljs-comment inline">// Canvas classic approach</span>
<span class="hljs-keyword inline">function</span> <span class="hljs-title function_ inline">drawParticle</span>(<span class="hljs-params inline">ctx, particle</span>) {
    ctx.<span class="hljs-title function_ inline">beginPath</span>();
    ctx.<span class="hljs-title function_ inline">arc</span>(particle.<span class="hljs-property inline">x</span>, particle.<span class="hljs-property inline">y</span>, particle.<span class="hljs-property inline">size</span>, <span class="hljs-number inline">0</span>, <span class="hljs-title class_ inline">Math</span>.<span class="hljs-property inline">PI</span> * <span class="hljs-number inline">2</span>);
    ctx.<span class="hljs-property inline">fillStyle</span> = particle.<span class="hljs-property inline">color</span>;
    ctx.<span class="hljs-title function_ inline">fill</span>();
}

<span class="hljs-keyword inline">function</span> <span class="hljs-title function_ inline">animateFrame</span>(<span class="hljs-params inline"></span>) {
    ctx.<span class="hljs-title function_ inline">clearRect</span>(<span class="hljs-number inline">0</span>, <span class="hljs-number inline">0</span>, canvas.<span class="hljs-property inline">width</span>, canvas.<span class="hljs-property inline">height</span>);
    particles.<span class="hljs-title function_ inline">forEach</span>(<span class="hljs-function inline"><span class="hljs-params inline">particle</span> =&gt;</span> {
        <span class="hljs-title function_ inline">updateParticle</span>(particle);
        <span class="hljs-title function_ inline">drawParticle</span>(ctx, particle);
    });
    <span class="hljs-title function_ inline">requestAnimationFrame</span>(animateFrame);
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">Clean and simple, with decent performance. But I chose DOM for these reasons:</p>
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed">This is point one</li>
<li class="text-foreground leading-relaxed">This is point two</li>
<li class="text-foreground leading-relaxed">This is point three</li>
<li class="text-foreground leading-relaxed">This is point four</li>
<li class="text-foreground leading-relaxed">This is…</li>
</ol>
<p class="text-base leading-7 mb-4 text-foreground">Okay, enough joking. Actually it’s:</p>
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Better accessibility</strong>: DOM elements natively support screen readers and other assistive technologies</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Easier theme integration</strong>: Seamless integration with CSS variables and theme systems</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Simpler event handling</strong>: Each particle is a real DOM element, making event handling more intuitive</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">GPU-accelerated transforms</strong>: CSS transform properties automatically trigger GPU acceleration</li>
</ol>
<p class="text-base leading-7 mb-4 text-foreground">Of course, the trade-off is increased complexity and some performance compromises. <del class="line-through opacity-60">(Mainly because the AI initially gave me a DOM solution and I went deeper and deeper down this path)</del></p>
<h3 id="the-art-of-creating-dom-particles" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#the-art-of-creating-dom-particles" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to The Art of Creating DOM Particles">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            The Art of Creating DOM Particles
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">In the DOM world, each particle is a real div element:</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20el%20%3D%20document.createElement('div')%3B%0Ael.style.position%20%3D%20'absolute'%3B%0Ael.style.borderRadius%20%3D%20'50%25'%3B%0Ael.style.backgroundColor%20%3D%20colors.particle%3B%0Ael.style.pointerEvents%20%3D%20'none'%3B%0Ael.style.willChange%20%3D%20'transform%2C%20opacity'%3B%0Acontainer.appendChild(el)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> el = <span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">createElement</span>(<span class="hljs-string inline">&#x27;div&#x27;</span>);
el.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">position</span> = <span class="hljs-string inline">&#x27;absolute&#x27;</span>;
el.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">borderRadius</span> = <span class="hljs-string inline">&#x27;50%&#x27;</span>;
el.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">backgroundColor</span> = colors.<span class="hljs-property inline">particle</span>;
el.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">pointerEvents</span> = <span class="hljs-string inline">&#x27;none&#x27;</span>;
el.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">willChange</span> = <span class="hljs-string inline">&#x27;transform, opacity&#x27;</span>;

container.<span class="hljs-title function_ inline">appendChild</span>(el);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">Property explanations:</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">position: absolute</strong>: Takes particles out of document flow for free positioning</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">borderRadius: 50%</strong>: Transforms square div into circle, mimicking foam shape</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">pointerEvents: none</strong>: Ensures particles don’t interfere with user page interactions</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">willChange</strong>: Hints to browser that this element will change frequently, enabling optimizations</li>
</ul>
<h3 id="coordinate-system-mapping" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#coordinate-system-mapping" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Coordinate System Mapping">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Coordinate System Mapping
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">Canvas uses standard Cartesian coordinates, while DOM uses CSS coordinates. Fortunately, the mapping is straightforward:</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20Canvas%3A%20drawCircle(x%2C%20y%2C%20radius)%0A%2F%2F%20DOM%3A%20element.style.left%20%3D%20x%20%2B%20'px'%3B%20element.style.top%20%3D%20y%20%2B%20'px'%3B%0A%2F%2F%20Our%20implementation%0Ap.el.style.transform%20%3D%20%60translate(%24%7Bp.x%7Dpx%2C%20%24%7Bp.y%7Dpx)%20scale(%24%7Bscale%7D)%60%3B%0Ap.el.style.opacity%20%3D%20opacity.toString()%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// Canvas: drawCircle(x, y, radius)</span>
<span class="hljs-comment inline">// DOM: element.style.left = x + &#x27;px&#x27;; element.style.top = y + &#x27;px&#x27;;</span>

<span class="hljs-comment inline">// Our implementation</span>
p.<span class="hljs-property inline">el</span>.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">transform</span> = <span class="hljs-string inline">`translate(<span class="hljs-subst inline">${p.x}</span>px, <span class="hljs-subst inline">${p.y}</span>px) scale(<span class="hljs-subst inline">${scale}</span>)`</span>;
p.<span class="hljs-property inline">el</span>.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">opacity</span> = opacity.<span class="hljs-title function_ inline">toString</span>();
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">Using <code>transform</code> instead of directly modifying <code>left/top</code> is important: <strong class="font-bold text-foreground">transform doesn’t trigger reflow</strong>, only repaint and compositing, which is much better for performance.</p>
<h2 id="particle-lifecycle-data-architecture" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#particle-lifecycle-data-architecture" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Particle Lifecycle & Data Architecture">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Particle Lifecycle &amp; Data Architecture
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">Now let’s dive into the core of the particle system—data structure design.</p>
<h3 id="particle-interface-design" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#particle-interface-design" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Particle Interface Design">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Particle Interface Design
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="interface%20Particle%20%7B%0Ael%3A%20HTMLDivElement%3B%20%20%20%20%2F%2F%20DOM%20element%20reference%0Ax%3A%20number%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20X%20coordinate%0Ay%3A%20number%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Y%20coordinate%0Avx%3A%20number%3B%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20X%20velocity%0Avy%3A%20number%3B%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Y%20velocity%0Asize%3A%20number%3B%20%20%20%20%20%20%20%20%20%20%2F%2F%20Particle%20size%0Adepth%3A%20number%3B%20%20%20%20%20%20%20%20%20%2F%2F%20Depth%20layer%20(0-1)%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">interface</span> <span class="hljs-title class_ inline">Particle</span> {
  <span class="hljs-attr inline">el</span>: <span class="hljs-title class_ inline">HTMLDivElement</span>;    <span class="hljs-comment inline">// DOM element reference</span>
  <span class="hljs-attr inline">x</span>: <span class="hljs-built_in inline">number</span>;             <span class="hljs-comment inline">// X coordinate</span>
  <span class="hljs-attr inline">y</span>: <span class="hljs-built_in inline">number</span>;             <span class="hljs-comment inline">// Y coordinate  </span>
  <span class="hljs-attr inline">vx</span>: <span class="hljs-built_in inline">number</span>;            <span class="hljs-comment inline">// X velocity</span>
  <span class="hljs-attr inline">vy</span>: <span class="hljs-built_in inline">number</span>;            <span class="hljs-comment inline">// Y velocity</span>
  <span class="hljs-attr inline">size</span>: <span class="hljs-built_in inline">number</span>;          <span class="hljs-comment inline">// Particle size</span>
  <span class="hljs-attr inline">depth</span>: <span class="hljs-built_in inline">number</span>;         <span class="hljs-comment inline">// Depth layer (0-1)</span>
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">Field explanations:</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">el</strong>: Directly stores DOM element reference, avoiding frequent DOM queries</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">x, y</strong>: Current precise position (can be decimal)</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">vx, vy</strong>: Velocity vector for physics simulation</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">size</strong>: Base particle size, combined with depth to calculate final display size</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">depth</strong>: Key to visual depth, controlling particle size, opacity, and movement speed</li>
</ul>
<h3 id="particle-initialization-randomization-strategy" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#particle-initialization-randomization-strategy" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Particle Initialization Randomization Strategy">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Particle Initialization Randomization Strategy
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20initializeParticles%20%3D%20useCallback(()%20%3D%3E%20%7B%0Aconst%20width%20%3D%20window.innerWidth%3B%0Aconst%20height%20%3D%20window.innerHeight%3B%0Aconst%20colors%20%3D%20getThemeColors()%3B%0Afor%20(let%20i%20%3D%200%3B%20i%20NUM_PARTICLES%3B%20i%2B%2B)%20%7B%0Aconst%20size%20%3D%202%20%2B%20Math.random()%20*%204%3B%20%20%20%20%20%20%2F%2F%20Random%20size%202-6px%0Aconst%20depth%20%3D%20Math.random()%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Random%20depth%200-1%0Aconst%20x%20%3D%20Math.random()%20*%20width%3B%20%20%20%20%20%20%20%20%20%2F%2F%20Random%20X%20position%0Aconst%20y%20%3D%20Math.random()%20*%20height%3B%20%20%20%20%20%20%20%20%2F%2F%20Random%20Y%20position%0Aconst%20particle%20%3D%20%7B%0Ael%2C%20x%2C%20y%2C%0Avx%3A%200%2C%20vy%3A%200%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Initial%20velocity%20is%200%0Asize%2C%20depth%0A%7D%3B%0AparticlesRef.current.push(particle)%3B%0A%7D%0A%7D%2C%20%5BgetThemeColors%5D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> initializeParticles = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-keyword inline">const</span> width = <span class="hljs-variable language_ inline">window</span>.<span class="hljs-property inline">innerWidth</span>;
    <span class="hljs-keyword inline">const</span> height = <span class="hljs-variable language_ inline">window</span>.<span class="hljs-property inline">innerHeight</span>;
    <span class="hljs-keyword inline">const</span> colors = <span class="hljs-title function_ inline">getThemeColors</span>();

    <span class="hljs-keyword inline">for</span> (<span class="hljs-keyword inline">let</span> i = <span class="hljs-number inline">0</span>; i &lt; <span class="hljs-variable constant_ inline">NUM_PARTICLES</span>; i++) {
        <span class="hljs-keyword inline">const</span> size = <span class="hljs-number inline">2</span> + <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">random</span>() * <span class="hljs-number inline">4</span>;      <span class="hljs-comment inline">// Random size 2-6px</span>
        <span class="hljs-keyword inline">const</span> depth = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">random</span>();             <span class="hljs-comment inline">// Random depth 0-1</span>
        <span class="hljs-keyword inline">const</span> x = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">random</span>() * width;         <span class="hljs-comment inline">// Random X position</span>
        <span class="hljs-keyword inline">const</span> y = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">random</span>() * height;        <span class="hljs-comment inline">// Random Y position</span>

        <span class="hljs-keyword inline">const</span> particle = {
            el, x, y,
            <span class="hljs-attr inline">vx</span>: <span class="hljs-number inline">0</span>, <span class="hljs-attr inline">vy</span>: <span class="hljs-number inline">0</span>,                        <span class="hljs-comment inline">// Initial velocity is 0</span>
            size, depth
        };
        
        particlesRef.<span class="hljs-property inline">current</span>.<span class="hljs-title function_ inline">push</span>(particle);
    }
}, [getThemeColors]);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">Why initial velocity is 0</strong>? Let particles start from rest, only moving when subject to external forces (animation effects), which feels more physically intuitive.</p>
<h3 id="animation-loop-time-precision-control" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#animation-loop-time-precision-control" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Animation Loop Time Precision Control">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Animation Loop Time Precision Control
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">This is the heart of the entire system—the animation loop:</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20animate%20%3D%20useCallback(()%20%3D%3E%20%7B%0Aconst%20mouse%20%3D%20mouseRef.current%3B%0Aconst%20width%20%3D%20window.innerWidth%3B%0Aconst%20height%20%3D%20window.innerHeight%3B%0Afor%20(let%20p%20of%20particlesRef.current)%20%7B%0A%2F%2F%20Base%20drift%20(simulate%20fluid%20motion)%0Ap.vx%20%2B%3D%200.01%20*%20p.depth%3B%0Ap.vy%20%2B%3D%200.005%20*%20p.depth%3B%0A%2F%2F%20Interactive%20force%20field%20calculation%0Aif%20(mouse.down)%20%7B%0Aconst%20dx%20%3D%20p.x%20-%20mouse.x%3B%0Aconst%20dy%20%3D%20p.y%20-%20mouse.y%3B%0Aconst%20dist%20%3D%20Math.sqrt(dx%20*%20dx%20%2B%20dy%20*%20dy)%3B%0Aif%20(dist%20100)%20%7B%0Aconst%20baseForce%20%3D%20100%20%2F%20(dist%20%2B%2010)%3B%0Aconst%20force%20%3D%20baseForce%20*%20p.depth%3B%0Ap.vx%20%2B%3D%20force%20*%20(dx%20%2F%20dist)%3B%0Ap.vy%20%2B%3D%20force%20*%20(dy%20%2F%20dist)%3B%0A%7D%0A%7D%0A%2F%2F%20Apply%20friction%0Ap.vx%20*%3D%200.95%3B%0Ap.vy%20*%3D%200.95%3B%0A%2F%2F%20Update%20position%0Ap.x%20%2B%3D%20p.vx%3B%0Ap.y%20%2B%3D%20p.vy%3B%0A%2F%2F%20Boundary%20wrapping%0Aif%20(p.x%2010)%20p.x%20%3D%20width%20%2B%2010%3B%0Aif%20(p.x%20%3E%20width%20%2B%2010)%20p.x%20%3D%20-10%3B%0Aif%20(p.y%2010)%20p.y%20%3D%20height%20%2B%2010%3B%0Aif%20(p.y%20%3E%20height%20%2B%2010)%20p.y%20%3D%20-10%3B%0A%2F%2F%20Visual%20effect%20updates%0Aconst%20scale%20%3D%200.6%20%2B%200.4%20*%20p.depth%3B%0Aconst%20opacity%20%3D%200.4%20%2B%200.6%20*%20p.depth%3B%0Ap.el.style.transform%20%3D%20%60translate(%24%7Bp.x%7Dpx%2C%20%24%7Bp.y%7Dpx)%20scale(%24%7Bscale%7D)%60%3B%0Ap.el.style.opacity%20%3D%20opacity.toString()%3B%0A%7D%0AanimationRef.current%20%3D%20requestAnimationFrame(animate)%3B%0A%7D%2C%20%5B%5D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> animate = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-keyword inline">const</span> mouse = mouseRef.<span class="hljs-property inline">current</span>;
    <span class="hljs-keyword inline">const</span> width = <span class="hljs-variable language_ inline">window</span>.<span class="hljs-property inline">innerWidth</span>;
    <span class="hljs-keyword inline">const</span> height = <span class="hljs-variable language_ inline">window</span>.<span class="hljs-property inline">innerHeight</span>;

    <span class="hljs-keyword inline">for</span> (<span class="hljs-keyword inline">let</span> p <span class="hljs-keyword inline">of</span> particlesRef.<span class="hljs-property inline">current</span>) {
        <span class="hljs-comment inline">// Base drift (simulate fluid motion)</span>
        p.<span class="hljs-property inline">vx</span> += <span class="hljs-number inline">0.01</span> * p.<span class="hljs-property inline">depth</span>;
        p.<span class="hljs-property inline">vy</span> += <span class="hljs-number inline">0.005</span> * p.<span class="hljs-property inline">depth</span>;

        <span class="hljs-comment inline">// Interactive force field calculation</span>
        <span class="hljs-keyword inline">if</span> (mouse.<span class="hljs-property inline">down</span>) {
            <span class="hljs-keyword inline">const</span> dx = p.<span class="hljs-property inline">x</span> - mouse.<span class="hljs-property inline">x</span>;
            <span class="hljs-keyword inline">const</span> dy = p.<span class="hljs-property inline">y</span> - mouse.<span class="hljs-property inline">y</span>;
            <span class="hljs-keyword inline">const</span> dist = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">sqrt</span>(dx * dx + dy * dy);

            <span class="hljs-keyword inline">if</span> (dist &lt; <span class="hljs-number inline">100</span>) {
                <span class="hljs-keyword inline">const</span> baseForce = <span class="hljs-number inline">100</span> / (dist + <span class="hljs-number inline">10</span>);
                <span class="hljs-keyword inline">const</span> force = baseForce * p.<span class="hljs-property inline">depth</span>;

                p.<span class="hljs-property inline">vx</span> += force * (dx / dist);
                p.<span class="hljs-property inline">vy</span> += force * (dy / dist);
            }
        }

        <span class="hljs-comment inline">// Apply friction</span>
        p.<span class="hljs-property inline">vx</span> *= <span class="hljs-number inline">0.95</span>;
        p.<span class="hljs-property inline">vy</span> *= <span class="hljs-number inline">0.95</span>;

        <span class="hljs-comment inline">// Update position</span>
        p.<span class="hljs-property inline">x</span> += p.<span class="hljs-property inline">vx</span>;
        p.<span class="hljs-property inline">y</span> += p.<span class="hljs-property inline">vy</span>;

        <span class="hljs-comment inline">// Boundary wrapping</span>
        <span class="hljs-keyword inline">if</span> (p.<span class="hljs-property inline">x</span> &lt; -<span class="hljs-number inline">10</span>) p.<span class="hljs-property inline">x</span> = width + <span class="hljs-number inline">10</span>;
        <span class="hljs-keyword inline">if</span> (p.<span class="hljs-property inline">x</span> &gt; width + <span class="hljs-number inline">10</span>) p.<span class="hljs-property inline">x</span> = -<span class="hljs-number inline">10</span>;
        <span class="hljs-keyword inline">if</span> (p.<span class="hljs-property inline">y</span> &lt; -<span class="hljs-number inline">10</span>) p.<span class="hljs-property inline">y</span> = height + <span class="hljs-number inline">10</span>;
        <span class="hljs-keyword inline">if</span> (p.<span class="hljs-property inline">y</span> &gt; height + <span class="hljs-number inline">10</span>) p.<span class="hljs-property inline">y</span> = -<span class="hljs-number inline">10</span>;

        <span class="hljs-comment inline">// Visual effect updates</span>
        <span class="hljs-keyword inline">const</span> scale = <span class="hljs-number inline">0.6</span> + <span class="hljs-number inline">0.4</span> * p.<span class="hljs-property inline">depth</span>;
        <span class="hljs-keyword inline">const</span> opacity = <span class="hljs-number inline">0.4</span> + <span class="hljs-number inline">0.6</span> * p.<span class="hljs-property inline">depth</span>;

        p.<span class="hljs-property inline">el</span>.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">transform</span> = <span class="hljs-string inline">`translate(<span class="hljs-subst inline">${p.x}</span>px, <span class="hljs-subst inline">${p.y}</span>px) scale(<span class="hljs-subst inline">${scale}</span>)`</span>;
        p.<span class="hljs-property inline">el</span>.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">opacity</span> = opacity.<span class="hljs-title function_ inline">toString</span>();
    }

    animationRef.<span class="hljs-property inline">current</span> = <span class="hljs-title function_ inline">requestAnimationFrame</span>(animate);
}, []);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">Value explanations:</p>
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">0.01 * p.depth</strong>: Base drift force, giving particles slight natural movement</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">0.005 * p.depth</strong>: Y-direction drift is smaller, simulating subtle gravity influence</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">100 / (dist + 10)</strong>: Inverse square force field, closer distance = stronger force, +10 avoids division by zero</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">0.95</strong>: Friction coefficient, gradually slowing particle movement, simulating air resistance</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">-10, +10</strong>: Boundary buffer, letting particles enter from off-screen to avoid sudden appearance</li>
</ol>
<h2 id="the-physics-world-of-interaction-systems" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#the-physics-world-of-interaction-systems" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to The Physics World of Interaction Systems">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            The Physics World of Interaction Systems
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">You don’t want the background UI to be just a dynamic wallpaper, right?—Woz Ki Shuo De</p>
<h3 id="complete-lifecycle-management-of-mouse-events" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#complete-lifecycle-management-of-mouse-events" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Complete Lifecycle Management of Mouse Events">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Complete Lifecycle Management of Mouse Events
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20mouseRef%20%3D%20useRefMouseState%3E(%7B%20x%3A%200%2C%20y%3A%200%2C%20down%3A%20false%20%7D)%3B%0Aconst%20updateMousePos%20%3D%20useCallback((e%3A%20MouseEvent%20%7C%20Touch)%20%3D%3E%20%7B%0AmouseRef.current.x%20%3D%20e.clientX%3B%0AmouseRef.current.y%20%3D%20e.clientY%3B%0A%7D%2C%20%5B%5D)%3B%0Aconst%20handleMouseDown%20%3D%20useCallback((e%3A%20MouseEvent)%20%3D%3E%20%7B%0AmouseRef.current.down%20%3D%20true%3B%0AupdateMousePos(e)%3B%0A%7D%2C%20%5BupdateMousePos%5D)%3B%0Aconst%20handleMouseUp%20%3D%20useCallback(()%20%3D%3E%20%7B%0AmouseRef.current.down%20%3D%20false%3B%0A%7D%2C%20%5B%5D)%3B%0Aconst%20handleMouseMove%20%3D%20useCallback((e%3A%20MouseEvent)%20%3D%3E%20%7B%0Aif%20(mouseRef.current.down)%20updateMousePos(e)%3B%0A%7D%2C%20%5BupdateMousePos%5D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> mouseRef = useRef&lt;<span class="hljs-title class_ inline">MouseState</span>&gt;({ <span class="hljs-attr inline">x</span>: <span class="hljs-number inline">0</span>, <span class="hljs-attr inline">y</span>: <span class="hljs-number inline">0</span>, <span class="hljs-attr inline">down</span>: <span class="hljs-literal inline">false</span> });

<span class="hljs-keyword inline">const</span> updateMousePos = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">e</span>: <span class="hljs-title class_ inline">MouseEvent</span> | <span class="hljs-title class_ inline">Touch</span></span>) =&gt;</span> {
    mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">x</span> = e.<span class="hljs-property inline">clientX</span>;
    mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">y</span> = e.<span class="hljs-property inline">clientY</span>;
}, []);

<span class="hljs-keyword inline">const</span> handleMouseDown = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">e</span>: <span class="hljs-title class_ inline">MouseEvent</span></span>) =&gt;</span> {
    mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span> = <span class="hljs-literal inline">true</span>;
    <span class="hljs-title function_ inline">updateMousePos</span>(e);
}, [updateMousePos]);

<span class="hljs-keyword inline">const</span> handleMouseUp = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">() =&gt;</span> {
    mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span> = <span class="hljs-literal inline">false</span>;
}, []);

<span class="hljs-keyword inline">const</span> handleMouseMove = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">e</span>: <span class="hljs-title class_ inline">MouseEvent</span></span>) =&gt;</span> {
    <span class="hljs-keyword inline">if</span> (mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span>) <span class="hljs-title function_ inline">updateMousePos</span>(e);
}, [updateMousePos]);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">Why use ref instead of state</strong>? Because in a 60fps animation loop, we need to read mouse position every frame. Using state would cause unnecessary re-renders. Ref provides an “escape hatch from React’s render cycle.”</p>
<h3 id="mathematical-principles-of-force-field-calculation" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#mathematical-principles-of-force-field-calculation" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Mathematical Principles of Force Field Calculation">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Mathematical Principles of Force Field Calculation
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">This is the core of physics simulation:</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20Calculate%20vector%20from%20particle%20to%20mouse%0Aconst%20dx%20%3D%20p.x%20-%20mouse.x%3B%0Aconst%20dy%20%3D%20p.y%20-%20mouse.y%3B%0A%2F%2F%20Calculate%20distance%20(Euclidean%20distance)%0Aconst%20dist%20%3D%20Math.sqrt(dx%20*%20dx%20%2B%20dy%20*%20dy)%3B%0A%2F%2F%20Inverse%20square%20force%20field%20(like%20gravity)%0Aconst%20baseForce%20%3D%20100%20%2F%20(dist%20%2B%2010)%3B%0A%2F%2F%20Depth%20affects%20force%20magnitude%0Aconst%20force%20%3D%20baseForce%20*%20p.depth%3B%0A%2F%2F%20Calculate%20unit%20vector%20and%20apply%20force%0Ap.vx%20%2B%3D%20force%20*%20(dx%20%2F%20dist)%3B%0Ap.vy%20%2B%3D%20force%20*%20(dy%20%2F%20dist)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// Calculate vector from particle to mouse</span>
<span class="hljs-keyword inline">const</span> dx = p.<span class="hljs-property inline">x</span> - mouse.<span class="hljs-property inline">x</span>;
<span class="hljs-keyword inline">const</span> dy = p.<span class="hljs-property inline">y</span> - mouse.<span class="hljs-property inline">y</span>;

<span class="hljs-comment inline">// Calculate distance (Euclidean distance)</span>
<span class="hljs-keyword inline">const</span> dist = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">sqrt</span>(dx * dx + dy * dy);

<span class="hljs-comment inline">// Inverse square force field (like gravity)</span>
<span class="hljs-keyword inline">const</span> baseForce = <span class="hljs-number inline">100</span> / (dist + <span class="hljs-number inline">10</span>);

<span class="hljs-comment inline">// Depth affects force magnitude</span>
<span class="hljs-keyword inline">const</span> force = baseForce * p.<span class="hljs-property inline">depth</span>;

<span class="hljs-comment inline">// Calculate unit vector and apply force</span>
p.<span class="hljs-property inline">vx</span> += force * (dx / dist);
p.<span class="hljs-property inline">vy</span> += force * (dy / dist);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">This formula simulates a &quot;repulsion field&quot;:</p>
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Distance calculation</strong>: Uses Pythagorean theorem to calculate actual distance</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Force magnitude</strong>: Uses inverse square law, closer distance = stronger force</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Force direction</strong>: <code>(dx/dist, dy/dist)</code> is the unit vector from mouse to particle</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Depth weighting</strong>: Particles closer to screen are more affected by force, adding depth perception</li>
</ol>
<h3 id="multi-touch-support" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#multi-touch-support" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Multi-touch Support">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Multi-touch Support
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20handleTouchStart%20%3D%20useCallback((e%3A%20TouchEvent)%20%3D%3E%20%7B%0AmouseRef.current.down%20%3D%20true%3B%0AupdateMousePos(e.touches%5B0%5D)%3B%0A%7D%2C%20%5BupdateMousePos%5D)%3B%0Aconst%20handleTouchMove%20%3D%20useCallback((e%3A%20TouchEvent)%20%3D%3E%20%7B%0Aif%20(mouseRef.current.down)%20updateMousePos(e.touches%5B0%5D)%3B%0A%7D%2C%20%5BupdateMousePos%5D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> handleTouchStart = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">e</span>: <span class="hljs-title class_ inline">TouchEvent</span></span>) =&gt;</span> {
    mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span> = <span class="hljs-literal inline">true</span>;
    <span class="hljs-title function_ inline">updateMousePos</span>(e.<span class="hljs-property inline">touches</span>[<span class="hljs-number inline">0</span>]);
}, [updateMousePos]);

<span class="hljs-keyword inline">const</span> handleTouchMove = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">e</span>: <span class="hljs-title class_ inline">TouchEvent</span></span>) =&gt;</span> {
    <span class="hljs-keyword inline">if</span> (mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span>) <span class="hljs-title function_ inline">updateMousePos</span>(e.<span class="hljs-property inline">touches</span>[<span class="hljs-number inline">0</span>]);
}, [updateMousePos]);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">Mobile device support only takes the first touch point because multi-touch physics simulation would become extremely complex, and most users only use one finger anyway. <del class="line-through opacity-60">(Rationalization of laziness)</del></p>
<h3 id="friction-simulation" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#friction-simulation" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Friction Simulation">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Friction Simulation
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="p.vx%20*%3D%200.95%3B%0Ap.vy%20*%3D%200.95%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript">p.<span class="hljs-property inline">vx</span> *= <span class="hljs-number inline">0.95</span>;
p.<span class="hljs-property inline">vy</span> *= <span class="hljs-number inline">0.95</span>;
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><del class="line-through opacity-60">Random friction coefficient found online.</del></p>
<h2 id="color-mixing-in-theme-systems" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#color-mixing-in-theme-systems" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Color Mixing in Theme Systems">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Color Mixing in Theme Systems
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">The foam background needs seamless integration with the website’s theme system, involving fairly complex color mixing calculations.</p>
<h3 id="hsl-color-space" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#hsl-color-space" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to HSL Color Space">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            HSL Color Space
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">Compared to RGB, HSL is more suitable for generating similar colors:</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20hexToHsl%20%3D%20useCallback((hex%3A%20string)%20%3D%3E%20%7B%0A%2F%2F%20Convert%20hex%20to%20RGB%0Aconst%20r%20%3D%20parseInt(hex.slice(1%2C%203)%2C%2016)%20%2F%20255%3B%0Aconst%20g%20%3D%20parseInt(hex.slice(3%2C%205)%2C%2016)%20%2F%20255%3B%0Aconst%20b%20%3D%20parseInt(hex.slice(5%2C%207)%2C%2016)%20%2F%20255%3B%0A%2F%2F%20Find%20max%20and%20min%20values%0Aconst%20max%20%3D%20Math.max(r%2C%20g%2C%20b)%3B%0Aconst%20min%20%3D%20Math.min(r%2C%20g%2C%20b)%3B%0Alet%20h%20%3D%200%2C%20s%20%3D%200%2C%20l%20%3D%20(max%20%2B%20min)%20%2F%202%3B%0Aif%20(max%20!%3D%3D%20min)%20%7B%0Aconst%20d%20%3D%20max%20-%20min%3B%0As%20%3D%20l%20%3E%200.5%20%3F%20d%20%2F%20(2%20-%20max%20-%20min)%20%3A%20d%20%2F%20(max%20%2B%20min)%3B%0Aswitch%20(max)%20%7B%0Acase%20r%3A%20h%20%3D%20(g%20-%20b)%20%2F%20d%20%2B%20(g%206%20%3A%200)%3B%20break%3B%0Acase%20g%3A%20h%20%3D%20(b%20-%20r)%20%2F%20d%20%2B%202%3B%20break%3B%0Acase%20b%3A%20h%20%3D%20(r%20-%20g)%20%2F%20d%20%2B%204%3B%20break%3B%0A%7D%0Ah%20%2F%3D%206%3B%0A%7D%0Areturn%20%5BMath.round(h%20*%20360)%2C%20Math.round(s%20*%20100)%2C%20Math.round(l%20*%20100)%5D%3B%0A%7D%2C%20%5B%5D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> hexToHsl = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">hex</span>: <span class="hljs-built_in inline">string</span></span>) =&gt;</span> {
    <span class="hljs-comment inline">// Convert hex to RGB</span>
    <span class="hljs-keyword inline">const</span> r = <span class="hljs-built_in inline">parseInt</span>(hex.<span class="hljs-title function_ inline">slice</span>(<span class="hljs-number inline">1</span>, <span class="hljs-number inline">3</span>), <span class="hljs-number inline">16</span>) / <span class="hljs-number inline">255</span>;
    <span class="hljs-keyword inline">const</span> g = <span class="hljs-built_in inline">parseInt</span>(hex.<span class="hljs-title function_ inline">slice</span>(<span class="hljs-number inline">3</span>, <span class="hljs-number inline">5</span>), <span class="hljs-number inline">16</span>) / <span class="hljs-number inline">255</span>;
    <span class="hljs-keyword inline">const</span> b = <span class="hljs-built_in inline">parseInt</span>(hex.<span class="hljs-title function_ inline">slice</span>(<span class="hljs-number inline">5</span>, <span class="hljs-number inline">7</span>), <span class="hljs-number inline">16</span>) / <span class="hljs-number inline">255</span>;

    <span class="hljs-comment inline">// Find max and min values</span>
    <span class="hljs-keyword inline">const</span> max = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">max</span>(r, g, b);
    <span class="hljs-keyword inline">const</span> min = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">min</span>(r, g, b);
    <span class="hljs-keyword inline">let</span> h = <span class="hljs-number inline">0</span>, s = <span class="hljs-number inline">0</span>, l = (max + min) / <span class="hljs-number inline">2</span>;

    <span class="hljs-keyword inline">if</span> (max !== min) {
        <span class="hljs-keyword inline">const</span> d = max - min;
        s = l &gt; <span class="hljs-number inline">0.5</span> ? d / (<span class="hljs-number inline">2</span> - max - min) : d / (max + min);
        
        <span class="hljs-keyword inline">switch</span> (max) {
            <span class="hljs-keyword inline">case</span> <span class="hljs-attr inline">r</span>: h = (g - b) / d + (g &lt; b ? <span class="hljs-number inline">6</span> : <span class="hljs-number inline">0</span>); <span class="hljs-keyword inline">break</span>;
            <span class="hljs-keyword inline">case</span> <span class="hljs-attr inline">g</span>: h = (b - r) / d + <span class="hljs-number inline">2</span>; <span class="hljs-keyword inline">break</span>;
            <span class="hljs-keyword inline">case</span> <span class="hljs-attr inline">b</span>: h = (r - g) / d + <span class="hljs-number inline">4</span>; <span class="hljs-keyword inline">break</span>;
        }
        h /= <span class="hljs-number inline">6</span>;
    }

    <span class="hljs-keyword inline">return</span> [<span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">round</span>(h * <span class="hljs-number inline">360</span>), <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">round</span>(s * <span class="hljs-number inline">100</span>), <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">round</span>(l * <span class="hljs-number inline">100</span>)];
}, []);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">This conversion algorithm looks complex but the principle is intuitive:</p>
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Normalize RGB to 0-1 range</strong></li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Calculate lightness (L)</strong>: Average of max and min values</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Calculate saturation (S)</strong>: Based on lightness and color range</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Calculate hue (H)</strong>: Based on dominant color position</li>
</ol>
<h3 id="dynamic-generation-strategy-for-theme-response" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#dynamic-generation-strategy-for-theme-response" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Dynamic Generation Strategy for Theme Response">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Dynamic Generation Strategy for Theme Response
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20getThemeColors%20%3D%20useCallback(()%20%3D%3E%20%7B%0Aconst%20%5BprimaryH%2C%20primaryS%5D%20%3D%20hexToHsl(currentTheme.colors.primary)%3B%0Aconst%20%5BaccentH%2C%20accentS%5D%20%3D%20hexToHsl(currentTheme.colors.accent)%3B%0Aconst%20isDark%20%3D%20currentTheme.id%20%3D%3D%3D%20'dark'%3B%0Aif%20(isDark)%20%7B%0A%2F%2F%20Dark%20theme%3A%20deeper%2C%20more%20saturated%20colors%0Areturn%20%7B%0Abackground%3A%20%60linear-gradient(135deg%2C%20hsl(%24%7BprimaryH%7D%2C%20%24%7BMath.max(primaryS%20%2B%2010%2C%2040)%7D%25%2C%2025%25)%2C%20hsl(%24%7BaccentH%7D%2C%20%24%7BMath.max(accentS%20%2B%205%2C%2035)%7D%25%2C%2020%25))%60%2C%0Aparticle%3A%20%60hsl(%24%7BprimaryH%7D%2C%20%24%7BMath.max(primaryS%20%2B%2015%2C%2050)%7D%25%2C%2045%25)%60%0A%7D%3B%0A%7D%20else%20%7B%0A%2F%2F%20Light%20theme%3A%20brighter%20colors%0Areturn%20%7B%0Abackground%3A%20%60linear-gradient(135deg%2C%20hsl(%24%7BprimaryH%7D%2C%20%24%7BMath.max(primaryS%20-%2020%2C%2020)%7D%25%2C%2060%25)%2C%20hsl(%24%7BaccentH%7D%2C%20%24%7BMath.max(accentS%20-%2010%2C%2030)%7D%25%2C%2050%25))%60%2C%0Aparticle%3A%20%60hsl(%24%7BprimaryH%7D%2C%20%24%7BMath.max(primaryS%20-%2010%2C%2035)%7D%25%2C%2075%25)%60%0A%7D%3B%0A%7D%0A%7D%2C%20%5BcurrentTheme%2C%20hexToHsl%5D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> getThemeColors = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-keyword inline">const</span> [primaryH, primaryS] = <span class="hljs-title function_ inline">hexToHsl</span>(currentTheme.<span class="hljs-property inline">colors</span>.<span class="hljs-property inline">primary</span>);
    <span class="hljs-keyword inline">const</span> [accentH, accentS] = <span class="hljs-title function_ inline">hexToHsl</span>(currentTheme.<span class="hljs-property inline">colors</span>.<span class="hljs-property inline">accent</span>);
    
    <span class="hljs-keyword inline">const</span> isDark = currentTheme.<span class="hljs-property inline">id</span> === <span class="hljs-string inline">&#x27;dark&#x27;</span>;
    
    <span class="hljs-keyword inline">if</span> (isDark) {
        <span class="hljs-comment inline">// Dark theme: deeper, more saturated colors</span>
        <span class="hljs-keyword inline">return</span> {
            <span class="hljs-attr inline">background</span>: <span class="hljs-string inline">`linear-gradient(135deg, hsl(<span class="hljs-subst inline">${primaryH}</span>, <span class="hljs-subst inline">${<span class="hljs-built_in inline">Math</span>.max(primaryS + <span class="hljs-number inline">10</span>, <span class="hljs-number inline">40</span>)}</span>%, 25%), hsl(<span class="hljs-subst inline">${accentH}</span>, <span class="hljs-subst inline">${<span class="hljs-built_in inline">Math</span>.max(accentS + <span class="hljs-number inline">5</span>, <span class="hljs-number inline">35</span>)}</span>%, 20%))`</span>,
            <span class="hljs-attr inline">particle</span>: <span class="hljs-string inline">`hsl(<span class="hljs-subst inline">${primaryH}</span>, <span class="hljs-subst inline">${<span class="hljs-built_in inline">Math</span>.max(primaryS + <span class="hljs-number inline">15</span>, <span class="hljs-number inline">50</span>)}</span>%, 45%)`</span>
        };
    } <span class="hljs-keyword inline">else</span> {
        <span class="hljs-comment inline">// Light theme: brighter colors</span>
        <span class="hljs-keyword inline">return</span> {
            <span class="hljs-attr inline">background</span>: <span class="hljs-string inline">`linear-gradient(135deg, hsl(<span class="hljs-subst inline">${primaryH}</span>, <span class="hljs-subst inline">${<span class="hljs-built_in inline">Math</span>.max(primaryS - <span class="hljs-number inline">20</span>, <span class="hljs-number inline">20</span>)}</span>%, 60%), hsl(<span class="hljs-subst inline">${accentH}</span>, <span class="hljs-subst inline">${<span class="hljs-built_in inline">Math</span>.max(accentS - <span class="hljs-number inline">10</span>, <span class="hljs-number inline">30</span>)}</span>%, 50%))`</span>,
            <span class="hljs-attr inline">particle</span>: <span class="hljs-string inline">`hsl(<span class="hljs-subst inline">${primaryH}</span>, <span class="hljs-subst inline">${<span class="hljs-built_in inline">Math</span>.max(primaryS - <span class="hljs-number inline">10</span>, <span class="hljs-number inline">35</span>)}</span>%, 75%)`</span>
        };
    }
}, [currentTheme, hexToHsl]);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">This function considers multiple factors:</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Saturation adjustment</strong>: Dark mode increases saturation, light mode decreases it, ensuring appropriate contrast</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Lightness control</strong>: Dark mode uses lower lightness values (20-45%), light mode uses higher values (50-75%)</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Gradient design</strong>: 135-degree diagonal gradient from primary to accent color, creating spatial depth</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Safety boundaries</strong>: Uses <code>Math.max()</code> to ensure saturation and lightness don’t go too low</li>
</ul>
<h3 id="real-time-updates-of-dynamic-colors" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#real-time-updates-of-dynamic-colors" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Real-time Updates of Dynamic Colors">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Real-time Updates of Dynamic Colors
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="useEffect(()%20%3D%3E%20%7B%0Aif%20(particlesRef.current.length%20%3E%200)%20%7B%0Aconst%20colors%20%3D%20getThemeColors()%3B%0A%2F%2F%20Update%20all%20particle%20colors%0AparticlesRef.current.forEach(p%20%3D%3E%20%7B%0Ap.el.style.backgroundColor%20%3D%20colors.particle%3B%0A%7D)%3B%0A%2F%2F%20Update%20container%20background%0Aif%20(containerRef.current)%20%7B%0AcontainerRef.current.style.background%20%3D%20colors.background%3B%0A%7D%0A%7D%0A%7D%2C%20%5BcurrentTheme%2C%20getThemeColors%5D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-title function_ inline">useEffect</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-keyword inline">if</span> (particlesRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">length</span> &gt; <span class="hljs-number inline">0</span>) {
        <span class="hljs-keyword inline">const</span> colors = <span class="hljs-title function_ inline">getThemeColors</span>();
        
        <span class="hljs-comment inline">// Update all particle colors</span>
        particlesRef.<span class="hljs-property inline">current</span>.<span class="hljs-title function_ inline">forEach</span>(<span class="hljs-function inline"><span class="hljs-params inline">p</span> =&gt;</span> {
            p.<span class="hljs-property inline">el</span>.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">backgroundColor</span> = colors.<span class="hljs-property inline">particle</span>;
        });
        
        <span class="hljs-comment inline">// Update container background</span>
        <span class="hljs-keyword inline">if</span> (containerRef.<span class="hljs-property inline">current</span>) {
            containerRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">background</span> = colors.<span class="hljs-property inline">background</span>;
        }
    }
}, [currentTheme, getThemeColors]);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">When themes switch, all particles synchronously update colors without recreating DOM elements, ensuring smooth transitions.</p>
<h3 id="depth-mathematical-model" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#depth-mathematical-model" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Depth Mathematical Model">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Depth Mathematical Model
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20depth%20%3D%20Math.random()%3B%20%2F%2F%20Random%20depth%20value%200-1%0A%2F%2F%20Depth-based%20scaling%0Aconst%20scale%20%3D%200.6%20%2B%200.4%20*%20depth%3B%0A%2F%2F%20Depth-based%20opacity%0Aconst%20opacity%20%3D%200.4%20%2B%200.6%20*%20depth%3B%0A%2F%2F%20Depth-based%20movement%20speed%0Ap.vx%20%2B%3D%200.01%20*%20p.depth%3B%0Ap.vy%20%2B%3D%200.005%20*%20p.depth%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> depth = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">random</span>(); <span class="hljs-comment inline">// Random depth value 0-1</span>

<span class="hljs-comment inline">// Depth-based scaling</span>
<span class="hljs-keyword inline">const</span> scale = <span class="hljs-number inline">0.6</span> + <span class="hljs-number inline">0.4</span> * depth;

<span class="hljs-comment inline">// Depth-based opacity</span>
<span class="hljs-keyword inline">const</span> opacity = <span class="hljs-number inline">0.4</span> + <span class="hljs-number inline">0.6</span> * depth;

<span class="hljs-comment inline">// Depth-based movement speed</span>
p.<span class="hljs-property inline">vx</span> += <span class="hljs-number inline">0.01</span> * p.<span class="hljs-property inline">depth</span>;
p.<span class="hljs-property inline">vy</span> += <span class="hljs-number inline">0.005</span> * p.<span class="hljs-property inline">depth</span>;
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">Layered rendering:</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">scale: 0.6-1.0</strong>: Distant particles are small, near particles are large</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">opacity: 0.4-1.0</strong>: Distant particles are transparent, near particles are opaque</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">speed: depth multiplier</strong>: Near particles move faster, distant particles move slower</li>
</ul>
<h3 id="parallax-motion-simulation" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#parallax-motion-simulation" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Parallax Motion Simulation">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Parallax Motion Simulation
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20In%20interaction%20force%20calculation%0Aconst%20force%20%3D%20baseForce%20*%20p.depth%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// In interaction force calculation</span>
<span class="hljs-keyword inline">const</span> force = baseForce * p.<span class="hljs-property inline">depth</span>;
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">Using depth value as force multiplier means:</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed">Near particles are more sensitive to interaction</li>
<li class="text-foreground leading-relaxed">Distant particles react more sluggishly</li>
<li class="text-foreground leading-relaxed">Overall presents parallax scrolling effect</li>
</ul>
<p class="text-base leading-7 mb-4 text-foreground">This design makes users feel like they’re interacting with a real 3D space rather than points on a plane. (Maybe?)</p>
<h2 id="particle-redistribution-in-responsive-layout" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#particle-redistribution-in-responsive-layout" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Particle Redistribution in Responsive Layout">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Particle Redistribution in Responsive Layout
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">When window size changes, the particle system needs to flexibly adapt to new dimensions.</p>
<h3 id="window-size-change-monitoring-strategy" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#window-size-change-monitoring-strategy" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Window Size Change Monitoring Strategy">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Window Size Change Monitoring Strategy
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20handleResize%20%3D%20useCallback(()%20%3D%3E%20%7B%0A%2F%2F%20Reinitialize%20particle%20distribution%0AinitializeParticles()%3B%0A%7D%2C%20%5BinitializeParticles%5D)%3B%0AuseEffect(()%20%3D%3E%20%7B%0Awindow.addEventListener('resize'%2C%20handleResize)%3B%0Areturn%20()%20%3D%3E%20window.removeEventListener('resize'%2C%20handleResize)%3B%0A%7D%2C%20%5BhandleResize%5D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> handleResize = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-comment inline">// Reinitialize particle distribution</span>
    <span class="hljs-title function_ inline">initializeParticles</span>();
}, [initializeParticles]);

<span class="hljs-title function_ inline">useEffect</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-variable language_ inline">window</span>.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;resize&#x27;</span>, handleResize);
    
    <span class="hljs-keyword inline">return</span> <span class="hljs-function inline">() =&gt;</span> <span class="hljs-variable language_ inline">window</span>.<span class="hljs-title function_ inline">removeEventListener</span>(<span class="hljs-string inline">&#x27;resize&#x27;</span>, handleResize);
}, [handleResize]);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">Why choose reinitialization over repositioning</strong>? Because repositioning existing particles would cause visual “jumping,” while reinitialization, though briefly rebuilding, creates more natural visual effects.</p>
<h3 id="memory-safety-of-particle-cleanup" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#memory-safety-of-particle-cleanup" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Memory Safety of Particle Cleanup">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Memory Safety of Particle Cleanup
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20Clean%20existing%20particles%0AparticlesRef.current.forEach(p%20%3D%3E%20p.el.remove())%3B%0AparticlesRef.current%20%3D%20%5B%5D%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// Clean existing particles</span>
particlesRef.<span class="hljs-property inline">current</span>.<span class="hljs-title function_ inline">forEach</span>(<span class="hljs-function inline"><span class="hljs-params inline">p</span> =&gt;</span> p.<span class="hljs-property inline">el</span>.<span class="hljs-title function_ inline">remove</span>());
particlesRef.<span class="hljs-property inline">current</span> = [];
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">Why manual remove</strong>? Because we use native DOM operations, React won’t automatically clean these elements. Without manual removal, DOM would accumulate lots of invisible elements, causing memory leaks.</p>
<h3 id="necessity-of-debouncing" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#necessity-of-debouncing" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Necessity of Debouncing">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Necessity of Debouncing
        </h3>
<p class="text-base leading-7 mb-4 text-foreground">When users resize windows, resize events fire frantically. Without debouncing, every tiny window change would recreate 300 particles—after dragging back and forth dozens of times, you might hear the beautiful sound of GPU fans spinning.</p>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">Debounce implementation</strong>:</p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20Debounce%20utility%20function%0Aconst%20debounce%20%3D%20useCallback((func%3A%20Function%2C%20wait%3A%20number)%20%3D%3E%20%7B%0Alet%20timeout%3A%20NodeJS.Timeout%3B%0Areturn%20function%20executedFunction(...args%3A%20any%5B%5D)%20%7B%0Aconst%20later%20%3D%20()%20%3D%3E%20%7B%0AclearTimeout(timeout)%3B%0Afunc(...args)%3B%0A%7D%3B%0AclearTimeout(timeout)%3B%0Atimeout%20%3D%20setTimeout(later%2C%20wait)%3B%0A%7D%3B%0A%7D%2C%20%5B%5D)%3B%0A%2F%2F%20Create%20debounced%20resize%20handler%0Aconst%20debouncedHandleResize%20%3D%20useCallback(%0Adebounce(handleResize%2C%201000)%2C%20%2F%2F%201%20second%20debounce%20delay%0A%5Bdebounce%2C%20handleResize%5D%0A)%3B%0A%2F%2F%20Use%20debounced%20version%20in%20event%20listener%0AuseEffect(()%20%3D%3E%20%7B%0Awindow.addEventListener('resize'%2C%20debouncedHandleResize)%3B%0Areturn%20()%20%3D%3E%20%7B%0Awindow.removeEventListener('resize'%2C%20debouncedHandleResize)%3B%0A%7D%3B%0A%7D%2C%20%5BdebouncedHandleResize%5D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// Debounce utility function</span>
<span class="hljs-keyword inline">const</span> debounce = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">func</span>: <span class="hljs-title class_ inline">Function</span>, <span class="hljs-attr inline">wait</span>: <span class="hljs-built_in inline">number</span></span>) =&gt;</span> {
    <span class="hljs-keyword inline">let</span> <span class="hljs-attr inline">timeout</span>: <span class="hljs-title class_ inline">NodeJS</span>.<span class="hljs-property inline">Timeout</span>;
    <span class="hljs-keyword inline">return</span> <span class="hljs-keyword inline">function</span> <span class="hljs-title function_ inline">executedFunction</span>(<span class="hljs-params inline">...<span class="hljs-attr inline">args</span>: <span class="hljs-built_in inline">any</span>[]</span>) {
        <span class="hljs-keyword inline">const</span> <span class="hljs-title function_ inline">later</span> = (<span class="hljs-params inline"></span>) =&gt; {
            <span class="hljs-built_in inline">clearTimeout</span>(timeout);
            <span class="hljs-title function_ inline">func</span>(...args);
        };
        <span class="hljs-built_in inline">clearTimeout</span>(timeout);
        timeout = <span class="hljs-built_in inline">setTimeout</span>(later, wait);
    };
}, []);

<span class="hljs-comment inline">// Create debounced resize handler</span>
<span class="hljs-keyword inline">const</span> debouncedHandleResize = <span class="hljs-title function_ inline">useCallback</span>(
    <span class="hljs-title function_ inline">debounce</span>(handleResize, <span class="hljs-number inline">1000</span>), <span class="hljs-comment inline">// 1 second debounce delay</span>
    [debounce, handleResize]
);

<span class="hljs-comment inline">// Use debounced version in event listener</span>
<span class="hljs-title function_ inline">useEffect</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-variable language_ inline">window</span>.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;resize&#x27;</span>, debouncedHandleResize);
    
    <span class="hljs-keyword inline">return</span> <span class="hljs-function inline">() =&gt;</span> {
        <span class="hljs-variable language_ inline">window</span>.<span class="hljs-title function_ inline">removeEventListener</span>(<span class="hljs-string inline">&#x27;resize&#x27;</span>, debouncedHandleResize);
    };
}, [debouncedHandleResize]);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">How debouncing works</strong>:</p>
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed">User starts dragging window → First resize event arrives</li>
<li class="text-foreground leading-relaxed">Debounce function sets 1000ms timer, preparing to execute rebuild</li>
<li class="text-foreground leading-relaxed">User continues dragging → More resize events arrive</li>
<li class="text-foreground leading-relaxed">Each new event cancels previous timer and restarts countdown</li>
<li class="text-foreground leading-relaxed">User stops dragging for 1000ms → Timer triggers, executes particle rebuild</li>
</ol>
<p class="text-base leading-7 mb-4 text-foreground">This optimizes what could be dozens of rebuild operations into just one rebuild after the user truly “finishes adjusting.”</p>
<h2 id="key-performance-optimization-strategies" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#key-performance-optimization-strategies" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Key Performance Optimization Strategies">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Key Performance Optimization Strategies
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">Animating 300 DOM elements simultaneously is a severe test for browsers—every optimization detail is crucial.</p>
<h3 id="proper-use-of-willchange-property" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#proper-use-of-willchange-property" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Proper Use of willChange Property">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Proper Use of willChange Property
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="el.style.willChange%20%3D%20'transform%2C%20opacity'%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript">el.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">willChange</span> = <span class="hljs-string inline">&#x27;transform, opacity&#x27;</span>;
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">This line tells the browser: “This element’s transform and opacity will change frequently, please prepare a GPU layer for it.”</p>
<p class="text-base leading-7 mb-4 text-foreground">But! willChange is a double-edged sword:</p>
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Benefits</strong>: Enables GPU acceleration, smoother animations</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Drawbacks</strong>: Consumes extra GPU memory, too much use can backfire</li>
</ul>
<p class="text-base leading-7 mb-4 text-foreground">So we only use it on properties that truly need animation.</p>
<h3 id="requestanimationframe-lifecycle-management" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#requestanimationframe-lifecycle-management" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to requestAnimationFrame Lifecycle Management">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            requestAnimationFrame Lifecycle Management
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="useEffect(()%20%3D%3E%20%7B%0Aanimate()%3B%0Areturn%20()%20%3D%3E%20%7B%0Aif%20(animationIdRef.current%20!%3D%3D%20null)%20%7B%0AcancelAnimationFrame(animationIdRef.current)%3B%0A%7D%0A%2F%2F%20Clean%20all%20particles%0AparticlesRef.current.forEach(p%20%3D%3E%20p.el.remove())%3B%0A%7D%3B%0A%7D%2C%20%5Banimate%5D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-title function_ inline">useEffect</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-title function_ inline">animate</span>();
    
    <span class="hljs-keyword inline">return</span> <span class="hljs-function inline">() =&gt;</span> {
        <span class="hljs-keyword inline">if</span> (animationIdRef.<span class="hljs-property inline">current</span> !== <span class="hljs-literal inline">null</span>) {
            <span class="hljs-title function_ inline">cancelAnimationFrame</span>(animationIdRef.<span class="hljs-property inline">current</span>);
        }
        
        <span class="hljs-comment inline">// Clean all particles</span>
        particlesRef.<span class="hljs-property inline">current</span>.<span class="hljs-title function_ inline">forEach</span>(<span class="hljs-function inline"><span class="hljs-params inline">p</span> =&gt;</span> p.<span class="hljs-property inline">el</span>.<span class="hljs-title function_ inline">remove</span>());
    };
}, [animate]);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground">This cleanup function does two important things:</p>
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Cancel animation frames</strong>: Prevents animation from continuing after component unmounts</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Clean DOM elements</strong>: Prevents memory leaks</li>
</ol>
<h3 id="z-index-strategy-for-layer-management" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#z-index-strategy-for-layer-management" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to z-index Strategy for Layer Management">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            z-index Strategy for Layer Management
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="className%3D%22fixed%20inset-0%20w-full%20h-full%20overflow-hidden%20pointer-events-none%20z-0%22">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript">className=<span class="hljs-string inline">&quot;fixed inset-0 w-full h-full overflow-hidden pointer-events-none z-0&quot;</span>
</code></pre>
            </div>
        
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">z-0</strong>: Ensures background stays at bottom layer, never obscuring other content</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">pointer-events-none</strong>: Makes entire container non-responsive to mouse events, avoiding page interaction interference</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">overflow-hidden</strong>: Prevents particles from displaying outside container</li>
</ul>
<h2 id="edge-cases-in-event-handling" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#edge-cases-in-event-handling" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Edge Cases in Event Handling">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Edge Cases in Event Handling
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">Real-world user interactions are far more complex than ideal scenarios—we need to handle various edge cases.</p>
<h3 id="special-handling-for-touch-devices" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#special-handling-for-touch-devices" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Special Handling for Touch Devices">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Special Handling for Touch Devices
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="const%20handleTouchStart%20%3D%20useCallback((e%3A%20TouchEvent)%20%3D%3E%20%7B%0AmouseRef.current.down%20%3D%20true%3B%0AupdateMousePos(e.touches%5B0%5D)%3B%0A%7D%2C%20%5BupdateMousePos%5D)%3B%0Aconst%20handleTouchMove%20%3D%20useCallback((e%3A%20TouchEvent)%20%3D%3E%20%7B%0Aif%20(mouseRef.current.down)%20updateMousePos(e.touches%5B0%5D)%3B%0A%7D%2C%20%5BupdateMousePos%5D)%3B%0Aconst%20handleTouchEnd%20%3D%20useCallback(()%20%3D%3E%20%7B%0AmouseRef.current.down%20%3D%20false%3B%0A%7D%2C%20%5B%5D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-keyword inline">const</span> handleTouchStart = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">e</span>: <span class="hljs-title class_ inline">TouchEvent</span></span>) =&gt;</span> {
    mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span> = <span class="hljs-literal inline">true</span>;
    <span class="hljs-title function_ inline">updateMousePos</span>(e.<span class="hljs-property inline">touches</span>[<span class="hljs-number inline">0</span>]);
}, [updateMousePos]);

<span class="hljs-keyword inline">const</span> handleTouchMove = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">e</span>: <span class="hljs-title class_ inline">TouchEvent</span></span>) =&gt;</span> {
    <span class="hljs-keyword inline">if</span> (mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span>) <span class="hljs-title function_ inline">updateMousePos</span>(e.<span class="hljs-property inline">touches</span>[<span class="hljs-number inline">0</span>]);
}, [updateMousePos]);

<span class="hljs-keyword inline">const</span> handleTouchEnd = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">() =&gt;</span> {
    mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span> = <span class="hljs-literal inline">false</span>;
}, []);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">Why only take the first touch point</strong>? Because multi-touch would make force field calculations extremely complex, and most users only use one finger to “poke bubbles” anyway.</p>
<h3 id="event-listener-scope-control" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#event-listener-scope-control" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Event Listener Scope Control">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Event Listener Scope Control
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20Global%20events%0Adocument.addEventListener('mousedown'%2C%20handleMouseDown)%3B%0Adocument.addEventListener('mouseup'%2C%20handleMouseUp)%3B%0Adocument.addEventListener('mousemove'%2C%20handleMouseMove)%3B%0A%2F%2F%20Container%20local%20events%0Acontainer.addEventListener('touchstart'%2C%20handleTouchStart)%3B%0Acontainer.addEventListener('touchend'%2C%20handleTouchEnd)%3B%0Acontainer.addEventListener('touchmove'%2C%20handleTouchMove)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// Global events</span>
<span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;mousedown&#x27;</span>, handleMouseDown);
<span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;mouseup&#x27;</span>, handleMouseUp);
<span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;mousemove&#x27;</span>, handleMouseMove);

<span class="hljs-comment inline">// Container local events</span>
container.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;touchstart&#x27;</span>, handleTouchStart);
container.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;touchend&#x27;</span>, handleTouchEnd);
container.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;touchmove&#x27;</span>, handleTouchMove);
</code></pre>
            </div>
        
<ul class="list-disc list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Mouse events bound to document</strong>: Ensures interaction continues even when mouse moves outside container during dragging</li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Touch events bound to container</strong>: Touch event propagation mechanisms differ, binding to container is safer</li>
</ul>
<h2 id="reusable-design-pattern-summary" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#reusable-design-pattern-summary" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Reusable Design Pattern Summary">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Reusable Design Pattern Summary
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">Through this in-depth implementation analysis, we can extract several universal design patterns.</p>
<h3 id="universal-architecture-for-particle-systems" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#universal-architecture-for-particle-systems" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Universal Architecture for Particle Systems">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Universal Architecture for Particle Systems
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%201.%20Data%20structure%20design%0Ainterface%20Particle%20%7B%0Ael%3A%20HTMLElement%3B%20%20%20%20%20%20%2F%2F%20DOM%20reference%0Ax%3A%20number%3B%20y%3A%20number%3B%20%2F%2F%20Position%0Avx%3A%20number%3B%20vy%3A%20number%3B%20%2F%2F%20Velocity%0A%5Bkey%3A%20string%5D%3A%20any%3B%20%20%20%2F%2F%20Other%20properties%0A%7D%0A%2F%2F%202.%20Lifecycle%20management%0Aconst%20createParticle%20%3D%20()%20%3D%3E%20%7B%20%2F*%20Creation%20logic%20*%2F%20%7D%3B%0Aconst%20updateParticle%20%3D%20(particle%3A%20Particle)%20%3D%3E%20%7B%20%2F*%20Update%20logic%20*%2F%20%7D%3B%0Aconst%20destroyParticle%20%3D%20(particle%3A%20Particle)%20%3D%3E%20%7B%20%2F*%20Destruction%20logic%20*%2F%20%7D%3B%0A%2F%2F%203.%20Animation%20loop%0Aconst%20animate%20%3D%20()%20%3D%3E%20%7B%0Aparticles.forEach(updateParticle)%3B%0ArequestAnimationFrame(animate)%3B%0A%7D%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// 1. Data structure design</span>
<span class="hljs-keyword inline">interface</span> <span class="hljs-title class_ inline">Particle</span> {
    <span class="hljs-attr inline">el</span>: <span class="hljs-title class_ inline">HTMLElement</span>;      <span class="hljs-comment inline">// DOM reference</span>
    <span class="hljs-attr inline">x</span>: <span class="hljs-built_in inline">number</span>; <span class="hljs-attr inline">y</span>: <span class="hljs-built_in inline">number</span>; <span class="hljs-comment inline">// Position</span>
    <span class="hljs-attr inline">vx</span>: <span class="hljs-built_in inline">number</span>; <span class="hljs-attr inline">vy</span>: <span class="hljs-built_in inline">number</span>; <span class="hljs-comment inline">// Velocity</span>
    [<span class="hljs-attr inline">key</span>: <span class="hljs-built_in inline">string</span>]: <span class="hljs-built_in inline">any</span>;   <span class="hljs-comment inline">// Other properties</span>
}

<span class="hljs-comment inline">// 2. Lifecycle management</span>
<span class="hljs-keyword inline">const</span> <span class="hljs-title function_ inline">createParticle</span> = (<span class="hljs-params inline"></span>) =&gt; { <span class="hljs-comment inline">/* Creation logic */</span> };
<span class="hljs-keyword inline">const</span> <span class="hljs-title function_ inline">updateParticle</span> = (<span class="hljs-params inline"><span class="hljs-attr inline">particle</span>: <span class="hljs-title class_ inline">Particle</span></span>) =&gt; { <span class="hljs-comment inline">/* Update logic */</span> };
<span class="hljs-keyword inline">const</span> <span class="hljs-title function_ inline">destroyParticle</span> = (<span class="hljs-params inline"><span class="hljs-attr inline">particle</span>: <span class="hljs-title class_ inline">Particle</span></span>) =&gt; { <span class="hljs-comment inline">/* Destruction logic */</span> };

<span class="hljs-comment inline">// 3. Animation loop</span>
<span class="hljs-keyword inline">const</span> <span class="hljs-title function_ inline">animate</span> = (<span class="hljs-params inline"></span>) =&gt; {
    particles.<span class="hljs-title function_ inline">forEach</span>(updateParticle);
    <span class="hljs-title function_ inline">requestAnimationFrame</span>(animate);
};
</code></pre>
            </div>
        
<h3 id="basic-patterns-for-physics-simulation" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#basic-patterns-for-physics-simulation" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Basic Patterns for Physics Simulation">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Basic Patterns for Physics Simulation
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20Force%20field%20calculation%20pattern%0Aconst%20calculateForce%20%3D%20(particle%3A%20Particle%2C%20target%3A%20Position)%20%3D%3E%20%7B%0Aconst%20dx%20%3D%20particle.x%20-%20target.x%3B%0Aconst%20dy%20%3D%20particle.y%20-%20target.y%3B%0Aconst%20distance%20%3D%20Math.sqrt(dx%20*%20dx%20%2B%20dy%20*%20dy)%3B%0Aconst%20force%20%3D%20strength%20%2F%20(distance%20%2B%20epsilon)%3B%0Areturn%20%7B%0Afx%3A%20force%20*%20(dx%20%2F%20distance)%2C%0Afy%3A%20force%20*%20(dy%20%2F%20distance)%0A%7D%3B%0A%7D%3B%0A%2F%2F%20Boundary%20handling%20pattern%0Aconst%20handleBoundaries%20%3D%20(particle%3A%20Particle%2C%20bounds%3A%20Bounds)%20%3D%3E%20%7B%0Aif%20(particle.x%20left)%20particle.x%20%3D%20bounds.right%3B%0Aif%20(particle.x%20%3E%20bounds.right)%20particle.x%20%3D%20bounds.left%3B%0Aif%20(particle.y%20top)%20particle.y%20%3D%20bounds.bottom%3B%0Aif%20(particle.y%20%3E%20bounds.bottom)%20particle.y%20%3D%20bounds.top%3B%0A%7D%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// Force field calculation pattern</span>
<span class="hljs-keyword inline">const</span> <span class="hljs-title function_ inline">calculateForce</span> = (<span class="hljs-params inline"><span class="hljs-attr inline">particle</span>: <span class="hljs-title class_ inline">Particle</span>, <span class="hljs-attr inline">target</span>: <span class="hljs-title class_ inline">Position</span></span>) =&gt; {
    <span class="hljs-keyword inline">const</span> dx = particle.<span class="hljs-property inline">x</span> - target.<span class="hljs-property inline">x</span>;
    <span class="hljs-keyword inline">const</span> dy = particle.<span class="hljs-property inline">y</span> - target.<span class="hljs-property inline">y</span>;
    <span class="hljs-keyword inline">const</span> distance = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">sqrt</span>(dx * dx + dy * dy);
    <span class="hljs-keyword inline">const</span> force = strength / (distance + epsilon);
    
    <span class="hljs-keyword inline">return</span> {
        <span class="hljs-attr inline">fx</span>: force * (dx / distance),
        <span class="hljs-attr inline">fy</span>: force * (dy / distance)
    };
};

<span class="hljs-comment inline">// Boundary handling pattern</span>
<span class="hljs-keyword inline">const</span> <span class="hljs-title function_ inline">handleBoundaries</span> = (<span class="hljs-params inline"><span class="hljs-attr inline">particle</span>: <span class="hljs-title class_ inline">Particle</span>, <span class="hljs-attr inline">bounds</span>: <span class="hljs-title class_ inline">Bounds</span></span>) =&gt; {
    <span class="hljs-keyword inline">if</span> (particle.<span class="hljs-property inline">x</span> &lt; bounds.<span class="hljs-property inline">left</span>) particle.<span class="hljs-property inline">x</span> = bounds.<span class="hljs-property inline">right</span>;
    <span class="hljs-keyword inline">if</span> (particle.<span class="hljs-property inline">x</span> &gt; bounds.<span class="hljs-property inline">right</span>) particle.<span class="hljs-property inline">x</span> = bounds.<span class="hljs-property inline">left</span>;
    <span class="hljs-keyword inline">if</span> (particle.<span class="hljs-property inline">y</span> &lt; bounds.<span class="hljs-property inline">top</span>) particle.<span class="hljs-property inline">y</span> = bounds.<span class="hljs-property inline">bottom</span>;
    <span class="hljs-keyword inline">if</span> (particle.<span class="hljs-property inline">y</span> &gt; bounds.<span class="hljs-property inline">bottom</span>) particle.<span class="hljs-property inline">y</span> = bounds.<span class="hljs-property inline">top</span>;
};
</code></pre>
            </div>
        
<h3 id="design-patterns-for-theme-response" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#design-patterns-for-theme-response" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Design Patterns for Theme Response">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Design Patterns for Theme Response
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20Color%20system%20pattern%0Aconst%20createThemeColors%20%3D%20(baseTheme%3A%20Theme)%20%3D%3E%20%7B%0Aconst%20%5Bh%2C%20s%2C%20l%5D%20%3D%20hexToHsl(baseTheme.primary)%3B%0Areturn%20%7B%0Abackground%3A%20%60hsl(%24%7Bh%7D%2C%20%24%7Bs%7D%25%2C%20%24%7Bl%7D%25)%60%2C%0Aparticle%3A%20%60hsl(%24%7Bh%7D%2C%20%24%7BMath.max(s%20-%2020%2C%2020)%7D%25%2C%20%24%7Bl%20%2B%2020%7D%25)%60%2C%0A%2F%2F%20...%20other%20colors%0A%7D%3B%0A%7D%3B%0A%2F%2F%20Theme%20switching%20response%20pattern%0AuseEffect(()%20%3D%3E%20%7B%0Aconst%20colors%20%3D%20createThemeColors(currentTheme)%3B%0AupdateParticleColors(colors)%3B%0A%7D%2C%20%5BcurrentTheme%5D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// Color system pattern</span>
<span class="hljs-keyword inline">const</span> <span class="hljs-title function_ inline">createThemeColors</span> = (<span class="hljs-params inline"><span class="hljs-attr inline">baseTheme</span>: <span class="hljs-title class_ inline">Theme</span></span>) =&gt; {
    <span class="hljs-keyword inline">const</span> [h, s, l] = <span class="hljs-title function_ inline">hexToHsl</span>(baseTheme.<span class="hljs-property inline">primary</span>);
    
    <span class="hljs-keyword inline">return</span> {
        <span class="hljs-attr inline">background</span>: <span class="hljs-string inline">`hsl(<span class="hljs-subst inline">${h}</span>, <span class="hljs-subst inline">${s}</span>%, <span class="hljs-subst inline">${l}</span>%)`</span>,
        <span class="hljs-attr inline">particle</span>: <span class="hljs-string inline">`hsl(<span class="hljs-subst inline">${h}</span>, <span class="hljs-subst inline">${<span class="hljs-built_in inline">Math</span>.max(s - <span class="hljs-number inline">20</span>, <span class="hljs-number inline">20</span>)}</span>%, <span class="hljs-subst inline">${l + <span class="hljs-number inline">20</span>}</span>%)`</span>,
        <span class="hljs-comment inline">// ... other colors</span>
    };
};

<span class="hljs-comment inline">// Theme switching response pattern</span>
<span class="hljs-title function_ inline">useEffect</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-keyword inline">const</span> colors = <span class="hljs-title function_ inline">createThemeColors</span>(currentTheme);
    <span class="hljs-title function_ inline">updateParticleColors</span>(colors);
}, [currentTheme]);
</code></pre>
            </div>
        
<h3 id="responsive-particle-layout-pattern" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#responsive-particle-layout-pattern" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Responsive Particle Layout Pattern">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Responsive Particle Layout Pattern
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20Responsive%20relayout%20pattern%0Aconst%20handleResize%20%3D%20useCallback(()%20%3D%3E%20%7B%0A%2F%2F%20Clean%20existing%20particles%0Aparticles.forEach(particle%20%3D%3E%20particle.el.remove())%3B%0A%2F%2F%20Reinitialize%0AinitializeParticles()%3B%0A%7D%2C%20%5B%5D)%3B%0AuseEffect(()%20%3D%3E%20%7B%0Awindow.addEventListener('resize'%2C%20handleResize)%3B%0Areturn%20()%20%3D%3E%20window.removeEventListener('resize'%2C%20handleResize)%3B%0A%7D%2C%20%5B%5D)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// Responsive relayout pattern</span>
<span class="hljs-keyword inline">const</span> handleResize = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-comment inline">// Clean existing particles</span>
    particles.<span class="hljs-title function_ inline">forEach</span>(<span class="hljs-function inline"><span class="hljs-params inline">particle</span> =&gt;</span> particle.<span class="hljs-property inline">el</span>.<span class="hljs-title function_ inline">remove</span>());
    
    <span class="hljs-comment inline">// Reinitialize</span>
    <span class="hljs-title function_ inline">initializeParticles</span>();
}, []);

<span class="hljs-title function_ inline">useEffect</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-variable language_ inline">window</span>.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;resize&#x27;</span>, handleResize);
    <span class="hljs-keyword inline">return</span> <span class="hljs-function inline">() =&gt;</span> <span class="hljs-variable language_ inline">window</span>.<span class="hljs-title function_ inline">removeEventListener</span>(<span class="hljs-string inline">&#x27;resize&#x27;</span>, handleResize);
}, []);
</code></pre>
            </div>
        
<h3 id="performance-optimization-best-practices" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#performance-optimization-best-practices" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Performance Optimization Best Practices">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Performance Optimization Best Practices
        </h3>
<ol class="list-decimal list-inside mb-4 pl-6 space-y-2">
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Use requestAnimationFrame instead of timers</strong></li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Use transform instead of directly modifying position properties</strong></li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Use willChange hints appropriately</strong></li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Clean up DOM elements and event listeners promptly</strong></li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Avoid frequent DOM queries, use reference caching</strong></li>
<li class="text-foreground leading-relaxed"><strong class="font-bold text-foreground">Use debouncing and throttling when appropriate</strong></li>
</ol>
<h2 id="implementation-review" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#implementation-review" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Implementation Review">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Implementation Review
        </h2>
<p class="text-base leading-7 mb-4 text-foreground">Through this in-depth technical analysis, we’ve seen the complex world hidden behind a seemingly simple “foam background.” From Canvas thinking to DOM implementation, from physics simulation to visual effects, from performance optimization to edge case handling—every aspect requires careful design and meticulous debugging.</p>
<p class="text-base leading-7 mb-4 text-foreground">Choosing DOM over Canvas might seem like “using a cannon to shoot mosquitoes,” but this choice brings better accessibility, easier theme integration, and more intuitive event handling. Sometimes, the seemingly “dumb” approach can open up new possibilities.</p>
<h2 id="complete-implementation-source-code" class="group relative text-3xl font-semibold mt-6 mb-3 text-foreground leading-tight">
            <a href="#complete-implementation-source-code" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Complete Implementation Source Code">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Complete Implementation Source Code
        </h2>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="'use%20client'%3B%0Aimport%20React%2C%20%7B%20useEffect%2C%20useRef%2C%20useCallback%20%7D%20from%20'react'%3B%0Aimport%20%7B%20useThemeStore%20%7D%20from%20'%40%2Flib%2Fstores%2FthemeStore'%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20Type%20Definitions%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F**%0A*%20Particle%20data%20structure%0A*%20Each%20particle%20is%20an%20independent%20physical%20entity%0A*%2F%0Ainterface%20Particle%20%7B%0Ael%3A%20HTMLDivElement%3B%20%20%2F%2F%20DOM%20element%20reference%2C%20avoiding%20frequent%20queries%0Ax%3A%20number%3B%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Current%20X%20coordinate%20(precise%20to%20decimal)%0Ay%3A%20number%3B%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Current%20Y%20coordinate%20(precise%20to%20decimal)%0Avx%3A%20number%3B%20%20%20%20%20%20%20%20%20%20%2F%2F%20X-direction%20velocity%0Avy%3A%20number%3B%20%20%20%20%20%20%20%20%20%20%2F%2F%20Y-direction%20velocity%0Asize%3A%20number%3B%20%20%20%20%20%20%20%20%2F%2F%20Particle%20base%20size%0Adepth%3A%20number%3B%20%20%20%20%20%20%20%2F%2F%20Depth%20layer%20(0-1)%2C%20affecting%20size%2C%20opacity%2C%20speed%0A%7D%0A%2F**%0A*%20Mouse%2FTouch%20state%0A*%20Used%20for%20interactive%20force%20field%20calculations%0A*%2F%0Ainterface%20MouseState%20%7B%0Ax%3A%20number%3B%20%20%20%20%20%20%2F%2F%20Mouse%20X%20coordinate%0Ay%3A%20number%3B%20%20%20%20%20%20%2F%2F%20Mouse%20Y%20coordinate%0Adown%3A%20boolean%3B%20%20%2F%2F%20Whether%20in%20pressed%20state%0A%7D%0Aconst%20FoamBackground%3A%20React.FC%20%3D%20()%20%3D%3E%20%7B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20Reference%20Definitions%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Aconst%20containerRef%20%3D%20useRefHTMLDivElement%3E(null)%3B%20%20%20%20%20%20%20%20%2F%2F%20Container%20DOM%20reference%0Aconst%20particlesRef%20%3D%20useRefParticle%5B%5D%3E(%5B%5D)%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Particle%20array%20reference%0Aconst%20mouseRef%20%3D%20useRefMouseState%3E(%7B%20x%3A%200%2C%20y%3A%200%2C%20down%3A%20false%20%7D)%3B%20%2F%2F%20Mouse%20state%20reference%0Aconst%20animationIdRef%20%3D%20useRefnumber%20%7C%20null%3E(null)%3B%20%20%20%20%20%20%20%2F%2F%20Animation%20ID%20reference%20for%20canceling%20animation%0Aconst%20%7B%20currentTheme%20%7D%20%3D%20useThemeStore()%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Theme%20state%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20Configuration%20Constants%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Aconst%20NUM_PARTICLES%20%3D%20300%3B%20%20%2F%2F%20Total%20particle%20count%2C%20balancing%20visual%20effect%20and%20performance%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20Utility%20Functions%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F**%0A*%20Debounce%20utility%20function%0A*%20Used%20to%20optimize%20resize%20event%20handling%2C%20avoiding%20frequent%20particle%20rebuilds%0A*%20%40param%20func%20Function%20to%20debounce%0A*%20%40param%20wait%20Debounce%20delay%20time%20(milliseconds)%0A*%2F%0Aconst%20debounce%20%3D%20useCallback((func%3A%20Function%2C%20wait%3A%20number)%20%3D%3E%20%7B%0Alet%20timeout%3A%20NodeJS.Timeout%3B%0Areturn%20function%20executedFunction(...args%3A%20any%5B%5D)%20%7B%0Aconst%20later%20%3D%20()%20%3D%3E%20%7B%0AclearTimeout(timeout)%3B%0Afunc(...args)%3B%0A%7D%3B%0AclearTimeout(timeout)%3B%0Atimeout%20%3D%20setTimeout(later%2C%20wait)%3B%0A%7D%3B%0A%7D%2C%20%5B%5D)%3B%0A%2F**%0A*%20Convert%20hexadecimal%20color%20to%20HSL%20color%20space%0A*%20HSL%20is%20more%20suitable%20for%20generating%20similar%20color%20variations%0A*%20%40param%20hex%20Hexadecimal%20color%20value%20(e.g.%2C%20%22%23ff6600%22)%0A*%20%40returns%20%5Bhue%2C%20saturation%2C%20lightness%5D%20array%0A*%2F%0Aconst%20hexToHsl%20%3D%20useCallback((hex%3A%20string)%20%3D%3E%20%7B%0A%2F%2F%20Convert%20hex%20to%20RGB%20(0-1%20range)%0Aconst%20r%20%3D%20parseInt(hex.slice(1%2C%203)%2C%2016)%20%2F%20255%3B%0Aconst%20g%20%3D%20parseInt(hex.slice(3%2C%205)%2C%2016)%20%2F%20255%3B%0Aconst%20b%20%3D%20parseInt(hex.slice(5%2C%207)%2C%2016)%20%2F%20255%3B%0A%2F%2F%20Calculate%20max%20and%20min%20values%0Aconst%20max%20%3D%20Math.max(r%2C%20g%2C%20b)%3B%0Aconst%20min%20%3D%20Math.min(r%2C%20g%2C%20b)%3B%0Alet%20h%20%3D%200%2C%20s%20%3D%200%2C%20l%20%3D%20(max%20%2B%20min)%20%2F%202%3B%20%20%2F%2F%20Lightness%20is%20average%20of%20max%20and%20min%0Aif%20(max%20!%3D%3D%20min)%20%7B%0Aconst%20d%20%3D%20max%20-%20min%3B%0A%2F%2F%20Calculate%20saturation%20based%20on%20lightness%0As%20%3D%20l%20%3E%200.5%20%3F%20d%20%2F%20(2%20-%20max%20-%20min)%20%3A%20d%20%2F%20(max%20%2B%20min)%3B%0A%2F%2F%20Calculate%20hue%20based%20on%20dominant%20color%0Aswitch%20(max)%20%7B%0Acase%20r%3A%20h%20%3D%20(g%20-%20b)%20%2F%20d%20%2B%20(g%206%20%3A%200)%3B%20break%3B%20%20%2F%2F%20Red%20dominant%0Acase%20g%3A%20h%20%3D%20(b%20-%20r)%20%2F%20d%20%2B%202%3B%20break%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Green%20dominant%0Acase%20b%3A%20h%20%3D%20(r%20-%20g)%20%2F%20d%20%2B%204%3B%20break%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Blue%20dominant%0A%7D%0Ah%20%2F%3D%206%3B%20%20%2F%2F%20Convert%20to%200-1%20range%0A%7D%0A%2F%2F%20Return%20standard%20HSL%20format%0Areturn%20%5BMath.round(h%20*%20360)%2C%20Math.round(s%20*%20100)%2C%20Math.round(l%20*%20100)%5D%3B%0A%7D%2C%20%5B%5D)%3B%0A%2F**%0A*%20Generate%20dynamic%20colors%20based%20on%20current%20theme%0A*%20Dark%20theme%20uses%20deeper%2C%20more%20saturated%20colors%0A*%20Light%20theme%20uses%20brighter%2C%20softer%20colors%0A*%2F%0Aconst%20getThemeColors%20%3D%20useCallback(()%20%3D%3E%20%7B%0Aconst%20%5BprimaryH%2C%20primaryS%5D%20%3D%20hexToHsl(currentTheme.colors.primary)%3B%0Aconst%20%5BaccentH%2C%20accentS%5D%20%3D%20hexToHsl(currentTheme.colors.accent)%3B%0Aconst%20isDark%20%3D%20currentTheme.id%20%3D%3D%3D%20'dark'%3B%0Aif%20(isDark)%20%7B%0A%2F%2F%20Dark%20theme%3A%20increase%20saturation%2C%20decrease%20lightness%0Areturn%20%7B%0Abackground%3A%20%60linear-gradient(135deg%2C%20hsl(%24%7BprimaryH%7D%2C%20%24%7BMath.max(primaryS%20%2B%2010%2C%2040)%7D%25%2C%2025%25)%2C%20hsl(%24%7BaccentH%7D%2C%20%24%7BMath.max(accentS%20%2B%205%2C%2035)%7D%25%2C%2020%25))%60%2C%0Aparticle%3A%20%60hsl(%24%7BprimaryH%7D%2C%20%24%7BMath.max(primaryS%20%2B%2015%2C%2050)%7D%25%2C%2045%25)%60%0A%7D%3B%0A%7D%20else%20%7B%0A%2F%2F%20Light%20theme%3A%20decrease%20saturation%2C%20increase%20lightness%0Areturn%20%7B%0Abackground%3A%20%60linear-gradient(135deg%2C%20hsl(%24%7BprimaryH%7D%2C%20%24%7BMath.max(primaryS%20-%2020%2C%2020)%7D%25%2C%2060%25)%2C%20hsl(%24%7BaccentH%7D%2C%20%24%7BMath.max(accentS%20-%2010%2C%2030)%7D%25%2C%2050%25))%60%2C%0Aparticle%3A%20%60hsl(%24%7BprimaryH%7D%2C%20%24%7BMath.max(primaryS%20-%2010%2C%2035)%7D%25%2C%2075%25)%60%0A%7D%3B%0A%7D%0A%7D%2C%20%5BcurrentTheme%2C%20hexToHsl%5D)%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20Mouse%20and%20Touch%20Event%20Handling%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F**%0A*%20Update%20mouse%20position%0A*%20Compatible%20with%20mouse%20events%20and%20touch%20events%0A*%2F%0Aconst%20updateMousePos%20%3D%20useCallback((e%3A%20MouseEvent%20%7C%20Touch)%20%3D%3E%20%7B%0AmouseRef.current.x%20%3D%20e.clientX%3B%0AmouseRef.current.y%20%3D%20e.clientY%3B%0A%7D%2C%20%5B%5D)%3B%0A%2F**%0A*%20Mouse%20down%20event%20handler%0A*%20Activate%20interactive%20force%20field%0A*%2F%0Aconst%20handleMouseDown%20%3D%20useCallback((e%3A%20MouseEvent)%20%3D%3E%20%7B%0AmouseRef.current.down%20%3D%20true%3B%0AupdateMousePos(e)%3B%0A%7D%2C%20%5BupdateMousePos%5D)%3B%0A%2F**%0A*%20Mouse%20up%20event%20handler%0A*%20Deactivate%20interactive%20force%20field%0A*%2F%0Aconst%20handleMouseUp%20%3D%20useCallback(()%20%3D%3E%20%7B%0AmouseRef.current.down%20%3D%20false%3B%0A%7D%2C%20%5B%5D)%3B%0A%2F**%0A*%20Mouse%20move%20event%20handler%0A*%20Only%20update%20position%20when%20pressed%20to%20reduce%20unnecessary%20calculations%0A*%2F%0Aconst%20handleMouseMove%20%3D%20useCallback((e%3A%20MouseEvent)%20%3D%3E%20%7B%0Aif%20(mouseRef.current.down)%20updateMousePos(e)%3B%0A%7D%2C%20%5BupdateMousePos%5D)%3B%0A%2F**%0A*%20Touch%20start%20event%20handler%0A*%20Mobile%20device%20interaction%20support%0A*%2F%0Aconst%20handleTouchStart%20%3D%20useCallback((e%3A%20TouchEvent)%20%3D%3E%20%7B%0AmouseRef.current.down%20%3D%20true%3B%0AupdateMousePos(e.touches%5B0%5D)%3B%20%20%2F%2F%20Only%20take%20first%20touch%20point%0A%7D%2C%20%5BupdateMousePos%5D)%3B%0A%2F**%0A*%20Touch%20end%20event%20handler%0A*%2F%0Aconst%20handleTouchEnd%20%3D%20useCallback(()%20%3D%3E%20%7B%0AmouseRef.current.down%20%3D%20false%3B%0A%7D%2C%20%5B%5D)%3B%0A%2F**%0A*%20Touch%20move%20event%20handler%0A*%2F%0Aconst%20handleTouchMove%20%3D%20useCallback((e%3A%20TouchEvent)%20%3D%3E%20%7B%0Aif%20(mouseRef.current.down)%20updateMousePos(e.touches%5B0%5D)%3B%0A%7D%2C%20%5BupdateMousePos%5D)%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20Particle%20System%20Core%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F**%0A*%20Initialize%20particle%20system%0A*%20Create%20specified%20number%20of%20particles%20and%20distribute%20them%20on%20screen%0A*%2F%0Aconst%20initializeParticles%20%3D%20useCallback(()%20%3D%3E%20%7B%0Aconst%20container%20%3D%20containerRef.current%3B%0Aif%20(!container)%20return%3B%0A%2F%2F%20Clean%20existing%20particles%20to%20prevent%20memory%20leaks%0AparticlesRef.current.forEach(p%20%3D%3E%20p.el.remove())%3B%0AparticlesRef.current%20%3D%20%5B%5D%3B%0Aconst%20width%20%3D%20window.innerWidth%3B%0Aconst%20height%20%3D%20window.innerHeight%3B%0Aconst%20colors%20%3D%20getThemeColors()%3B%0A%2F%2F%20Create%20specified%20number%20of%20particles%0Afor%20(let%20i%20%3D%200%3B%20i%20NUM_PARTICLES%3B%20i%2B%2B)%20%7B%0A%2F%2F%20Create%20DOM%20element%0Aconst%20el%20%3D%20document.createElement('div')%3B%0Ael.style.position%20%3D%20'absolute'%3B%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Absolute%20positioning%2C%20out%20of%20document%20flow%0Ael.style.borderRadius%20%3D%20'50%25'%3B%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Circular%20particles%0Ael.style.backgroundColor%20%3D%20colors.particle%3B%20%2F%2F%20Theme%20color%0Ael.style.pointerEvents%20%3D%20'none'%3B%20%20%20%20%20%20%20%20%20%20%2F%2F%20Don't%20respond%20to%20mouse%20events%0Ael.style.willChange%20%3D%20'transform%2C%20opacity'%3B%20%2F%2F%20Hint%20browser%20for%20optimization%0Acontainer.appendChild(el)%3B%0A%2F%2F%20Random%20size%20(2-6px)%0Aconst%20size%20%3D%202%20%2B%20Math.random()%20*%204%3B%0Ael.style.width%20%3D%20%60%24%7Bsize%7Dpx%60%3B%0Ael.style.height%20%3D%20%60%24%7Bsize%7Dpx%60%3B%0A%2F%2F%20Random%20depth%20and%20position%0Aconst%20depth%20%3D%20Math.random()%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%200-1%20depth%20value%0Aconst%20x%20%3D%20Math.random()%20*%20width%3B%20%20%20%20%20%20%20%20%20%20%2F%2F%20Random%20X%20position%0Aconst%20y%20%3D%20Math.random()%20*%20height%3B%20%20%20%20%20%20%20%20%20%2F%2F%20Random%20Y%20position%0A%2F%2F%20Create%20particle%20object%0AparticlesRef.current.push(%7B%0Ael%2C%0Ax%2C%20y%2C%0Avx%3A%200%2C%20vy%3A%200%2C%20%20%20%20%2F%2F%20Initial%20velocity%20is%200%0Asize%2C%20depth%0A%7D)%3B%0A%7D%0A%7D%2C%20%5BgetThemeColors%5D)%3B%0A%2F**%0A*%20Animation%20loop%20function%0A*%20This%20is%20the%20heart%20of%20the%20entire%20particle%20system%2C%20called%20every%20frame%0A*%2F%0Aconst%20animate%20%3D%20useCallback(()%20%3D%3E%20%7B%0Aconst%20mouse%20%3D%20mouseRef.current%3B%0Aconst%20width%20%3D%20window.innerWidth%3B%0Aconst%20height%20%3D%20window.innerHeight%3B%0A%2F%2F%20Traverse%20all%20particles%20for%20physics%20updates%0Afor%20(let%20p%20of%20particlesRef.current)%20%7B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20Base%20Drift%20Force%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F%2F%20Simulate%20natural%20fluid%20motion%0Ap.vx%20%2B%3D%200.01%20*%20p.depth%3B%20%20%20%2F%2F%20X-direction%20base%20drift%0Ap.vy%20%2B%3D%200.005%20*%20p.depth%3B%20%20%2F%2F%20Y-direction%20base%20drift%20(slightly%20smaller%2C%20simulating%20gravity)%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20Interactive%20Force%20Field%20Calculation%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Aif%20(mouse.down)%20%7B%0A%2F%2F%20Calculate%20vector%20from%20particle%20to%20mouse%0Aconst%20dx%20%3D%20p.x%20-%20mouse.x%3B%0Aconst%20dy%20%3D%20p.y%20-%20mouse.y%3B%0A%2F%2F%20Calculate%20distance%20(Euclidean%20distance)%0Aconst%20dist%20%3D%20Math.sqrt(dx%20*%20dx%20%2B%20dy%20*%20dy)%3B%0A%2F%2F%20Only%20apply%20force%20within%20interaction%20range%0Aif%20(dist%20100)%20%7B%0A%2F%2F%20Inverse%20square%20force%20field%20(like%20gravity)%0Aconst%20baseForce%20%3D%20100%20%2F%20(dist%20%2B%2010)%3B%20%20%2F%2F%20%2B10%20prevents%20division%20by%20zero%0Aconst%20force%20%3D%20baseForce%20*%20p.depth%3B%20%20%20%20%20%2F%2F%20Depth%20affects%20force%20magnitude%0A%2F%2F%20Apply%20force%20in%20direction%20away%20from%20mouse%0Ap.vx%20%2B%3D%20force%20*%20(dx%20%2F%20dist)%3B%20%20%2F%2F%20Unit%20vector%20X%20component%0Ap.vy%20%2B%3D%20force%20*%20(dy%20%2F%20dist)%3B%20%20%2F%2F%20Unit%20vector%20Y%20component%0A%7D%0A%7D%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20Apply%20Friction%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F%2F%20Gradually%20slow%20down%20particle%20movement%2C%20simulating%20air%20resistance%0Ap.vx%20*%3D%200.95%3B%20%20%2F%2F%20Friction%20coefficient%0Ap.vy%20*%3D%200.95%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20Update%20Position%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Ap.x%20%2B%3D%20p.vx%3B%20%20%2F%2F%20Apply%20X%20velocity%0Ap.y%20%2B%3D%20p.vy%3B%20%20%2F%2F%20Apply%20Y%20velocity%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20Boundary%20Wrapping%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F%2F%20Particles%20loop%20from%20one%20side%20to%20the%20other%0Aif%20(p.x%2010)%20p.x%20%3D%20width%20%2B%2010%3B%20%20%20%2F%2F%20Left%20boundary%20wrapping%0Aif%20(p.x%20%3E%20width%20%2B%2010)%20p.x%20%3D%20-10%3B%20%20%20%2F%2F%20Right%20boundary%20wrapping%0Aif%20(p.y%2010)%20p.y%20%3D%20height%20%2B%2010%3B%20%20%2F%2F%20Top%20boundary%20wrapping%0Aif%20(p.y%20%3E%20height%20%2B%2010)%20p.y%20%3D%20-10%3B%20%20%2F%2F%20Bottom%20boundary%20wrapping%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20Visual%20Effect%20Updates%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F%2F%20Calculate%20display%20properties%20based%20on%20depth%0Aconst%20scale%20%3D%200.6%20%2B%200.4%20*%20p.depth%3B%20%20%20%20%20%20%2F%2F%20Scale%3A%200.6-1.0%0Aconst%20opacity%20%3D%200.4%20%2B%200.6%20*%20p.depth%3B%20%20%20%20%2F%2F%20Opacity%3A%200.4-1.0%0A%2F%2F%20Apply%20visual%20changes%20to%20DOM%20element%0Ap.el.style.transform%20%3D%20%60translate(%24%7Bp.x%7Dpx%2C%20%24%7Bp.y%7Dpx)%20scale(%24%7Bscale%7D)%60%3B%0Ap.el.style.opacity%20%3D%20opacity.toString()%3B%0A%7D%0A%2F%2F%20Continue%20animation%20loop%0AanimationIdRef.current%20%3D%20requestAnimationFrame(animate)%3B%0A%7D%2C%20%5B%5D)%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20Window%20Resize%20Handling%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F**%0A*%20Handle%20window%20resize%0A*%20Reinitialize%20particles%20to%20adapt%20to%20new%20screen%20size%0A*%2F%0Aconst%20handleResize%20%3D%20useCallback(()%20%3D%3E%20%7B%0A%2F%2F%20Reinitialize%20particle%20distribution%0AinitializeParticles()%3B%0A%7D%2C%20%5BinitializeParticles%5D)%3B%0A%2F%2F%20Create%20debounced%20resize%20handler%20(1%20second%20delay)%0Aconst%20debouncedHandleResize%20%3D%20useCallback(%0Adebounce(handleResize%2C%201000)%2C%0A%5Bdebounce%2C%20handleResize%5D%0A)%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20Theme%20Change%20Handling%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F**%0A*%20Handle%20theme%20changes%0A*%20Update%20particle%20colors%20when%20theme%20switches%0A*%2F%0AuseEffect(()%20%3D%3E%20%7B%0Aif%20(particlesRef.current.length%20%3E%200)%20%7B%0Aconst%20colors%20%3D%20getThemeColors()%3B%0A%2F%2F%20Update%20all%20particle%20colors%0AparticlesRef.current.forEach(p%20%3D%3E%20%7B%0Ap.el.style.backgroundColor%20%3D%20colors.particle%3B%0A%7D)%3B%0A%2F%2F%20Update%20container%20background%0Aif%20(containerRef.current)%20%7B%0AcontainerRef.current.style.background%20%3D%20colors.background%3B%0A%7D%0A%7D%0A%7D%2C%20%5BcurrentTheme%2C%20getThemeColors%5D)%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20Component%20Lifecycle%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0A%2F**%0A*%20Component%20initialization%20effect%0A*%20Set%20up%20particles%2C%20events%2C%20and%20start%20animation%0A*%2F%0AuseEffect(()%20%3D%3E%20%7B%0A%2F%2F%20Initialize%20particle%20system%0AinitializeParticles()%3B%0A%2F%2F%20Start%20animation%20loop%0Aanimate()%3B%0A%2F%2F%20Add%20global%20event%20listeners%0Adocument.addEventListener('mousedown'%2C%20handleMouseDown)%3B%0Adocument.addEventListener('mouseup'%2C%20handleMouseUp)%3B%0Adocument.addEventListener('mousemove'%2C%20handleMouseMove)%3B%0A%2F%2F%20Add%20resize%20listener%0Awindow.addEventListener('resize'%2C%20debouncedHandleResize)%3B%0A%2F%2F%20Add%20container%20touch%20event%20listeners%0Aconst%20container%20%3D%20containerRef.current%3B%0Aif%20(container)%20%7B%0Acontainer.addEventListener('touchstart'%2C%20handleTouchStart)%3B%0Acontainer.addEventListener('touchend'%2C%20handleTouchEnd)%3B%0Acontainer.addEventListener('touchmove'%2C%20handleTouchMove)%3B%0A%7D%0A%2F%2F%20Cleanup%20function%0Areturn%20()%20%3D%3E%20%7B%0A%2F%2F%20Cancel%20animation%0Aif%20(animationIdRef.current%20!%3D%3D%20null)%20%7B%0AcancelAnimationFrame(animationIdRef.current)%3B%0A%7D%0A%2F%2F%20Remove%20event%20listeners%0Adocument.removeEventListener('mousedown'%2C%20handleMouseDown)%3B%0Adocument.removeEventListener('mouseup'%2C%20handleMouseUp)%3B%0Adocument.removeEventListener('mousemove'%2C%20handleMouseMove)%3B%0Awindow.removeEventListener('resize'%2C%20debouncedHandleResize)%3B%0Aif%20(container)%20%7B%0Acontainer.removeEventListener('touchstart'%2C%20handleTouchStart)%3B%0Acontainer.removeEventListener('touchend'%2C%20handleTouchEnd)%3B%0Acontainer.removeEventListener('touchmove'%2C%20handleTouchMove)%3B%0A%7D%0A%2F%2F%20Clean%20up%20all%20particles%0AparticlesRef.current.forEach(p%20%3D%3E%20p.el.remove())%3B%0A%7D%3B%0A%7D%2C%20%5Banimate%2C%20initializeParticles%2C%20debouncedHandleResize%2C%0AhandleMouseDown%2C%20handleMouseUp%2C%20handleMouseMove%2C%0AhandleTouchStart%2C%20handleTouchEnd%2C%20handleTouchMove%5D)%3B%0A%2F%2F%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%20Render%20%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%0Areturn%20(%0Adiv%0Aref%3D%7BcontainerRef%7D%0AclassName%3D%22fixed%20inset-0%20w-full%20h-full%20overflow-hidden%20pointer-events-none%20z-0%22%0Astyle%3D%7B%7B%0Abackground%3A%20getThemeColors().background%0A%7D%7D%0A%2F%3E%0A)%3B%0A%7D%3B%0Aexport%20default%20FoamBackground%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-string inline">&#x27;use client&#x27;</span>;
<span class="hljs-keyword inline">import</span> <span class="hljs-title class_ inline">React</span>, { useEffect, useRef, useCallback } <span class="hljs-keyword inline">from</span> <span class="hljs-string inline">&#x27;react&#x27;</span>;
<span class="hljs-keyword inline">import</span> { useThemeStore } <span class="hljs-keyword inline">from</span> <span class="hljs-string inline">&#x27;@/lib/stores/themeStore&#x27;</span>;

<span class="hljs-comment inline">// ==================== Type Definitions ====================</span>
<span class="hljs-comment inline">/**
 * Particle data structure
 * Each particle is an independent physical entity
 */</span>
<span class="hljs-keyword inline">interface</span> <span class="hljs-title class_ inline">Particle</span> {
  <span class="hljs-attr inline">el</span>: <span class="hljs-title class_ inline">HTMLDivElement</span>;  <span class="hljs-comment inline">// DOM element reference, avoiding frequent queries</span>
  <span class="hljs-attr inline">x</span>: <span class="hljs-built_in inline">number</span>;           <span class="hljs-comment inline">// Current X coordinate (precise to decimal)</span>
  <span class="hljs-attr inline">y</span>: <span class="hljs-built_in inline">number</span>;           <span class="hljs-comment inline">// Current Y coordinate (precise to decimal)</span>
  <span class="hljs-attr inline">vx</span>: <span class="hljs-built_in inline">number</span>;          <span class="hljs-comment inline">// X-direction velocity</span>
  <span class="hljs-attr inline">vy</span>: <span class="hljs-built_in inline">number</span>;          <span class="hljs-comment inline">// Y-direction velocity</span>
  <span class="hljs-attr inline">size</span>: <span class="hljs-built_in inline">number</span>;        <span class="hljs-comment inline">// Particle base size</span>
  <span class="hljs-attr inline">depth</span>: <span class="hljs-built_in inline">number</span>;       <span class="hljs-comment inline">// Depth layer (0-1), affecting size, opacity, speed</span>
}

<span class="hljs-comment inline">/**
 * Mouse/Touch state
 * Used for interactive force field calculations
 */</span>
<span class="hljs-keyword inline">interface</span> <span class="hljs-title class_ inline">MouseState</span> {
  <span class="hljs-attr inline">x</span>: <span class="hljs-built_in inline">number</span>;      <span class="hljs-comment inline">// Mouse X coordinate</span>
  <span class="hljs-attr inline">y</span>: <span class="hljs-built_in inline">number</span>;      <span class="hljs-comment inline">// Mouse Y coordinate</span>
  <span class="hljs-attr inline">down</span>: <span class="hljs-built_in inline">boolean</span>;  <span class="hljs-comment inline">// Whether in pressed state</span>
}

<span class="hljs-keyword inline">const</span> <span class="hljs-title class_ inline">FoamBackground</span>: <span class="hljs-title class_ inline">React</span>.<span class="hljs-property inline">FC</span> = <span class="hljs-function inline">() =&gt;</span> {
  <span class="hljs-comment inline">// ==================== Reference Definitions ====================</span>
  <span class="hljs-keyword inline">const</span> containerRef = useRef&lt;<span class="hljs-title class_ inline">HTMLDivElement</span>&gt;(<span class="hljs-literal inline">null</span>);        <span class="hljs-comment inline">// Container DOM reference</span>
  <span class="hljs-keyword inline">const</span> particlesRef = useRef&lt;<span class="hljs-title class_ inline">Particle</span>[]&gt;([]);              <span class="hljs-comment inline">// Particle array reference</span>
  <span class="hljs-keyword inline">const</span> mouseRef = useRef&lt;<span class="hljs-title class_ inline">MouseState</span>&gt;({ <span class="hljs-attr inline">x</span>: <span class="hljs-number inline">0</span>, <span class="hljs-attr inline">y</span>: <span class="hljs-number inline">0</span>, <span class="hljs-attr inline">down</span>: <span class="hljs-literal inline">false</span> }); <span class="hljs-comment inline">// Mouse state reference</span>
  <span class="hljs-keyword inline">const</span> animationIdRef = useRef&lt;<span class="hljs-built_in inline">number</span> | <span class="hljs-literal inline">null</span>&gt;(<span class="hljs-literal inline">null</span>);       <span class="hljs-comment inline">// Animation ID reference for canceling animation</span>
  <span class="hljs-keyword inline">const</span> { currentTheme } = <span class="hljs-title function_ inline">useThemeStore</span>();                 <span class="hljs-comment inline">// Theme state</span>

  <span class="hljs-comment inline">// ==================== Configuration Constants ====================</span>
  <span class="hljs-keyword inline">const</span> <span class="hljs-variable constant_ inline">NUM_PARTICLES</span> = <span class="hljs-number inline">300</span>;  <span class="hljs-comment inline">// Total particle count, balancing visual effect and performance</span>

  <span class="hljs-comment inline">// ==================== Utility Functions ====================</span>
  <span class="hljs-comment inline">/**
   * Debounce utility function
   * Used to optimize resize event handling, avoiding frequent particle rebuilds
   * <span class="hljs-doctag inline">@param</span> func Function to debounce
   * <span class="hljs-doctag inline">@param</span> wait Debounce delay time (milliseconds)
   */</span>
  <span class="hljs-keyword inline">const</span> debounce = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">func</span>: <span class="hljs-title class_ inline">Function</span>, <span class="hljs-attr inline">wait</span>: <span class="hljs-built_in inline">number</span></span>) =&gt;</span> {
    <span class="hljs-keyword inline">let</span> <span class="hljs-attr inline">timeout</span>: <span class="hljs-title class_ inline">NodeJS</span>.<span class="hljs-property inline">Timeout</span>;
    <span class="hljs-keyword inline">return</span> <span class="hljs-keyword inline">function</span> <span class="hljs-title function_ inline">executedFunction</span>(<span class="hljs-params inline">...<span class="hljs-attr inline">args</span>: <span class="hljs-built_in inline">any</span>[]</span>) {
      <span class="hljs-keyword inline">const</span> <span class="hljs-title function_ inline">later</span> = (<span class="hljs-params inline"></span>) =&gt; {
        <span class="hljs-built_in inline">clearTimeout</span>(timeout);
        <span class="hljs-title function_ inline">func</span>(...args);
      };
      <span class="hljs-built_in inline">clearTimeout</span>(timeout);
      timeout = <span class="hljs-built_in inline">setTimeout</span>(later, wait);
    };
  }, []);

  <span class="hljs-comment inline">/**
   * Convert hexadecimal color to HSL color space
   * HSL is more suitable for generating similar color variations
   * <span class="hljs-doctag inline">@param</span> hex Hexadecimal color value (e.g., &quot;#ff6600&quot;)
   * <span class="hljs-doctag inline">@returns</span> [hue, saturation, lightness] array
   */</span>
  <span class="hljs-keyword inline">const</span> hexToHsl = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">hex</span>: <span class="hljs-built_in inline">string</span></span>) =&gt;</span> {
    <span class="hljs-comment inline">// Convert hex to RGB (0-1 range)</span>
    <span class="hljs-keyword inline">const</span> r = <span class="hljs-built_in inline">parseInt</span>(hex.<span class="hljs-title function_ inline">slice</span>(<span class="hljs-number inline">1</span>, <span class="hljs-number inline">3</span>), <span class="hljs-number inline">16</span>) / <span class="hljs-number inline">255</span>;
    <span class="hljs-keyword inline">const</span> g = <span class="hljs-built_in inline">parseInt</span>(hex.<span class="hljs-title function_ inline">slice</span>(<span class="hljs-number inline">3</span>, <span class="hljs-number inline">5</span>), <span class="hljs-number inline">16</span>) / <span class="hljs-number inline">255</span>;
    <span class="hljs-keyword inline">const</span> b = <span class="hljs-built_in inline">parseInt</span>(hex.<span class="hljs-title function_ inline">slice</span>(<span class="hljs-number inline">5</span>, <span class="hljs-number inline">7</span>), <span class="hljs-number inline">16</span>) / <span class="hljs-number inline">255</span>;

    <span class="hljs-comment inline">// Calculate max and min values</span>
    <span class="hljs-keyword inline">const</span> max = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">max</span>(r, g, b);
    <span class="hljs-keyword inline">const</span> min = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">min</span>(r, g, b);
    <span class="hljs-keyword inline">let</span> h = <span class="hljs-number inline">0</span>, s = <span class="hljs-number inline">0</span>, l = (max + min) / <span class="hljs-number inline">2</span>;  <span class="hljs-comment inline">// Lightness is average of max and min</span>

    <span class="hljs-keyword inline">if</span> (max !== min) {
      <span class="hljs-keyword inline">const</span> d = max - min;
      <span class="hljs-comment inline">// Calculate saturation based on lightness</span>
      s = l &gt; <span class="hljs-number inline">0.5</span> ? d / (<span class="hljs-number inline">2</span> - max - min) : d / (max + min);
      
      <span class="hljs-comment inline">// Calculate hue based on dominant color</span>
      <span class="hljs-keyword inline">switch</span> (max) {
        <span class="hljs-keyword inline">case</span> <span class="hljs-attr inline">r</span>: h = (g - b) / d + (g &lt; b ? <span class="hljs-number inline">6</span> : <span class="hljs-number inline">0</span>); <span class="hljs-keyword inline">break</span>;  <span class="hljs-comment inline">// Red dominant</span>
        <span class="hljs-keyword inline">case</span> <span class="hljs-attr inline">g</span>: h = (b - r) / d + <span class="hljs-number inline">2</span>; <span class="hljs-keyword inline">break</span>;                <span class="hljs-comment inline">// Green dominant</span>
        <span class="hljs-keyword inline">case</span> <span class="hljs-attr inline">b</span>: h = (r - g) / d + <span class="hljs-number inline">4</span>; <span class="hljs-keyword inline">break</span>;                <span class="hljs-comment inline">// Blue dominant</span>
      }
      h /= <span class="hljs-number inline">6</span>;  <span class="hljs-comment inline">// Convert to 0-1 range</span>
    }

    <span class="hljs-comment inline">// Return standard HSL format</span>
    <span class="hljs-keyword inline">return</span> [<span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">round</span>(h * <span class="hljs-number inline">360</span>), <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">round</span>(s * <span class="hljs-number inline">100</span>), <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">round</span>(l * <span class="hljs-number inline">100</span>)];
  }, []);

  <span class="hljs-comment inline">/**
   * Generate dynamic colors based on current theme
   * Dark theme uses deeper, more saturated colors
   * Light theme uses brighter, softer colors
   */</span>
  <span class="hljs-keyword inline">const</span> getThemeColors = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-keyword inline">const</span> [primaryH, primaryS] = <span class="hljs-title function_ inline">hexToHsl</span>(currentTheme.<span class="hljs-property inline">colors</span>.<span class="hljs-property inline">primary</span>);
    <span class="hljs-keyword inline">const</span> [accentH, accentS] = <span class="hljs-title function_ inline">hexToHsl</span>(currentTheme.<span class="hljs-property inline">colors</span>.<span class="hljs-property inline">accent</span>);
    
    <span class="hljs-keyword inline">const</span> isDark = currentTheme.<span class="hljs-property inline">id</span> === <span class="hljs-string inline">&#x27;dark&#x27;</span>;
    
    <span class="hljs-keyword inline">if</span> (isDark) {
      <span class="hljs-comment inline">// Dark theme: increase saturation, decrease lightness</span>
      <span class="hljs-keyword inline">return</span> {
        <span class="hljs-attr inline">background</span>: <span class="hljs-string inline">`linear-gradient(135deg, hsl(<span class="hljs-subst inline">${primaryH}</span>, <span class="hljs-subst inline">${<span class="hljs-built_in inline">Math</span>.max(primaryS + <span class="hljs-number inline">10</span>, <span class="hljs-number inline">40</span>)}</span>%, 25%), hsl(<span class="hljs-subst inline">${accentH}</span>, <span class="hljs-subst inline">${<span class="hljs-built_in inline">Math</span>.max(accentS + <span class="hljs-number inline">5</span>, <span class="hljs-number inline">35</span>)}</span>%, 20%))`</span>,
        <span class="hljs-attr inline">particle</span>: <span class="hljs-string inline">`hsl(<span class="hljs-subst inline">${primaryH}</span>, <span class="hljs-subst inline">${<span class="hljs-built_in inline">Math</span>.max(primaryS + <span class="hljs-number inline">15</span>, <span class="hljs-number inline">50</span>)}</span>%, 45%)`</span>
      };
    } <span class="hljs-keyword inline">else</span> {
      <span class="hljs-comment inline">// Light theme: decrease saturation, increase lightness</span>
      <span class="hljs-keyword inline">return</span> {
        <span class="hljs-attr inline">background</span>: <span class="hljs-string inline">`linear-gradient(135deg, hsl(<span class="hljs-subst inline">${primaryH}</span>, <span class="hljs-subst inline">${<span class="hljs-built_in inline">Math</span>.max(primaryS - <span class="hljs-number inline">20</span>, <span class="hljs-number inline">20</span>)}</span>%, 60%), hsl(<span class="hljs-subst inline">${accentH}</span>, <span class="hljs-subst inline">${<span class="hljs-built_in inline">Math</span>.max(accentS - <span class="hljs-number inline">10</span>, <span class="hljs-number inline">30</span>)}</span>%, 50%))`</span>,
        <span class="hljs-attr inline">particle</span>: <span class="hljs-string inline">`hsl(<span class="hljs-subst inline">${primaryH}</span>, <span class="hljs-subst inline">${<span class="hljs-built_in inline">Math</span>.max(primaryS - <span class="hljs-number inline">10</span>, <span class="hljs-number inline">35</span>)}</span>%, 75%)`</span>
      };
    }
  }, [currentTheme, hexToHsl]);

  <span class="hljs-comment inline">// ==================== Mouse and Touch Event Handling ====================</span>
  <span class="hljs-comment inline">/**
   * Update mouse position
   * Compatible with mouse events and touch events
   */</span>
  <span class="hljs-keyword inline">const</span> updateMousePos = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">e</span>: <span class="hljs-title class_ inline">MouseEvent</span> | <span class="hljs-title class_ inline">Touch</span></span>) =&gt;</span> {
    mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">x</span> = e.<span class="hljs-property inline">clientX</span>;
    mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">y</span> = e.<span class="hljs-property inline">clientY</span>;
  }, []);

  <span class="hljs-comment inline">/**
   * Mouse down event handler
   * Activate interactive force field
   */</span>
  <span class="hljs-keyword inline">const</span> handleMouseDown = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">e</span>: <span class="hljs-title class_ inline">MouseEvent</span></span>) =&gt;</span> {
    mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span> = <span class="hljs-literal inline">true</span>;
    <span class="hljs-title function_ inline">updateMousePos</span>(e);
  }, [updateMousePos]);

  <span class="hljs-comment inline">/**
   * Mouse up event handler
   * Deactivate interactive force field
   */</span>
  <span class="hljs-keyword inline">const</span> handleMouseUp = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">() =&gt;</span> {
    mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span> = <span class="hljs-literal inline">false</span>;
  }, []);

  <span class="hljs-comment inline">/**
   * Mouse move event handler
   * Only update position when pressed to reduce unnecessary calculations
   */</span>
  <span class="hljs-keyword inline">const</span> handleMouseMove = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">e</span>: <span class="hljs-title class_ inline">MouseEvent</span></span>) =&gt;</span> {
    <span class="hljs-keyword inline">if</span> (mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span>) <span class="hljs-title function_ inline">updateMousePos</span>(e);
  }, [updateMousePos]);

  <span class="hljs-comment inline">/**
   * Touch start event handler
   * Mobile device interaction support
   */</span>
  <span class="hljs-keyword inline">const</span> handleTouchStart = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">e</span>: <span class="hljs-title class_ inline">TouchEvent</span></span>) =&gt;</span> {
    mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span> = <span class="hljs-literal inline">true</span>;
    <span class="hljs-title function_ inline">updateMousePos</span>(e.<span class="hljs-property inline">touches</span>[<span class="hljs-number inline">0</span>]);  <span class="hljs-comment inline">// Only take first touch point</span>
  }, [updateMousePos]);

  <span class="hljs-comment inline">/**
   * Touch end event handler
   */</span>
  <span class="hljs-keyword inline">const</span> handleTouchEnd = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">() =&gt;</span> {
    mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span> = <span class="hljs-literal inline">false</span>;
  }, []);

  <span class="hljs-comment inline">/**
   * Touch move event handler
   */</span>
  <span class="hljs-keyword inline">const</span> handleTouchMove = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">(<span class="hljs-params inline"><span class="hljs-attr inline">e</span>: <span class="hljs-title class_ inline">TouchEvent</span></span>) =&gt;</span> {
    <span class="hljs-keyword inline">if</span> (mouseRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">down</span>) <span class="hljs-title function_ inline">updateMousePos</span>(e.<span class="hljs-property inline">touches</span>[<span class="hljs-number inline">0</span>]);
  }, [updateMousePos]);

  <span class="hljs-comment inline">// ==================== Particle System Core ====================</span>
  <span class="hljs-comment inline">/**
   * Initialize particle system
   * Create specified number of particles and distribute them on screen
   */</span>
  <span class="hljs-keyword inline">const</span> initializeParticles = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-keyword inline">const</span> container = containerRef.<span class="hljs-property inline">current</span>;
    <span class="hljs-keyword inline">if</span> (!container) <span class="hljs-keyword inline">return</span>;

    <span class="hljs-comment inline">// Clean existing particles to prevent memory leaks</span>
    particlesRef.<span class="hljs-property inline">current</span>.<span class="hljs-title function_ inline">forEach</span>(<span class="hljs-function inline"><span class="hljs-params inline">p</span> =&gt;</span> p.<span class="hljs-property inline">el</span>.<span class="hljs-title function_ inline">remove</span>());
    particlesRef.<span class="hljs-property inline">current</span> = [];

    <span class="hljs-keyword inline">const</span> width = <span class="hljs-variable language_ inline">window</span>.<span class="hljs-property inline">innerWidth</span>;
    <span class="hljs-keyword inline">const</span> height = <span class="hljs-variable language_ inline">window</span>.<span class="hljs-property inline">innerHeight</span>;
    <span class="hljs-keyword inline">const</span> colors = <span class="hljs-title function_ inline">getThemeColors</span>();

    <span class="hljs-comment inline">// Create specified number of particles</span>
    <span class="hljs-keyword inline">for</span> (<span class="hljs-keyword inline">let</span> i = <span class="hljs-number inline">0</span>; i &lt; <span class="hljs-variable constant_ inline">NUM_PARTICLES</span>; i++) {
      <span class="hljs-comment inline">// Create DOM element</span>
      <span class="hljs-keyword inline">const</span> el = <span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">createElement</span>(<span class="hljs-string inline">&#x27;div&#x27;</span>);
      el.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">position</span> = <span class="hljs-string inline">&#x27;absolute&#x27;</span>;           <span class="hljs-comment inline">// Absolute positioning, out of document flow</span>
      el.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">borderRadius</span> = <span class="hljs-string inline">&#x27;50%&#x27;</span>;            <span class="hljs-comment inline">// Circular particles</span>
      el.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">backgroundColor</span> = colors.<span class="hljs-property inline">particle</span>; <span class="hljs-comment inline">// Theme color</span>
      el.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">pointerEvents</span> = <span class="hljs-string inline">&#x27;none&#x27;</span>;          <span class="hljs-comment inline">// Don&#x27;t respond to mouse events</span>
      el.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">willChange</span> = <span class="hljs-string inline">&#x27;transform, opacity&#x27;</span>; <span class="hljs-comment inline">// Hint browser for optimization</span>
      
      container.<span class="hljs-title function_ inline">appendChild</span>(el);

      <span class="hljs-comment inline">// Random size (2-6px)</span>
      <span class="hljs-keyword inline">const</span> size = <span class="hljs-number inline">2</span> + <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">random</span>() * <span class="hljs-number inline">4</span>;
      el.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">width</span> = <span class="hljs-string inline">`<span class="hljs-subst inline">${size}</span>px`</span>;
      el.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">height</span> = <span class="hljs-string inline">`<span class="hljs-subst inline">${size}</span>px`</span>;

      <span class="hljs-comment inline">// Random depth and position</span>
      <span class="hljs-keyword inline">const</span> depth = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">random</span>();              <span class="hljs-comment inline">// 0-1 depth value</span>
      <span class="hljs-keyword inline">const</span> x = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">random</span>() * width;          <span class="hljs-comment inline">// Random X position</span>
      <span class="hljs-keyword inline">const</span> y = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">random</span>() * height;         <span class="hljs-comment inline">// Random Y position</span>

      <span class="hljs-comment inline">// Create particle object</span>
      particlesRef.<span class="hljs-property inline">current</span>.<span class="hljs-title function_ inline">push</span>({
        el,
        x, y,
        <span class="hljs-attr inline">vx</span>: <span class="hljs-number inline">0</span>, <span class="hljs-attr inline">vy</span>: <span class="hljs-number inline">0</span>,    <span class="hljs-comment inline">// Initial velocity is 0</span>
        size, depth
      });
    }
  }, [getThemeColors]);

  <span class="hljs-comment inline">/**
   * Animation loop function
   * This is the heart of the entire particle system, called every frame
   */</span>
  <span class="hljs-keyword inline">const</span> animate = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-keyword inline">const</span> mouse = mouseRef.<span class="hljs-property inline">current</span>;
    <span class="hljs-keyword inline">const</span> width = <span class="hljs-variable language_ inline">window</span>.<span class="hljs-property inline">innerWidth</span>;
    <span class="hljs-keyword inline">const</span> height = <span class="hljs-variable language_ inline">window</span>.<span class="hljs-property inline">innerHeight</span>;

    <span class="hljs-comment inline">// Traverse all particles for physics updates</span>
    <span class="hljs-keyword inline">for</span> (<span class="hljs-keyword inline">let</span> p <span class="hljs-keyword inline">of</span> particlesRef.<span class="hljs-property inline">current</span>) {
      <span class="hljs-comment inline">// ==================== Base Drift Force ====================</span>
      <span class="hljs-comment inline">// Simulate natural fluid motion</span>
      p.<span class="hljs-property inline">vx</span> += <span class="hljs-number inline">0.01</span> * p.<span class="hljs-property inline">depth</span>;   <span class="hljs-comment inline">// X-direction base drift</span>
      p.<span class="hljs-property inline">vy</span> += <span class="hljs-number inline">0.005</span> * p.<span class="hljs-property inline">depth</span>;  <span class="hljs-comment inline">// Y-direction base drift (slightly smaller, simulating gravity)</span>

      <span class="hljs-comment inline">// ==================== Interactive Force Field Calculation ====================</span>
      <span class="hljs-keyword inline">if</span> (mouse.<span class="hljs-property inline">down</span>) {
        <span class="hljs-comment inline">// Calculate vector from particle to mouse</span>
        <span class="hljs-keyword inline">const</span> dx = p.<span class="hljs-property inline">x</span> - mouse.<span class="hljs-property inline">x</span>;
        <span class="hljs-keyword inline">const</span> dy = p.<span class="hljs-property inline">y</span> - mouse.<span class="hljs-property inline">y</span>;
        <span class="hljs-comment inline">// Calculate distance (Euclidean distance)</span>
        <span class="hljs-keyword inline">const</span> dist = <span class="hljs-title class_ inline">Math</span>.<span class="hljs-title function_ inline">sqrt</span>(dx * dx + dy * dy);

        <span class="hljs-comment inline">// Only apply force within interaction range</span>
        <span class="hljs-keyword inline">if</span> (dist &lt; <span class="hljs-number inline">100</span>) {
          <span class="hljs-comment inline">// Inverse square force field (like gravity)</span>
          <span class="hljs-keyword inline">const</span> baseForce = <span class="hljs-number inline">100</span> / (dist + <span class="hljs-number inline">10</span>);  <span class="hljs-comment inline">// +10 prevents division by zero</span>
          <span class="hljs-keyword inline">const</span> force = baseForce * p.<span class="hljs-property inline">depth</span>;     <span class="hljs-comment inline">// Depth affects force magnitude</span>

          <span class="hljs-comment inline">// Apply force in direction away from mouse</span>
          p.<span class="hljs-property inline">vx</span> += force * (dx / dist);  <span class="hljs-comment inline">// Unit vector X component</span>
          p.<span class="hljs-property inline">vy</span> += force * (dy / dist);  <span class="hljs-comment inline">// Unit vector Y component</span>
        }
      }

      <span class="hljs-comment inline">// ==================== Apply Friction ====================</span>
      <span class="hljs-comment inline">// Gradually slow down particle movement, simulating air resistance</span>
      p.<span class="hljs-property inline">vx</span> *= <span class="hljs-number inline">0.95</span>;  <span class="hljs-comment inline">// Friction coefficient</span>
      p.<span class="hljs-property inline">vy</span> *= <span class="hljs-number inline">0.95</span>;

      <span class="hljs-comment inline">// ==================== Update Position ====================</span>
      p.<span class="hljs-property inline">x</span> += p.<span class="hljs-property inline">vx</span>;  <span class="hljs-comment inline">// Apply X velocity</span>
      p.<span class="hljs-property inline">y</span> += p.<span class="hljs-property inline">vy</span>;  <span class="hljs-comment inline">// Apply Y velocity</span>

      <span class="hljs-comment inline">// ==================== Boundary Wrapping ====================</span>
      <span class="hljs-comment inline">// Particles loop from one side to the other</span>
      <span class="hljs-keyword inline">if</span> (p.<span class="hljs-property inline">x</span> &lt; -<span class="hljs-number inline">10</span>) p.<span class="hljs-property inline">x</span> = width + <span class="hljs-number inline">10</span>;   <span class="hljs-comment inline">// Left boundary wrapping</span>
      <span class="hljs-keyword inline">if</span> (p.<span class="hljs-property inline">x</span> &gt; width + <span class="hljs-number inline">10</span>) p.<span class="hljs-property inline">x</span> = -<span class="hljs-number inline">10</span>;   <span class="hljs-comment inline">// Right boundary wrapping</span>
      <span class="hljs-keyword inline">if</span> (p.<span class="hljs-property inline">y</span> &lt; -<span class="hljs-number inline">10</span>) p.<span class="hljs-property inline">y</span> = height + <span class="hljs-number inline">10</span>;  <span class="hljs-comment inline">// Top boundary wrapping</span>
      <span class="hljs-keyword inline">if</span> (p.<span class="hljs-property inline">y</span> &gt; height + <span class="hljs-number inline">10</span>) p.<span class="hljs-property inline">y</span> = -<span class="hljs-number inline">10</span>;  <span class="hljs-comment inline">// Bottom boundary wrapping</span>

      <span class="hljs-comment inline">// ==================== Visual Effect Updates ====================</span>
      <span class="hljs-comment inline">// Calculate display properties based on depth</span>
      <span class="hljs-keyword inline">const</span> scale = <span class="hljs-number inline">0.6</span> + <span class="hljs-number inline">0.4</span> * p.<span class="hljs-property inline">depth</span>;      <span class="hljs-comment inline">// Scale: 0.6-1.0</span>
      <span class="hljs-keyword inline">const</span> opacity = <span class="hljs-number inline">0.4</span> + <span class="hljs-number inline">0.6</span> * p.<span class="hljs-property inline">depth</span>;    <span class="hljs-comment inline">// Opacity: 0.4-1.0</span>

      <span class="hljs-comment inline">// Apply visual changes to DOM element</span>
      p.<span class="hljs-property inline">el</span>.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">transform</span> = <span class="hljs-string inline">`translate(<span class="hljs-subst inline">${p.x}</span>px, <span class="hljs-subst inline">${p.y}</span>px) scale(<span class="hljs-subst inline">${scale}</span>)`</span>;
      p.<span class="hljs-property inline">el</span>.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">opacity</span> = opacity.<span class="hljs-title function_ inline">toString</span>();
    }

    <span class="hljs-comment inline">// Continue animation loop</span>
    animationIdRef.<span class="hljs-property inline">current</span> = <span class="hljs-title function_ inline">requestAnimationFrame</span>(animate);
  }, []);

  <span class="hljs-comment inline">// ==================== Window Resize Handling ====================</span>
  <span class="hljs-comment inline">/**
   * Handle window resize
   * Reinitialize particles to adapt to new screen size
   */</span>
  <span class="hljs-keyword inline">const</span> handleResize = <span class="hljs-title function_ inline">useCallback</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-comment inline">// Reinitialize particle distribution</span>
    <span class="hljs-title function_ inline">initializeParticles</span>();
  }, [initializeParticles]);

  <span class="hljs-comment inline">// Create debounced resize handler (1 second delay)</span>
  <span class="hljs-keyword inline">const</span> debouncedHandleResize = <span class="hljs-title function_ inline">useCallback</span>(
    <span class="hljs-title function_ inline">debounce</span>(handleResize, <span class="hljs-number inline">1000</span>),
    [debounce, handleResize]
  );

  <span class="hljs-comment inline">// ==================== Theme Change Handling ====================</span>
  <span class="hljs-comment inline">/**
   * Handle theme changes
   * Update particle colors when theme switches
   */</span>
  <span class="hljs-title function_ inline">useEffect</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-keyword inline">if</span> (particlesRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">length</span> &gt; <span class="hljs-number inline">0</span>) {
      <span class="hljs-keyword inline">const</span> colors = <span class="hljs-title function_ inline">getThemeColors</span>();
      
      <span class="hljs-comment inline">// Update all particle colors</span>
      particlesRef.<span class="hljs-property inline">current</span>.<span class="hljs-title function_ inline">forEach</span>(<span class="hljs-function inline"><span class="hljs-params inline">p</span> =&gt;</span> {
        p.<span class="hljs-property inline">el</span>.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">backgroundColor</span> = colors.<span class="hljs-property inline">particle</span>;
      });
      
      <span class="hljs-comment inline">// Update container background</span>
      <span class="hljs-keyword inline">if</span> (containerRef.<span class="hljs-property inline">current</span>) {
        containerRef.<span class="hljs-property inline">current</span>.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">background</span> = colors.<span class="hljs-property inline">background</span>;
      }
    }
  }, [currentTheme, getThemeColors]);

  <span class="hljs-comment inline">// ==================== Component Lifecycle ====================</span>
  <span class="hljs-comment inline">/**
   * Component initialization effect
   * Set up particles, events, and start animation
   */</span>
  <span class="hljs-title function_ inline">useEffect</span>(<span class="hljs-function inline">() =&gt;</span> {
    <span class="hljs-comment inline">// Initialize particle system</span>
    <span class="hljs-title function_ inline">initializeParticles</span>();

    <span class="hljs-comment inline">// Start animation loop</span>
    <span class="hljs-title function_ inline">animate</span>();

    <span class="hljs-comment inline">// Add global event listeners</span>
    <span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;mousedown&#x27;</span>, handleMouseDown);
    <span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;mouseup&#x27;</span>, handleMouseUp);
    <span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;mousemove&#x27;</span>, handleMouseMove);

    <span class="hljs-comment inline">// Add resize listener</span>
    <span class="hljs-variable language_ inline">window</span>.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;resize&#x27;</span>, debouncedHandleResize);

    <span class="hljs-comment inline">// Add container touch event listeners</span>
    <span class="hljs-keyword inline">const</span> container = containerRef.<span class="hljs-property inline">current</span>;
    <span class="hljs-keyword inline">if</span> (container) {
      container.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;touchstart&#x27;</span>, handleTouchStart);
      container.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;touchend&#x27;</span>, handleTouchEnd);
      container.<span class="hljs-title function_ inline">addEventListener</span>(<span class="hljs-string inline">&#x27;touchmove&#x27;</span>, handleTouchMove);
    }

    <span class="hljs-comment inline">// Cleanup function</span>
    <span class="hljs-keyword inline">return</span> <span class="hljs-function inline">() =&gt;</span> {
      <span class="hljs-comment inline">// Cancel animation</span>
      <span class="hljs-keyword inline">if</span> (animationIdRef.<span class="hljs-property inline">current</span> !== <span class="hljs-literal inline">null</span>) {
        <span class="hljs-title function_ inline">cancelAnimationFrame</span>(animationIdRef.<span class="hljs-property inline">current</span>);
      }
      
      <span class="hljs-comment inline">// Remove event listeners</span>
      <span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">removeEventListener</span>(<span class="hljs-string inline">&#x27;mousedown&#x27;</span>, handleMouseDown);
      <span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">removeEventListener</span>(<span class="hljs-string inline">&#x27;mouseup&#x27;</span>, handleMouseUp);
      <span class="hljs-variable language_ inline">document</span>.<span class="hljs-title function_ inline">removeEventListener</span>(<span class="hljs-string inline">&#x27;mousemove&#x27;</span>, handleMouseMove);
      <span class="hljs-variable language_ inline">window</span>.<span class="hljs-title function_ inline">removeEventListener</span>(<span class="hljs-string inline">&#x27;resize&#x27;</span>, debouncedHandleResize);
      
      <span class="hljs-keyword inline">if</span> (container) {
        container.<span class="hljs-title function_ inline">removeEventListener</span>(<span class="hljs-string inline">&#x27;touchstart&#x27;</span>, handleTouchStart);
        container.<span class="hljs-title function_ inline">removeEventListener</span>(<span class="hljs-string inline">&#x27;touchend&#x27;</span>, handleTouchEnd);
        container.<span class="hljs-title function_ inline">removeEventListener</span>(<span class="hljs-string inline">&#x27;touchmove&#x27;</span>, handleTouchMove);
      }
      
      <span class="hljs-comment inline">// Clean up all particles</span>
      particlesRef.<span class="hljs-property inline">current</span>.<span class="hljs-title function_ inline">forEach</span>(<span class="hljs-function inline"><span class="hljs-params inline">p</span> =&gt;</span> p.<span class="hljs-property inline">el</span>.<span class="hljs-title function_ inline">remove</span>());
    };
  }, [animate, initializeParticles, debouncedHandleResize, 
      handleMouseDown, handleMouseUp, handleMouseMove,
      handleTouchStart, handleTouchEnd, handleTouchMove]);

  <span class="hljs-comment inline">// ==================== Render ====================</span>
  <span class="hljs-keyword inline">return</span> (
    <span class="language-xml inline"><span class="hljs-tag inline">&lt;<span class="hljs-name inline">div</span>
      <span class="hljs-attr inline">ref</span>=<span class="hljs-string inline">{containerRef}</span>
      <span class="hljs-attr inline">className</span>=<span class="hljs-string inline">&quot;fixed inset-0 w-full h-full overflow-hidden pointer-events-none z-0&quot;</span>
      <span class="hljs-attr inline">style</span>=<span class="hljs-string inline">{{</span>
        <span class="hljs-attr inline">background:</span> <span class="hljs-attr inline">getThemeColors</span>()<span class="hljs-attr inline">.background</span>
      }}
    /&gt;</span></span>
  );
};

<span class="hljs-keyword inline">export</span> <span class="hljs-keyword inline">default</span> <span class="hljs-title class_ inline">FoamBackground</span>;
</code></pre>
            </div>
        
<h3 id="performance-analysis-and-optimization-strategies" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#performance-analysis-and-optimization-strategies" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Performance Analysis and Optimization Strategies">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Performance Analysis and Optimization Strategies
        </h3>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">1. Memory Management</strong></p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20Proper%20cleanup%20prevents%20memory%20leaks%0AparticlesRef.current.forEach(p%20%3D%3E%20p.el.remove())%3B%0AparticlesRef.current%20%3D%20%5B%5D%3B%0A%2F%2F%20Cancel%20animation%20frames%20when%20component%20unmounts%0Aif%20(animationIdRef.current%20!%3D%3D%20null)%20%7B%0AcancelAnimationFrame(animationIdRef.current)%3B%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// Proper cleanup prevents memory leaks</span>
particlesRef.<span class="hljs-property inline">current</span>.<span class="hljs-title function_ inline">forEach</span>(<span class="hljs-function inline"><span class="hljs-params inline">p</span> =&gt;</span> p.<span class="hljs-property inline">el</span>.<span class="hljs-title function_ inline">remove</span>());
particlesRef.<span class="hljs-property inline">current</span> = [];

<span class="hljs-comment inline">// Cancel animation frames when component unmounts</span>
<span class="hljs-keyword inline">if</span> (animationIdRef.<span class="hljs-property inline">current</span> !== <span class="hljs-literal inline">null</span>) {
  <span class="hljs-title function_ inline">cancelAnimationFrame</span>(animationIdRef.<span class="hljs-property inline">current</span>);
}
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">2. Event Optimization</strong></p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20Use%20refs%20for%20high-frequency%20reads%20to%20avoid%20re-renders%0Aconst%20mouseRef%20%3D%20useRefMouseState%3E(%7B%20x%3A%200%2C%20y%3A%200%2C%20down%3A%20false%20%7D)%3B%0A%2F%2F%20Debounce%20resize%20events%20to%20prevent%20excessive%20rebuilds%0Aconst%20debouncedHandleResize%20%3D%20useCallback(%0Adebounce(handleResize%2C%201000)%2C%0A%5Bdebounce%2C%20handleResize%5D%0A)%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// Use refs for high-frequency reads to avoid re-renders</span>
<span class="hljs-keyword inline">const</span> mouseRef = useRef&lt;<span class="hljs-title class_ inline">MouseState</span>&gt;({ <span class="hljs-attr inline">x</span>: <span class="hljs-number inline">0</span>, <span class="hljs-attr inline">y</span>: <span class="hljs-number inline">0</span>, <span class="hljs-attr inline">down</span>: <span class="hljs-literal inline">false</span> });

<span class="hljs-comment inline">// Debounce resize events to prevent excessive rebuilds</span>
<span class="hljs-keyword inline">const</span> debouncedHandleResize = <span class="hljs-title function_ inline">useCallback</span>(
  <span class="hljs-title function_ inline">debounce</span>(handleResize, <span class="hljs-number inline">1000</span>),
  [debounce, handleResize]
);
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">3. DOM Performance</strong></p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20Use%20willChange%20hint%20for%20GPU%20acceleration%0Ael.style.willChange%20%3D%20'transform%2C%20opacity'%3B%0A%2F%2F%20Use%20transform%20instead%20of%20top%2Fleft%20for%20better%20performance%0Ap.el.style.transform%20%3D%20%60translate(%24%7Bp.x%7Dpx%2C%20%24%7Bp.y%7Dpx)%20scale(%24%7Bscale%7D)%60%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// Use willChange hint for GPU acceleration</span>
el.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">willChange</span> = <span class="hljs-string inline">&#x27;transform, opacity&#x27;</span>;

<span class="hljs-comment inline">// Use transform instead of top/left for better performance</span>
p.<span class="hljs-property inline">el</span>.<span class="hljs-property inline">style</span>.<span class="hljs-property inline">transform</span> = <span class="hljs-string inline">`translate(<span class="hljs-subst inline">${p.x}</span>px, <span class="hljs-subst inline">${p.y}</span>px) scale(<span class="hljs-subst inline">${scale}</span>)`</span>;
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">4. Physics Optimization</strong></p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20Limit%20force%20field%20range%20to%20reduce%20calculations%0Aif%20(dist%20100)%20%7B%0Aconst%20baseForce%20%3D%20100%20%2F%20(dist%20%2B%2010)%3B%0A%2F%2F%20Apply%20force%20only%20to%20nearby%20particles%0A%7D">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// Limit force field range to reduce calculations</span>
<span class="hljs-keyword inline">if</span> (dist &lt; <span class="hljs-number inline">100</span>) {
  <span class="hljs-keyword inline">const</span> baseForce = <span class="hljs-number inline">100</span> / (dist + <span class="hljs-number inline">10</span>);
  <span class="hljs-comment inline">// Apply force only to nearby particles</span>
}
</code></pre>
            </div>
        
<h3 id="algorithm-flow-diagram" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#algorithm-flow-diagram" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Algorithm Flow Diagram">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Algorithm Flow Diagram
        </h3>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="" data-code="Initialize%20%E2%86%92%20Create%20Particles%20%E2%86%92%20Start%20Animation%20Loop%0A%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%0ATheme%20Setup%20%20%20DOM%20Creation%20%20%20%20%20%20%20%20Physics%20Update%0A%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%0AColor%20Calc%20%20%20Position%2FSize%20%20%20%20%20%20%20%20%20Force%20Fields%0A%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%0AEvent%20Setup%20%20%20Style%20Applied%20%20%20%20%20%20%20%20Boundary%20Check%0A%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%0AReady%20State%20%20%20Visual%20Setup%20%20%20%20%20%20%20%20%20Render%20Frame%0A%E2%86%93%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%86%93%0AAnimation%20Ready%20%20%20%20%20%20Continue%20Loop">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">code</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code><span class="hljs-built_in inline">Initialize</span> → <span class="hljs-variable inline">Create</span> <span class="hljs-variable inline">Particles</span> → <span class="hljs-variable inline">Start</span> <span class="hljs-variable inline">Animation</span> <span class="hljs-variable inline">Loop</span>
    ↓              ↓                    ↓
<span class="hljs-variable inline">Theme</span> <span class="hljs-variable inline">Setup</span>   <span class="hljs-variable inline">DOM</span> <span class="hljs-variable inline">Creation</span>        <span class="hljs-variable inline">Physics</span> <span class="hljs-built_in inline">Update</span>
    ↓              ↓                    ↓
<span class="hljs-variable inline">Color</span> <span class="hljs-variable inline">Calc</span>   <span class="hljs-built_in inline">Position</span><span class="hljs-operator inline">/</span><span class="hljs-variable inline">Size</span>         <span class="hljs-variable inline">Force</span> <span class="hljs-variable inline">Fields</span>
    ↓              ↓                    ↓
<span class="hljs-variable inline">Event</span> <span class="hljs-variable inline">Setup</span>   <span class="hljs-built_in inline">Style</span> <span class="hljs-variable inline">Applied</span>        <span class="hljs-variable inline">Boundary</span> <span class="hljs-built_in inline">Check</span>
    ↓              ↓                    ↓
<span class="hljs-variable inline">Ready</span> <span class="hljs-variable inline">State</span>   <span class="hljs-variable inline">Visual</span> <span class="hljs-variable inline">Setup</span>         <span class="hljs-variable inline">Render</span> <span class="hljs-built_in inline">Frame</span>
                   ↓                    ↓
              <span class="hljs-variable inline">Animation</span> <span class="hljs-variable inline">Ready</span>      <span class="hljs-built_in inline">Continue</span> <span class="hljs-variable inline">Loop</span>
</code></pre>
            </div>
        
<h3 id="core-mathematical-models" class="group relative text-2xl font-semibold mt-5 mb-2 text-foreground leading-snug">
            <a href="#core-mathematical-models" class="absolute -left-6 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-primary/60 hover:text-primary" aria-label="Link to Core Mathematical Models">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 11.414-1.414 4 4 0 105.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 10-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                </svg>
            </a>
            Core Mathematical Models
        </h3>
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">1. Force Field Physics</strong></p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20Inverse%20square%20law%20force%20calculation%0Aconst%20baseForce%20%3D%20100%20%2F%20(dist%20%2B%2010)%3B%0Aconst%20force%20%3D%20baseForce%20*%20p.depth%3B%0A%2F%2F%20Unit%20vector%20calculation%0Aconst%20unitX%20%3D%20dx%20%2F%20dist%3B%0Aconst%20unitY%20%3D%20dy%20%2F%20dist%3B%0A%2F%2F%20Apply%20force%0Ap.vx%20%2B%3D%20force%20*%20unitX%3B%0Ap.vy%20%2B%3D%20force%20*%20unitY%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// Inverse square law force calculation</span>
<span class="hljs-keyword inline">const</span> baseForce = <span class="hljs-number inline">100</span> / (dist + <span class="hljs-number inline">10</span>);
<span class="hljs-keyword inline">const</span> force = baseForce * p.<span class="hljs-property inline">depth</span>;

<span class="hljs-comment inline">// Unit vector calculation</span>
<span class="hljs-keyword inline">const</span> unitX = dx / dist;
<span class="hljs-keyword inline">const</span> unitY = dy / dist;

<span class="hljs-comment inline">// Apply force</span>
p.<span class="hljs-property inline">vx</span> += force * unitX;
p.<span class="hljs-property inline">vy</span> += force * unitY;
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">2. Depth-Based Layering</strong></p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20Depth%20affects%20multiple%20visual%20properties%0Aconst%20scale%20%3D%200.6%20%2B%200.4%20*%20p.depth%3B%20%20%20%20%20%20%2F%2F%20Size%3A%2060%25-100%25%0Aconst%20opacity%20%3D%200.4%20%2B%200.6%20*%20p.depth%3B%20%20%20%20%2F%2F%20Opacity%3A%2040%25-100%25%0Aconst%20speed%20%3D%200.01%20*%20p.depth%3B%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20Speed%3A%20depth%20proportional">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// Depth affects multiple visual properties</span>
<span class="hljs-keyword inline">const</span> scale = <span class="hljs-number inline">0.6</span> + <span class="hljs-number inline">0.4</span> * p.<span class="hljs-property inline">depth</span>;      <span class="hljs-comment inline">// Size: 60%-100%</span>
<span class="hljs-keyword inline">const</span> opacity = <span class="hljs-number inline">0.4</span> + <span class="hljs-number inline">0.6</span> * p.<span class="hljs-property inline">depth</span>;    <span class="hljs-comment inline">// Opacity: 40%-100%</span>
<span class="hljs-keyword inline">const</span> speed = <span class="hljs-number inline">0.01</span> * p.<span class="hljs-property inline">depth</span>;           <span class="hljs-comment inline">// Speed: depth proportional</span>
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><strong class="font-bold text-foreground">3. Color Space Mathematics</strong></p>

            <div class="enhanced-codeblock relative mb-6 rounded-lg border bg-background border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm" data-enhanced-codeblock="true" data-language="typescript" data-code="%2F%2F%20HSL%20color%20space%20conversion%20for%20theme%20adaptation%0Aconst%20%5Bh%2C%20s%2C%20l%5D%20%3D%20hexToHsl(themeColor)%3B%0A%2F%2F%20Dark%20theme%3A%20%2Bsaturation%2C%20-lightness%0Aconst%20darkColor%20%3D%20%60hsl(%24%7Bh%7D%2C%20%24%7Bs%20%2B%2015%7D%25%2C%20%24%7Bl%20-%2020%7D%25)%60%3B%0A%2F%2F%20Light%20theme%3A%20-saturation%2C%20%2Blightness%0Aconst%20lightColor%20%3D%20%60hsl(%24%7Bh%7D%2C%20%24%7Bs%20-%2010%7D%25%2C%20%24%7Bl%20%2B%2020%7D%25)%60%3B">
                <div class="codeblock-header flex items-center justify-between px-4 py-2 bg-surface border-b border-gray-200 dark:border-gray-700">
                    <span class="codeblock-language text-xs font-medium uppercase tracking-wide text-foreground opacity-70 inline">typescript</span>
                    <button class="codeblock-copy-btn inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium border rounded transition-all duration-200 bg-background hover:bg-surface text-foreground hover:text-primary border-gray-300 dark:border-gray-600 hover:scale-105 active:scale-95" title="Copy code">
                        <svg class="copy-icon w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                        </svg>
                        <svg class="copied-icon w-4 h-4 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="copy-text inline">Copy</span>
                    </button>
                </div>
                <pre class="codeblock-content p-4 overflow-x-auto font-mono text-sm leading-relaxed bg-surface text-foreground"><code class="language-typescript"><span class="hljs-comment inline">// HSL color space conversion for theme adaptation</span>
<span class="hljs-keyword inline">const</span> [h, s, l] = <span class="hljs-title function_ inline">hexToHsl</span>(themeColor);

<span class="hljs-comment inline">// Dark theme: +saturation, -lightness</span>
<span class="hljs-keyword inline">const</span> darkColor = <span class="hljs-string inline">`hsl(<span class="hljs-subst inline">${h}</span>, <span class="hljs-subst inline">${s + <span class="hljs-number inline">15</span>}</span>%, <span class="hljs-subst inline">${l - <span class="hljs-number inline">20</span>}</span>%)`</span>;

<span class="hljs-comment inline">// Light theme: -saturation, +lightness  </span>
<span class="hljs-keyword inline">const</span> lightColor = <span class="hljs-string inline">`hsl(<span class="hljs-subst inline">${h}</span>, <span class="hljs-subst inline">${s - <span class="hljs-number inline">10</span>}</span>%, <span class="hljs-subst inline">${l + <span class="hljs-number inline">20</span>}</span>%)`</span>;
</code></pre>
            </div>
        
<p class="text-base leading-7 mb-4 text-foreground"><em class="italic text-foreground">May your particles shine like stardust, light as foam, dancing gracefully at users’ fingertips.</em> ✨</p>
d:["$","$L1d",null,{"htmlContent":"$1e","frontMatter":{"title":"Foam Background: From Canvas Thinking to DOM Implementation of a Particle World","description":"Detailed analysis of foam background particle system implementation principles, from mathematical foundations to interaction optimization","date":"2025-06-22","author":"MilkWind","tags":["Canvas","Interaction Design"],"references":{}},"readingTime":"26 min read","category":"personal-website","tocItems":[{"id":"foam-background-from-canvas-thinking-to-dom-implementation-of-a-particle-world","text":"Foam Background: From Canvas Thinking to DOM Implementation of a Particle World","level":1},{"id":"translating-canvas-thinking-into-the-dom-world","text":"Translating Canvas Thinking into the DOM World","level":2},{"id":"canvas-vs-dom-a-philosophical-choice","text":"Canvas vs DOM: A Philosophical Choice","level":3},{"id":"the-art-of-creating-dom-particles","text":"The Art of Creating DOM Particles","level":3},{"id":"coordinate-system-mapping","text":"Coordinate System Mapping","level":3},{"id":"particle-lifecycle-data-architecture","text":"Particle Lifecycle & Data Architecture","level":2},{"id":"particle-interface-design","text":"Particle Interface Design","level":3},{"id":"particle-initialization-randomization-strategy","text":"Particle Initialization Randomization Strategy","level":3},{"id":"animation-loop-time-precision-control","text":"Animation Loop Time Precision Control","level":3},{"id":"the-physics-world-of-interaction-systems","text":"The Physics World of Interaction Systems","level":2},{"id":"complete-lifecycle-management-of-mouse-events","text":"Complete Lifecycle Management of Mouse Events","level":3},{"id":"mathematical-principles-of-force-field-calculation","text":"Mathematical Principles of Force Field Calculation","level":3},{"id":"multi-touch-support","text":"Multi-touch Support","level":3},{"id":"friction-simulation","text":"Friction Simulation","level":3},{"id":"color-mixing-in-theme-systems","text":"Color Mixing in Theme Systems","level":2},{"id":"hsl-color-space","text":"HSL Color Space","level":3},{"id":"dynamic-generation-strategy-for-theme-response","text":"Dynamic Generation Strategy for Theme Response","level":3},{"id":"real-time-updates-of-dynamic-colors","text":"Real-time Updates of Dynamic Colors","level":3},{"id":"depth-mathematical-model","text":"Depth Mathematical Model","level":3},{"id":"parallax-motion-simulation","text":"Parallax Motion Simulation","level":3},{"id":"particle-redistribution-in-responsive-layout","text":"Particle Redistribution in Responsive Layout","level":2},{"id":"window-size-change-monitoring-strategy","text":"Window Size Change Monitoring Strategy","level":3},{"id":"memory-safety-of-particle-cleanup","text":"Memory Safety of Particle Cleanup","level":3},{"id":"necessity-of-debouncing","text":"Necessity of Debouncing","level":3},{"id":"key-performance-optimization-strategies","text":"Key Performance Optimization Strategies","level":2},{"id":"proper-use-of-willchange-property","text":"Proper Use of willChange Property","level":3},{"id":"requestanimationframe-lifecycle-management","text":"requestAnimationFrame Lifecycle Management","level":3},{"id":"z-index-strategy-for-layer-management","text":"z-index Strategy for Layer Management","level":3},{"id":"edge-cases-in-event-handling","text":"Edge Cases in Event Handling","level":2},{"id":"special-handling-for-touch-devices","text":"Special Handling for Touch Devices","level":3},{"id":"event-listener-scope-control","text":"Event Listener Scope Control","level":3},{"id":"reusable-design-pattern-summary","text":"Reusable Design Pattern Summary","level":2},{"id":"universal-architecture-for-particle-systems","text":"Universal Architecture for Particle Systems","level":3},{"id":"basic-patterns-for-physics-simulation","text":"Basic Patterns for Physics Simulation","level":3},{"id":"design-patterns-for-theme-response","text":"Design Patterns for Theme Response","level":3},{"id":"responsive-particle-layout-pattern","text":"Responsive Particle Layout Pattern","level":3},{"id":"performance-optimization-best-practices","text":"Performance Optimization Best Practices","level":3},{"id":"implementation-review","text":"Implementation Review","level":2},{"id":"complete-implementation-source-code","text":"Complete Implementation Source Code","level":2},{"id":"performance-analysis-and-optimization-strategies","text":"Performance Analysis and Optimization Strategies","level":3},{"id":"algorithm-flow-diagram","text":"Algorithm Flow Diagram","level":3},{"id":"core-mathematical-models","text":"Core Mathematical Models","level":3}],"translations":{"common":{"welcome":"Welcome","loading":"Loading...","error":"Something went wrong","retry":"Try again","theme":"Theme","language":"Language","light":"Light","dark":"Dark"},"navigation":{"home":"Home","personal":"Personal","works":"Works","contributions":"Contributions","documents":"Documents","about":"About","contact":"Contact"},"personal":{"technicalSkills":"Technical Skills","email":"Email","github":"GitHub","resume":"Resume","codeRepository":"Code Repository","loadingPersonalInfo":"Loading personal information...","loadingResume":"Loading resume...","closeResume":"Close Resume","emailCopied":"Email copied to clipboard!","galaxyDefaultDescription":"Expert in full-stack development, cross-platform architecture, AI technology integration, and high-performance system optimization","skillGalaxy":"Skill Galaxy","stirGalaxy":"Stir Galaxy","stirring":"Stirring...","fullStackEngineer":"MilkWind - Full Stack Engineer","professionalProfile":"About Me"},"documents":{"technicalDocuments":"Technical Documents","description":"Basic principles, code splitting, and some random thoughts.","articles":"Articles","categories":"Categories","allCategories":"All Categories","noArticlesFound":"No articles found","noArticlesAvailable":"No articles available in English.","noArticlesInCategory":"No articles found in the category.","readMore":"Read more","loadingDocuments":"Loading documents...","backToDocuments":"← Back to Documents","documentNotFound":"Document Not Found","documentNotFoundDescription":"The requested document could not be found.","technicalInsights":"Insights","untitledDocument":"Untitled Document","byAuthor":"By","search":"Search articles...","searchByTags":"Filter by tags","searching":"Searching...","noSearchResults":"No articles match your search criteria","clearSearch":"Clear search","selectedTags":"Selected tags","allTags":"All tags","searchInTitle":"Search in titles, descriptions, and content","enterImmersiveMode":"Immersive Reading","exitImmersiveMode":"Exit Immersive Mode","immersiveReading":"Immersive Reading Mode","exploreContent":"Explore content by category","browseBy":"Browse by","exploreAll":"All content in one place","categoryDescription":"Articles in this category","totalArticles":"Articles","totalCategories":"Categories","foundArticles":"Found articles","categoriesWithResults":"Categories with results"},"works":{"workCases":"Work Cases","projects":"Portfolio","loadingProjects":"Loading projects...","grid":"Grid","stack":"Stack","of":"of","workCasesPageTitle":"Work Cases Page","pageWorkingCorrectly":"This page is working! The routing is correct.","try3DVersion":"Try 3D Version","dragToScroll":"Drag to scroll","dragToChange":"Drag to change","swipeCards":"Swipe cards","keyboardNav":"Keyboard navigation"},"contributions":{"contributionCases":"Open Source","contributions":"Contributions","loadingContributions":"Loading contributions...","grid":"Grid","stack":"Stack","of":"of","contributionCasesPageTitle":"Contribution Cases Page","pageWorkingCorrectly":"This page is working! The routing is correct.","try3DVersion":"Try 3D Version","dragToScroll":"Drag to scroll","dragToChange":"Drag to change","swipeCards":"Swipe cards","keyboardNav":"Keyboard navigation"},"contribution":{"contributionPreview":"Contribution Preview","accessible":"Accessible","code":"Code","maintenance":"Maintenance","enhancement":"Enhancement","documentation":"Documentation","community":"Community","moreItems":"more","technicalDetails":"Technical Details","technologies":"Technologies:","contributionDetail":"Contribution Detail","description":"Description:","seeDetails":"See Details","github":"GitHub","viewContribution":"View Contribution","viewCode":"View Code"},"project":{"projectPreview":"Project Preview","accessible":"Accessible","tool":"Tool","plugin":"Plugin","toy":"Toy","moreItems":"more","technicalDetails":"Technical Details","technologies":"Technologies:","description":"Description:","seeDetails":"See Details","github":"GitHub","gitee":"Gitee","viewLiveDemo":"View Live Demo","viewCode":"View Code","access":"Access","videos":"Videos","watchVideo":"Watch Video","hasVideo":"Has Video"},"codeblock":{"copy":"Copy","copySuccess":"Code copied to clipboard!","copyError":"Failed to copy code","copyTooltip":"Copy code"},"toc":{"contents":"Contents","autoScroll":"Auto-scroll to section","collapse":"Collapse","expand":"Expand"},"loading":{"loading":"LOADING","preparingExperience":"Preparing experience"}},"lang":"en","theme":"dark"}]
12:null
18:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
11:null
1c:{"metadata":[["$","title","0",{"children":"Foam Background: From Canvas Thinking to DOM Implementation of a Particle World | Interactive Portfolio"}],["$","meta","1",{"name":"description","content":"Detailed analysis of foam background particle system implementation principles, from mathematical foundations to interaction optimization"}],["$","meta","2",{"name":"author","content":"Developer"}],["$","meta","3",{"name":"keywords","content":"portfolio,3D,interactive,web development,Three.js,Next.js"}],["$","meta","4",{"property":"og:title","content":"Foam Background: From Canvas Thinking to DOM Implementation of a Particle World | Interactive Portfolio"}],["$","meta","5",{"property":"og:description","content":"Detailed analysis of foam background particle system implementation principles, from mathematical foundations to interaction optimization"}],["$","meta","6",{"property":"og:type","content":"article"}],["$","meta","7",{"property":"article:published_time","content":"2025-06-22"}],["$","meta","8",{"property":"article:tag","content":"Canvas"}],["$","meta","9",{"property":"article:tag","content":"Interaction Design"}],["$","meta","10",{"name":"twitter:card","content":"summary_large_image"}],["$","meta","11",{"name":"twitter:title","content":"Foam Background: From Canvas Thinking to DOM Implementation of a Particle World | Interactive Portfolio"}],["$","meta","12",{"name":"twitter:description","content":"Detailed analysis of foam background particle system implementation principles, from mathematical foundations to interaction optimization"}],["$","link","13",{"rel":"icon","href":"/MilkWind-Website/favicon.ico","type":"image/x-icon","sizes":"32x32"}]],"error":null,"digest":"$undefined"}
14:{"metadata":"$1c:metadata","error":null,"digest":"$undefined"}
